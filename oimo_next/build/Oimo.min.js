!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).OIMO={})}(this,(function(t){"use strict";var i=function(t){var i,a=Object.prototype,n=a.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",r=o.asyncIterator||"@@asyncIterator",e=o.toStringTag||"@@toStringTag";function _(t,i,a){return Object.defineProperty(t,i,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[i]}try{_({},"")}catch(t){_=function(t,i,a){return t[i]=a}}function h(t,i,a,n){var o=i&&i.prototype instanceof u?i:u,s=Object.create(o.prototype),r=new V(n||[]);return s._invoke=function(t,i,a){var n=c;return function(o,s){if(n===v)throw new Error("Generator is already running");if(n===b){if("throw"===o)throw s;return L()}for(a.method=o,a.arg=s;;){var r=a.delegate;if(r){var e=Z(r,a);if(e){if(e===f)continue;return e}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(n===c)throw n=b,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);n=v;var _=l(t,i,a);if("normal"===_.type){if(n=a.done?b:m,_.arg===f)continue;return{value:_.arg,done:a.done}}"throw"===_.type&&(n=b,a.method="throw",a.arg=_.arg)}}}(t,a,r),s}function l(t,i,a){try{return{type:"normal",arg:t.call(i,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var c="suspendedStart",m="suspendedYield",v="executing",b="completed",f={};function u(){}function p(){}function x(){}var y={};y[s]=function(){return this};var d=Object.getPrototypeOf,g=d&&d(d(w([])));g&&g!==a&&n.call(g,s)&&(y=g);var X=x.prototype=u.prototype=Object.create(y);function Y(t){["next","throw","return"].forEach((function(i){_(t,i,(function(t){return this._invoke(i,t)}))}))}function z(t,i){function a(o,s,r,e){var _=l(t[o],t,s);if("throw"!==_.type){var h=_.arg,c=h.value;return c&&"object"==typeof c&&n.call(c,"__await")?i.resolve(c.__await).then((function(t){a("next",t,r,e)}),(function(t){a("throw",t,r,e)})):i.resolve(c).then((function(t){h.value=t,r(h)}),(function(t){return a("throw",t,r,e)}))}e(_.arg)}var o;this._invoke=function(t,n){function s(){return new i((function(i,o){a(t,n,i,o)}))}return o=o?o.then(s,s):s()}}function Z(t,a){var n=t.iterator[a.method];if(n===i){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=i,Z(t,a),"throw"===a.method))return f;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var o=l(n,t.iterator,a.arg);if("throw"===o.type)return a.method="throw",a.arg=o.arg,a.delegate=null,f;var s=o.arg;return s?s.done?(a[t.resultName]=s.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=i),a.delegate=null,f):s:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,f)}function M(t){var i={tryLoc:t[0]};1 in t&&(i.catchLoc=t[1]),2 in t&&(i.finallyLoc=t[2],i.afterLoc=t[3]),this.tryEntries.push(i)}function I(t){var i=t.completion||{};i.type="normal",delete i.arg,t.completion=i}function V(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function w(t){if(t){var a=t[s];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,r=function a(){for(;++o<t.length;)if(n.call(t,o))return a.value=t[o],a.done=!1,a;return a.value=i,a.done=!0,a};return r.next=r}}return{next:L}}function L(){return{value:i,done:!0}}return p.prototype=X.constructor=x,x.constructor=p,p.displayName=_(x,e,"GeneratorFunction"),t.isGeneratorFunction=function(t){var i="function"==typeof t&&t.constructor;return!!i&&(i===p||"GeneratorFunction"===(i.displayName||i.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,_(t,e,"GeneratorFunction")),t.prototype=Object.create(X),t},t.awrap=function(t){return{__await:t}},Y(z.prototype),z.prototype[r]=function(){return this},t.AsyncIterator=z,t.async=function(i,a,n,o,s){void 0===s&&(s=Promise);var r=new z(h(i,a,n,o),s);return t.isGeneratorFunction(a)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},Y(X),_(X,e,"Generator"),X[s]=function(){return this},X.toString=function(){return"[object Generator]"},t.keys=function(t){var i=[];for(var a in t)i.push(a);return i.reverse(),function a(){for(;i.length;){var n=i.pop();if(n in t)return a.value=n,a.done=!1,a}return a.done=!0,a}},t.values=w,V.prototype={constructor:V,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(I),!t)for(var a in this)"t"===a.charAt(0)&&n.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=i)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var a=this;function o(n,o){return e.type="throw",e.arg=t,a.next=n,o&&(a.method="next",a.arg=i),!!o}for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s],e=r.completion;if("root"===r.tryLoc)return o("end");if(r.tryLoc<=this.prev){var _=n.call(r,"catchLoc"),h=n.call(r,"finallyLoc");if(_&&h){if(this.prev<r.catchLoc)return o(r.catchLoc,!0);if(this.prev<r.finallyLoc)return o(r.finallyLoc)}else if(_){if(this.prev<r.catchLoc)return o(r.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return o(r.finallyLoc)}}}},abrupt:function(t,i){for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=i&&i<=s.finallyLoc&&(s=null);var r=s?s.completion:{};return r.type=t,r.arg=i,s?(this.method="next",this.next=s.finallyLoc,f):this.complete(r)},complete:function(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),f},finish:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),I(a),f}},catch:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc===t){var n=a.completion;if("throw"===n.type){var o=n.arg;I(a)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,a,n){return this.delegate={iterator:w(t),resultName:a,nextLoc:n},"next"===this.method&&(this.arg=i),f}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}function a(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,n(t,i)}function n(t,i){return(n=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var s="undefined"==typeof performance?Date:performance,r={};r.collision||(r.collision={}),r.collision.broadphase||(r.collision.broadphase={}),r.collision.broadphase.BroadPhase=function(){function t(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new r.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new r.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new r.common.Transform,this.zero=new r.common.Vec3,this.rayCastHit=new r.collision.geometry.RayCastHit}var i=t.prototype;return i.createProxy=function(t,i){return null},i.destroyProxy=function(t){},i.moveProxy=function(t,i,a){},i.isOverlapping=function(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ},i.collectPairs=function(){},i.getProxyPairList=function(){return this._proxyPairList},i.isIncremental=function(){return this._incremental},i.getTestCount=function(){return this._testCount},i.rayCast=function(t,i,a){},i.convexCast=function(t,i,a,n){},i.aabbTest=function(t,i){},t}(),r.collision.geometry||(r.collision.geometry={}),r.collision.geometry.Geometry=function(){function t(t){this._type=t,this._volume=0}var i=t.prototype;return i._updateMass=function(){},i._computeAabb=function(t,i){},i._rayCastLocal=function(t,i,a,n,o,s,r){return!1},i.getType=function(){return this._type},i.getVolume=function(){return this._volume},i.rayCast=function(t,i,a,n){var o,s,r,e,_,h,l,c,m,v,b,f;if(o=t.x,s=t.y,r=t.z,e=i.x,_=i.y,h=i.z,o-=a._positionX,s-=a._positionY,r-=a._positionZ,e-=a._positionX,_-=a._positionY,h-=a._positionZ,l=a._rotation00*o+a._rotation10*s+a._rotation20*r,c=a._rotation01*o+a._rotation11*s+a._rotation21*r,m=a._rotation02*o+a._rotation12*s+a._rotation22*r,o=l,s=c,r=m,v=a._rotation00*e+a._rotation10*_+a._rotation20*h,b=a._rotation01*e+a._rotation11*_+a._rotation21*h,f=a._rotation02*e+a._rotation12*_+a._rotation22*h,e=v,_=b,h=f,this._rayCastLocal(o,s,r,e,_,h,n)){var u,p,x,y,d,g,X=n.position;u=X.x,p=X.y,x=X.z;var Y,z,Z,M,I,V,w=n.normal;y=w.x,d=w.y,g=w.z,Y=a._rotation00*u+a._rotation01*p+a._rotation02*x,z=a._rotation10*u+a._rotation11*p+a._rotation12*x,Z=a._rotation20*u+a._rotation21*p+a._rotation22*x,u=Y,p=z,x=Z,M=a._rotation00*y+a._rotation01*d+a._rotation02*g,I=a._rotation10*y+a._rotation11*d+a._rotation12*g,V=a._rotation20*y+a._rotation21*d+a._rotation22*g,y=M,d=I,g=V,u+=a._positionX,p+=a._positionY,x+=a._positionZ;var L=n.position;L.x=u,L.y=p,L.z=x;var k=n.normal;return k.x=y,k.y=d,k.z=g,!0}return!1},t}(),r.collision.geometry.ConvexGeometry=function(t){function i(i){var a;return(a=t.call(this,i)||this)._gjkMargin=r.common.Setting.defaultGJKMargin,a._useGjkRayCast=!1,a}a(i,t);var n=i.prototype;return n.getGjkMergin=function(){return this._gjkMargin},n.setGjkMergin=function(t){t<0&&(t=0),this._gjkMargin=t},n.computeLocalSupportingVertex=function(t,i){},n.rayCast=function(i,a,n,o){return this._useGjkRayCast?r.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,n,i,a,o):t.prototype.rayCast.call(this,i,a,n,o)},i}(r.collision.geometry.Geometry),r.collision.broadphase._BroadPhase||(r.collision.broadphase._BroadPhase={}),r.collision.broadphase._BroadPhase.ConvexSweepGeometry=function(t){function i(){return t.call(this,-1)||this}a(i,t);var n=i.prototype;return n.init=function(t,i,a){var n,o,s,e,_,h;this.c=t,n=a.x,o=a.y,s=a.z,e=i._rotation00*n+i._rotation10*o+i._rotation20*s,_=i._rotation01*n+i._rotation11*o+i._rotation21*s,h=i._rotation02*n+i._rotation12*o+i._rotation22*s,this.localTranslation=new r.common.Vec3;var l=this.localTranslation;l.x=e,l.y=_,l.z=h,this._gjkMargin=t._gjkMargin},n.computeLocalSupportingVertex=function(t,i){this.c.computeLocalSupportingVertex(t,i);var a=this.localTranslation;if(t.x*a.x+t.y*a.y+t.z*a.z>0){var n=this.localTranslation;i.x+=n.x,i.y+=n.y,i.z+=n.z}},i}(r.collision.geometry.ConvexGeometry),r.collision.broadphase._BroadPhase.AabbGeometry=function(t){function i(){var i;return(i=t.call(this,-1)||this).min=new r.common.Vec3,i.max=new r.common.Vec3,i}return a(i,t),i.prototype.computeLocalSupportingVertex=function(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z},i}(r.collision.geometry.ConvexGeometry),r.collision.broadphase.BroadPhaseProxyCallback=function(){function t(){}return t.prototype.process=function(t){},t}(),r.collision.broadphase.BroadPhaseType=function(){},r.collision.broadphase.Proxy=function(){function t(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}var i=t.prototype;return i.getId=function(){return this._id},i.getFatAabb=function(){var t=new r.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t},i.getFatAabbTo=function(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ},t}(),r.collision.broadphase.ProxyPair=function(){function t(){this._p1=null,this._p2=null}var i=t.prototype;return i.getProxy1=function(){return this._p1},i.getProxy2=function(){return this._p2},i.getNext=function(){return this._next},t}(),r.collision.broadphase.bruteforce||(r.collision.broadphase.bruteforce={}),r.collision.broadphase.bruteforce.BruteForceBroadPhase=function(t){function i(){var i;return(i=t.call(this,1)||this)._incremental=!1,i}a(i,t);var n=i.prototype;return n.createProxy=function(t,i){var a=new r.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ,a},n.destroyProxy=function(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null},n.moveProxy=function(t,i,a){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ},n.collectPairs=function(){var t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,null!=(t=t._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var i=this._proxyList;null!=i;){for(var a=i._next,n=i._next;null!=n;){var o=n._next;if(this._testCount++,i._aabbMinX<n._aabbMaxX&&i._aabbMaxX>n._aabbMinX&&i._aabbMinY<n._aabbMaxY&&i._aabbMaxY>n._aabbMinY&&i._aabbMinZ<n._aabbMaxZ&&i._aabbMaxZ>n._aabbMinZ){var s=this._proxyPairPool;null!=s?(this._proxyPairPool=s._next,s._next=null):s=new r.collision.broadphase.ProxyPair;var e=s;null==this._proxyPairList||(e._next=this._proxyPairList),this._proxyPairList=e,e._p1=i,e._p2=n}n=o}i=a}},n.rayCast=function(t,i,a){var n,o,s,r,e,_;n=t.x,o=t.y,s=t.z,r=i.x,e=i.y,_=i.z;for(var h=this._proxyList;null!=h;){var l=h._next,c=n,m=o,v=s,b=r,f=e,u=_,p=h._aabbMinX,x=h._aabbMinY,y=h._aabbMinZ,d=h._aabbMaxX,g=h._aabbMaxY,X=h._aabbMaxZ,Y=void 0;if(p>(c>b?c:b)||d<(c<b?c:b)||x>(m>f?m:f)||g<(m<f?m:f)||y>(v>u?v:u)||X<(v<u?v:u))Y=!1;else{var z=b-c,Z=f-m,M=u-v,I=z<0?-z:z,V=Z<0?-Z:Z,w=M<0?-M:M,L=.5*(d-p),k=.5*(g-x),A=.5*(X-y),B=c-.5*(d+p),P=m-.5*(g+x),S=v-.5*(X+y),T=void 0,C=void 0,j=P*M-S*Z;if((j<0?-j:j)-(k*w+A*V)>0)C=!0;else{var R=S*z-B*M;C=(R<0?-R:R)-(A*I+L*w)>0}if(C)T=!0;else{var E=B*Z-P*z;T=(E<0?-E:E)-(L*V+k*I)>0}Y=!T}Y&&a.process(h),h=l}},n.convexCast=function(t,i,a,n){for(var o=this._proxyList;null!=o;){var s=o._next,e=this._aabb.min;e.x=o._aabbMinX,e.y=o._aabbMinY,e.z=o._aabbMinZ;var _=this._aabb.max;_.x=o._aabbMaxX,_.y=o._aabbMaxY,_.z=o._aabbMaxZ,this._convexSweep.init(t,i,a);var h=r.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==h.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)&&h.distance<=0&&n.process(o),o=s}},n.aabbTest=function(t,i){for(var a=this._proxyList;null!=a;){var n=a._next;t._minX<a._aabbMaxX&&t._maxX>a._aabbMinX&&t._minY<a._aabbMaxY&&t._maxY>a._aabbMinY&&t._minZ<a._aabbMaxZ&&t._maxZ>a._aabbMinZ&&i.process(a),a=n}},i}(r.collision.broadphase.BroadPhase),r.collision.broadphase.bvh||(r.collision.broadphase.bvh={}),r.collision.broadphase.bvh.BvhBroadPhase=function(t){function i(){var i;return(i=t.call(this,2)||this)._incremental=!0,i._tree=new r.collision.broadphase.bvh.BvhTree,i.movedProxies=new Array(1024),i.numMovedProxies=0,i}a(i,t);var n=i.prototype;return n.collide=function(t,i){this._testCount++;var a=0==t._height,n=0==i._height;if(t==i){if(a)return;return this.collide(t._children[0],i),void this.collide(t._children[1],i)}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(a&&n){var o=this._proxyPairPool;null!=o?(this._proxyPairPool=o._next,o._next=null):o=new r.collision.broadphase.ProxyPair;var s=o;return null==this._proxyPairList||(s._next=this._proxyPairList),this._proxyPairList=s,s._p1=t._proxy,void(s._p2=i._proxy)}n||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}},n.rayCastRecursive=function(t,i,a,n,o,s,r,e){var _,h=i,l=a,c=n,m=o,v=s,b=r,f=t._aabbMinX,u=t._aabbMinY,p=t._aabbMinZ,x=t._aabbMaxX,y=t._aabbMaxY,d=t._aabbMaxZ;if(f>(h>m?h:m)||x<(h<m?h:m)||u>(l>v?l:v)||y<(l<v?l:v)||p>(c>b?c:b)||d<(c<b?c:b))_=!1;else{var g,X,Y=m-h,z=v-l,Z=b-c,M=Y<0?-Y:Y,I=z<0?-z:z,V=Z<0?-Z:Z,w=.5*(x-f),L=.5*(y-u),k=.5*(d-p),A=h-.5*(x+f),B=l-.5*(y+u),P=c-.5*(d+p),S=B*Z-P*z;if((S<0?-S:S)-(L*V+k*I)>0)X=!0;else{var T=P*Y-A*Z;X=(T<0?-T:T)-(k*M+w*V)>0}if(X)g=!0;else{var C=A*z-B*Y;g=(C<0?-C:C)-(w*I+L*M)>0}_=!g}_&&(0!=t._height?(this.rayCastRecursive(t._children[0],i,a,n,o,s,r,e),this.rayCastRecursive(t._children[1],i,a,n,o,s,r,e)):e.process(t._proxy))},n.convexCastRecursive=function(t,i,a,n,o){var s=this._aabb.min;s.x=t._aabbMinX,s.y=t._aabbMinY,s.z=t._aabbMinZ;var e=this._aabb.max;e.x=t._aabbMaxX,e.y=t._aabbMaxY,e.z=t._aabbMaxZ,this._convexSweep.init(i,a,n);var _=r.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==_.computeClosestPointsImpl(this._convexSweep,this._aabb,a,this.identity,null,!1)&&_.distance<=0&&(0!=t._height?(this.convexCastRecursive(t._children[0],i,a,n,o),this.convexCastRecursive(t._children[1],i,a,n,o)):o.process(t._proxy))},n.aabbTestRecursive=function(t,i,a){t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ&&(0!=t._height?(this.aabbTestRecursive(t._children[0],i,a),this.aabbTestRecursive(t._children[1],i,a)):a.process(t._proxy))},n.createProxy=function(t,i){var a=new r.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ;var n=r.common.Setting.bvhProxyPadding;a._aabbMinX-=n,a._aabbMinY-=n,a._aabbMinZ-=n,a._aabbMaxX+=n,a._aabbMaxY+=n,a._aabbMaxZ+=n;var o=this._tree,s=o._nodePool;null!=s?(o._nodePool=s._next,s._next=null):s=new r.collision.broadphase.bvh.BvhNode;var e=s;if(e._proxy=a,a._leaf=e,e._aabbMinX=a._aabbMinX,e._aabbMinY=a._aabbMinY,e._aabbMinZ=a._aabbMinZ,e._aabbMaxX=a._aabbMaxX,e._aabbMaxY=a._aabbMaxY,e._aabbMaxZ=a._aabbMaxZ,o._numLeaves++,null==o.leafList?(o.leafList=e,o.leafListLast=e):(o.leafListLast._nextLeaf=e,e._prevLeaf=o.leafListLast,o.leafListLast=e),null==o._root)o._root=e;else{for(var _=o._root;_._height>0;){var h=o._strategy._decideInsertion(_,e);if(-1==h)break;_=_._children[h]}var l=_._parent,c=o._nodePool;null!=c?(o._nodePool=c._next,c._next=null):c=new r.collision.broadphase.bvh.BvhNode;var m=c;if(null==l)o._root=m;else{var v=_._childIndex;l._children[v]=m,m._parent=l,m._childIndex=v}var b=_._childIndex;m._children[b]=_,_._parent=m,_._childIndex=b;var f=1^_._childIndex;for(m._children[f]=e,e._parent=m,e._childIndex=f;null!=m;){if(o._strategy._balancingEnabled&&m._height>=2){var u=m._parent,p=m._children[0],x=m._children[1],y=p._height-x._height,d=m._childIndex;if(y>1){var g=p._children[0],X=p._children[1];if(g._height>X._height){p._children[1]=m,m._parent=p,m._childIndex=1,m._children[0]=X,X._parent=m,X._childIndex=0;var Y=p._children[0],z=p._children[1];p._aabbMinX=Y._aabbMinX<z._aabbMinX?Y._aabbMinX:z._aabbMinX,p._aabbMinY=Y._aabbMinY<z._aabbMinY?Y._aabbMinY:z._aabbMinY,p._aabbMinZ=Y._aabbMinZ<z._aabbMinZ?Y._aabbMinZ:z._aabbMinZ,p._aabbMaxX=Y._aabbMaxX>z._aabbMaxX?Y._aabbMaxX:z._aabbMaxX,p._aabbMaxY=Y._aabbMaxY>z._aabbMaxY?Y._aabbMaxY:z._aabbMaxY,p._aabbMaxZ=Y._aabbMaxZ>z._aabbMaxZ?Y._aabbMaxZ:z._aabbMaxZ;var Z=p._children[0]._height,M=p._children[1]._height;p._height=(Z>M?Z:M)+1;var I=m._children[0],V=m._children[1];m._aabbMinX=I._aabbMinX<V._aabbMinX?I._aabbMinX:V._aabbMinX,m._aabbMinY=I._aabbMinY<V._aabbMinY?I._aabbMinY:V._aabbMinY,m._aabbMinZ=I._aabbMinZ<V._aabbMinZ?I._aabbMinZ:V._aabbMinZ,m._aabbMaxX=I._aabbMaxX>V._aabbMaxX?I._aabbMaxX:V._aabbMaxX,m._aabbMaxY=I._aabbMaxY>V._aabbMaxY?I._aabbMaxY:V._aabbMaxY,m._aabbMaxZ=I._aabbMaxZ>V._aabbMaxZ?I._aabbMaxZ:V._aabbMaxZ;var w=m._children[0]._height,L=m._children[1]._height;m._height=(w>L?w:L)+1}else{p._children[0]=m,m._parent=p,m._childIndex=0,m._children[0]=g,g._parent=m,g._childIndex=0;var k=p._children[0],A=p._children[1];p._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,p._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,p._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,p._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,p._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,p._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;var B=p._children[0]._height,P=p._children[1]._height;p._height=(B>P?B:P)+1;var S=m._children[0],T=m._children[1];m._aabbMinX=S._aabbMinX<T._aabbMinX?S._aabbMinX:T._aabbMinX,m._aabbMinY=S._aabbMinY<T._aabbMinY?S._aabbMinY:T._aabbMinY,m._aabbMinZ=S._aabbMinZ<T._aabbMinZ?S._aabbMinZ:T._aabbMinZ,m._aabbMaxX=S._aabbMaxX>T._aabbMaxX?S._aabbMaxX:T._aabbMaxX,m._aabbMaxY=S._aabbMaxY>T._aabbMaxY?S._aabbMaxY:T._aabbMaxY,m._aabbMaxZ=S._aabbMaxZ>T._aabbMaxZ?S._aabbMaxZ:T._aabbMaxZ;var C=m._children[0]._height,j=m._children[1]._height;m._height=(C>j?C:j)+1}null!=u?(u._children[d]=p,p._parent=u,p._childIndex=d):(o._root=p,p._parent=null),m=p}else if(y<-1){var R=x._children[0],E=x._children[1];if(R._height>E._height){x._children[1]=m,m._parent=x,m._childIndex=1,m._children[1]=E,E._parent=m,E._childIndex=1;var q=x._children[0],D=x._children[1];x._aabbMinX=q._aabbMinX<D._aabbMinX?q._aabbMinX:D._aabbMinX,x._aabbMinY=q._aabbMinY<D._aabbMinY?q._aabbMinY:D._aabbMinY,x._aabbMinZ=q._aabbMinZ<D._aabbMinZ?q._aabbMinZ:D._aabbMinZ,x._aabbMaxX=q._aabbMaxX>D._aabbMaxX?q._aabbMaxX:D._aabbMaxX,x._aabbMaxY=q._aabbMaxY>D._aabbMaxY?q._aabbMaxY:D._aabbMaxY,x._aabbMaxZ=q._aabbMaxZ>D._aabbMaxZ?q._aabbMaxZ:D._aabbMaxZ;var N=x._children[0]._height,F=x._children[1]._height;x._height=(N>F?N:F)+1;var G=m._children[0],J=m._children[1];m._aabbMinX=G._aabbMinX<J._aabbMinX?G._aabbMinX:J._aabbMinX,m._aabbMinY=G._aabbMinY<J._aabbMinY?G._aabbMinY:J._aabbMinY,m._aabbMinZ=G._aabbMinZ<J._aabbMinZ?G._aabbMinZ:J._aabbMinZ,m._aabbMaxX=G._aabbMaxX>J._aabbMaxX?G._aabbMaxX:J._aabbMaxX,m._aabbMaxY=G._aabbMaxY>J._aabbMaxY?G._aabbMaxY:J._aabbMaxY,m._aabbMaxZ=G._aabbMaxZ>J._aabbMaxZ?G._aabbMaxZ:J._aabbMaxZ;var W=m._children[0]._height,O=m._children[1]._height;m._height=(W>O?W:O)+1}else{x._children[0]=m,m._parent=x,m._childIndex=0,m._children[1]=R,R._parent=m,R._childIndex=1;var U=x._children[0],H=x._children[1];x._aabbMinX=U._aabbMinX<H._aabbMinX?U._aabbMinX:H._aabbMinX,x._aabbMinY=U._aabbMinY<H._aabbMinY?U._aabbMinY:H._aabbMinY,x._aabbMinZ=U._aabbMinZ<H._aabbMinZ?U._aabbMinZ:H._aabbMinZ,x._aabbMaxX=U._aabbMaxX>H._aabbMaxX?U._aabbMaxX:H._aabbMaxX,x._aabbMaxY=U._aabbMaxY>H._aabbMaxY?U._aabbMaxY:H._aabbMaxY,x._aabbMaxZ=U._aabbMaxZ>H._aabbMaxZ?U._aabbMaxZ:H._aabbMaxZ;var Q=x._children[0]._height,K=x._children[1]._height;x._height=(Q>K?Q:K)+1;var $=m._children[0],tt=m._children[1];m._aabbMinX=$._aabbMinX<tt._aabbMinX?$._aabbMinX:tt._aabbMinX,m._aabbMinY=$._aabbMinY<tt._aabbMinY?$._aabbMinY:tt._aabbMinY,m._aabbMinZ=$._aabbMinZ<tt._aabbMinZ?$._aabbMinZ:tt._aabbMinZ,m._aabbMaxX=$._aabbMaxX>tt._aabbMaxX?$._aabbMaxX:tt._aabbMaxX,m._aabbMaxY=$._aabbMaxY>tt._aabbMaxY?$._aabbMaxY:tt._aabbMaxY,m._aabbMaxZ=$._aabbMaxZ>tt._aabbMaxZ?$._aabbMaxZ:tt._aabbMaxZ;var it=m._children[0]._height,at=m._children[1]._height;m._height=(it>at?it:at)+1}null!=u?(u._children[d]=x,x._parent=u,x._childIndex=d):(o._root=x,x._parent=null),m=x}}var nt=m._children[0]._height,ot=m._children[1]._height;m._height=(nt>ot?nt:ot)+1;var st=m._children[0],rt=m._children[1];m._aabbMinX=st._aabbMinX<rt._aabbMinX?st._aabbMinX:rt._aabbMinX,m._aabbMinY=st._aabbMinY<rt._aabbMinY?st._aabbMinY:rt._aabbMinY,m._aabbMinZ=st._aabbMinZ<rt._aabbMinZ?st._aabbMinZ:rt._aabbMinZ,m._aabbMaxX=st._aabbMaxX>rt._aabbMaxX?st._aabbMaxX:rt._aabbMaxX,m._aabbMaxY=st._aabbMaxY>rt._aabbMaxY?st._aabbMaxY:rt._aabbMaxY,m._aabbMaxZ=st._aabbMaxZ>rt._aabbMaxZ?st._aabbMaxZ:rt._aabbMaxZ,m=m._parent}}if(!a._moved){if(a._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var et=new Array(this.numMovedProxies<<1),_t=0,ht=this.numMovedProxies;_t<ht;){var lt=_t++;et[lt]=this.movedProxies[lt],this.movedProxies[lt]=null}this.movedProxies=et}this.movedProxies[this.numMovedProxies++]=a}return a},n.destroyProxy=function(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;var n=t,o=this._tree,s=n._leaf;o._numLeaves--;var r=s._prevLeaf,e=s._nextLeaf;if(null!=r&&(r._nextLeaf=e),null!=e&&(e._prevLeaf=r),s==o.leafList&&(o.leafList=o.leafList._nextLeaf),s==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),s._nextLeaf=null,s._prevLeaf=null,o._root==s)o._root=null;else{var _=s._parent,h=_._children[1^s._childIndex],l=_._parent;if(null==l)h._parent=null,h._childIndex=0,o._root=h,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=o._nodePool,o._nodePool=_;else{h._parent=l;var c=_._childIndex;l._children[c]=h,h._parent=l,h._childIndex=c,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=o._nodePool,o._nodePool=_;for(var m=l;null!=m;){if(o._strategy._balancingEnabled&&m._height>=2){var v=m._parent,b=m._children[0],f=m._children[1],u=b._height-f._height,p=m._childIndex;if(u>1){var x=b._children[0],y=b._children[1];if(x._height>y._height){b._children[1]=m,m._parent=b,m._childIndex=1,m._children[0]=y,y._parent=m,y._childIndex=0;var d=b._children[0],g=b._children[1];b._aabbMinX=d._aabbMinX<g._aabbMinX?d._aabbMinX:g._aabbMinX,b._aabbMinY=d._aabbMinY<g._aabbMinY?d._aabbMinY:g._aabbMinY,b._aabbMinZ=d._aabbMinZ<g._aabbMinZ?d._aabbMinZ:g._aabbMinZ,b._aabbMaxX=d._aabbMaxX>g._aabbMaxX?d._aabbMaxX:g._aabbMaxX,b._aabbMaxY=d._aabbMaxY>g._aabbMaxY?d._aabbMaxY:g._aabbMaxY,b._aabbMaxZ=d._aabbMaxZ>g._aabbMaxZ?d._aabbMaxZ:g._aabbMaxZ;var X=b._children[0]._height,Y=b._children[1]._height;b._height=(X>Y?X:Y)+1;var z=m._children[0],Z=m._children[1];m._aabbMinX=z._aabbMinX<Z._aabbMinX?z._aabbMinX:Z._aabbMinX,m._aabbMinY=z._aabbMinY<Z._aabbMinY?z._aabbMinY:Z._aabbMinY,m._aabbMinZ=z._aabbMinZ<Z._aabbMinZ?z._aabbMinZ:Z._aabbMinZ,m._aabbMaxX=z._aabbMaxX>Z._aabbMaxX?z._aabbMaxX:Z._aabbMaxX,m._aabbMaxY=z._aabbMaxY>Z._aabbMaxY?z._aabbMaxY:Z._aabbMaxY,m._aabbMaxZ=z._aabbMaxZ>Z._aabbMaxZ?z._aabbMaxZ:Z._aabbMaxZ;var M=m._children[0]._height,I=m._children[1]._height;m._height=(M>I?M:I)+1}else{b._children[0]=m,m._parent=b,m._childIndex=0,m._children[0]=x,x._parent=m,x._childIndex=0;var V=b._children[0],w=b._children[1];b._aabbMinX=V._aabbMinX<w._aabbMinX?V._aabbMinX:w._aabbMinX,b._aabbMinY=V._aabbMinY<w._aabbMinY?V._aabbMinY:w._aabbMinY,b._aabbMinZ=V._aabbMinZ<w._aabbMinZ?V._aabbMinZ:w._aabbMinZ,b._aabbMaxX=V._aabbMaxX>w._aabbMaxX?V._aabbMaxX:w._aabbMaxX,b._aabbMaxY=V._aabbMaxY>w._aabbMaxY?V._aabbMaxY:w._aabbMaxY,b._aabbMaxZ=V._aabbMaxZ>w._aabbMaxZ?V._aabbMaxZ:w._aabbMaxZ;var L=b._children[0]._height,k=b._children[1]._height;b._height=(L>k?L:k)+1;var A=m._children[0],B=m._children[1];m._aabbMinX=A._aabbMinX<B._aabbMinX?A._aabbMinX:B._aabbMinX,m._aabbMinY=A._aabbMinY<B._aabbMinY?A._aabbMinY:B._aabbMinY,m._aabbMinZ=A._aabbMinZ<B._aabbMinZ?A._aabbMinZ:B._aabbMinZ,m._aabbMaxX=A._aabbMaxX>B._aabbMaxX?A._aabbMaxX:B._aabbMaxX,m._aabbMaxY=A._aabbMaxY>B._aabbMaxY?A._aabbMaxY:B._aabbMaxY,m._aabbMaxZ=A._aabbMaxZ>B._aabbMaxZ?A._aabbMaxZ:B._aabbMaxZ;var P=m._children[0]._height,S=m._children[1]._height;m._height=(P>S?P:S)+1}null!=v?(v._children[p]=b,b._parent=v,b._childIndex=p):(o._root=b,b._parent=null),m=b}else if(u<-1){var T=f._children[0],C=f._children[1];if(T._height>C._height){f._children[1]=m,m._parent=f,m._childIndex=1,m._children[1]=C,C._parent=m,C._childIndex=1;var j=f._children[0],R=f._children[1];f._aabbMinX=j._aabbMinX<R._aabbMinX?j._aabbMinX:R._aabbMinX,f._aabbMinY=j._aabbMinY<R._aabbMinY?j._aabbMinY:R._aabbMinY,f._aabbMinZ=j._aabbMinZ<R._aabbMinZ?j._aabbMinZ:R._aabbMinZ,f._aabbMaxX=j._aabbMaxX>R._aabbMaxX?j._aabbMaxX:R._aabbMaxX,f._aabbMaxY=j._aabbMaxY>R._aabbMaxY?j._aabbMaxY:R._aabbMaxY,f._aabbMaxZ=j._aabbMaxZ>R._aabbMaxZ?j._aabbMaxZ:R._aabbMaxZ;var E=f._children[0]._height,q=f._children[1]._height;f._height=(E>q?E:q)+1;var D=m._children[0],N=m._children[1];m._aabbMinX=D._aabbMinX<N._aabbMinX?D._aabbMinX:N._aabbMinX,m._aabbMinY=D._aabbMinY<N._aabbMinY?D._aabbMinY:N._aabbMinY,m._aabbMinZ=D._aabbMinZ<N._aabbMinZ?D._aabbMinZ:N._aabbMinZ,m._aabbMaxX=D._aabbMaxX>N._aabbMaxX?D._aabbMaxX:N._aabbMaxX,m._aabbMaxY=D._aabbMaxY>N._aabbMaxY?D._aabbMaxY:N._aabbMaxY,m._aabbMaxZ=D._aabbMaxZ>N._aabbMaxZ?D._aabbMaxZ:N._aabbMaxZ;var F=m._children[0]._height,G=m._children[1]._height;m._height=(F>G?F:G)+1}else{f._children[0]=m,m._parent=f,m._childIndex=0,m._children[1]=T,T._parent=m,T._childIndex=1;var J=f._children[0],W=f._children[1];f._aabbMinX=J._aabbMinX<W._aabbMinX?J._aabbMinX:W._aabbMinX,f._aabbMinY=J._aabbMinY<W._aabbMinY?J._aabbMinY:W._aabbMinY,f._aabbMinZ=J._aabbMinZ<W._aabbMinZ?J._aabbMinZ:W._aabbMinZ,f._aabbMaxX=J._aabbMaxX>W._aabbMaxX?J._aabbMaxX:W._aabbMaxX,f._aabbMaxY=J._aabbMaxY>W._aabbMaxY?J._aabbMaxY:W._aabbMaxY,f._aabbMaxZ=J._aabbMaxZ>W._aabbMaxZ?J._aabbMaxZ:W._aabbMaxZ;var O=f._children[0]._height,U=f._children[1]._height;f._height=(O>U?O:U)+1;var H=m._children[0],Q=m._children[1];m._aabbMinX=H._aabbMinX<Q._aabbMinX?H._aabbMinX:Q._aabbMinX,m._aabbMinY=H._aabbMinY<Q._aabbMinY?H._aabbMinY:Q._aabbMinY,m._aabbMinZ=H._aabbMinZ<Q._aabbMinZ?H._aabbMinZ:Q._aabbMinZ,m._aabbMaxX=H._aabbMaxX>Q._aabbMaxX?H._aabbMaxX:Q._aabbMaxX,m._aabbMaxY=H._aabbMaxY>Q._aabbMaxY?H._aabbMaxY:Q._aabbMaxY,m._aabbMaxZ=H._aabbMaxZ>Q._aabbMaxZ?H._aabbMaxZ:Q._aabbMaxZ;var K=m._children[0]._height,$=m._children[1]._height;m._height=(K>$?K:$)+1}null!=v?(v._children[p]=f,f._parent=v,f._childIndex=p):(o._root=f,f._parent=null),m=f}}var tt=m._children[0]._height,it=m._children[1]._height;m._height=(tt>it?tt:it)+1;var at=m._children[0],nt=m._children[1];m._aabbMinX=at._aabbMinX<nt._aabbMinX?at._aabbMinX:nt._aabbMinX,m._aabbMinY=at._aabbMinY<nt._aabbMinY?at._aabbMinY:nt._aabbMinY,m._aabbMinZ=at._aabbMinZ<nt._aabbMinZ?at._aabbMinZ:nt._aabbMinZ,m._aabbMaxX=at._aabbMaxX>nt._aabbMaxX?at._aabbMaxX:nt._aabbMaxX,m._aabbMaxY=at._aabbMaxY>nt._aabbMaxY?at._aabbMaxY:nt._aabbMaxY,m._aabbMaxZ=at._aabbMaxZ>nt._aabbMaxZ?at._aabbMaxZ:nt._aabbMaxZ,m=m._parent}}}n._leaf=null,s._next=null,s._childIndex=0,s._children[0]=null,s._children[1]=null,s._childIndex=0,s._parent=null,s._height=0,s._proxy=null,s._next=o._nodePool,o._nodePool=s,n.userData=null,n._next=null,n._prev=null,n._moved&&(n._moved=!1)},n.moveProxy=function(t,i,a){var n=t;if(!(n._aabbMinX<=i._minX&&n._aabbMaxX>=i._maxX&&n._aabbMinY<=i._minY&&n._aabbMaxY>=i._maxY&&n._aabbMinZ<=i._minZ&&n._aabbMaxZ>=i._maxZ)){n._aabbMinX=i._minX,n._aabbMinY=i._minY,n._aabbMinZ=i._minZ,n._aabbMaxX=i._maxX,n._aabbMaxY=i._maxY,n._aabbMaxZ=i._maxZ;var o,s,e,_,h,l,c,m,v,b=r.common.Setting.bvhProxyPadding;if(n._aabbMinX-=b,n._aabbMinY-=b,n._aabbMinZ-=b,n._aabbMaxX+=b,n._aabbMaxY+=b,n._aabbMaxZ+=b,null!=a)0,0,0,_=0<(o=a.x)?0:o,h=0<(s=a.y)?0:s,l=0<(e=a.z)?0:e,c=0>o?0:o,m=0>s?0:s,v=0>e?0:e,n._aabbMinX+=_,n._aabbMinY+=h,n._aabbMinZ+=l,n._aabbMaxX+=c,n._aabbMaxY+=m,n._aabbMaxZ+=v;if(!n._moved){if(n._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var f=new Array(this.numMovedProxies<<1),u=0,p=this.numMovedProxies;u<p;){var x=u++;f[x]=this.movedProxies[x],this.movedProxies[x]=null}this.movedProxies=f}this.movedProxies[this.numMovedProxies++]=n}}},n.collectPairs=function(){var t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,null!=(t=t._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(this._numProxies<2)){for(var i=this.numMovedProxies/this._numProxies<r.common.Setting.bvhIncrementalCollisionThreshold,a=0,n=this.numMovedProxies;a<n;){var o=a++,s=this.movedProxies[o];if(s._moved){var e=this._tree,_=s._leaf;e._numLeaves--;var h=_._prevLeaf,l=_._nextLeaf;if(null!=h&&(h._nextLeaf=l),null!=l&&(l._prevLeaf=h),_==e.leafList&&(e.leafList=e.leafList._nextLeaf),_==e.leafListLast&&(e.leafListLast=e.leafListLast._prevLeaf),_._nextLeaf=null,_._prevLeaf=null,e._root==_)e._root=null;else{var c=_._parent,m=c._children[1^_._childIndex],v=c._parent;if(null==v)m._parent=null,m._childIndex=0,e._root=m,c._next=null,c._childIndex=0,c._children[0]=null,c._children[1]=null,c._childIndex=0,c._parent=null,c._height=0,c._proxy=null,c._next=e._nodePool,e._nodePool=c;else{m._parent=v;var b=c._childIndex;v._children[b]=m,m._parent=v,m._childIndex=b,c._next=null,c._childIndex=0,c._children[0]=null,c._children[1]=null,c._childIndex=0,c._parent=null,c._height=0,c._proxy=null,c._next=e._nodePool,e._nodePool=c;for(var f=v;null!=f;){if(e._strategy._balancingEnabled&&f._height>=2){var u=f._parent,p=f._children[0],x=f._children[1],y=p._height-x._height,d=f._childIndex;if(y>1){var g=p._children[0],X=p._children[1];if(g._height>X._height){p._children[1]=f,f._parent=p,f._childIndex=1,f._children[0]=X,X._parent=f,X._childIndex=0;var Y=p._children[0],z=p._children[1];p._aabbMinX=Y._aabbMinX<z._aabbMinX?Y._aabbMinX:z._aabbMinX,p._aabbMinY=Y._aabbMinY<z._aabbMinY?Y._aabbMinY:z._aabbMinY,p._aabbMinZ=Y._aabbMinZ<z._aabbMinZ?Y._aabbMinZ:z._aabbMinZ,p._aabbMaxX=Y._aabbMaxX>z._aabbMaxX?Y._aabbMaxX:z._aabbMaxX,p._aabbMaxY=Y._aabbMaxY>z._aabbMaxY?Y._aabbMaxY:z._aabbMaxY,p._aabbMaxZ=Y._aabbMaxZ>z._aabbMaxZ?Y._aabbMaxZ:z._aabbMaxZ;var Z=p._children[0]._height,M=p._children[1]._height;p._height=(Z>M?Z:M)+1;var I=f._children[0],V=f._children[1];f._aabbMinX=I._aabbMinX<V._aabbMinX?I._aabbMinX:V._aabbMinX,f._aabbMinY=I._aabbMinY<V._aabbMinY?I._aabbMinY:V._aabbMinY,f._aabbMinZ=I._aabbMinZ<V._aabbMinZ?I._aabbMinZ:V._aabbMinZ,f._aabbMaxX=I._aabbMaxX>V._aabbMaxX?I._aabbMaxX:V._aabbMaxX,f._aabbMaxY=I._aabbMaxY>V._aabbMaxY?I._aabbMaxY:V._aabbMaxY,f._aabbMaxZ=I._aabbMaxZ>V._aabbMaxZ?I._aabbMaxZ:V._aabbMaxZ;var w=f._children[0]._height,L=f._children[1]._height;f._height=(w>L?w:L)+1}else{p._children[0]=f,f._parent=p,f._childIndex=0,f._children[0]=g,g._parent=f,g._childIndex=0;var k=p._children[0],A=p._children[1];p._aabbMinX=k._aabbMinX<A._aabbMinX?k._aabbMinX:A._aabbMinX,p._aabbMinY=k._aabbMinY<A._aabbMinY?k._aabbMinY:A._aabbMinY,p._aabbMinZ=k._aabbMinZ<A._aabbMinZ?k._aabbMinZ:A._aabbMinZ,p._aabbMaxX=k._aabbMaxX>A._aabbMaxX?k._aabbMaxX:A._aabbMaxX,p._aabbMaxY=k._aabbMaxY>A._aabbMaxY?k._aabbMaxY:A._aabbMaxY,p._aabbMaxZ=k._aabbMaxZ>A._aabbMaxZ?k._aabbMaxZ:A._aabbMaxZ;var B=p._children[0]._height,P=p._children[1]._height;p._height=(B>P?B:P)+1;var S=f._children[0],T=f._children[1];f._aabbMinX=S._aabbMinX<T._aabbMinX?S._aabbMinX:T._aabbMinX,f._aabbMinY=S._aabbMinY<T._aabbMinY?S._aabbMinY:T._aabbMinY,f._aabbMinZ=S._aabbMinZ<T._aabbMinZ?S._aabbMinZ:T._aabbMinZ,f._aabbMaxX=S._aabbMaxX>T._aabbMaxX?S._aabbMaxX:T._aabbMaxX,f._aabbMaxY=S._aabbMaxY>T._aabbMaxY?S._aabbMaxY:T._aabbMaxY,f._aabbMaxZ=S._aabbMaxZ>T._aabbMaxZ?S._aabbMaxZ:T._aabbMaxZ;var C=f._children[0]._height,j=f._children[1]._height;f._height=(C>j?C:j)+1}null!=u?(u._children[d]=p,p._parent=u,p._childIndex=d):(e._root=p,p._parent=null),f=p}else if(y<-1){var R=x._children[0],E=x._children[1];if(R._height>E._height){x._children[1]=f,f._parent=x,f._childIndex=1,f._children[1]=E,E._parent=f,E._childIndex=1;var q=x._children[0],D=x._children[1];x._aabbMinX=q._aabbMinX<D._aabbMinX?q._aabbMinX:D._aabbMinX,x._aabbMinY=q._aabbMinY<D._aabbMinY?q._aabbMinY:D._aabbMinY,x._aabbMinZ=q._aabbMinZ<D._aabbMinZ?q._aabbMinZ:D._aabbMinZ,x._aabbMaxX=q._aabbMaxX>D._aabbMaxX?q._aabbMaxX:D._aabbMaxX,x._aabbMaxY=q._aabbMaxY>D._aabbMaxY?q._aabbMaxY:D._aabbMaxY,x._aabbMaxZ=q._aabbMaxZ>D._aabbMaxZ?q._aabbMaxZ:D._aabbMaxZ;var N=x._children[0]._height,F=x._children[1]._height;x._height=(N>F?N:F)+1;var G=f._children[0],J=f._children[1];f._aabbMinX=G._aabbMinX<J._aabbMinX?G._aabbMinX:J._aabbMinX,f._aabbMinY=G._aabbMinY<J._aabbMinY?G._aabbMinY:J._aabbMinY,f._aabbMinZ=G._aabbMinZ<J._aabbMinZ?G._aabbMinZ:J._aabbMinZ,f._aabbMaxX=G._aabbMaxX>J._aabbMaxX?G._aabbMaxX:J._aabbMaxX,f._aabbMaxY=G._aabbMaxY>J._aabbMaxY?G._aabbMaxY:J._aabbMaxY,f._aabbMaxZ=G._aabbMaxZ>J._aabbMaxZ?G._aabbMaxZ:J._aabbMaxZ;var W=f._children[0]._height,O=f._children[1]._height;f._height=(W>O?W:O)+1}else{x._children[0]=f,f._parent=x,f._childIndex=0,f._children[1]=R,R._parent=f,R._childIndex=1;var U=x._children[0],H=x._children[1];x._aabbMinX=U._aabbMinX<H._aabbMinX?U._aabbMinX:H._aabbMinX,x._aabbMinY=U._aabbMinY<H._aabbMinY?U._aabbMinY:H._aabbMinY,x._aabbMinZ=U._aabbMinZ<H._aabbMinZ?U._aabbMinZ:H._aabbMinZ,x._aabbMaxX=U._aabbMaxX>H._aabbMaxX?U._aabbMaxX:H._aabbMaxX,x._aabbMaxY=U._aabbMaxY>H._aabbMaxY?U._aabbMaxY:H._aabbMaxY,x._aabbMaxZ=U._aabbMaxZ>H._aabbMaxZ?U._aabbMaxZ:H._aabbMaxZ;var Q=x._children[0]._height,K=x._children[1]._height;x._height=(Q>K?Q:K)+1;var $=f._children[0],tt=f._children[1];f._aabbMinX=$._aabbMinX<tt._aabbMinX?$._aabbMinX:tt._aabbMinX,f._aabbMinY=$._aabbMinY<tt._aabbMinY?$._aabbMinY:tt._aabbMinY,f._aabbMinZ=$._aabbMinZ<tt._aabbMinZ?$._aabbMinZ:tt._aabbMinZ,f._aabbMaxX=$._aabbMaxX>tt._aabbMaxX?$._aabbMaxX:tt._aabbMaxX,f._aabbMaxY=$._aabbMaxY>tt._aabbMaxY?$._aabbMaxY:tt._aabbMaxY,f._aabbMaxZ=$._aabbMaxZ>tt._aabbMaxZ?$._aabbMaxZ:tt._aabbMaxZ;var it=f._children[0]._height,at=f._children[1]._height;f._height=(it>at?it:at)+1}null!=u?(u._children[d]=x,x._parent=u,x._childIndex=d):(e._root=x,x._parent=null),f=x}}var nt=f._children[0]._height,ot=f._children[1]._height;f._height=(nt>ot?nt:ot)+1;var st=f._children[0],rt=f._children[1];f._aabbMinX=st._aabbMinX<rt._aabbMinX?st._aabbMinX:rt._aabbMinX,f._aabbMinY=st._aabbMinY<rt._aabbMinY?st._aabbMinY:rt._aabbMinY,f._aabbMinZ=st._aabbMinZ<rt._aabbMinZ?st._aabbMinZ:rt._aabbMinZ,f._aabbMaxX=st._aabbMaxX>rt._aabbMaxX?st._aabbMaxX:rt._aabbMaxX,f._aabbMaxY=st._aabbMaxY>rt._aabbMaxY?st._aabbMaxY:rt._aabbMaxY,f._aabbMaxZ=st._aabbMaxZ>rt._aabbMaxZ?st._aabbMaxZ:rt._aabbMaxZ,f=f._parent}}}s._leaf=null,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=e._nodePool,e._nodePool=_;var et=this._tree,_t=et._nodePool;null!=_t?(et._nodePool=_t._next,_t._next=null):_t=new r.collision.broadphase.bvh.BvhNode;var ht=_t;if(ht._proxy=s,s._leaf=ht,ht._aabbMinX=s._aabbMinX,ht._aabbMinY=s._aabbMinY,ht._aabbMinZ=s._aabbMinZ,ht._aabbMaxX=s._aabbMaxX,ht._aabbMaxY=s._aabbMaxY,ht._aabbMaxZ=s._aabbMaxZ,et._numLeaves++,null==et.leafList?(et.leafList=ht,et.leafListLast=ht):(et.leafListLast._nextLeaf=ht,ht._prevLeaf=et.leafListLast,et.leafListLast=ht),null==et._root)et._root=ht;else{for(var lt=et._root;lt._height>0;){var ct=et._strategy._decideInsertion(lt,ht);if(-1==ct)break;lt=lt._children[ct]}var mt=lt._parent,vt=et._nodePool;null!=vt?(et._nodePool=vt._next,vt._next=null):vt=new r.collision.broadphase.bvh.BvhNode;var bt=vt;if(null==mt)et._root=bt;else{var ft=lt._childIndex;mt._children[ft]=bt,bt._parent=mt,bt._childIndex=ft}var ut=lt._childIndex;bt._children[ut]=lt,lt._parent=bt,lt._childIndex=ut;var pt=1^lt._childIndex;for(bt._children[pt]=ht,ht._parent=bt,ht._childIndex=pt;null!=bt;){if(et._strategy._balancingEnabled&&bt._height>=2){var xt=bt._parent,yt=bt._children[0],dt=bt._children[1],gt=yt._height-dt._height,Xt=bt._childIndex;if(gt>1){var Yt=yt._children[0],zt=yt._children[1];if(Yt._height>zt._height){yt._children[1]=bt,bt._parent=yt,bt._childIndex=1,bt._children[0]=zt,zt._parent=bt,zt._childIndex=0;var Zt=yt._children[0],Mt=yt._children[1];yt._aabbMinX=Zt._aabbMinX<Mt._aabbMinX?Zt._aabbMinX:Mt._aabbMinX,yt._aabbMinY=Zt._aabbMinY<Mt._aabbMinY?Zt._aabbMinY:Mt._aabbMinY,yt._aabbMinZ=Zt._aabbMinZ<Mt._aabbMinZ?Zt._aabbMinZ:Mt._aabbMinZ,yt._aabbMaxX=Zt._aabbMaxX>Mt._aabbMaxX?Zt._aabbMaxX:Mt._aabbMaxX,yt._aabbMaxY=Zt._aabbMaxY>Mt._aabbMaxY?Zt._aabbMaxY:Mt._aabbMaxY,yt._aabbMaxZ=Zt._aabbMaxZ>Mt._aabbMaxZ?Zt._aabbMaxZ:Mt._aabbMaxZ;var It=yt._children[0]._height,Vt=yt._children[1]._height;yt._height=(It>Vt?It:Vt)+1;var wt=bt._children[0],Lt=bt._children[1];bt._aabbMinX=wt._aabbMinX<Lt._aabbMinX?wt._aabbMinX:Lt._aabbMinX,bt._aabbMinY=wt._aabbMinY<Lt._aabbMinY?wt._aabbMinY:Lt._aabbMinY,bt._aabbMinZ=wt._aabbMinZ<Lt._aabbMinZ?wt._aabbMinZ:Lt._aabbMinZ,bt._aabbMaxX=wt._aabbMaxX>Lt._aabbMaxX?wt._aabbMaxX:Lt._aabbMaxX,bt._aabbMaxY=wt._aabbMaxY>Lt._aabbMaxY?wt._aabbMaxY:Lt._aabbMaxY,bt._aabbMaxZ=wt._aabbMaxZ>Lt._aabbMaxZ?wt._aabbMaxZ:Lt._aabbMaxZ;var kt=bt._children[0]._height,At=bt._children[1]._height;bt._height=(kt>At?kt:At)+1}else{yt._children[0]=bt,bt._parent=yt,bt._childIndex=0,bt._children[0]=Yt,Yt._parent=bt,Yt._childIndex=0;var Bt=yt._children[0],Pt=yt._children[1];yt._aabbMinX=Bt._aabbMinX<Pt._aabbMinX?Bt._aabbMinX:Pt._aabbMinX,yt._aabbMinY=Bt._aabbMinY<Pt._aabbMinY?Bt._aabbMinY:Pt._aabbMinY,yt._aabbMinZ=Bt._aabbMinZ<Pt._aabbMinZ?Bt._aabbMinZ:Pt._aabbMinZ,yt._aabbMaxX=Bt._aabbMaxX>Pt._aabbMaxX?Bt._aabbMaxX:Pt._aabbMaxX,yt._aabbMaxY=Bt._aabbMaxY>Pt._aabbMaxY?Bt._aabbMaxY:Pt._aabbMaxY,yt._aabbMaxZ=Bt._aabbMaxZ>Pt._aabbMaxZ?Bt._aabbMaxZ:Pt._aabbMaxZ;var St=yt._children[0]._height,Tt=yt._children[1]._height;yt._height=(St>Tt?St:Tt)+1;var Ct=bt._children[0],jt=bt._children[1];bt._aabbMinX=Ct._aabbMinX<jt._aabbMinX?Ct._aabbMinX:jt._aabbMinX,bt._aabbMinY=Ct._aabbMinY<jt._aabbMinY?Ct._aabbMinY:jt._aabbMinY,bt._aabbMinZ=Ct._aabbMinZ<jt._aabbMinZ?Ct._aabbMinZ:jt._aabbMinZ,bt._aabbMaxX=Ct._aabbMaxX>jt._aabbMaxX?Ct._aabbMaxX:jt._aabbMaxX,bt._aabbMaxY=Ct._aabbMaxY>jt._aabbMaxY?Ct._aabbMaxY:jt._aabbMaxY,bt._aabbMaxZ=Ct._aabbMaxZ>jt._aabbMaxZ?Ct._aabbMaxZ:jt._aabbMaxZ;var Rt=bt._children[0]._height,Et=bt._children[1]._height;bt._height=(Rt>Et?Rt:Et)+1}null!=xt?(xt._children[Xt]=yt,yt._parent=xt,yt._childIndex=Xt):(et._root=yt,yt._parent=null),bt=yt}else if(gt<-1){var qt=dt._children[0],Dt=dt._children[1];if(qt._height>Dt._height){dt._children[1]=bt,bt._parent=dt,bt._childIndex=1,bt._children[1]=Dt,Dt._parent=bt,Dt._childIndex=1;var Nt=dt._children[0],Ft=dt._children[1];dt._aabbMinX=Nt._aabbMinX<Ft._aabbMinX?Nt._aabbMinX:Ft._aabbMinX,dt._aabbMinY=Nt._aabbMinY<Ft._aabbMinY?Nt._aabbMinY:Ft._aabbMinY,dt._aabbMinZ=Nt._aabbMinZ<Ft._aabbMinZ?Nt._aabbMinZ:Ft._aabbMinZ,dt._aabbMaxX=Nt._aabbMaxX>Ft._aabbMaxX?Nt._aabbMaxX:Ft._aabbMaxX,dt._aabbMaxY=Nt._aabbMaxY>Ft._aabbMaxY?Nt._aabbMaxY:Ft._aabbMaxY,dt._aabbMaxZ=Nt._aabbMaxZ>Ft._aabbMaxZ?Nt._aabbMaxZ:Ft._aabbMaxZ;var Gt=dt._children[0]._height,Jt=dt._children[1]._height;dt._height=(Gt>Jt?Gt:Jt)+1;var Wt=bt._children[0],Ot=bt._children[1];bt._aabbMinX=Wt._aabbMinX<Ot._aabbMinX?Wt._aabbMinX:Ot._aabbMinX,bt._aabbMinY=Wt._aabbMinY<Ot._aabbMinY?Wt._aabbMinY:Ot._aabbMinY,bt._aabbMinZ=Wt._aabbMinZ<Ot._aabbMinZ?Wt._aabbMinZ:Ot._aabbMinZ,bt._aabbMaxX=Wt._aabbMaxX>Ot._aabbMaxX?Wt._aabbMaxX:Ot._aabbMaxX,bt._aabbMaxY=Wt._aabbMaxY>Ot._aabbMaxY?Wt._aabbMaxY:Ot._aabbMaxY,bt._aabbMaxZ=Wt._aabbMaxZ>Ot._aabbMaxZ?Wt._aabbMaxZ:Ot._aabbMaxZ;var Ut=bt._children[0]._height,Ht=bt._children[1]._height;bt._height=(Ut>Ht?Ut:Ht)+1}else{dt._children[0]=bt,bt._parent=dt,bt._childIndex=0,bt._children[1]=qt,qt._parent=bt,qt._childIndex=1;var Qt=dt._children[0],Kt=dt._children[1];dt._aabbMinX=Qt._aabbMinX<Kt._aabbMinX?Qt._aabbMinX:Kt._aabbMinX,dt._aabbMinY=Qt._aabbMinY<Kt._aabbMinY?Qt._aabbMinY:Kt._aabbMinY,dt._aabbMinZ=Qt._aabbMinZ<Kt._aabbMinZ?Qt._aabbMinZ:Kt._aabbMinZ,dt._aabbMaxX=Qt._aabbMaxX>Kt._aabbMaxX?Qt._aabbMaxX:Kt._aabbMaxX,dt._aabbMaxY=Qt._aabbMaxY>Kt._aabbMaxY?Qt._aabbMaxY:Kt._aabbMaxY,dt._aabbMaxZ=Qt._aabbMaxZ>Kt._aabbMaxZ?Qt._aabbMaxZ:Kt._aabbMaxZ;var $t=dt._children[0]._height,ti=dt._children[1]._height;dt._height=($t>ti?$t:ti)+1;var ii=bt._children[0],ai=bt._children[1];bt._aabbMinX=ii._aabbMinX<ai._aabbMinX?ii._aabbMinX:ai._aabbMinX,bt._aabbMinY=ii._aabbMinY<ai._aabbMinY?ii._aabbMinY:ai._aabbMinY,bt._aabbMinZ=ii._aabbMinZ<ai._aabbMinZ?ii._aabbMinZ:ai._aabbMinZ,bt._aabbMaxX=ii._aabbMaxX>ai._aabbMaxX?ii._aabbMaxX:ai._aabbMaxX,bt._aabbMaxY=ii._aabbMaxY>ai._aabbMaxY?ii._aabbMaxY:ai._aabbMaxY,bt._aabbMaxZ=ii._aabbMaxZ>ai._aabbMaxZ?ii._aabbMaxZ:ai._aabbMaxZ;var ni=bt._children[0]._height,oi=bt._children[1]._height;bt._height=(ni>oi?ni:oi)+1}null!=xt?(xt._children[Xt]=dt,dt._parent=xt,dt._childIndex=Xt):(et._root=dt,dt._parent=null),bt=dt}}var si=bt._children[0]._height,ri=bt._children[1]._height;bt._height=(si>ri?si:ri)+1;var ei=bt._children[0],_i=bt._children[1];bt._aabbMinX=ei._aabbMinX<_i._aabbMinX?ei._aabbMinX:_i._aabbMinX,bt._aabbMinY=ei._aabbMinY<_i._aabbMinY?ei._aabbMinY:_i._aabbMinY,bt._aabbMinZ=ei._aabbMinZ<_i._aabbMinZ?ei._aabbMinZ:_i._aabbMinZ,bt._aabbMaxX=ei._aabbMaxX>_i._aabbMaxX?ei._aabbMaxX:_i._aabbMaxX,bt._aabbMaxY=ei._aabbMaxY>_i._aabbMaxY?ei._aabbMaxY:_i._aabbMaxY,bt._aabbMaxZ=ei._aabbMaxZ>_i._aabbMaxZ?ei._aabbMaxZ:_i._aabbMaxZ,bt=bt._parent}}i&&this.collide(this._tree._root,s._leaf),s._moved=!1}this.movedProxies[o]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}},n.rayCast=function(t,i,a){var n,o,s,r,e,_;null!=this._tree._root&&(n=t.x,o=t.y,s=t.z,r=i.x,e=i.y,_=i.z,this.rayCastRecursive(this._tree._root,n,o,s,r,e,_,a))},n.convexCast=function(t,i,a,n){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,t,i,a,n)},n.aabbTest=function(t,i){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,t,i)},n.getTreeBalance=function(){return this._tree._getBalance()},i}(r.collision.broadphase.BroadPhase),r.collision.broadphase.bvh.BvhInsertionStrategy=function(){},r.collision.broadphase.bvh.BvhNode=function(){this._next=null,this._prevLeaf=null,this._nextLeaf=null,this._children=new Array(2),this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0},r.collision.broadphase.bvh.BvhProxy=function(t){function i(i,a){var n;return(n=t.call(this,i,a)||this)._leaf=null,n._moved=!1,n}return a(i,t),i}(r.collision.broadphase.Proxy),r.collision.broadphase.bvh.BvhStrategy=function(){function t(){this._insertionStrategy=0,this._balancingEnabled=!1}var i=t.prototype;return i._decideInsertion=function(t,i){switch(this._insertionStrategy){case 0:var a,n,o;a=i._aabbMinX+i._aabbMaxX,n=i._aabbMinY+i._aabbMaxY,o=i._aabbMinZ+i._aabbMaxZ;var s,r,e,_,h,l,c=t._children[0],m=t._children[1];return s=c._aabbMinX+c._aabbMaxX,r=c._aabbMinY+c._aabbMaxY,e=c._aabbMinZ+c._aabbMaxZ,_=m._aabbMinX+m._aabbMaxX,h=m._aabbMinY+m._aabbMaxY,l=m._aabbMinZ+m._aabbMaxZ,(s-=a)*s+(r-=n)*r+(e-=o)*e<(_-=a)*_+(h-=n)*h+(l-=o)*l?0:1;case 1:var v,b,f,u,p,x,y=t._children[0],d=t._children[1],g=t._aabbMaxY-t._aabbMinY,X=t._aabbMaxZ-t._aabbMinZ;v=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,b=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,f=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,u=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX;var Y=(p=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY)-b,z=(x=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ)-f,Z=2*((u-v)*(Y+z)+Y*z),M=2*Z,I=2*(Z-2*((t._aabbMaxX-t._aabbMinX)*(g+X)+g*X)),V=I;if(v=y._aabbMinX<i._aabbMinX?y._aabbMinX:i._aabbMinX,b=y._aabbMinY<i._aabbMinY?y._aabbMinY:i._aabbMinY,f=y._aabbMinZ<i._aabbMinZ?y._aabbMinZ:i._aabbMinZ,u=y._aabbMaxX>i._aabbMaxX?y._aabbMaxX:i._aabbMaxX,p=y._aabbMaxY>i._aabbMaxY?y._aabbMaxY:i._aabbMaxY,x=y._aabbMaxZ>i._aabbMaxZ?y._aabbMaxZ:i._aabbMaxZ,0==y._height){var w=p-b,L=x-f;V=I+2*((u-v)*(w+L)+w*L)}else{var k=p-b,A=x-f,B=y._aabbMaxY-y._aabbMinY,P=y._aabbMaxZ-y._aabbMinZ;V=I+(2*((u-v)*(k+A)+k*A)-2*((y._aabbMaxX-y._aabbMinX)*(B+P)+B*P))}var S=I;if(v=d._aabbMinX<i._aabbMinX?d._aabbMinX:i._aabbMinX,b=d._aabbMinY<i._aabbMinY?d._aabbMinY:i._aabbMinY,f=d._aabbMinZ<i._aabbMinZ?d._aabbMinZ:i._aabbMinZ,u=d._aabbMaxX>i._aabbMaxX?d._aabbMaxX:i._aabbMaxX,p=d._aabbMaxY>i._aabbMaxY?d._aabbMaxY:i._aabbMaxY,x=d._aabbMaxZ>i._aabbMaxZ?d._aabbMaxZ:i._aabbMaxZ,0==d._height){var T=p-b,C=x-f;S=I+2*((u-v)*(T+C)+T*C)}else{var j=p-b,R=x-f,E=d._aabbMaxY-d._aabbMinY,q=d._aabbMaxZ-d._aabbMinZ;S=I+(2*((u-v)*(j+R)+j*R)-2*((d._aabbMaxX-d._aabbMinX)*(E+q)+E*q))}return M<V?M<S?-1:1:V<S?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}},i._splitLeaves=function(t,i,a){var n,o,s,r=1/(a-i);n=0,o=0,s=0;for(var e,_,h,l=i;l<a;){var c=t[l++];c._tmpX=c._aabbMaxX+c._aabbMinX,c._tmpY=c._aabbMaxY+c._aabbMinY,c._tmpZ=c._aabbMaxZ+c._aabbMinZ,n+=c._tmpX,o+=c._tmpY,s+=c._tmpZ}n*=r,o*=r,s*=r,e=0,_=0,h=0;for(var m=i;m<a;){var v=t[m++],b=void 0,f=void 0,u=void 0;b=v._tmpX-n,f=v._tmpY-o,u=v._tmpZ-s,e+=b*=b,_+=f*=f,h+=u*=u}var p=_,x=h,y=i,d=a-1;if(e>p)if(e>x)for(var g=n;;){for(;!(t[y]._tmpX<=g);)++y;for(;!(t[d]._tmpX>=g);)--d;if(y>=d)break;var X=t[y];t[y]=t[d],t[d]=X,++y,--d}else for(var Y=s;;){for(;!(t[y]._tmpZ<=Y);)++y;for(;!(t[d]._tmpZ>=Y);)--d;if(y>=d)break;var z=t[y];t[y]=t[d],t[d]=z,++y,--d}else if(p>x)for(var Z=o;;){for(;!(t[y]._tmpY<=Z);)++y;for(;!(t[d]._tmpY>=Z);)--d;if(y>=d)break;var M=t[y];t[y]=t[d],t[d]=M,++y,--d}else for(var I=s;;){for(;!(t[y]._tmpZ<=I);)++y;for(;!(t[d]._tmpZ>=I);)--d;if(y>=d)break;var V=t[y];t[y]=t[d],t[d]=V,++y,--d}return y},t}(),r.collision.broadphase.bvh.BvhTree=function(){function t(){this._root=null,this._numLeaves=0,this._strategy=new r.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null,this.tmp=new Array(1024)}var i=t.prototype;return i._print=function(t,i){if(null==i&&(i=""),null!=t)if(0==t._height)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",i+t._proxy._id);else{var a,n,o,s;this._print(t._children[0],i+"\t"),n=t._aabbMaxX-t._aabbMinX;o=t._aabbMaxY-t._aabbMinY,s=t._aabbMaxZ-t._aabbMinZ;if(n*(o+s)+o*s>0){var r,e,_;r=t._aabbMaxX-t._aabbMinX;e=t._aabbMaxY-t._aabbMinY,_=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(r*(e+_)+e*_)+.5|0)/1e3}else{var h,l,c;h=t._aabbMaxX-t._aabbMinX;l=t._aabbMaxY-t._aabbMinY,c=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(h*(l+c)+l*c)-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",i+"#"+t._height+", "+a),this._print(t._children[1],i+"\t")}},i._getBalance=function(){return this.getBalanceRecursive(this._root)},i.deleteRecursive=function(t){if(0==t._height){var i=t._prevLeaf,a=t._nextLeaf;return null!=i&&(i._nextLeaf=a),null!=a&&(a._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,void(this._nodePool=t)}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t},i.decomposeRecursive=function(t){if(0==t._height)return t._childIndex=0,void(t._parent=null);this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t},i.buildTopDownRecursive=function(t,i,a){if(a-i==1){var n=t[i],o=n._proxy;return n._aabbMinX=o._aabbMinX,n._aabbMinY=o._aabbMinY,n._aabbMinZ=o._aabbMinZ,n._aabbMaxX=o._aabbMaxX,n._aabbMaxY=o._aabbMaxY,n._aabbMaxZ=o._aabbMaxZ,n}var s=this._strategy._splitLeaves(t,i,a),e=this.buildTopDownRecursive(t,i,s),_=this.buildTopDownRecursive(t,s,a),h=this._nodePool;null!=h?(this._nodePool=h._next,h._next=null):h=new r.collision.broadphase.bvh.BvhNode;var l=h;l._children[0]=e,e._parent=l,e._childIndex=0,l._children[1]=_,_._parent=l,_._childIndex=1;var c=l._children[0],m=l._children[1];l._aabbMinX=c._aabbMinX<m._aabbMinX?c._aabbMinX:m._aabbMinX,l._aabbMinY=c._aabbMinY<m._aabbMinY?c._aabbMinY:m._aabbMinY,l._aabbMinZ=c._aabbMinZ<m._aabbMinZ?c._aabbMinZ:m._aabbMinZ,l._aabbMaxX=c._aabbMaxX>m._aabbMaxX?c._aabbMaxX:m._aabbMaxX,l._aabbMaxY=c._aabbMaxY>m._aabbMaxY?c._aabbMaxY:m._aabbMaxY,l._aabbMaxZ=c._aabbMaxZ>m._aabbMaxZ?c._aabbMaxZ:m._aabbMaxZ;var v=l._children[0]._height,b=l._children[1]._height;return l._height=(v>b?v:b)+1,l},i.getBalanceRecursive=function(t){if(null==t||0==t._height)return 0;var i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])},t}(),r.collision.geometry.Aabb=function(){function t(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}var i=t.prototype;return i.init=function(t,i){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this},i.getMin=function(){var t=new r.common.Vec3;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,t},i.getMinTo=function(t){t.x=this._minX,t.y=this._minY,t.z=this._minZ},i.setMin=function(t){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this},i.getMax=function(){var t=new r.common.Vec3;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,t},i.getMaxTo=function(t){t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ},i.setMax=function(t){return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this},i.getCenter=function(){var t,i,a,n=new r.common.Vec3;return t=this._minX+this._maxX,i=this._minY+this._maxY,a=this._minZ+this._maxZ,t*=.5,i*=.5,a*=.5,n.x=t,n.y=i,n.z=a,n},i.getCenterTo=function(t){var i,a,n;i=this._minX+this._maxX,a=this._minY+this._maxY,n=this._minZ+this._maxZ,i*=.5,a*=.5,n*=.5,t.x=i,t.y=a,t.z=n},i.getExtents=function(){var t,i,a,n=new r.common.Vec3;return t=this._maxX-this._minX,i=this._maxY-this._minY,a=this._maxZ-this._minZ,t*=.5,i*=.5,a*=.5,n.x=t,n.y=i,n.z=a,n},i.getExtentsTo=function(t){var i,a,n;i=this._maxX-this._minX,a=this._maxY-this._minY,n=this._maxZ-this._minZ,i*=.5,a*=.5,n*=.5,t.x=i,t.y=a,t.z=n},i.combine=function(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this},i.combined=function(t){var i=new r.collision.geometry.Aabb;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i},i.overlap=function(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ&&this._maxZ>t._minZ},i.getIntersection=function(t){var i=new r.collision.geometry.Aabb;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i},i.getIntersectionTo=function(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ},i.copyFrom=function(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this},i.clone=function(){var t=new r.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t},t}(),r.collision.geometry.BoxGeometry=function(t){function i(i){var a;(a=t.call(this,1)||this)._halfExtentsX=i.x,a._halfExtentsY=i.y,a._halfExtentsZ=i.z,a._halfAxisXX=i.x,a._halfAxisXY=0,a._halfAxisXZ=0,a._halfAxisYX=0,a._halfAxisYY=i.y,a._halfAxisYZ=0,a._halfAxisZX=0,a._halfAxisZY=0,a._halfAxisZZ=i.z,a._updateMass();var n=i.x<i.y?i.z<i.x?i.z:i.x:i.z<i.y?i.z:i.y;return a._gjkMargin>.2*n&&(a._gjkMargin=.2*n),a}a(i,t);var n=i.prototype;return n.getHalfExtents=function(){var t=new r.common.Vec3;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,t},n.getHalfExtentsTo=function(t){t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ},n._updateMass=function(){var t,i,a;this._volume=this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ*8,t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,a=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+a),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(a+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)},n._computeAabb=function(t,i){var a,n,o,s,r,e,_,h,l,c,m,v;(a=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ)<0&&(a=-a),(n=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ)<0&&(n=-n),(o=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ)<0&&(o=-o),(s=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ)<0&&(s=-s),(r=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ)<0&&(r=-r),(e=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ)<0&&(e=-e),(_=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ)<0&&(_=-_),(h=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ)<0&&(h=-h),(l=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ)<0&&(l=-l),c=a+s,m=n+r,v=o+e,c+=_,m+=h,v+=l,t._minX=i._positionX-c,t._minY=i._positionY-m,t._minZ=i._positionZ-v,t._maxX=i._positionX+c,t._maxY=i._positionY+m,t._maxZ=i._positionZ+v},n.computeLocalSupportingVertex=function(t,i){var a,n,o,s,r,e;a=this._gjkMargin,n=this._gjkMargin,o=this._gjkMargin,a<this._halfExtentsX||(a=this._halfExtentsX),n<this._halfExtentsY||(n=this._halfExtentsY),o<this._halfExtentsZ||(o=this._halfExtentsZ),s=this._halfExtentsX-a,r=this._halfExtentsY-n,e=this._halfExtentsZ-o,i.x=t.x>0?s:-s,i.y=t.y>0?r:-r,i.z=t.z>0?e:-e},n._rayCastLocal=function(t,i,a,n,o,s,r){var e=this._halfExtentsX,_=this._halfExtentsY,h=this._halfExtentsZ,l=n-t,c=o-i,m=s-a,v=0,b=0,f=0,u=1,p=1,x=1;if(l>-1e-6&&l<1e-6){if(t<=-e||t>=e)return!1}else{var y=1/l,d=(-e-t)*y,g=(e-t)*y;if(d>g){var X=d;d=g,g=X}d>0&&(v=d),g<1&&(u=g)}if(c>-1e-6&&c<1e-6){if(i<=-_||i>=_)return!1}else{var Y=1/c,z=(-_-i)*Y,Z=(_-i)*Y;if(z>Z){var M=z;z=Z,Z=M}z>0&&(b=z),Z<1&&(p=Z)}if(m>-1e-6&&m<1e-6){if(a<=-h||a>=h)return!1}else{var I=1/m,V=(-h-a)*I,w=(h-a)*I;if(V>w){var L=V;V=w,w=L}V>0&&(f=V),w<1&&(x=w)}if(v>=1||b>=1||f>=1||u<=0||p<=0||x<=0)return!1;var k=v,A=u,B=0;if(b>k&&(k=b,B=1),f>k&&(k=f,B=2),p<A&&(A=p),x<A&&(A=x),k>A)return!1;if(0==k)return!1;switch(B){case 0:r.normal.init(l>0?-1:1,0,0);break;case 1:r.normal.init(0,c>0?-1:1,0);break;case 2:r.normal.init(0,0,m>0?-1:1)}return r.position.init(t+k*l,i+k*c,a+k*m),r.fraction=k,!0},i}(r.collision.geometry.ConvexGeometry),r.collision.geometry.CapsuleGeometry=function(t){function i(i,a){var n;return(n=t.call(this,4)||this)._radius=i,n._halfHeight=a,n._gjkMargin=n._radius,n._updateMass(),n}a(i,t);var n=i.prototype;return n.getRadius=function(){return this._radius},n.getHalfHeight=function(){return this._halfHeight},n._updateMass=function(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,a=6.28318530717958*t*this._halfHeight,n=3.14159265358979*t*this._radius*4/3;this._volume=a+n;var o=0==this._volume?0:1/this._volume,s=o*(a*(.25*t+i/3)+n*(.4*t+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=s,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=o*(a*t*.5+n*t*.4),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=s},n._computeAabb=function(t,i){var a,n,o,s,r,e;a=this._radius,n=this._radius,o=this._radius,(s=i._rotation01)<0&&(s=-s),(r=i._rotation11)<0&&(r=-r),(e=i._rotation21)<0&&(e=-e),a+=s*=this._halfHeight,n+=r*=this._halfHeight,o+=e*=this._halfHeight,t._minX=i._positionX-a,t._minY=i._positionY-n,t._minZ=i._positionZ-o,t._maxX=i._positionX+a,t._maxY=i._positionY+n,t._maxZ=i._positionZ+o},n.computeLocalSupportingVertex=function(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)},n._rayCastLocal=function(t,i,a,n,o,s,r){var e=this._halfHeight,_=n-t,h=s-a,l=0,c=1,m=_*_+h*h,v=t*_+a*h,b=t*t+a*a-this._radius*this._radius,f=v*v-m*b;if(f<0)return!1;if(m>0){var u=Math.sqrt(f);if(c=(-v+u)/m,(l=(-v-u)/m)>=1||c<=0)return!1}else{if(b>=0)return!1;l=0,c=1}var p,x,y,d,g,X,Y,z,Z=i+(o-i)*l;if(Z>-e&&Z<e){if(l>0){p=l;var M=r.normal.init(t+_*p,0,a+h*p),I=Math.sqrt(M.x*M.x+M.y*M.y+M.z*M.z);return I>0&&(I=1/I),M.x*=I,M.y*=I,M.z*=I,r.position.init(t+p*_,Z,a+p*h),r.fraction=p,!0}return!1}if(0,0,(f=(v=(y=t-0)*(X=n-t)+(d=i-(x=Z<0?-e:e))*(Y=o-i)+(g=a-0)*(z=s-a))*v-(m=X*X+Y*Y+z*z)*(b=y*y+d*d+g*g-this._radius*this._radius))<0)return!1;var V,w,L,k,A,B,P=(-v-Math.sqrt(f))/m;if(P<0||P>1)return!1;var S=(V=y+X*P)*V+(w=d+Y*P)*w+(L=g+z*P)*L;S>0&&(S=1/Math.sqrt(S)),k=V*S,A=w*S,B=L*S,V+=0,w+=x,L+=0;var T=r.position;T.x=V,T.y=w,T.z=L;var C=r.normal;return C.x=k,C.y=A,C.z=B,r.fraction=P,!0},i}(r.collision.geometry.ConvexGeometry),r.collision.geometry.ConeGeometry=function(t){function i(i,a){var n;return(n=t.call(this,3)||this)._radius=i,n._halfHeight=a,n.sinTheta=i/Math.sqrt(i*i+4*a*a),n.cosTheta=2*a/Math.sqrt(i*i+4*a*a),n._updateMass(),n}a(i,t);var n=i.prototype;return n.getRadius=function(){return this._radius},n.getHalfHeight=function(){return this._halfHeight},n._updateMass=function(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*i)},n._computeAabb=function(t,i){var a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z;s=(a=i._rotation01)*a,r=(n=i._rotation11)*n,e=(o=i._rotation21)*o,c=Math.sqrt(1-s),m=Math.sqrt(1-r),v=Math.sqrt(1-e),c*=this._radius,m*=this._radius,v*=this._radius,b=-(_=a*this._halfHeight),f=-(h=n*this._halfHeight),u=-(l=o*this._halfHeight),p=-_,x=-h,y=-l,(d=(b-=c)>(p+=c)?b:p)>_||(d=_),(g=(f-=m)>(x+=m)?f:x)>h||(g=h),(X=(u-=v)>(y+=v)?u:y)>l||(X=l),(Y=b<p?b:p)<_||(Y=_),(z=f<x?f:x)<h||(z=h),(Z=u<y?u:y)<l||(Z=l),t._minX=i._positionX+Y,t._minY=i._positionY+z,t._minZ=i._positionZ+Z,t._maxX=i._positionX+d,t._maxY=i._positionY+g,t._maxZ=i._positionZ+X},n.computeLocalSupportingVertex=function(t,i){var a=t.x,n=t.y,o=t.z;if(n>0&&n*n>this.sinTheta*this.sinTheta*(a*a+n*n+o*o))return i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(i.y<0&&(i.y=0));var s=t.x,r=t.z,e=s*s+r*r,_=2*this._halfHeight,h=(_-this._gjkMargin)/_*this._radius-this._gjkMargin/this.cosTheta;h<0&&(h=0);var l=e>0?h/Math.sqrt(e):0,c=this._halfHeight-this._gjkMargin;c<0&&(c=0),i.x=s*l,i.y=-c,i.z=r*l},n._rayCastLocal=function(t,i,a,n,o,s,r){var e=i,_=this._halfHeight,h=n-t,l=o-i,c=s-a,m=0,v=1;if(l>-1e-6&&l<1e-6){if(i<=-_||i>=_)return!1}else{var b=1/l,f=(-_-i)*b,u=(_-i)*b;if(f>u){var p=f;f=u,u=p}f>0&&(m=f),u<1&&(v=u)}if(m>=1||v<=0)return!1;var x=0,y=0;e=i-_;var d,g=this.cosTheta*this.cosTheta,X=g*(h*h+l*l+c*c)-l*l,Y=g*(t*h+e*l+a*c)-e*l,z=g*(t*t+e*e+a*a)-e*e,Z=Y*Y-X*z;if(0!=X){if(Z<0)return!1;var M=Math.sqrt(Z);if(X<0){if(l>0){if(x=0,(y=(-Y+M)/X)<=0)return!1}else if(y=1,(x=(-Y-M)/X)>=1)return!1}else if(y=(-Y+M)/X,(x=(-Y-M)/X)>=1||y<=0)return!1}else{var I=-z/(2*Y);if(Y>0){if(x=0,y=I,I<=0)return!1}else if(x=I,y=1,I>=1)return!1}if(e+=_,y<=m||v<=x)return!1;if(x<m){if(0==(d=m))return!1;r.normal.init(0,l>0?-1:1,0)}else{if(0==(d=x))return!1;var V=r.normal.init(t+h*d,0,a+c*d),w=Math.sqrt(V.x*V.x+V.y*V.y+V.z*V.z);w>0&&(w=1/w),V.x*=w,V.y*=w,V.z*=w;var L=this.cosTheta;V.x*=L,V.y*=L,V.z*=L,r.normal.y+=this.sinTheta}return r.position.init(t+d*h,e+d*l,a+d*c),r.fraction=d,!0},i}(r.collision.geometry.ConvexGeometry),r.collision.geometry.ConvexHullGeometry=function(t){function i(i){var a;(a=t.call(this,5)||this)._numVertices=i.length,a._vertices=new Array(a._numVertices),a._tmpVertices=new Array(a._numVertices);for(var n=0,o=a._numVertices;n<o;){var s=n++;a._vertices[s]=i[s],a._tmpVertices[s]=new r.common.Vec3}return a._useGjkRayCast=!0,a._updateMass(),a}a(i,t);var n=i.prototype;return n.getVertices=function(){return this._vertices},n._updateMass=function(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var t=this._vertices[0].x,i=this._vertices[0].y,a=this._vertices[0].z,n=this._vertices[0].x,o=this._vertices[0].y,s=this._vertices[0].z,r=1,e=this._numVertices;r<e;){var _=r++,h=this._vertices[_].x,l=this._vertices[_].y,c=this._vertices[_].z;h<t?t=h:h>n&&(n=h),l<i?i=l:l>o&&(o=l),c<a?a=c:c>s&&(s=c)}var m=n-t,v=o-i,b=s-a;this._volume=m*v*b;var f=.25*((t+n)*(t+n)+(i+o)*(i+o)+(a+s)*(a+s));m=m*m*.25,v=v*v*.25,b=b*b*.25,this._inertiaCoeff00=.3333333333333333*(v+b)+f,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(b+m)+f,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(m+v)+f},n._computeAabb=function(t,i){var a,n,o,s,r,e,_,h,l,c,m,v;_=this._gjkMargin,h=this._gjkMargin,l=this._gjkMargin;var b,f,u,p=this._vertices[0];c=p.x,m=p.y,v=p.z,b=i._rotation00*c+i._rotation01*m+i._rotation02*v,f=i._rotation10*c+i._rotation11*m+i._rotation12*v,u=i._rotation20*c+i._rotation21*m+i._rotation22*v,a=b+=i._positionX,n=f+=i._positionY,o=u+=i._positionZ,s=b,r=f,e=u;for(var x=1,y=this._numVertices;x<y;){var d=this._vertices[x++];c=d.x,m=d.y,v=d.z;b=i._rotation00*c+i._rotation01*m+i._rotation02*v,f=i._rotation10*c+i._rotation11*m+i._rotation12*v,u=i._rotation20*c+i._rotation21*m+i._rotation22*v,a<(b+=i._positionX)||(a=b),n<(f+=i._positionY)||(n=f),o<(u+=i._positionZ)||(o=u),s>b||(s=b),r>f||(r=f),e>u||(e=u)}t._minX=a-_,t._minY=n-h,t._minZ=o-l,t._maxX=s+_,t._maxY=r+h,t._maxZ=e+l},n.computeLocalSupportingVertex=function(t,i){for(var a=this._vertices[0],n=a.x*t.x+a.y*t.y+a.z*t.z,o=0,s=1,r=this._numVertices;s<r;){var e=s++,_=this._vertices[e],h=_.x*t.x+_.y*t.y+_.z*t.z;h>n&&(n=h,o=e)}var l=this._vertices[o];i.x=l.x,i.y=l.y,i.z=l.z},i}(r.collision.geometry.ConvexGeometry),r.collision.geometry.CylinderGeometry=function(t){function i(i,a){var n;return(n=t.call(this,2)||this)._radius=i,n._halfHeight=a,n._updateMass(),n}a(i,t);var n=i.prototype;return n.getRadius=function(){return this._radius},n.getHalfHeight=function(){return this._halfHeight},n._updateMass=function(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)},n._computeAabb=function(t,i){var a,n,o,s,r,e,_,h,l,c,m,v;(a=i._rotation01)<0&&(a=-a),(n=i._rotation11)<0&&(n=-n),(o=i._rotation21)<0&&(o=-o),s=a*a,r=n*n,e=o*o,_=Math.sqrt(1-s),h=Math.sqrt(1-r),l=Math.sqrt(1-e),_*=this._radius,h*=this._radius,l*=this._radius,c=_+a*this._halfHeight,m=h+n*this._halfHeight,v=l+o*this._halfHeight,t._minX=i._positionX-c,t._minY=i._positionY-m,t._minZ=i._positionZ-v,t._maxX=i._positionX+c,t._maxY=i._positionY+m,t._maxZ=i._positionZ+v},n.computeLocalSupportingVertex=function(t,i){var a=t.x,n=t.z,o=a*a+n*n,s=this._radius-this._gjkMargin;s<0&&(s=0);var r=o>0?s/Math.sqrt(o):0,e=this._halfHeight-this._gjkMargin;e<0&&(e=0),i.x=a*r,i.y=t.y>0?e:-e,i.z=n*r},n._rayCastLocal=function(t,i,a,n,o,s,r){var e=this._halfHeight,_=n-t,h=o-i,l=s-a,c=0,m=1;if(h>-1e-6&&h<1e-6){if(i<=-e||i>=e)return!1}else{var v=1/h,b=(-e-i)*v,f=(e-i)*v;if(b>f){var u=b;b=f,f=u}b>0&&(c=b),f<1&&(m=f)}if(c>=1||m<=0)return!1;var p,x=0,y=1,d=_*_+l*l,g=t*_+a*l,X=t*t+a*a-this._radius*this._radius,Y=g*g-d*X;if(Y<0)return!1;if(d>0){var z=Math.sqrt(Y);if(y=(-g+z)/d,(x=(-g-z)/d)>=1||y<=0)return!1}else{if(X>=0)return!1;x=0,y=1}if(y<=c||m<=x)return!1;if(x<c){if(0==(p=c))return!1;r.normal.init(0,h>0?-1:1,0)}else{if(0==(p=x))return!1;var Z=r.normal.init(t+_*p,0,a+l*p),M=Math.sqrt(Z.x*Z.x+Z.y*Z.y+Z.z*Z.z);M>0&&(M=1/M),Z.x*=M,Z.y*=M,Z.z*=M}return r.position.init(t+p*_,i+p*h,a+p*l),r.fraction=p,!0},i}(r.collision.geometry.ConvexGeometry),r.collision.geometry.GeometryType=function(){},r.collision.geometry.RayCastHit=function(){this.position=new r.common.Vec3,this.normal=new r.common.Vec3,this.fraction=0},r.collision.geometry.SphereGeometry=function(t){function i(i){var a;return(a=t.call(this,0)||this)._radius=i,a._gjkMargin=a._radius,a._updateMass(),a}a(i,t);var n=i.prototype;return n.getRadius=function(){return this._radius},n._updateMass=function(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius},n._computeAabb=function(t,i){var a,n,o;a=this._radius,n=this._radius,o=this._radius,t._minX=i._positionX-a,t._minY=i._positionY-n,t._minZ=i._positionZ-o,t._maxX=i._positionX+a,t._maxY=i._positionY+n,t._maxZ=i._positionZ+o},n.computeLocalSupportingVertex=function(t,i){i.zero()},n._rayCastLocal=function(t,i,a,n,o,s,r){var e,_,h,l=(e=n-t)*e+(_=o-i)*_+(h=s-a)*h,c=t*e+i*_+a*h,m=c*c-l*(t*t+i*i+a*a-this._radius*this._radius);if(m<0)return!1;var v,b,f,u,p,x,y=(-c-Math.sqrt(m))/l;if(y<0||y>1)return!1;var d=(v=t+e*y)*v+(b=i+_*y)*b+(f=a+h*y)*f;d>0&&(d=1/Math.sqrt(d)),u=v*d,p=b*d,x=f*d;var g=r.position;g.x=v,g.y=b,g.z=f;var X=r.normal;return X.x=u,X.y=p,X.z=x,r.fraction=y,!0},i}(r.collision.geometry.ConvexGeometry),r.collision.narrowphase||(r.collision.narrowphase={}),r.collision.narrowphase.CollisionMatrix=function(){function t(){this.detectors=new Array(8),this.detectors[0]=new Array(8),this.detectors[1]=new Array(8),this.detectors[2]=new Array(8),this.detectors[3]=new Array(8),this.detectors[4]=new Array(8),this.detectors[5]=new Array(8);var t=new r.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new r.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new r.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=t,this.detectors[0][3]=t,this.detectors[0][4]=new r.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=t,this.detectors[1][0]=new r.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new r.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=t,this.detectors[1][3]=t,this.detectors[1][4]=t,this.detectors[1][5]=t,this.detectors[2][0]=t,this.detectors[2][1]=t,this.detectors[2][2]=t,this.detectors[2][3]=t,this.detectors[2][4]=t,this.detectors[2][5]=t,this.detectors[3][0]=t,this.detectors[3][1]=t,this.detectors[3][2]=t,this.detectors[3][3]=t,this.detectors[3][4]=t,this.detectors[3][5]=t,this.detectors[4][0]=new r.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=t,this.detectors[4][2]=t,this.detectors[4][3]=t,this.detectors[4][4]=new r.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=t,this.detectors[5][0]=t,this.detectors[5][1]=t,this.detectors[5][2]=t,this.detectors[5][3]=t,this.detectors[5][4]=t,this.detectors[5][5]=t}return t.prototype.getDetector=function(t,i){return this.detectors[t][i]},t}(),r.collision.narrowphase.DetectorResult=function(){function t(){this.numPoints=0,this.normal=new r.common.Vec3,this.points=new Array(r.common.Setting.maxManifoldPoints),this.incremental=!1;for(var t=0,i=r.common.Setting.maxManifoldPoints;t<i;)this.points[t++]=new r.collision.narrowphase.DetectorResultPoint}var i=t.prototype;return i.getMaxDepth=function(){for(var t=0,i=0,a=this.numPoints;i<a;){var n=i++;this.points[n].depth>t&&(t=this.points[n].depth)}return t},i.clear=function(){this.numPoints=0;for(var t=0,i=this.points;t<i.length;){var a=i[t];++t,a.position1.zero(),a.position2.zero(),a.depth=0,a.id=0}this.normal.zero()},t}(),r.collision.narrowphase.DetectorResultPoint=function(){this.position1=new r.common.Vec3,this.position2=new r.common.Vec3,this.depth=0,this.id=0},r.collision.narrowphase.detector||(r.collision.narrowphase.detector={}),r.collision.narrowphase.detector.Detector=function(){function t(t){this.swapped=t}var i=t.prototype;return i.setNormal=function(t,i,a,n){var o=t.normal;if(o.x=i,o.y=a,o.z=n,this.swapped){var s=t.normal;s.x=-s.x,s.y=-s.y,s.z=-s.z}},i.addPoint=function(t,i,a,n,o,s,r,e,_){var h=t.points[t.numPoints++];if(h.depth=e,h.id=_,this.swapped){var l=h.position1;l.x=o,l.y=s,l.z=r;var c=h.position2;c.x=i,c.y=a,c.z=n}else{var m=h.position1;m.x=i,m.y=a,m.z=n;var v=h.position2;v.x=o,v.y=s,v.z=r}},i.detectImpl=function(t,i,a,n,o,s){},i.detect=function(t,i,a,n,o,s){t.numPoints=0;for(var r=0,e=t.points;r<e.length;){var _=e[r];++r,_.position1.zero(),_.position2.zero(),_.depth=0,_.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,a,i,o,n,s):this.detectImpl(t,i,a,n,o,s)},t}(),r.collision.narrowphase.detector.BoxBoxDetector=function(t){function i(){var i;return(i=t.call(this,!1)||this).clipper=new r.collision.narrowphase.detector._BoxBoxDetector.FaceClipper,i}return a(i,t),i.prototype.detectImpl=function(t,i,a,n,o,s){var e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P=i,S=a;t.incremental=!1,e=n._positionX,_=n._positionY,h=n._positionZ,v=(l=o._positionX)-e,b=(c=o._positionY)-_,f=(m=o._positionZ)-h,u=n._rotation00,p=n._rotation10,x=n._rotation20,y=n._rotation01,d=n._rotation11,g=n._rotation21,X=n._rotation02,Y=n._rotation12,z=n._rotation22,Z=o._rotation00,M=o._rotation10,I=o._rotation20,V=o._rotation01,w=o._rotation11,L=o._rotation21,k=o._rotation02,A=o._rotation12,B=o._rotation22;var T,C,j,R,E,q,D,N,F,G,J,W,O,U,H,Q,K,$,tt=P._halfExtentsX,it=P._halfExtentsY,at=P._halfExtentsZ,nt=S._halfExtentsX,ot=S._halfExtentsY,st=S._halfExtentsZ;T=u*tt,C=p*tt,j=x*tt,R=y*it,E=d*it,q=g*it,D=X*at,N=Y*at,F=z*at;var rt,et,_t,ht=Infinity,lt=-1,ct=0;rt=0,et=0,_t=0;var mt=tt,vt=u*(G=Z*nt)+p*(J=M*nt)+x*(W=I*nt),bt=u*(O=V*ot)+p*(U=w*ot)+x*(H=L*ot),ft=u*(Q=k*st)+p*(K=A*st)+x*($=B*st);vt<0&&(vt=-vt),bt<0&&(bt=-bt),ft<0&&(ft=-ft);var ut=vt+bt+ft,pt=u*v+p*b+x*f,xt=mt+ut,yt=pt<0,dt=yt?-pt:pt;if(dt<xt){var gt=xt-dt;gt<Infinity&&(ht=gt,lt=0,rt=u,et=p,_t=x,ct=yt?-1:1);var Xt=y*G+d*J+g*W,Yt=y*O+d*U+g*H,zt=y*Q+d*K+g*$;Xt<0&&(Xt=-Xt),Yt<0&&(Yt=-Yt),zt<0&&(zt=-zt);var Zt=(mt=it)+(ut=Xt+Yt+zt),Mt=(pt=y*v+d*b+g*f)<0,It=Mt?-pt:pt;if(It<Zt){var Vt=Zt-It;Vt<ht&&(ht=Vt,lt=1,rt=y,et=d,_t=g,ct=Mt?-1:1);var wt=X*G+Y*J+z*W,Lt=X*O+Y*U+z*H,kt=X*Q+Y*K+z*$;wt<0&&(wt=-wt),Lt<0&&(Lt=-Lt),kt<0&&(kt=-kt);var At=(mt=at)+(ut=wt+Lt+kt),Bt=(pt=X*v+Y*b+z*f)<0,Pt=Bt?-pt:pt;if(Pt<At){var St=At-Pt;St<ht&&(ht=St,lt=2,rt=X,et=Y,_t=z,ct=Bt?-1:1),ht>r.common.Setting.linearSlop?ht-=r.common.Setting.linearSlop:ht=0;var Tt=Z*T+M*C+I*j,Ct=Z*R+M*E+I*q,jt=Z*D+M*N+I*F;Tt<0&&(Tt=-Tt),Ct<0&&(Ct=-Ct),jt<0&&(jt=-jt);var Rt=(mt=Tt+Ct+jt)+(ut=nt),Et=(pt=Z*v+M*b+I*f)<0,qt=Et?-pt:pt;if(qt<Rt){var Dt=Rt-qt;Dt<ht&&(ht=Dt,lt=3,rt=Z,et=M,_t=I,ct=Et?-1:1);var Nt=V*T+w*C+L*j,Ft=V*R+w*E+L*q,Gt=V*D+w*N+L*F;Nt<0&&(Nt=-Nt),Ft<0&&(Ft=-Ft),Gt<0&&(Gt=-Gt);var Jt=(mt=Nt+Ft+Gt)+(ut=ot),Wt=(pt=V*v+w*b+L*f)<0,Ot=Wt?-pt:pt;if(Ot<Jt){var Ut=Jt-Ot;Ut<ht&&(ht=Ut,lt=4,rt=V,et=w,_t=L,ct=Wt?-1:1);var Ht=k*T+A*C+B*j,Qt=k*R+A*E+B*q,Kt=k*D+A*N+B*F;Ht<0&&(Ht=-Ht),Qt<0&&(Qt=-Qt),Kt<0&&(Kt=-Kt);var $t=(mt=Ht+Qt+Kt)+(ut=st),ti=(pt=k*v+A*b+B*f)<0,ii=ti?-pt:pt;if(ii<$t){var ai,ni,oi,si,ri,ei,_i,hi,li,ci,mi,vi,bi,fi,ui,pi,xi,yi,di,gi,Xi,Yi=$t-ii;if(Yi<ht&&(ht=Yi,lt=5,rt=k,et=A,_t=B,ct=ti?-1:1),ht>r.common.Setting.linearSlop?ht-=r.common.Setting.linearSlop:ht=0,ni=x*Z-u*I,oi=u*M-p*Z,0!=(ai=p*I-x*M)||0!=ni||0!=oi){var zi=ai*ai+ni*ni+oi*oi;zi>0&&(zi=1/Math.sqrt(zi));var Zi=(ai*=zi)*R+(ni*=zi)*E+(oi*=zi)*q,Mi=ai*D+ni*N+oi*F;Zi<0&&(Zi=-Zi),Mi<0&&(Mi=-Mi);var Ii=ai*O+ni*U+oi*H,Vi=ai*Q+ni*K+oi*$;Ii<0&&(Ii=-Ii),Vi<0&&(Vi=-Vi);var wi=(mt=Zi+Mi)+(ut=Ii+Vi),Li=(pt=ai*v+ni*b+oi*f)<0,ki=Li?-pt:pt;if(!(ki<wi))return;var Ai=wi-ki;Ai<ht&&(ht=Ai,lt=6,rt=ai,et=ni,_t=oi,ct=Li?-1:1)}if(ni=x*V-u*L,oi=u*w-p*V,0!=(ai=p*L-x*w)||0!=ni||0!=oi){var Bi=ai*ai+ni*ni+oi*oi;Bi>0&&(Bi=1/Math.sqrt(Bi));var Pi=(ai*=Bi)*R+(ni*=Bi)*E+(oi*=Bi)*q,Si=ai*D+ni*N+oi*F;Pi<0&&(Pi=-Pi),Si<0&&(Si=-Si);var Ti=ai*G+ni*J+oi*W,Ci=ai*Q+ni*K+oi*$;Ti<0&&(Ti=-Ti),Ci<0&&(Ci=-Ci);var ji=(mt=Pi+Si)+(ut=Ti+Ci),Ri=(pt=ai*v+ni*b+oi*f)<0,Ei=Ri?-pt:pt;if(!(Ei<ji))return;var qi=ji-Ei;qi<ht&&(ht=qi,lt=7,rt=ai,et=ni,_t=oi,ct=Ri?-1:1)}if(ni=x*k-u*B,oi=u*A-p*k,0!=(ai=p*B-x*A)||0!=ni||0!=oi){var Di=ai*ai+ni*ni+oi*oi;Di>0&&(Di=1/Math.sqrt(Di));var Ni=(ai*=Di)*R+(ni*=Di)*E+(oi*=Di)*q,Fi=ai*D+ni*N+oi*F;Ni<0&&(Ni=-Ni),Fi<0&&(Fi=-Fi);var Gi=ai*G+ni*J+oi*W,Ji=ai*O+ni*U+oi*H;Gi<0&&(Gi=-Gi),Ji<0&&(Ji=-Ji);var Wi=(mt=Ni+Fi)+(ut=Gi+Ji),Oi=(pt=ai*v+ni*b+oi*f)<0,Ui=Oi?-pt:pt;if(!(Ui<Wi))return;var Hi=Wi-Ui;Hi<ht&&(ht=Hi,lt=8,rt=ai,et=ni,_t=oi,ct=Oi?-1:1)}if(ni=g*Z-y*I,oi=y*M-d*Z,0!=(ai=d*I-g*M)||0!=ni||0!=oi){var Qi=ai*ai+ni*ni+oi*oi;Qi>0&&(Qi=1/Math.sqrt(Qi));var Ki=(ai*=Qi)*T+(ni*=Qi)*C+(oi*=Qi)*j,$i=ai*D+ni*N+oi*F;Ki<0&&(Ki=-Ki),$i<0&&($i=-$i);var ta=ai*O+ni*U+oi*H,ia=ai*Q+ni*K+oi*$;ta<0&&(ta=-ta),ia<0&&(ia=-ia);var aa=(mt=Ki+$i)+(ut=ta+ia),na=(pt=ai*v+ni*b+oi*f)<0,oa=na?-pt:pt;if(!(oa<aa))return;var sa=aa-oa;sa<ht&&(ht=sa,lt=9,rt=ai,et=ni,_t=oi,ct=na?-1:1)}if(ni=g*V-y*L,oi=y*w-d*V,0!=(ai=d*L-g*w)||0!=ni||0!=oi){var ra=ai*ai+ni*ni+oi*oi;ra>0&&(ra=1/Math.sqrt(ra));var ea=(ai*=ra)*T+(ni*=ra)*C+(oi*=ra)*j,_a=ai*D+ni*N+oi*F;ea<0&&(ea=-ea),_a<0&&(_a=-_a);var ha=ai*G+ni*J+oi*W,la=ai*Q+ni*K+oi*$;ha<0&&(ha=-ha),la<0&&(la=-la);var ca=(mt=ea+_a)+(ut=ha+la),ma=(pt=ai*v+ni*b+oi*f)<0,va=ma?-pt:pt;if(!(va<ca))return;var ba=ca-va;ba<ht&&(ht=ba,lt=10,rt=ai,et=ni,_t=oi,ct=ma?-1:1)}if(ni=g*k-y*B,oi=y*A-d*k,0!=(ai=d*B-g*A)||0!=ni||0!=oi){var fa=ai*ai+ni*ni+oi*oi;fa>0&&(fa=1/Math.sqrt(fa));var ua=(ai*=fa)*T+(ni*=fa)*C+(oi*=fa)*j,pa=ai*D+ni*N+oi*F;ua<0&&(ua=-ua),pa<0&&(pa=-pa);var xa=ai*G+ni*J+oi*W,ya=ai*O+ni*U+oi*H;xa<0&&(xa=-xa),ya<0&&(ya=-ya);var da=(mt=ua+pa)+(ut=xa+ya),ga=(pt=ai*v+ni*b+oi*f)<0,Xa=ga?-pt:pt;if(!(Xa<da))return;var Ya=da-Xa;Ya<ht&&(ht=Ya,lt=11,rt=ai,et=ni,_t=oi,ct=ga?-1:1)}if(ni=z*Z-X*I,oi=X*M-Y*Z,0!=(ai=Y*I-z*M)||0!=ni||0!=oi){var za=ai*ai+ni*ni+oi*oi;za>0&&(za=1/Math.sqrt(za));var Za=(ai*=za)*T+(ni*=za)*C+(oi*=za)*j,Ma=ai*R+ni*E+oi*q;Za<0&&(Za=-Za),Ma<0&&(Ma=-Ma);var Ia=ai*O+ni*U+oi*H,Va=ai*Q+ni*K+oi*$;Ia<0&&(Ia=-Ia),Va<0&&(Va=-Va);var wa=(mt=Za+Ma)+(ut=Ia+Va),La=(pt=ai*v+ni*b+oi*f)<0,ka=La?-pt:pt;if(!(ka<wa))return;var Aa=wa-ka;Aa<ht&&(ht=Aa,lt=12,rt=ai,et=ni,_t=oi,ct=La?-1:1)}if(ni=z*V-X*L,oi=X*w-Y*V,0!=(ai=Y*L-z*w)||0!=ni||0!=oi){var Ba=ai*ai+ni*ni+oi*oi;Ba>0&&(Ba=1/Math.sqrt(Ba));var Pa=(ai*=Ba)*T+(ni*=Ba)*C+(oi*=Ba)*j,Sa=ai*R+ni*E+oi*q;Pa<0&&(Pa=-Pa),Sa<0&&(Sa=-Sa);var Ta=ai*G+ni*J+oi*W,Ca=ai*Q+ni*K+oi*$;Ta<0&&(Ta=-Ta),Ca<0&&(Ca=-Ca);var ja=(mt=Pa+Sa)+(ut=Ta+Ca),Ra=(pt=ai*v+ni*b+oi*f)<0,Ea=Ra?-pt:pt;if(!(Ea<ja))return;var qa=ja-Ea;qa<ht&&(ht=qa,lt=13,rt=ai,et=ni,_t=oi,ct=Ra?-1:1)}if(ni=z*k-X*B,oi=X*A-Y*k,0!=(ai=Y*B-z*A)||0!=ni||0!=oi){var Da=ai*ai+ni*ni+oi*oi;Da>0&&(Da=1/Math.sqrt(Da));var Na=(ai*=Da)*T+(ni*=Da)*C+(oi*=Da)*j,Fa=ai*R+ni*E+oi*q;Na<0&&(Na=-Na),Fa<0&&(Fa=-Fa);var Ga=ai*G+ni*J+oi*W,Ja=ai*O+ni*U+oi*H;Ga<0&&(Ga=-Ga),Ja<0&&(Ja=-Ja);var Wa=(mt=Na+Fa)+(ut=Ga+Ja),Oa=(pt=ai*v+ni*b+oi*f)<0,Ua=Oa?-pt:pt;if(!(Ua<Wa))return;var Ha=Wa-Ua;Ha<ht&&(ht=Ha,lt=14,rt=ai,et=ni,_t=oi,ct=Oa?-1:1)}if(lt>=6){rt*=ct,et*=ct,_t*=ct;var Qa,Ka,$a,tn,an,nn,on,sn,rn,en,_n,hn,ln,cn,mn,vn=(lt-6)/3|0,bn=lt-6-3*vn;switch(vn){case 0:on=u,sn=p,rn=x;var fn=D*rt+N*et+F*_t>0;R*rt+E*et+q*_t>0?fn?(Qa=R+D,Ka=E+N,$a=q+F):(Qa=R-D,Ka=E-N,$a=q-F):fn?(Qa=D-R,Ka=N-E,$a=F-q):(Qa=-(Qa=R+D),Ka=-(Ka=E+N),$a=-($a=q+F));break;case 1:on=y,sn=d,rn=g;var un=D*rt+N*et+F*_t>0;T*rt+C*et+j*_t>0?un?(Qa=T+D,Ka=C+N,$a=j+F):(Qa=T-D,Ka=C-N,$a=j-F):un?(Qa=D-T,Ka=N-C,$a=F-j):(Qa=-(Qa=T+D),Ka=-(Ka=C+N),$a=-($a=j+F));break;default:on=X,sn=Y,rn=z;var pn=R*rt+E*et+q*_t>0;T*rt+C*et+j*_t>0?pn?(Qa=T+R,Ka=C+E,$a=j+q):(Qa=T-R,Ka=C-E,$a=j-q):pn?(Qa=R-T,Ka=E-C,$a=q-j):(Qa=-(Qa=T+R),Ka=-(Ka=C+E),$a=-($a=j+q))}switch(Qa=e+Qa,Ka=_+Ka,$a=h+$a,bn){case 0:en=Z,_n=M,hn=I;var xn=Q*rt+K*et+$*_t>0;O*rt+U*et+H*_t>0?xn?(tn=O+Q,an=U+K,nn=H+$):(tn=O-Q,an=U-K,nn=H-$):xn?(tn=Q-O,an=K-U,nn=$-H):(tn=-(tn=O+Q),an=-(an=U+K),nn=-(nn=H+$));break;case 1:en=V,_n=w,hn=L;var yn=Q*rt+K*et+$*_t>0;G*rt+J*et+W*_t>0?yn?(tn=G+Q,an=J+K,nn=W+$):(tn=G-Q,an=J-K,nn=W-$):yn?(tn=Q-G,an=K-J,nn=$-W):(tn=-(tn=G+Q),an=-(an=J+K),nn=-(nn=W+$));break;default:en=k,_n=A,hn=B;var dn=O*rt+U*et+H*_t>0;G*rt+J*et+W*_t>0?dn?(tn=G+O,an=J+U,nn=W+H):(tn=G-O,an=J-U,nn=W-H):dn?(tn=O-G,an=U-J,nn=H-W):(tn=-(tn=G+O),an=-(an=J+U),nn=-(nn=W+H))}var gn,Xn,Yn,zn,Zn,Mn,In,Vn,wn,Ln=on*en+sn*_n+rn*hn,kn=on*(ln=Qa-(tn=l-tn))+sn*(cn=Ka-(an=c-an))+rn*(mn=$a-(nn=m-nn)),An=en*ln+_n*cn+hn*mn,Bn=1/(1-Ln*Ln),Pn=(Ln*An-kn)*Bn,Sn=(An-Ln*kn)*Bn;return gn=Qa+on*Pn,Xn=Ka+sn*Pn,Yn=$a+rn*Pn,zn=tn+en*Sn,Zn=an+_n*Sn,Mn=nn+hn*Sn,In=-rt,Vn=-et,wn=-_t,this.setNormal(t,In,Vn,wn),void this.addPoint(t,gn,Xn,Yn,zn,Zn,Mn,ht,4)}if(lt>=3){ct=-ct,v=-v,b=-b,f=-f;var Tn=P;P=S,S=Tn;var Cn=tt;tt=nt,nt=Cn;var jn=it;it=ot,ot=jn;var Rn=at;at=st,st=Rn,si=e,ri=_,ei=h,e=l,_=c,h=m,l=si,c=ri,m=ei,si=u,ri=p,ei=x,u=Z,p=M,x=I,Z=si,M=ri,I=ei,si=y,ri=d,ei=g,y=V,d=w,g=L,V=si,w=ri,L=ei,si=X,ri=Y,ei=z,X=k,Y=A,z=B,k=si,A=ri,B=ei,si=T,ri=C,ei=j,T=G,C=J,j=W,G=si,J=ri,W=ei,si=R,ri=E,ei=q,R=O,E=U,q=H,O=si,U=ri,H=ei,si=D,ri=N,ei=F,D=Q,N=K,F=$,Q=si,K=ri,$=ei,lt-=3,_i=!0}else _i=!1;switch(lt){case 0:hi=T,li=C,ci=j,mi=u,vi=p,bi=x,fi=y,ui=d,pi=g,xi=X,yi=Y,di=z,gi=it,Xi=at;break;case 1:hi=R,li=E,ci=q,mi=y,vi=d,bi=g,fi=X,ui=Y,pi=z,xi=u,yi=p,di=x,gi=at,Xi=tt;break;default:hi=D,li=N,ci=F,mi=X,vi=Y,bi=z,fi=u,ui=p,pi=x,xi=y,yi=d,di=g,gi=tt,Xi=it}if(ct<0){hi=-hi,li=-li,ci=-ci,mi=-mi,vi=-vi,bi=-bi,si=fi,ri=ui,ei=pi,fi=xi,ui=yi,pi=di,xi=si,yi=ri,di=ei;var En=gi;gi=Xi,Xi=En}hi+=e,li+=_,ci+=h;var qn,Dn,Nn,Fn,Gn,Jn,Wn,On,Un,Hn,Qn,Kn,$n=1,to=0,io=mi*Z+vi*M+bi*I;switch(io<$n&&($n=io,to=0),-io<$n&&($n=-io,to=1),(io=mi*V+vi*w+bi*L)<$n&&($n=io,to=2),-io<$n&&($n=-io,to=3),(io=mi*k+vi*A+bi*B)<$n&&($n=io,to=4),-io<$n&&($n=-io,to=5),to){case 0:qn=G+O,Dn=J+U,Nn=W+H,qn+=Q,Dn+=K,Nn+=$,Fn=G-O,Gn=J-U,Jn=W-H,Fn+=Q,Gn+=K,Jn+=$,Wn=G-O,On=J-U,Un=W-H,Wn-=Q,On-=K,Un-=$,Hn=G+O,Qn=J+U,Kn=W+H,Hn-=Q,Qn-=K,Kn-=$;break;case 1:qn=O-G,Dn=U-J,Nn=H-W,qn+=Q,Dn+=K,Nn+=$,Fn=O-G,Gn=U-J,Jn=H-W,Fn-=Q,Gn-=K,Jn-=$,Wn=-(Wn=G+O),On=-(On=J+U),Un=-(Un=W+H),Wn-=Q,On-=K,Un-=$,Hn=-(Hn=G+O),Qn=-(Qn=J+U),Kn=-(Kn=W+H),Hn+=Q,Qn+=K,Kn+=$;break;case 2:qn=G+O,Dn=J+U,Nn=W+H,qn+=Q,Dn+=K,Nn+=$,Fn=G+O,Gn=J+U,Jn=W+H,Fn-=Q,Gn-=K,Jn-=$,Wn=O-G,On=U-J,Un=H-W,Wn-=Q,On-=K,Un-=$,Hn=O-G,Qn=U-J,Kn=H-W,Hn+=Q,Qn+=K,Kn+=$;break;case 3:qn=G-O,Dn=J-U,Nn=W-H,qn+=Q,Dn+=K,Nn+=$,Fn=-(Fn=G+O),Gn=-(Gn=J+U),Jn=-(Jn=W+H),Fn+=Q,Gn+=K,Jn+=$,Wn=-(Wn=G+O),On=-(On=J+U),Un=-(Un=W+H),Wn-=Q,On-=K,Un-=$,Hn=G-O,Qn=J-U,Kn=W-H,Hn-=Q,Qn-=K,Kn-=$;break;case 4:qn=G+O,Dn=J+U,Nn=W+H,qn+=Q,Dn+=K,Nn+=$,Fn=O-G,Gn=U-J,Jn=H-W,Fn+=Q,Gn+=K,Jn+=$,Wn=-(Wn=G+O),On=-(On=J+U),Un=-(Un=W+H),Wn+=Q,On+=K,Un+=$,Hn=G-O,Qn=J-U,Kn=W-H,Hn+=Q,Qn+=K,Kn+=$;break;default:qn=G+O,Dn=J+U,Nn=W+H,qn-=Q,Dn-=K,Nn-=$,Fn=G-O,Gn=J-U,Jn=W-H,Fn-=Q,Gn-=K,Jn-=$,Wn=-(Wn=G+O),On=-(On=J+U),Un=-(Un=W+H),Wn-=Q,On-=K,Un-=$,Hn=O-G,Qn=U-J,Kn=H-W,Hn-=Q,Qn-=K,Kn-=$}qn+=v,Dn+=b,Nn+=f,Fn+=v,Gn+=b,Jn+=f,Wn+=v,On+=b,Un+=f,Hn+=v,Qn+=b,Kn+=f;var ao=this.clipper;ao.w=gi,ao.h=Xi,ao.numVertices=0,ao.numTmpVertices=0;var no=this.clipper,oo=no.vertices[no.numVertices++];oo.x=qn*fi+Dn*ui+Nn*pi,oo.y=qn*xi+Dn*yi+Nn*di,oo.wx=qn,oo.wy=Dn,oo.wz=Nn;var so=this.clipper,ro=so.vertices[so.numVertices++];ro.x=Fn*fi+Gn*ui+Jn*pi,ro.y=Fn*xi+Gn*yi+Jn*di,ro.wx=Fn,ro.wy=Gn,ro.wz=Jn;var eo=this.clipper,_o=eo.vertices[eo.numVertices++];_o.x=Wn*fi+On*ui+Un*pi,_o.y=Wn*xi+On*yi+Un*di,_o.wx=Wn,_o.wy=On,_o.wz=Un;var ho,lo,co,mo=this.clipper,vo=mo.vertices[mo.numVertices++];vo.x=Hn*fi+Qn*ui+Kn*pi,vo.y=Hn*xi+Qn*yi+Kn*di,vo.wx=Hn,vo.wy=Qn,vo.wz=Kn,this.clipper.clip(),this.clipper.reduce(),_i?(ho=mi,lo=vi,co=bi):(ho=-mi,lo=-vi,co=-bi),this.setNormal(t,ho,lo,co);for(var bo=0,fo=this.clipper.numVertices;bo<fo;){var uo=bo++,po=this.clipper.vertices[uo],xo=void 0,yo=void 0,go=void 0;xo=po.wx,yo=po.wy,go=po.wz;var Xo,Yo,zo,Zo=(hi-(xo+=e))*mi+(li-(yo+=_))*vi+(ci-(go+=h))*bi;Xo=xo+mi*Zo,Yo=yo+vi*Zo,zo=go+bi*Zo,Zo>-r.common.Setting.contactPersistenceThreshold&&(_i?this.addPoint(t,xo,yo,go,Xo,Yo,zo,Zo,uo):this.addPoint(t,Xo,Yo,zo,xo,yo,go,Zo,uo))}}}}}}}},i}(r.collision.narrowphase.detector.Detector),r.collision.narrowphase.detector._BoxBoxDetector||(r.collision.narrowphase.detector._BoxBoxDetector={}),r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=function(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0},r.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=function(){function t(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0,this.vertices=new Array(8),this.tmpVertices=new Array(8),this.vertices[0]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new r.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}var i=t.prototype;return i.clip=function(){for(var t=0,i=this.numVertices;t<i;){var a=t++,n=this.vertices[a],o=this.vertices[(a+1)%this.numVertices],s=this.w+n.x,r=this.w+o.x;if(s>0&&r>0){var e=this.tmpVertices[this.numTmpVertices++];e.x=n.x,e.y=n.y,e.wx=n.wx,e.wy=n.wy,e.wz=n.wz}else if(s>0&&r<=0){var _=this.tmpVertices[this.numTmpVertices++];_.x=n.x,_.y=n.y,_.wx=n.wx,_.wy=n.wy,_.wz=n.wz;var h=s/(s-r),l=this.tmpVertices[this.numTmpVertices++];l.x=n.x+(o.x-n.x)*h,l.y=n.y+(o.y-n.y)*h,l.wx=n.wx+(o.wx-n.wx)*h,l.wy=n.wy+(o.wy-n.wy)*h,l.wz=n.wz+(o.wz-n.wz)*h}else if(s<=0&&r>0){var c=s/(s-r),m=this.tmpVertices[this.numTmpVertices++];m.x=n.x+(o.x-n.x)*c,m.y=n.y+(o.y-n.y)*c,m.wx=n.wx+(o.wx-n.wx)*c,m.wy=n.wy+(o.wy-n.wy)*c,m.wz=n.wz+(o.wz-n.wz)*c}}var v=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=v,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var b=0,f=this.numVertices;b<f;){var u=b++,p=this.vertices[u],x=this.vertices[(u+1)%this.numVertices],y=this.w-p.x,d=this.w-x.x;if(y>0&&d>0){var g=this.tmpVertices[this.numTmpVertices++];g.x=p.x,g.y=p.y,g.wx=p.wx,g.wy=p.wy,g.wz=p.wz}else if(y>0&&d<=0){var X=this.tmpVertices[this.numTmpVertices++];X.x=p.x,X.y=p.y,X.wx=p.wx,X.wy=p.wy,X.wz=p.wz;var Y=y/(y-d),z=this.tmpVertices[this.numTmpVertices++];z.x=p.x+(x.x-p.x)*Y,z.y=p.y+(x.y-p.y)*Y,z.wx=p.wx+(x.wx-p.wx)*Y,z.wy=p.wy+(x.wy-p.wy)*Y,z.wz=p.wz+(x.wz-p.wz)*Y}else if(y<=0&&d>0){var Z=y/(y-d),M=this.tmpVertices[this.numTmpVertices++];M.x=p.x+(x.x-p.x)*Z,M.y=p.y+(x.y-p.y)*Z,M.wx=p.wx+(x.wx-p.wx)*Z,M.wy=p.wy+(x.wy-p.wy)*Z,M.wz=p.wz+(x.wz-p.wz)*Z}}var I=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=I,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var V=0,w=this.numVertices;V<w;){var L=V++,k=this.vertices[L],A=this.vertices[(L+1)%this.numVertices],B=this.h+k.y,P=this.h+A.y;if(B>0&&P>0){var S=this.tmpVertices[this.numTmpVertices++];S.x=k.x,S.y=k.y,S.wx=k.wx,S.wy=k.wy,S.wz=k.wz}else if(B>0&&P<=0){var T=this.tmpVertices[this.numTmpVertices++];T.x=k.x,T.y=k.y,T.wx=k.wx,T.wy=k.wy,T.wz=k.wz;var C=B/(B-P),j=this.tmpVertices[this.numTmpVertices++];j.x=k.x+(A.x-k.x)*C,j.y=k.y+(A.y-k.y)*C,j.wx=k.wx+(A.wx-k.wx)*C,j.wy=k.wy+(A.wy-k.wy)*C,j.wz=k.wz+(A.wz-k.wz)*C}else if(B<=0&&P>0){var R=B/(B-P),E=this.tmpVertices[this.numTmpVertices++];E.x=k.x+(A.x-k.x)*R,E.y=k.y+(A.y-k.y)*R,E.wx=k.wx+(A.wx-k.wx)*R,E.wy=k.wy+(A.wy-k.wy)*R,E.wz=k.wz+(A.wz-k.wz)*R}}var q=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=q,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var D=0,N=this.numVertices;D<N;){var F=D++,G=this.vertices[F],J=this.vertices[(F+1)%this.numVertices],W=this.h-G.y,O=this.h-J.y;if(W>0&&O>0){var U=this.tmpVertices[this.numTmpVertices++];U.x=G.x,U.y=G.y,U.wx=G.wx,U.wy=G.wy,U.wz=G.wz}else if(W>0&&O<=0){var H=this.tmpVertices[this.numTmpVertices++];H.x=G.x,H.y=G.y,H.wx=G.wx,H.wy=G.wy,H.wz=G.wz;var Q=W/(W-O),K=this.tmpVertices[this.numTmpVertices++];K.x=G.x+(J.x-G.x)*Q,K.y=G.y+(J.y-G.y)*Q,K.wx=G.wx+(J.wx-G.wx)*Q,K.wy=G.wy+(J.wy-G.wy)*Q,K.wz=G.wz+(J.wz-G.wz)*Q}else if(W<=0&&O>0){var $=W/(W-O),tt=this.tmpVertices[this.numTmpVertices++];tt.x=G.x+(J.x-G.x)*$,tt.y=G.y+(J.y-G.y)*$,tt.wx=G.wx+(J.wx-G.wx)*$,tt.wy=G.wy+(J.wy-G.wy)*$,tt.wz=G.wz+(J.wz-G.wz)*$}}var it=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=it,this.numVertices=this.numTmpVertices,this.numTmpVertices=0},i.reduce=function(){if(!(this.numVertices<4)){for(var t=-Infinity,i=Infinity,a=-Infinity,n=Infinity,o=null,s=null,r=null,e=null,_=0,h=this.numVertices;_<h;){var l=this.vertices[_++],c=1*l.x+1*l.y,m=-1*l.x+1*l.y;c>t&&(t=c,o=l),c<i&&(i=c,s=l),m>a&&(a=m,r=l),m<n&&(n=m,e=l)}var v=this.tmpVertices[this.numTmpVertices++];v.x=o.x,v.y=o.y,v.wx=o.wx,v.wy=o.wy,v.wz=o.wz;var b=this.tmpVertices[this.numTmpVertices++];b.x=r.x,b.y=r.y,b.wx=r.wx,b.wy=r.wy,b.wz=r.wz;var f=this.tmpVertices[this.numTmpVertices++];f.x=s.x,f.y=s.y,f.wx=s.wx,f.wy=s.wy,f.wz=s.wz;var u=this.tmpVertices[this.numTmpVertices++];u.x=e.x,u.y=e.y,u.wx=e.wx,u.wy=e.wy,u.wz=e.wz;var p=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=p,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}},t}(),r.collision.narrowphase.detector.BoxBoxDetectorMacro=function(){},r.collision.narrowphase.detector.CachedDetectorData=function(){function t(){}return t.prototype._clear=function(){null!=this._gjkCache&&this._gjkCache.clear()},t}(),r.collision.narrowphase.detector.CapsuleCapsuleDetector=function(t){function i(){return t.call(this,!1)||this}return a(i,t),i.prototype.detectImpl=function(t,i,a,n,o,s){var r,e,_,h,l,c,m=i,v=a;t.incremental=!1,r=n._rotation01,e=n._rotation11,_=n._rotation21,h=o._rotation01,l=o._rotation11,c=o._rotation21;var b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A=m._halfHeight,B=v._halfHeight,P=m._radius,S=v._radius;b=n._positionX+r*-A,f=n._positionY+e*-A,u=n._positionZ+_*-A,p=n._positionX+r*A,x=n._positionY+e*A,y=n._positionZ+_*A;var T,C,j,R,E,q,D,N,F,G,J,W=-((Y=b-(d=o._positionX+h*-B))*(M=p-b)+(z=f-(g=o._positionY+l*-B))*(I=x-f)+(Z=u-(X=o._positionZ+c*-B))*(V=y-u)),O=Y*(w=o._positionX+h*B-d)+z*(L=o._positionY+l*B-g)+Z*(k=o._positionZ+c*B-X),U=A*A*4,H=M*w+I*L+V*k,Q=B*B*4;if(0==U&&0==Q)T=0,C=0;else if(0==U)T=0,C=O,C=O<0?0:O>Q?1:O/Q;else if(0==Q)C=0,T=W,T=W<0?0:W>U?1:W/U;else{var K=U*Q-H*H;0==K||(T=H*O+Q*W)<0?T=0:T>K?T=1:T/=K,(C=T*H+O)<0?(C=0,T=W,T=W<0?0:W>U?1:W/U):C>Q?(C=1,(T=H+W)<0?T=0:T>U?T=1:T/=U):C/=Q}var $=(F=(j=b+M*T)-(q=d+w*C))*F+(G=(R=f+I*T)-(D=g+L*C))*G+(J=(E=u+V*T)-(N=X+k*C))*J;if(!($>=(P+S)*(P+S))){var tt,it,at,nt,ot,st,rt,et,_t,ht=Math.sqrt($);ht>0?(tt=F*(1/ht),it=G*(1/ht),at=J*(1/ht)):(tt=1,it=0,at=0),this.setNormal(t,tt,it,at),nt=j+tt*-P,ot=R+it*-P,st=E+at*-P,rt=q+tt*S,et=D+it*S,_t=N+at*S,this.addPoint(t,nt,ot,st,rt,et,_t,P+S-ht,0)}},i}(r.collision.narrowphase.detector.Detector),r.collision.narrowphase.detector.GjkEpaDetector=function(t){function i(){return t.call(this,!1)||this}return a(i,t),i.prototype.detectImpl=function(t,i,a,n,o,s){var e=r.collision.narrowphase.detector.gjkepa.GjkEpa.instance,_=i,h=a,l=e.computeClosestPointsImpl(_,h,n,o,r.common.Setting.enableGJKCaching?s:null,!0);if(t.incremental=!0,l==r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){if(!(e.distance>_._gjkMargin+h._gjkMargin)){var c,m,v,b,f,u,p=e.closestPoint1;c=p.x,m=p.y,v=p.z;var x,y,d,g=e.closestPoint2;if((x=c-(b=g.x))*x+(y=m-(f=g.y))*y+(d=v-(u=g.z))*d!=0){e.distance<0&&(x=-x,y=-y,d=-d);var X=x*x+y*y+d*d;X>0&&(X=1/Math.sqrt(X)),x*=X,y*=X,d*=X,this.setNormal(t,x,y,d),c+=x*-_._gjkMargin,m+=y*-_._gjkMargin,v+=d*-_._gjkMargin,b+=x*h._gjkMargin,f+=y*h._gjkMargin,u+=d*h._gjkMargin,this.addPoint(t,c,m,v,b,f,u,_._gjkMargin+h._gjkMargin-e.distance,0)}}}else console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+l)},i}(r.collision.narrowphase.detector.Detector),r.collision.narrowphase.detector.SphereBoxDetector=function(t){function i(i){return t.call(this,i)||this}return a(i,t),i.prototype.detectImpl=function(t,i,a,n,o,s){var r,e,_,h,l,c,m=a;t.incremental=!1,h=-(r=m._halfExtentsX),l=-(e=m._halfExtentsY),c=-(_=m._halfExtentsZ);var v,b,f,u,p,x,y,d,g,X,Y,z,Z,M=i._radius;if(v=n._positionX-o._positionX,b=n._positionY-o._positionY,f=n._positionZ-o._positionZ,y=o._rotation00*v+o._rotation10*b+o._rotation20*f,p=o._rotation01*v+o._rotation11*b+o._rotation21*f,x=o._rotation02*v+o._rotation12*b+o._rotation22*f,h<(u=y)&&r>u&&l<p&&e>p&&c<x&&_>x){var I,V,w,L,k,A,B,P,S,T,C,j,R,E,q,D,N,F,G,J,W,O,U,H,Q;I=r-(I=u<0?-u:u),V=e-(V=p<0?-p:p),w=_-(w=x<0?-x:x);return I<V?I<w?(u>0?(L=1,k=0,A=0):(L=-1,k=0,A=0),P=0,S=1,T=1,B=I):(x>0?(L=0,k=0,A=1):(L=0,k=0,A=-1),P=1,S=1,T=0,B=w):V<w?(p>0?(L=0,k=1,A=0):(L=0,k=-1,A=0),P=1,S=0,T=1,B=V):(x>0?(L=0,k=0,A=1):(L=0,k=0,A=-1),P=1,S=1,T=0,B=w),C=L*r,j=k*e,R=A*_,C+=P*u,j+=S*p,R+=T*x,E=o._rotation00*C+o._rotation01*j+o._rotation02*R,q=o._rotation10*C+o._rotation11*j+o._rotation12*R,D=o._rotation20*C+o._rotation21*j+o._rotation22*R,N=o._rotation00*L+o._rotation01*k+o._rotation02*A,F=o._rotation10*L+o._rotation11*k+o._rotation12*A,G=o._rotation20*L+o._rotation21*k+o._rotation22*A,this.setNormal(t,N,F,G),J=n._positionX+N*-M,W=n._positionY+F*-M,O=n._positionZ+G*-M,U=o._positionX+E,H=o._positionY+q,Q=o._positionZ+D,void this.addPoint(t,J,W,O,U,H,Q,B,0)}(d=u<(r-=1e-9)?u:r)>(h+=1e-9)||(d=h),(g=p<(e-=1e-9)?p:e)>(l+=1e-9)||(g=l),(X=x<(_-=1e-9)?x:_)>(c+=1e-9)||(X=c);var K=(Y=u-d)*Y+(z=p-g)*z+(Z=x-X)*Z;if(!(K>=M*M)){var $,tt,it,at,nt,ot,st,rt,et;K=Math.sqrt(K),$=o._rotation00*d+o._rotation01*g+o._rotation02*X,tt=o._rotation10*d+o._rotation11*g+o._rotation12*X,it=o._rotation20*d+o._rotation21*g+o._rotation22*X;var _t,ht,lt,ct,mt,vt,bt=(at=o._rotation00*Y+o._rotation01*z+o._rotation02*Z)*at+(nt=o._rotation10*Y+o._rotation11*z+o._rotation12*Z)*nt+(ot=o._rotation20*Y+o._rotation21*z+o._rotation22*Z)*ot;bt>0&&(bt=1/Math.sqrt(bt)),st=at*bt,rt=nt*bt,et=ot*bt,this.setNormal(t,st,rt,et),_t=n._positionX+st*-M,ht=n._positionY+rt*-M,lt=n._positionZ+et*-M,ct=o._positionX+$,mt=o._positionY+tt,vt=o._positionZ+it,this.addPoint(t,_t,ht,lt,ct,mt,vt,M-K,0)}},i}(r.collision.narrowphase.detector.Detector),r.collision.narrowphase.detector.SphereCapsuleDetector=function(t){function i(i){return t.call(this,i)||this}return a(i,t),i.prototype.detectImpl=function(t,i,a,n,o,s){var r=a;t.incremental=!1;var e,_,h,l,c,m,v,b,f,u,p,x,y=r._halfHeight,d=i._radius,g=r._radius;e=o._rotation01,_=o._rotation11,h=o._rotation21,l=n._positionX,c=n._positionY,m=n._positionZ,v=o._positionX+e*-y,b=o._positionY+_*-y,f=o._positionZ+h*-y;var X,Y,z,Z,M,I,V=y*y*4,w=(l-v)*(u=o._positionX+e*y-v)+(c-b)*(p=o._positionY+_*y-b)+(m-f)*(x=o._positionZ+h*y-f);w<0?w=0:w>V?w=1:w/=V;var L=(Z=l-(X=v+u*w))*Z+(M=c-(Y=b+p*w))*M+(I=m-(z=f+x*w))*I;if(!(L>=(d+g)*(d+g))){var k,A,B,P,S,T,C,j,R,E=Math.sqrt(L);E>0?(k=Z*(1/E),A=M*(1/E),B=I*(1/E)):(k=1,A=0,B=0),this.setNormal(t,k,A,B),P=l+k*-d,S=c+A*-d,T=m+B*-d,C=X+k*g,j=Y+A*g,R=z+B*g,this.addPoint(t,P,S,T,C,j,R,d+g-E,0)}},i}(r.collision.narrowphase.detector.Detector),r.collision.narrowphase.detector.SphereSphereDetector=function(t){function i(){return t.call(this,!1)||this}return a(i,t),i.prototype.detectImpl=function(t,i,a,n,o,s){var r,e,_;t.incremental=!1,r=n._positionX-o._positionX,e=n._positionY-o._positionY,_=n._positionZ-o._positionZ;var h=i._radius,l=a._radius,c=r*r+e*e+_*_;if(!(c>=(h+l)*(h+l))){var m,v,b,f,u,p,x,y,d,g=Math.sqrt(c);g>0?(m=r*(1/g),v=e*(1/g),b=_*(1/g)):(m=1,v=0,b=0),this.setNormal(t,m,v,b),f=n._positionX+m*-h,u=n._positionY+v*-h,p=n._positionZ+b*-h,x=o._positionX+m*l,y=o._positionY+v*l,d=o._positionZ+b*l,this.addPoint(t,f,u,p,x,y,d,h+l-g,0)}},i}(r.collision.narrowphase.detector.Detector),r.collision.narrowphase.detector.gjkepa||(r.collision.narrowphase.detector.gjkepa={}),r.collision.narrowphase.detector.gjkepa.EpaPolyhedron=function(){function t(){this._vertices=new Array(r.common.Setting.maxEPAVertices),this._center=new r.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}var i=t.prototype;return i.dumpHoleEdge=function(t){},i.validate=function(){for(var t=this._triangleList;null!=t;){if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[0])return this._status=2,!1;if(null==t._adjacentTriangles[0])return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[1])return this._status=2,!1;if(null==t._adjacentTriangles[1])return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[2])return this._status=2,!1;if(null==t._adjacentTriangles[2])return this._status=3,!1;t=t._next}return!0},i.findEdgeLoop=function(t,i,a){if(i._tmpDfsId!=t){i._tmpDfsId=t;var n=i.tmp;n.x=a.x,n.y=a.y,n.z=a.z;var o=i._vertices[0].v;n.x-=o.x,n.y-=o.y,n.z-=o.z;var s=i.tmp,r=i._normal;if(i._tmpDfsVisible=s.x*r.x+s.y*r.y+s.z*r.z>0,i._tmpDfsVisible){for(var e=0;e<3;){var _=e++,h=i._adjacentTriangles[_];if(null!=h){var l=h.tmp;l.x=a.x,l.y=a.y,l.z=a.z;var c=h._vertices[0].v;l.x-=c.x,l.y-=c.y,l.z-=c.z;var m=h.tmp,v=h._normal;if(h._tmpDfsVisible=m.x*v.x+m.y*v.y+m.z*v.z>0,h._tmpDfsVisible)this.findEdgeLoop(t,h,a);else{var b=i._vertices[_];b._tmpEdgeLoopNext=i._vertices[i._nextIndex[_]],b._tmpEdgeLoopOuterTriangle=h}}}var f=i._adjacentTriangles[0];if(null!=f){var u=i._adjacentPairIndex[0];f._adjacentTriangles[u]=null,f._adjacentPairIndex[u]=-1,i._adjacentTriangles[0]=null,i._adjacentPairIndex[0]=-1}var p=i._adjacentTriangles[1];if(null!=p){var x=i._adjacentPairIndex[1];p._adjacentTriangles[x]=null,p._adjacentPairIndex[x]=-1,i._adjacentTriangles[1]=null,i._adjacentPairIndex[1]=-1}var y=i._adjacentTriangles[2];if(null!=y){var d=i._adjacentPairIndex[2];y._adjacentTriangles[d]=null,y._adjacentPairIndex[d]=-1,i._adjacentTriangles[2]=null,i._adjacentPairIndex[2]=-1}this._numTriangles--;var g=i._prev,X=i._next;null!=g&&(g._next=X),null!=X&&(X._prev=g),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}else this._status=6}},i._init=function(t,i,a,n){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a,this._vertices[3]=n;var o=this._center,s=t.v;o.x=s.x,o.y=s.y,o.z=s.z;var e=i.v;o.x+=e.x,o.y+=e.y,o.z+=e.z;var _=a.v;o.x+=_.x,o.y+=_.y,o.z+=_.z;var h=n.v;o.x+=h.x,o.y+=h.y,o.z+=h.z,o.x*=.25,o.y*=.25,o.z*=.25;var l=this._trianglePool;null!=l?(this._trianglePool=l._next,l._next=null):l=new r.collision.narrowphase.detector.gjkepa.EpaTriangle;var c=l,m=this._trianglePool;null!=m?(this._trianglePool=m._next,m._next=null):m=new r.collision.narrowphase.detector.gjkepa.EpaTriangle;var v=m,b=this._trianglePool;null!=b?(this._trianglePool=b._next,b._next=null):b=new r.collision.narrowphase.detector.gjkepa.EpaTriangle;var f=b,u=this._trianglePool;null!=u?(this._trianglePool=u._next,u._next=null):u=new r.collision.narrowphase.detector.gjkepa.EpaTriangle;var p=u;return c.init(t,i,a,this._center,!0)||(this._status=1),v.init(t,i,n,this._center,!0)||(this._status=1),f.init(t,a,n,this._center,!0)||(this._status=1),p.init(i,a,n,this._center,!0)||(this._status=1),c.setAdjacentTriangle(v)||(this._status=1),c.setAdjacentTriangle(f)||(this._status=1),c.setAdjacentTriangle(p)||(this._status=1),v.setAdjacentTriangle(f)||(this._status=1),v.setAdjacentTriangle(p)||(this._status=1),f.setAdjacentTriangle(p)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=c,this._triangleListLast=c):(this._triangleListLast._next=c,c._prev=this._triangleListLast,this._triangleListLast=c),this._numTriangles++,null==this._triangleList?(this._triangleList=v,this._triangleListLast=v):(this._triangleListLast._next=v,v._prev=this._triangleListLast,this._triangleListLast=v),this._numTriangles++,null==this._triangleList?(this._triangleList=f,this._triangleListLast=f):(this._triangleListLast._next=f,f._prev=this._triangleListLast,this._triangleListLast=f),this._numTriangles++,null==this._triangleList?(this._triangleList=p,this._triangleListLast=p):(this._triangleListLast._next=p,p._prev=this._triangleListLast,this._triangleListLast=p),0==this._status},i._addVertex=function(t,i){this._vertices[this._numVertices++]=t;var a=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),0!=this._status)return!1;for(var n=a,o=null,s=null;;){if(null==n._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==n._tmpEdgeLoopOuterTriangle)return this._status=5,!1;var e=this._trianglePool;null!=e?(this._trianglePool=e._next,e._next=null):e=new r.collision.narrowphase.detector.gjkepa.EpaTriangle;var _=e;if(null==s&&(s=_),_.init(n,n._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=_,this._triangleListLast=_):(this._triangleListLast._next=_,_._prev=this._triangleListLast,this._triangleListLast=_),_.setAdjacentTriangle(n._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=o&&(_.setAdjacentTriangle(o)||(this._status=1)),o=_,(n=n._tmpEdgeLoopNext)==a)break}return o.setAdjacentTriangle(s)||(this._status=1),0==this._status&&this.validate()},i._dumpAsObjModel=function(){},t}(),r.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=function(){},r.collision.narrowphase.detector.gjkepa.EpaTriangle=function(){function t(){this.id=++r.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new r.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._vertices=new Array(3),this._adjacentTriangles=new Array(3),this._adjacentPairIndex=new Array(3),this.tmp=new r.common.Vec3,this._nextIndex=new Array(3),this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}var i=t.prototype;return i.init=function(t,i,a,n,o){var s,r,e,_,h,l,c,m,v;null==o&&(o=!1);var b=t.v;s=b.x,r=b.y,e=b.z;var f=i.v;_=f.x,h=f.y,l=f.z;var u,p,x,y,d,g,X,Y,z,Z=a.v;c=Z.x,m=Z.y,v=Z.z;var M=!1;if((s-n.x)*(X=(p=h-r)*(g=v-e)-(x=l-e)*(d=m-r))+(r-n.y)*(Y=x*(y=c-s)-(u=_-s)*g)+(e-n.z)*(z=u*d-p*y)<0)if(o){var I=i;i=a,a=I,X*=-1,Y*=-1,z*=-1}else M=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a;var V=this._normal;V.x=X,V.y=Y,V.z=z;var w,L,k,A,B,P,S,T,C,j,R,E,q,D,N,F,G,J,W,O,U,H,Q,K,$,tt,it,at=t.v,nt=i.v,ot=a.v,st=this.tmp;w=at.x,L=at.y,k=at.z,A=nt.x,B=nt.y,P=nt.z,S=ot.x,H=(D=(T=ot.y)-B)*(U=(j=A-w)*D-(R=B-L)*(q=S-A))-(N=(C=ot.z)-P)*(O=(E=P-k)*q-j*N),Q=N*(W=R*N-E*D)-q*U,K=q*O-D*W,$=(G=L-T)*U-(J=k-C)*O,tt=J*W-(F=w-S)*U,it=F*O-G*W;var rt,et,_t,ht=-1;if(rt=0,et=0,_t=0,w*(R*U-E*O)+L*(E*W-j*U)+k*(j*O-R*W)<0){var lt,ct,mt,vt,bt,ft,ut,pt,xt;lt=at.x,ct=at.y,mt=at.z;var yt=(ut=(vt=nt.x)-lt)*lt+(pt=(bt=nt.y)-ct)*ct+(xt=(ft=nt.z)-mt)*mt;if((yt=-yt/(ut*ut+pt*pt+xt*xt))<0)st.x=lt,st.y=ct,st.z=mt;else if(yt>1)st.x=vt,st.y=bt,st.z=ft;else{var dt,gt,Xt;dt=lt+ut*yt,gt=ct+pt*yt,Xt=mt+xt*yt,st.x=dt,st.y=gt,st.z=Xt}ht=st.x*st.x+st.y*st.y+st.z*st.z,rt=st.x,et=st.y,_t=st.z}if(A*H+B*Q+P*K<0){var Yt,zt,Zt,Mt,It,Vt,wt,Lt,kt;Yt=nt.x,zt=nt.y,Zt=nt.z;var At=(wt=(Mt=ot.x)-Yt)*Yt+(Lt=(It=ot.y)-zt)*zt+(kt=(Vt=ot.z)-Zt)*Zt;if((At=-At/(wt*wt+Lt*Lt+kt*kt))<0)st.x=Yt,st.y=zt,st.z=Zt;else if(At>1)st.x=Mt,st.y=It,st.z=Vt;else{var Bt,Pt,St;Bt=Yt+wt*At,Pt=zt+Lt*At,St=Zt+kt*At,st.x=Bt,st.y=Pt,st.z=St}var Tt=st.x*st.x+st.y*st.y+st.z*st.z;(ht<0||Tt<ht)&&(ht=Tt,rt=st.x,et=st.y,_t=st.z)}if(S*$+T*tt+C*it<0){var Ct,jt,Rt,Et,qt,Dt,Nt,Ft,Gt;Ct=at.x,jt=at.y,Rt=at.z;var Jt=(Nt=(Et=ot.x)-Ct)*Ct+(Ft=(qt=ot.y)-jt)*jt+(Gt=(Dt=ot.z)-Rt)*Rt;if((Jt=-Jt/(Nt*Nt+Ft*Ft+Gt*Gt))<0)st.x=Ct,st.y=jt,st.z=Rt;else if(Jt>1)st.x=Et,st.y=qt,st.z=Dt;else{var Wt,Ot,Ut;Wt=Ct+Nt*Jt,Ot=jt+Ft*Jt,Ut=Rt+Gt*Jt,st.x=Wt,st.y=Ot,st.z=Ut}var Ht=st.x*st.x+st.y*st.y+st.z*st.z;(ht<0||Ht<ht)&&(ht=Ht,rt=st.x,et=st.y,_t=st.z)}if(ht>0)st.x=rt,st.y=et,st.z=_t;else{var Qt=W*W+O*O+U*U;Qt>0&&(Qt=1/Math.sqrt(Qt));var Kt=(W*=Qt)*W+(O*=Qt)*O+(U*=Qt)*U;rt=W*(Kt=(w*W+L*O+k*U)/Kt),et=O*Kt,_t=U*Kt,st.x=rt,st.y=et,st.z=_t}var $t=this.tmp;return this._distanceSq=$t.x*$t.x+$t.y*$t.y+$t.z*$t.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!M},i.setAdjacentTriangle=function(t){var i=0;return this._vertices[0]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[0]]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,i=1),this._vertices[0]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[0]]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++i),this._vertices[0]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[0]]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++i),this._vertices[1]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[1]]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[1]]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[1]]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++i),this._vertices[2]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[2]]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[2]]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[2]]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++i),1==i},i.removeAdjacentTriangles=function(){var t=this._adjacentTriangles[0];if(null!=t){var i=this._adjacentPairIndex[0];t._adjacentTriangles[i]=null,t._adjacentPairIndex[i]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}var a=this._adjacentTriangles[1];if(null!=a){var n=this._adjacentPairIndex[1];a._adjacentTriangles[n]=null,a._adjacentPairIndex[n]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}var o=this._adjacentTriangles[2];if(null!=o){var s=this._adjacentPairIndex[2];o._adjacentTriangles[s]=null,o._adjacentPairIndex[s]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}},i.removeReferences=function(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0},i.dump=function(){},t}(),r.collision.narrowphase.detector.gjkepa.EpaVertex=function(){function t(){this.randId=1e5*Math.random()|0,this.v=new r.common.Vec3,this.w1=new r.common.Vec3,this.w2=new r.common.Vec3}var i=t.prototype;return i.init=function(t,i,a){var n=this.v;n.x=t.x,n.y=t.y,n.z=t.z;var o=this.w1;o.x=i.x,o.y=i.y,o.z=i.z;var s=this.w2;return s.x=a.x,s.y=a.y,s.z=a.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this},i.removeReferences=function(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null},t}(),r.collision.narrowphase.detector.gjkepa.GjkCache=function(){function t(){this.prevClosestDir=new r.common.Vec3}return t.prototype.clear=function(){this.prevClosestDir.zero()},t}(),r.common||(r.common={}),r.common.Vec3=function(){function t(t,i,a){null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,r.common.Vec3.numCreations++}var i=t.prototype;return i.init=function(t,i,a){return this.x=t,this.y=i,this.z=a,this},i.zero=function(){return this.x=0,this.y=0,this.z=0,this},i.add=function(t){return new r.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)},i.add3=function(t,i,a){return new r.common.Vec3(this.x+t,this.y+i,this.z+a)},i.addScaled=function(t,i){return new r.common.Vec3(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)},i.sub=function(t){return new r.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)},i.sub3=function(t,i,a){return new r.common.Vec3(this.x-t,this.y-i,this.z-a)},i.scale=function(t){return new r.common.Vec3(this.x*t,this.y*t,this.z*t)},i.scale3=function(t,i,a){return new r.common.Vec3(this.x*t,this.y*i,this.z*a)},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.cross=function(t){return new r.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},i.addEq=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.add3Eq=function(t,i,a){return this.x+=t,this.y+=i,this.z+=a,this},i.addScaledEq=function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},i.subEq=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.sub3Eq=function(t,i,a){return this.x-=t,this.y-=i,this.z-=a,this},i.scaleEq=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.scale3Eq=function(t,i,a){return this.x*=t,this.y*=i,this.z*=a,this},i.crossEq=function(t){var i=this.z*t.x-this.x*t.z,a=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=i,this.z=a,this},i.mulMat3=function(t){return new r.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)},i.mulMat4=function(t){return new r.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)},i.mulTransform=function(t){var i,a,n,o,s,e;i=this.x,a=this.y,n=this.z,o=t._rotation00*i+t._rotation01*a+t._rotation02*n,s=t._rotation10*i+t._rotation11*a+t._rotation12*n,e=t._rotation20*i+t._rotation21*a+t._rotation22*n,i=o,a=s,n=e,i+=t._positionX,a+=t._positionY,n+=t._positionZ;var _=new r.common.Vec3;return _.x=i,_.y=a,_.z=n,_},i.mulMat3Eq=function(t){var i=this.x*t.e10+this.y*t.e11+this.z*t.e12,a=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=i,this.z=a,this},i.mulMat4Eq=function(t){var i=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,a=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=i,this.z=a,this},i.mulTransformEq=function(t){var i,a,n,o,s,r;return i=this.x,a=this.y,n=this.z,o=t._rotation00*i+t._rotation01*a+t._rotation02*n,s=t._rotation10*i+t._rotation11*a+t._rotation12*n,r=t._rotation20*i+t._rotation21*a+t._rotation22*n,i=o,a=s,n=r,i+=t._positionX,a+=t._positionY,n+=t._positionZ,this.x=i,this.y=a,this.z=n,this},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.normalized=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new r.common.Vec3(this.x*t,this.y*t,this.z*t)},i.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this},i.negate=function(){return new r.common.Vec3(-this.x,-this.y,-this.z)},i.negateEq=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.clone=function(){return new r.common.Vec3(this.x,this.y,this.z)},i.toString=function(){return"Vec3["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"},t}(),r.common.Transform=function(){function t(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}var i=t.prototype;return i.identity=function(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this},i.getPosition=function(){var t=new r.common.Vec3;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,t},i.getPositionTo=function(t){t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ},i.setPosition=function(t){return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this},i.translate=function(t){var i,a,n;i=t.x,a=t.y,n=t.z,this._positionX+=i,this._positionY+=a,this._positionZ+=n},i.getRotation=function(){var t=new r.common.Mat3;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,t},i.getRotationTo=function(t){t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22},i.setRotation=function(t){return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this},i.setRotationXyz=function(t){var i,a,n;i=t.x,a=t.y,n=t.z;var o=Math.sin(i),s=Math.sin(a),r=Math.sin(n),e=Math.cos(i),_=Math.cos(a),h=Math.cos(n);this._rotation00=_*h,this._rotation01=-_*r,this._rotation02=s,this._rotation10=e*r+h*o*s,this._rotation11=e*h-o*s*r,this._rotation12=-_*o,this._rotation20=o*r-e*h*s,this._rotation21=h*o+e*s*r,this._rotation22=e*_},i.rotate=function(t){var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x;i=t.e00,a=t.e01,n=t.e02,o=t.e10,s=t.e11,r=t.e12,e=t.e20,_=t.e21,h=t.e22,l=i*this._rotation00+a*this._rotation10+n*this._rotation20,c=i*this._rotation01+a*this._rotation11+n*this._rotation21,m=i*this._rotation02+a*this._rotation12+n*this._rotation22,v=o*this._rotation00+s*this._rotation10+r*this._rotation20,b=o*this._rotation01+s*this._rotation11+r*this._rotation21,f=o*this._rotation02+s*this._rotation12+r*this._rotation22,u=e*this._rotation00+_*this._rotation10+h*this._rotation20,p=e*this._rotation01+_*this._rotation11+h*this._rotation21,x=e*this._rotation02+_*this._rotation12+h*this._rotation22,this._rotation00=l,this._rotation01=c,this._rotation02=m,this._rotation10=v,this._rotation11=b,this._rotation12=f,this._rotation20=u,this._rotation21=p,this._rotation22=x},i.rotateXyz=function(t){var i,a,n,o,s,r,e,_,h,l,c,m;i=t.x,a=t.y,n=t.z;var v,b,f,u,p,x,y,d,g,X=Math.sin(i),Y=Math.sin(a),z=Math.sin(n),Z=Math.cos(i),M=Math.cos(a),I=Math.cos(n);s=-M*z,r=Y,e=Z*z+I*X*Y,_=Z*I-X*Y*z,h=-M*X,l=X*z-Z*I*Y,c=I*X+Z*Y*z,m=Z*M,v=(o=M*I)*this._rotation00+s*this._rotation10+r*this._rotation20,b=o*this._rotation01+s*this._rotation11+r*this._rotation21,f=o*this._rotation02+s*this._rotation12+r*this._rotation22,u=e*this._rotation00+_*this._rotation10+h*this._rotation20,p=e*this._rotation01+_*this._rotation11+h*this._rotation21,x=e*this._rotation02+_*this._rotation12+h*this._rotation22,y=l*this._rotation00+c*this._rotation10+m*this._rotation20,d=l*this._rotation01+c*this._rotation11+m*this._rotation21,g=l*this._rotation02+c*this._rotation12+m*this._rotation22,this._rotation00=v,this._rotation01=b,this._rotation02=f,this._rotation10=u,this._rotation11=p,this._rotation12=x,this._rotation20=y,this._rotation21=d,this._rotation22=g},i.getOrientation=function(){var t,i,a,n,o,s=new r.common.Quat,e=this._rotation00,_=this._rotation11,h=this._rotation22,l=e+_+h;return l>0?(n=.5*(o=Math.sqrt(l+1)),o=.5/o,t=(this._rotation21-this._rotation12)*o,i=(this._rotation02-this._rotation20)*o,a=(this._rotation10-this._rotation01)*o):e>_?e>h?(t=.5*(o=Math.sqrt(e-_-h+1)),o=.5/o,i=(this._rotation01+this._rotation10)*o,a=(this._rotation02+this._rotation20)*o,n=(this._rotation21-this._rotation12)*o):(a=.5*(o=Math.sqrt(h-e-_+1)),o=.5/o,t=(this._rotation02+this._rotation20)*o,i=(this._rotation12+this._rotation21)*o,n=(this._rotation10-this._rotation01)*o):_>h?(i=.5*(o=Math.sqrt(_-h-e+1)),o=.5/o,t=(this._rotation01+this._rotation10)*o,a=(this._rotation12+this._rotation21)*o,n=(this._rotation02-this._rotation20)*o):(a=.5*(o=Math.sqrt(h-e-_+1)),o=.5/o,t=(this._rotation02+this._rotation20)*o,i=(this._rotation12+this._rotation21)*o,n=(this._rotation10-this._rotation01)*o),s.x=t,s.y=i,s.z=a,s.w=n,s},i.getOrientationTo=function(t){var i,a,n,o,s,r=this._rotation00,e=this._rotation11,_=this._rotation22,h=r+e+_;h>0?(o=.5*(s=Math.sqrt(h+1)),s=.5/s,i=(this._rotation21-this._rotation12)*s,a=(this._rotation02-this._rotation20)*s,n=(this._rotation10-this._rotation01)*s):r>e?r>_?(i=.5*(s=Math.sqrt(r-e-_+1)),s=.5/s,a=(this._rotation01+this._rotation10)*s,n=(this._rotation02+this._rotation20)*s,o=(this._rotation21-this._rotation12)*s):(n=.5*(s=Math.sqrt(_-r-e+1)),s=.5/s,i=(this._rotation02+this._rotation20)*s,a=(this._rotation12+this._rotation21)*s,o=(this._rotation10-this._rotation01)*s):e>_?(a=.5*(s=Math.sqrt(e-_-r+1)),s=.5/s,i=(this._rotation01+this._rotation10)*s,n=(this._rotation12+this._rotation21)*s,o=(this._rotation02-this._rotation20)*s):(n=.5*(s=Math.sqrt(_-r-e+1)),s=.5/s,i=(this._rotation02+this._rotation20)*s,a=(this._rotation12+this._rotation21)*s,o=(this._rotation10-this._rotation01)*s),t.x=i,t.y=a,t.z=n,t.w=o},i.setOrientation=function(t){i=t.x,a=t.y,n=t.z,o=t.w;var i,a,n,o,s=2*i,r=2*a,e=2*n,_=i*s,h=a*r,l=n*e,c=i*r,m=a*e,v=i*e,b=o*s,f=o*r,u=o*e;return this._rotation00=1-h-l,this._rotation01=c-u,this._rotation02=v+f,this._rotation10=c+u,this._rotation11=1-_-l,this._rotation12=m-b,this._rotation20=v-f,this._rotation21=m+b,this._rotation22=1-_-h,this},i.clone=function(){var t=new r.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t},i.copyFrom=function(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this},t}(),r.common.Setting=function(){},r.collision.narrowphase.detector.gjkepa.GjkEpa=function(){function t(){this.s=new Array(4),this.w1=new Array(4),this.w2=new Array(4),this.baseDirs=new Array(3),this.baseDirs[0]=new r.common.Vec3(1,0,0),this.baseDirs[1]=new r.common.Vec3(0,1,0),this.baseDirs[2]=new r.common.Vec3(0,0,1),this.tl1=new r.common.Vec3,this.tl2=new r.common.Vec3,this.rayX=new r.common.Vec3,this.rayR=new r.common.Vec3,this.tempTransform=new r.common.Transform,this.s[0]=new r.common.Vec3,this.w1[0]=new r.common.Vec3,this.w2[0]=new r.common.Vec3,this.s[1]=new r.common.Vec3,this.w1[1]=new r.common.Vec3,this.w2[1]=new r.common.Vec3,this.s[2]=new r.common.Vec3,this.w1[2]=new r.common.Vec3,this.w2[2]=new r.common.Vec3,this.s[3]=new r.common.Vec3,this.w1[3]=new r.common.Vec3,this.w2[3]=new r.common.Vec3,this.dir=new r.common.Vec3,this.closest=new r.common.Vec3,this.closestPoint1=new r.common.Vec3,this.closestPoint2=new r.common.Vec3,this.polyhedron=new r.collision.narrowphase.detector.gjkepa.EpaPolyhedron}var i=t.prototype;return i.computeClosestPointsImpl=function(t,i,a,n,o,s){this.c1=t,this.c2=i,this.tf1=a,this.tf2=n;var e,_,h,l=this.s,c=this.w1,m=this.w2,v=this.closest,b=this.dir;(null!=o?(null==o._gjkCache&&(o._gjkCache=new r.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(o._gjkCache)):b.zero(),b.x*b.x+b.y*b.y+b.z*b.z==0)&&(e=n._positionX-a._positionX,_=n._positionY-a._positionY,h=n._positionZ-a._positionZ,b.x=e,b.y=_,b.z=h,b.x*b.x+b.y*b.y+b.z*b.z<1e-6&&b.init(1,0,0));this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var f=this.s[this.simplexSize],u=this.w1[this.simplexSize];f.x=u.x,f.y=u.y,f.z=u.z;var p=this.w2[this.simplexSize];f.x-=p.x,f.y-=p.y,f.z-=p.z,this.simplexSize=1;for(var x=0;x<40;){var y=0;switch(this.simplexSize){case 1:var d=l[0];v.x=d.x,v.y=d.y,v.z=d.z,y=1;break;case 2:var g,X,Y,z,Z,M,I=l[0];g=I.x,X=I.y,Y=I.z;var V,w,L,k=l[1],A=(V=(z=k.x)-g)*g+(w=(Z=k.y)-X)*X+(L=(M=k.z)-Y)*Y;if((A=-A/(V*V+w*w+L*L))<0)v.x=g,v.y=X,v.z=Y,y=1;else if(A>1)v.x=z,v.y=Z,v.z=M,y=2;else{var B,P,S;B=g+V*A,P=X+w*A,S=Y+L*A,v.x=B,v.y=P,v.z=S,y=3}break;case 3:var T,C,j,R,E,q,D,N,F,G,J,W,O,U,H,Q,K,$,tt=l[0],it=l[1],at=l[2];T=tt.x,C=tt.y,j=tt.z,R=it.x,E=it.y,q=it.z,D=at.x,N=at.y;var nt=void 0,ot=void 0,st=void 0;nt=(J=E-C)*(H=(F=at.z)-q)-(W=q-j)*(U=N-E);var rt,et,_t,ht,lt,ct;rt=U*(st=(G=R-T)*U-J*(O=D-R))-H*(ot=W*O-G*H),et=H*nt-O*st,_t=O*ot-U*nt,ht=(K=C-N)*st-($=j-F)*ot,lt=$*nt-(Q=T-D)*st,ct=Q*ot-K*nt;var mt=-1,vt=void 0,bt=void 0,ft=void 0,ut=0;if(vt=0,bt=0,ft=0,T*(J*st-W*ot)+C*(W*nt-G*st)+j*(G*ot-J*nt)<0){var pt,xt,yt,dt,gt,Xt;pt=tt.x,xt=tt.y,yt=tt.z;var Yt,zt,Zt,Mt=(Yt=(dt=it.x)-pt)*pt+(zt=(gt=it.y)-xt)*xt+(Zt=(Xt=it.z)-yt)*yt,It=void 0;if((Mt=-Mt/(Yt*Yt+zt*zt+Zt*Zt))<0)v.x=pt,v.y=xt,v.z=yt,It=1;else if(Mt>1)v.x=dt,v.y=gt,v.z=Xt,It=2;else{var Vt,wt,Lt;Vt=pt+Yt*Mt,wt=xt+zt*Mt,Lt=yt+Zt*Mt,v.x=Vt,v.y=wt,v.z=Lt,It=3}ut=It,mt=v.x*v.x+v.y*v.y+v.z*v.z,vt=v.x,bt=v.y,ft=v.z}if(R*rt+E*et+q*_t<0){var kt,At,Bt,Pt,St,Tt;kt=it.x,At=it.y,Bt=it.z;var Ct,jt,Rt,Et=(Ct=(Pt=at.x)-kt)*kt+(jt=(St=at.y)-At)*At+(Rt=(Tt=at.z)-Bt)*Bt,qt=void 0;if((Et=-Et/(Ct*Ct+jt*jt+Rt*Rt))<0)v.x=kt,v.y=At,v.z=Bt,qt=1;else if(Et>1)v.x=Pt,v.y=St,v.z=Tt,qt=2;else{var Dt,Nt,Ft;Dt=kt+Ct*Et,Nt=At+jt*Et,Ft=Bt+Rt*Et,v.x=Dt,v.y=Nt,v.z=Ft,qt=3}var Gt=v.x*v.x+v.y*v.y+v.z*v.z;(mt<0||Gt<mt)&&(ut=qt<<1,mt=Gt,vt=v.x,bt=v.y,ft=v.z)}if(D*ht+N*lt+F*ct<0){var Jt,Wt,Ot,Ut,Ht,Qt;Jt=tt.x,Wt=tt.y,Ot=tt.z;var Kt,$t,ti,ii=(Kt=(Ut=at.x)-Jt)*Jt+($t=(Ht=at.y)-Wt)*Wt+(ti=(Qt=at.z)-Ot)*Ot,ai=void 0;if((ii=-ii/(Kt*Kt+$t*$t+ti*ti))<0)v.x=Jt,v.y=Wt,v.z=Ot,ai=1;else if(ii>1)v.x=Ut,v.y=Ht,v.z=Qt,ai=2;else{var ni,oi,si;ni=Jt+Kt*ii,oi=Wt+$t*ii,si=Ot+ti*ii,v.x=ni,v.y=oi,v.z=si,ai=3}var ri=v.x*v.x+v.y*v.y+v.z*v.z;(mt<0||ri<mt)&&(ut=1&ai|(2&ai)<<1,mt=ri,vt=v.x,bt=v.y,ft=v.z)}if(mt>0)v.x=vt,v.y=bt,v.z=ft,y=ut;else{var ei=nt*nt+ot*ot+st*st;ei>0&&(ei=1/Math.sqrt(ei));var _i=(nt*=ei)*nt+(ot*=ei)*ot+(st*=ei)*st;vt=nt*(_i=(T*nt+C*ot+j*st)/_i),bt=ot*_i,ft=st*_i,v.x=vt,v.y=bt,v.z=ft,y=7}break;case 4:var hi,li,ci,mi,vi,bi,fi,ui,pi,xi,yi,di,gi,Xi,Yi,zi,Zi,Mi,Ii,Vi,wi,Li,ki,Ai,Bi,Pi,Si,Ti=l[0],Ci=l[1],ji=l[2],Ri=l[3];hi=Ti.x,li=Ti.y,ci=Ti.z,mi=Ci.x,vi=Ci.y,bi=Ci.z,fi=ji.x,ui=ji.y,pi=ji.z,xi=Ri.x,yi=Ri.y;var Ei,qi,Di,Ni,Fi,Gi,Ji,Wi,Oi;Ei=(Zi=ui-li)*(wi=(di=Ri.z)-ci)-(Mi=pi-ci)*(Vi=yi-li),qi=Mi*(Ii=xi-hi)-(zi=fi-hi)*wi,Di=zi*Vi-Zi*Ii,Ni=Vi*(Yi=bi-ci)-wi*(Xi=vi-li),Fi=wi*(gi=mi-hi)-Ii*Yi,Gi=Ii*Xi-Vi*gi;var Ui=gi*(Ji=(Pi=yi-vi)*(Ai=pi-bi)-(Si=di-bi)*(ki=ui-vi))+Xi*(Wi=Si*(Li=fi-mi)-(Bi=xi-mi)*Ai)+Yi*(Oi=Bi*ki-Pi*Li)>0?1:-1,Hi=-1,Qi=void 0,Ki=void 0,$i=void 0,ta=0;if(Qi=0,Ki=0,$i=0,(hi*(Xi*Mi-Yi*Zi)+li*(Yi*zi-gi*Mi)+ci*(gi*Zi-Xi*zi))*Ui<0){var ia,aa,na,oa,sa,ra,ea,_a,ha,la,ca,ma,va,ba,fa,ua,pa,xa;ia=Ti.x,aa=Ti.y,na=Ti.z,oa=Ci.x,sa=Ci.y,ra=Ci.z,ea=ji.x,_a=ji.y;var ya=void 0,da=void 0,ga=void 0;ya=(ca=sa-aa)*(fa=(ha=ji.z)-ra)-(ma=ra-na)*(ba=_a-sa);var Xa,Ya,za,Za,Ma,Ia;Xa=ba*(ga=(la=oa-ia)*ba-ca*(va=ea-oa))-fa*(da=ma*va-la*fa),Ya=fa*ya-va*ga,za=va*da-ba*ya,Za=(pa=aa-_a)*ga-(xa=na-ha)*da,Ma=xa*ya-(ua=ia-ea)*ga,Ia=ua*da-pa*ya;var Va=-1,wa=void 0,La=void 0,ka=void 0,Aa=0;if(wa=0,La=0,ka=0,ia*(ca*ga-ma*da)+aa*(ma*ya-la*ga)+na*(la*da-ca*ya)<0){var Ba,Pa,Sa,Ta,Ca,ja;Ba=Ti.x,Pa=Ti.y,Sa=Ti.z;var Ra,Ea,qa,Da=(Ra=(Ta=Ci.x)-Ba)*Ba+(Ea=(Ca=Ci.y)-Pa)*Pa+(qa=(ja=Ci.z)-Sa)*Sa,Na=void 0;if((Da=-Da/(Ra*Ra+Ea*Ea+qa*qa))<0)v.x=Ba,v.y=Pa,v.z=Sa,Na=1;else if(Da>1)v.x=Ta,v.y=Ca,v.z=ja,Na=2;else{var Fa,Ga,Ja;Fa=Ba+Ra*Da,Ga=Pa+Ea*Da,Ja=Sa+qa*Da,v.x=Fa,v.y=Ga,v.z=Ja,Na=3}Aa=Na,Va=v.x*v.x+v.y*v.y+v.z*v.z,wa=v.x,La=v.y,ka=v.z}if(oa*Xa+sa*Ya+ra*za<0){var Wa,Oa,Ua,Ha,Qa,Ka;Wa=Ci.x,Oa=Ci.y,Ua=Ci.z;var $a,tn,an,nn=($a=(Ha=ji.x)-Wa)*Wa+(tn=(Qa=ji.y)-Oa)*Oa+(an=(Ka=ji.z)-Ua)*Ua,on=void 0;if((nn=-nn/($a*$a+tn*tn+an*an))<0)v.x=Wa,v.y=Oa,v.z=Ua,on=1;else if(nn>1)v.x=Ha,v.y=Qa,v.z=Ka,on=2;else{var sn,rn,en;sn=Wa+$a*nn,rn=Oa+tn*nn,en=Ua+an*nn,v.x=sn,v.y=rn,v.z=en,on=3}var _n=v.x*v.x+v.y*v.y+v.z*v.z;(Va<0||_n<Va)&&(Aa=on<<1,Va=_n,wa=v.x,La=v.y,ka=v.z)}if(ea*Za+_a*Ma+ha*Ia<0){var hn,ln,cn,mn,vn,bn;hn=Ti.x,ln=Ti.y,cn=Ti.z;var fn,un,pn,xn=(fn=(mn=ji.x)-hn)*hn+(un=(vn=ji.y)-ln)*ln+(pn=(bn=ji.z)-cn)*cn,yn=void 0;if((xn=-xn/(fn*fn+un*un+pn*pn))<0)v.x=hn,v.y=ln,v.z=cn,yn=1;else if(xn>1)v.x=mn,v.y=vn,v.z=bn,yn=2;else{var dn,gn,Xn;dn=hn+fn*xn,gn=ln+un*xn,Xn=cn+pn*xn,v.x=dn,v.y=gn,v.z=Xn,yn=3}var Yn=v.x*v.x+v.y*v.y+v.z*v.z;(Va<0||Yn<Va)&&(Aa=1&yn|(2&yn)<<1,Va=Yn,wa=v.x,La=v.y,ka=v.z)}var zn=void 0;if(Va>0)v.x=wa,v.y=La,v.z=ka,zn=Aa;else{var Zn=ya*ya+da*da+ga*ga;Zn>0&&(Zn=1/Math.sqrt(Zn));var Mn=(ya*=Zn)*ya+(da*=Zn)*da+(ga*=Zn)*ga;wa=ya*(Mn=(ia*ya+aa*da+na*ga)/Mn),La=da*Mn,ka=ga*Mn,v.x=wa,v.y=La,v.z=ka,zn=7}ta=zn,Hi=v.x*v.x+v.y*v.y+v.z*v.z,Qi=v.x,Ki=v.y,$i=v.z}if((hi*Ei+li*qi+ci*Di)*Ui<0){var In,Vn,wn,Ln,kn,An,Bn,Pn,Sn,Tn,Cn,jn,Rn,En,qn,Dn,Nn,Fn;In=Ti.x,Vn=Ti.y,wn=Ti.z,Ln=ji.x,kn=ji.y,An=ji.z,Bn=Ri.x,Pn=Ri.y;var Gn=void 0,Jn=void 0,Wn=void 0;Gn=(Cn=kn-Vn)*(qn=(Sn=Ri.z)-An)-(jn=An-wn)*(En=Pn-kn);var On,Un,Hn,Qn,Kn,$n;On=En*(Wn=(Tn=Ln-In)*En-Cn*(Rn=Bn-Ln))-qn*(Jn=jn*Rn-Tn*qn),Un=qn*Gn-Rn*Wn,Hn=Rn*Jn-En*Gn,Qn=(Nn=Vn-Pn)*Wn-(Fn=wn-Sn)*Jn,Kn=Fn*Gn-(Dn=In-Bn)*Wn,$n=Dn*Jn-Nn*Gn;var to=-1,io=void 0,ao=void 0,no=void 0,oo=0;if(io=0,ao=0,no=0,In*(Cn*Wn-jn*Jn)+Vn*(jn*Gn-Tn*Wn)+wn*(Tn*Jn-Cn*Gn)<0){var so,ro,eo,_o,ho,lo;so=Ti.x,ro=Ti.y,eo=Ti.z;var co,mo,vo,bo=(co=(_o=ji.x)-so)*so+(mo=(ho=ji.y)-ro)*ro+(vo=(lo=ji.z)-eo)*eo,fo=void 0;if((bo=-bo/(co*co+mo*mo+vo*vo))<0)v.x=so,v.y=ro,v.z=eo,fo=1;else if(bo>1)v.x=_o,v.y=ho,v.z=lo,fo=2;else{var uo,po,xo;uo=so+co*bo,po=ro+mo*bo,xo=eo+vo*bo,v.x=uo,v.y=po,v.z=xo,fo=3}oo=fo,to=v.x*v.x+v.y*v.y+v.z*v.z,io=v.x,ao=v.y,no=v.z}if(Ln*On+kn*Un+An*Hn<0){var yo,go,Xo,Yo,zo,Zo;yo=ji.x,go=ji.y,Xo=ji.z;var Mo,Io,Vo,wo=(Mo=(Yo=Ri.x)-yo)*yo+(Io=(zo=Ri.y)-go)*go+(Vo=(Zo=Ri.z)-Xo)*Xo,Lo=void 0;if((wo=-wo/(Mo*Mo+Io*Io+Vo*Vo))<0)v.x=yo,v.y=go,v.z=Xo,Lo=1;else if(wo>1)v.x=Yo,v.y=zo,v.z=Zo,Lo=2;else{var ko,Ao,Bo;ko=yo+Mo*wo,Ao=go+Io*wo,Bo=Xo+Vo*wo,v.x=ko,v.y=Ao,v.z=Bo,Lo=3}var Po=v.x*v.x+v.y*v.y+v.z*v.z;(to<0||Po<to)&&(oo=Lo<<1,to=Po,io=v.x,ao=v.y,no=v.z)}if(Bn*Qn+Pn*Kn+Sn*$n<0){var So,To,Co,jo,Ro,Eo;So=Ti.x,To=Ti.y,Co=Ti.z;var qo,Do,No,Fo=(qo=(jo=Ri.x)-So)*So+(Do=(Ro=Ri.y)-To)*To+(No=(Eo=Ri.z)-Co)*Co,Go=void 0;if((Fo=-Fo/(qo*qo+Do*Do+No*No))<0)v.x=So,v.y=To,v.z=Co,Go=1;else if(Fo>1)v.x=jo,v.y=Ro,v.z=Eo,Go=2;else{var Jo,Wo,Oo;Jo=So+qo*Fo,Wo=To+Do*Fo,Oo=Co+No*Fo,v.x=Jo,v.y=Wo,v.z=Oo,Go=3}var Uo=v.x*v.x+v.y*v.y+v.z*v.z;(to<0||Uo<to)&&(oo=1&Go|(2&Go)<<1,to=Uo,io=v.x,ao=v.y,no=v.z)}var Ho=void 0;if(to>0)v.x=io,v.y=ao,v.z=no,Ho=oo;else{var Qo=Gn*Gn+Jn*Jn+Wn*Wn;Qo>0&&(Qo=1/Math.sqrt(Qo));var Ko=(Gn*=Qo)*Gn+(Jn*=Qo)*Jn+(Wn*=Qo)*Wn;io=Gn*(Ko=(In*Gn+Vn*Jn+wn*Wn)/Ko),ao=Jn*Ko,no=Wn*Ko,v.x=io,v.y=ao,v.z=no,Ho=7}var $o=v.x*v.x+v.y*v.y+v.z*v.z;(Hi<0||$o<Hi)&&(ta=1&Ho|(6&Ho)<<1,Hi=$o,Qi=v.x,Ki=v.y,$i=v.z)}if((hi*Ni+li*Fi+ci*Gi)*Ui<0){var ts,is,as,ns,os,ss,rs,es,_s,hs,ls,cs,ms,vs,bs,fs,us,ps;ts=Ti.x,is=Ti.y,as=Ti.z,ns=Ci.x,os=Ci.y,ss=Ci.z,rs=Ri.x,es=Ri.y;var xs=void 0,ys=void 0,ds=void 0;xs=(ls=os-is)*(bs=(_s=Ri.z)-ss)-(cs=ss-as)*(vs=es-os);var gs,Xs,Ys,zs,Zs,Ms;gs=vs*(ds=(hs=ns-ts)*vs-ls*(ms=rs-ns))-bs*(ys=cs*ms-hs*bs),Xs=bs*xs-ms*ds,Ys=ms*ys-vs*xs,zs=(us=is-es)*ds-(ps=as-_s)*ys,Zs=ps*xs-(fs=ts-rs)*ds,Ms=fs*ys-us*xs;var Is=-1,Vs=void 0,ws=void 0,Ls=void 0,ks=0;if(Vs=0,ws=0,Ls=0,ts*(ls*ds-cs*ys)+is*(cs*xs-hs*ds)+as*(hs*ys-ls*xs)<0){var As,Bs,Ps,Ss,Ts,Cs;As=Ti.x,Bs=Ti.y,Ps=Ti.z;var js,Rs,Es,qs=(js=(Ss=Ci.x)-As)*As+(Rs=(Ts=Ci.y)-Bs)*Bs+(Es=(Cs=Ci.z)-Ps)*Ps,Ds=void 0;if((qs=-qs/(js*js+Rs*Rs+Es*Es))<0)v.x=As,v.y=Bs,v.z=Ps,Ds=1;else if(qs>1)v.x=Ss,v.y=Ts,v.z=Cs,Ds=2;else{var Ns,Fs,Gs;Ns=As+js*qs,Fs=Bs+Rs*qs,Gs=Ps+Es*qs,v.x=Ns,v.y=Fs,v.z=Gs,Ds=3}ks=Ds,Is=v.x*v.x+v.y*v.y+v.z*v.z,Vs=v.x,ws=v.y,Ls=v.z}if(ns*gs+os*Xs+ss*Ys<0){var Js,Ws,Os,Us,Hs,Qs;Js=Ci.x,Ws=Ci.y,Os=Ci.z;var Ks,$s,tr,ir=(Ks=(Us=Ri.x)-Js)*Js+($s=(Hs=Ri.y)-Ws)*Ws+(tr=(Qs=Ri.z)-Os)*Os,ar=void 0;if((ir=-ir/(Ks*Ks+$s*$s+tr*tr))<0)v.x=Js,v.y=Ws,v.z=Os,ar=1;else if(ir>1)v.x=Us,v.y=Hs,v.z=Qs,ar=2;else{var nr,or,sr;nr=Js+Ks*ir,or=Ws+$s*ir,sr=Os+tr*ir,v.x=nr,v.y=or,v.z=sr,ar=3}var rr=v.x*v.x+v.y*v.y+v.z*v.z;(Is<0||rr<Is)&&(ks=ar<<1,Is=rr,Vs=v.x,ws=v.y,Ls=v.z)}if(rs*zs+es*Zs+_s*Ms<0){var er,_r,hr,lr,cr,mr;er=Ti.x,_r=Ti.y,hr=Ti.z;var vr,br,fr,ur=(vr=(lr=Ri.x)-er)*er+(br=(cr=Ri.y)-_r)*_r+(fr=(mr=Ri.z)-hr)*hr,pr=void 0;if((ur=-ur/(vr*vr+br*br+fr*fr))<0)v.x=er,v.y=_r,v.z=hr,pr=1;else if(ur>1)v.x=lr,v.y=cr,v.z=mr,pr=2;else{var xr,yr,dr;xr=er+vr*ur,yr=_r+br*ur,dr=hr+fr*ur,v.x=xr,v.y=yr,v.z=dr,pr=3}var gr=v.x*v.x+v.y*v.y+v.z*v.z;(Is<0||gr<Is)&&(ks=1&pr|(2&pr)<<1,Is=gr,Vs=v.x,ws=v.y,Ls=v.z)}var Xr=void 0;if(Is>0)v.x=Vs,v.y=ws,v.z=Ls,Xr=ks;else{var Yr=xs*xs+ys*ys+ds*ds;Yr>0&&(Yr=1/Math.sqrt(Yr));var zr=(xs*=Yr)*xs+(ys*=Yr)*ys+(ds*=Yr)*ds;Vs=xs*(zr=(ts*xs+is*ys+as*ds)/zr),ws=ys*zr,Ls=ds*zr,v.x=Vs,v.y=ws,v.z=Ls,Xr=7}var Zr=v.x*v.x+v.y*v.y+v.z*v.z;(Hi<0||Zr<Hi)&&(ta=3&Xr|(4&Xr)<<1,Hi=Zr,Qi=v.x,Ki=v.y,$i=v.z)}if((mi*Ji+vi*Wi+bi*Oi)*Ui<0){var Mr,Ir,Vr,wr,Lr,kr,Ar,Br,Pr,Sr,Tr,Cr,jr,Rr,Er,qr,Dr,Nr;Mr=Ci.x,Ir=Ci.y,Vr=Ci.z,wr=ji.x,Lr=ji.y,kr=ji.z,Ar=Ri.x,Br=Ri.y;var Fr=void 0,Gr=void 0,Jr=void 0;Fr=(Tr=Lr-Ir)*(Er=(Pr=Ri.z)-kr)-(Cr=kr-Vr)*(Rr=Br-Lr);var Wr,Or,Ur,Hr,Qr,Kr;Wr=Rr*(Jr=(Sr=wr-Mr)*Rr-Tr*(jr=Ar-wr))-Er*(Gr=Cr*jr-Sr*Er),Or=Er*Fr-jr*Jr,Ur=jr*Gr-Rr*Fr,Hr=(Dr=Ir-Br)*Jr-(Nr=Vr-Pr)*Gr,Qr=Nr*Fr-(qr=Mr-Ar)*Jr,Kr=qr*Gr-Dr*Fr;var $r=-1,te=void 0,ie=void 0,ae=void 0,ne=0;if(te=0,ie=0,ae=0,Mr*(Tr*Jr-Cr*Gr)+Ir*(Cr*Fr-Sr*Jr)+Vr*(Sr*Gr-Tr*Fr)<0){var oe,se,re,ee,_e,he;oe=Ci.x,se=Ci.y,re=Ci.z;var le,ce,me,ve=(le=(ee=ji.x)-oe)*oe+(ce=(_e=ji.y)-se)*se+(me=(he=ji.z)-re)*re,be=void 0;if((ve=-ve/(le*le+ce*ce+me*me))<0)v.x=oe,v.y=se,v.z=re,be=1;else if(ve>1)v.x=ee,v.y=_e,v.z=he,be=2;else{var fe,ue,pe;fe=oe+le*ve,ue=se+ce*ve,pe=re+me*ve,v.x=fe,v.y=ue,v.z=pe,be=3}ne=be,$r=v.x*v.x+v.y*v.y+v.z*v.z,te=v.x,ie=v.y,ae=v.z}if(wr*Wr+Lr*Or+kr*Ur<0){var xe,ye,de,ge,Xe,Ye;xe=ji.x,ye=ji.y,de=ji.z;var ze,Ze,Me,Ie=(ze=(ge=Ri.x)-xe)*xe+(Ze=(Xe=Ri.y)-ye)*ye+(Me=(Ye=Ri.z)-de)*de,Ve=void 0;if((Ie=-Ie/(ze*ze+Ze*Ze+Me*Me))<0)v.x=xe,v.y=ye,v.z=de,Ve=1;else if(Ie>1)v.x=ge,v.y=Xe,v.z=Ye,Ve=2;else{var we,Le,ke;we=xe+ze*Ie,Le=ye+Ze*Ie,ke=de+Me*Ie,v.x=we,v.y=Le,v.z=ke,Ve=3}var Ae=v.x*v.x+v.y*v.y+v.z*v.z;($r<0||Ae<$r)&&(ne=Ve<<1,$r=Ae,te=v.x,ie=v.y,ae=v.z)}if(Ar*Hr+Br*Qr+Pr*Kr<0){var Be,Pe,Se,Te,Ce,je;Be=Ci.x,Pe=Ci.y,Se=Ci.z;var Re,Ee,qe,De=(Re=(Te=Ri.x)-Be)*Be+(Ee=(Ce=Ri.y)-Pe)*Pe+(qe=(je=Ri.z)-Se)*Se,Ne=void 0;if((De=-De/(Re*Re+Ee*Ee+qe*qe))<0)v.x=Be,v.y=Pe,v.z=Se,Ne=1;else if(De>1)v.x=Te,v.y=Ce,v.z=je,Ne=2;else{var Fe,Ge,Je;Fe=Be+Re*De,Ge=Pe+Ee*De,Je=Se+qe*De,v.x=Fe,v.y=Ge,v.z=Je,Ne=3}var We=v.x*v.x+v.y*v.y+v.z*v.z;($r<0||We<$r)&&(ne=1&Ne|(2&Ne)<<1,$r=We,te=v.x,ie=v.y,ae=v.z)}var Oe=void 0;if($r>0)v.x=te,v.y=ie,v.z=ae,Oe=ne;else{var Ue=Fr*Fr+Gr*Gr+Jr*Jr;Ue>0&&(Ue=1/Math.sqrt(Ue));var He=(Fr*=Ue)*Fr+(Gr*=Ue)*Gr+(Jr*=Ue)*Jr;te=Fr*(He=(Mr*Fr+Ir*Gr+Vr*Jr)/He),ie=Gr*He,ae=Jr*He,v.x=te,v.y=ie,v.z=ae,Oe=7}var Qe=v.x*v.x+v.y*v.y+v.z*v.z;(Hi<0||Qe<Hi)&&(ta=Oe<<1,Hi=Qe,Qi=v.x,Ki=v.y,$i=v.z)}Hi>0?(v.x=Qi,v.y=Ki,v.z=$i,y=ta):(v.zero(),y=15)}if(v.x*v.x+v.y*v.y+v.z*v.z<1e-8){if(!s)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron()}if(4==this.simplexSize){var Ke=this.computeDepth(t,i,a,n,l,c,m);return 0!=Ke?(this.distance=0,Ke):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(y),b.x=v.x,b.y=v.y,b.z=v.z,b.x=-b.x,b.y=-b.y,b.z=-b.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var $e=this.s[this.simplexSize],t_=this.w1[this.simplexSize];$e.x=t_.x,$e.y=t_.y,$e.z=t_.z;var i_=this.w2[this.simplexSize];if($e.x-=i_.x,$e.y-=i_.y,$e.z-=i_.z,b.x*b.x+b.y*b.y+b.z*b.z<1e-8)throw new Error("!?");var a_=l[this.simplexSize];if(a_.x*b.x+a_.y*b.y+a_.z*b.z-(v.x*b.x+v.y*b.y+v.z*b.z)<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z),null!=o&&null!=o._gjkCache&&this.saveCache(o._gjkCache),0;this.simplexSize++,++x}return 2},i.convexCastImpl=function(t,i,a,n,o,s,r){this.c1=t,this.c2=i,this.tf1=a,this.tf2=n;var e,_,h,l=this.s,c=this.closest,m=this.dir;if(e=n._positionX-a._positionX,_=n._positionY-a._positionY,h=n._positionZ-a._positionZ,m.x=e,m.y=_,m.z=h,m.x*m.x+m.y*m.y+m.z*m.z<1e-6&&m.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{var v=this.w1[this.simplexSize];v.x=this.tf1._positionX,v.y=this.tf1._positionY,v.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var b=this.s[this.simplexSize],f=this.w1[this.simplexSize];b.x=f.x,b.y=f.y,b.z=f.z;var u=this.w2[this.simplexSize];b.x-=u.x,b.y-=u.y,b.z-=u.z,this.simplexSize=1;var p=0,x=0,y=this.rayX,d=this.rayR;for(y.zero(),d.x=s.x,d.y=s.y,d.z=s.z,d.x-=o.x,d.y-=o.y,d.z-=o.z;p<40;){var g=0;switch(this.simplexSize){case 1:var X=l[0];c.x=X.x,c.y=X.y,c.z=X.z,g=1;break;case 2:var Y,z,Z,M,I,V,w=l[0];Y=w.x,z=w.y,Z=w.z;var L,k,A,B=l[1],P=(L=(M=B.x)-Y)*Y+(k=(I=B.y)-z)*z+(A=(V=B.z)-Z)*Z;if((P=-P/(L*L+k*k+A*A))<0)c.x=Y,c.y=z,c.z=Z,g=1;else if(P>1)c.x=M,c.y=I,c.z=V,g=2;else{var S,T,C;S=Y+L*P,T=z+k*P,C=Z+A*P,c.x=S,c.y=T,c.z=C,g=3}break;case 3:var j,R,E,q,D,N,F,G,J,W,O,U,H,Q,K,$,tt,it,at=l[0],nt=l[1],ot=l[2];j=at.x,R=at.y,E=at.z,q=nt.x,D=nt.y,N=nt.z,F=ot.x,G=ot.y;var st=void 0,rt=void 0,et=void 0;st=(O=D-R)*(K=(J=ot.z)-N)-(U=N-E)*(Q=G-D);var _t,ht,lt,ct,mt,vt;_t=Q*(et=(W=q-j)*Q-O*(H=F-q))-K*(rt=U*H-W*K),ht=K*st-H*et,lt=H*rt-Q*st,ct=(tt=R-G)*et-(it=E-J)*rt,mt=it*st-($=j-F)*et,vt=$*rt-tt*st;var bt=-1,ft=void 0,ut=void 0,pt=void 0,xt=0;if(ft=0,ut=0,pt=0,j*(O*et-U*rt)+R*(U*st-W*et)+E*(W*rt-O*st)<0){var yt,dt,gt,Xt,Yt,zt;yt=at.x,dt=at.y,gt=at.z;var Zt,Mt,It,Vt=(Zt=(Xt=nt.x)-yt)*yt+(Mt=(Yt=nt.y)-dt)*dt+(It=(zt=nt.z)-gt)*gt,wt=void 0;if((Vt=-Vt/(Zt*Zt+Mt*Mt+It*It))<0)c.x=yt,c.y=dt,c.z=gt,wt=1;else if(Vt>1)c.x=Xt,c.y=Yt,c.z=zt,wt=2;else{var Lt,kt,At;Lt=yt+Zt*Vt,kt=dt+Mt*Vt,At=gt+It*Vt,c.x=Lt,c.y=kt,c.z=At,wt=3}xt=wt,bt=c.x*c.x+c.y*c.y+c.z*c.z,ft=c.x,ut=c.y,pt=c.z}if(q*_t+D*ht+N*lt<0){var Bt,Pt,St,Tt,Ct,jt;Bt=nt.x,Pt=nt.y,St=nt.z;var Rt,Et,qt,Dt=(Rt=(Tt=ot.x)-Bt)*Bt+(Et=(Ct=ot.y)-Pt)*Pt+(qt=(jt=ot.z)-St)*St,Nt=void 0;if((Dt=-Dt/(Rt*Rt+Et*Et+qt*qt))<0)c.x=Bt,c.y=Pt,c.z=St,Nt=1;else if(Dt>1)c.x=Tt,c.y=Ct,c.z=jt,Nt=2;else{var Ft,Gt,Jt;Ft=Bt+Rt*Dt,Gt=Pt+Et*Dt,Jt=St+qt*Dt,c.x=Ft,c.y=Gt,c.z=Jt,Nt=3}var Wt=c.x*c.x+c.y*c.y+c.z*c.z;(bt<0||Wt<bt)&&(xt=Nt<<1,bt=Wt,ft=c.x,ut=c.y,pt=c.z)}if(F*ct+G*mt+J*vt<0){var Ot,Ut,Ht,Qt,Kt,$t;Ot=at.x,Ut=at.y,Ht=at.z;var ti,ii,ai,ni=(ti=(Qt=ot.x)-Ot)*Ot+(ii=(Kt=ot.y)-Ut)*Ut+(ai=($t=ot.z)-Ht)*Ht,oi=void 0;if((ni=-ni/(ti*ti+ii*ii+ai*ai))<0)c.x=Ot,c.y=Ut,c.z=Ht,oi=1;else if(ni>1)c.x=Qt,c.y=Kt,c.z=$t,oi=2;else{var si,ri,ei;si=Ot+ti*ni,ri=Ut+ii*ni,ei=Ht+ai*ni,c.x=si,c.y=ri,c.z=ei,oi=3}var _i=c.x*c.x+c.y*c.y+c.z*c.z;(bt<0||_i<bt)&&(xt=1&oi|(2&oi)<<1,bt=_i,ft=c.x,ut=c.y,pt=c.z)}if(bt>0)c.x=ft,c.y=ut,c.z=pt,g=xt;else{var hi=st*st+rt*rt+et*et;hi>0&&(hi=1/Math.sqrt(hi));var li=(st*=hi)*st+(rt*=hi)*rt+(et*=hi)*et;ft=st*(li=(j*st+R*rt+E*et)/li),ut=rt*li,pt=et*li,c.x=ft,c.y=ut,c.z=pt,g=7}break;case 4:var ci,mi,vi,bi,fi,ui,pi,xi,yi,di,gi,Xi,Yi,zi,Zi,Mi,Ii,Vi,wi,Li,ki,Ai,Bi,Pi,Si,Ti,Ci,ji=l[0],Ri=l[1],Ei=l[2],qi=l[3];ci=ji.x,mi=ji.y,vi=ji.z,bi=Ri.x,fi=Ri.y,ui=Ri.z,pi=Ei.x,xi=Ei.y,yi=Ei.z,di=qi.x,gi=qi.y;var Di,Ni,Fi,Gi,Ji,Wi,Oi,Ui,Hi;Di=(Ii=xi-mi)*(ki=(Xi=qi.z)-vi)-(Vi=yi-vi)*(Li=gi-mi),Ni=Vi*(wi=di-ci)-(Mi=pi-ci)*ki,Fi=Mi*Li-Ii*wi,Gi=Li*(Zi=ui-vi)-ki*(zi=fi-mi),Ji=ki*(Yi=bi-ci)-wi*Zi,Wi=wi*zi-Li*Yi;var Qi=Yi*(Oi=(Ti=gi-fi)*(Pi=yi-ui)-(Ci=Xi-ui)*(Bi=xi-fi))+zi*(Ui=Ci*(Ai=pi-bi)-(Si=di-bi)*Pi)+Zi*(Hi=Si*Bi-Ti*Ai)>0?1:-1,Ki=-1,$i=void 0,ta=void 0,ia=void 0,aa=0;if($i=0,ta=0,ia=0,(ci*(zi*Vi-Zi*Ii)+mi*(Zi*Mi-Yi*Vi)+vi*(Yi*Ii-zi*Mi))*Qi<0){var na,oa,sa,ra,ea,_a,ha,la,ca,ma,va,ba,fa,ua,pa,xa,ya,da;na=ji.x,oa=ji.y,sa=ji.z,ra=Ri.x,ea=Ri.y,_a=Ri.z,ha=Ei.x,la=Ei.y;var ga=void 0,Xa=void 0,Ya=void 0;ga=(va=ea-oa)*(pa=(ca=Ei.z)-_a)-(ba=_a-sa)*(ua=la-ea);var za,Za,Ma,Ia,Va,wa;za=ua*(Ya=(ma=ra-na)*ua-va*(fa=ha-ra))-pa*(Xa=ba*fa-ma*pa),Za=pa*ga-fa*Ya,Ma=fa*Xa-ua*ga,Ia=(ya=oa-la)*Ya-(da=sa-ca)*Xa,Va=da*ga-(xa=na-ha)*Ya,wa=xa*Xa-ya*ga;var La=-1,ka=void 0,Aa=void 0,Ba=void 0,Pa=0;if(ka=0,Aa=0,Ba=0,na*(va*Ya-ba*Xa)+oa*(ba*ga-ma*Ya)+sa*(ma*Xa-va*ga)<0){var Sa,Ta,Ca,ja,Ra,Ea;Sa=ji.x,Ta=ji.y,Ca=ji.z;var qa,Da,Na,Fa=(qa=(ja=Ri.x)-Sa)*Sa+(Da=(Ra=Ri.y)-Ta)*Ta+(Na=(Ea=Ri.z)-Ca)*Ca,Ga=void 0;if((Fa=-Fa/(qa*qa+Da*Da+Na*Na))<0)c.x=Sa,c.y=Ta,c.z=Ca,Ga=1;else if(Fa>1)c.x=ja,c.y=Ra,c.z=Ea,Ga=2;else{var Ja,Wa,Oa;Ja=Sa+qa*Fa,Wa=Ta+Da*Fa,Oa=Ca+Na*Fa,c.x=Ja,c.y=Wa,c.z=Oa,Ga=3}Pa=Ga,La=c.x*c.x+c.y*c.y+c.z*c.z,ka=c.x,Aa=c.y,Ba=c.z}if(ra*za+ea*Za+_a*Ma<0){var Ua,Ha,Qa,Ka,$a,tn;Ua=Ri.x,Ha=Ri.y,Qa=Ri.z;var an,nn,on,sn=(an=(Ka=Ei.x)-Ua)*Ua+(nn=($a=Ei.y)-Ha)*Ha+(on=(tn=Ei.z)-Qa)*Qa,rn=void 0;if((sn=-sn/(an*an+nn*nn+on*on))<0)c.x=Ua,c.y=Ha,c.z=Qa,rn=1;else if(sn>1)c.x=Ka,c.y=$a,c.z=tn,rn=2;else{var en,_n,hn;en=Ua+an*sn,_n=Ha+nn*sn,hn=Qa+on*sn,c.x=en,c.y=_n,c.z=hn,rn=3}var ln=c.x*c.x+c.y*c.y+c.z*c.z;(La<0||ln<La)&&(Pa=rn<<1,La=ln,ka=c.x,Aa=c.y,Ba=c.z)}if(ha*Ia+la*Va+ca*wa<0){var cn,mn,vn,bn,fn,un;cn=ji.x,mn=ji.y,vn=ji.z;var pn,xn,yn,dn=(pn=(bn=Ei.x)-cn)*cn+(xn=(fn=Ei.y)-mn)*mn+(yn=(un=Ei.z)-vn)*vn,gn=void 0;if((dn=-dn/(pn*pn+xn*xn+yn*yn))<0)c.x=cn,c.y=mn,c.z=vn,gn=1;else if(dn>1)c.x=bn,c.y=fn,c.z=un,gn=2;else{var Xn,Yn,zn;Xn=cn+pn*dn,Yn=mn+xn*dn,zn=vn+yn*dn,c.x=Xn,c.y=Yn,c.z=zn,gn=3}var Zn=c.x*c.x+c.y*c.y+c.z*c.z;(La<0||Zn<La)&&(Pa=1&gn|(2&gn)<<1,La=Zn,ka=c.x,Aa=c.y,Ba=c.z)}var Mn=void 0;if(La>0)c.x=ka,c.y=Aa,c.z=Ba,Mn=Pa;else{var In=ga*ga+Xa*Xa+Ya*Ya;In>0&&(In=1/Math.sqrt(In));var Vn=(ga*=In)*ga+(Xa*=In)*Xa+(Ya*=In)*Ya;ka=ga*(Vn=(na*ga+oa*Xa+sa*Ya)/Vn),Aa=Xa*Vn,Ba=Ya*Vn,c.x=ka,c.y=Aa,c.z=Ba,Mn=7}aa=Mn,Ki=c.x*c.x+c.y*c.y+c.z*c.z,$i=c.x,ta=c.y,ia=c.z}if((ci*Di+mi*Ni+vi*Fi)*Qi<0){var wn,Ln,kn,An,Bn,Pn,Sn,Tn,Cn,jn,Rn,En,qn,Dn,Nn,Fn,Gn,Jn;wn=ji.x,Ln=ji.y,kn=ji.z,An=Ei.x,Bn=Ei.y,Pn=Ei.z,Sn=qi.x,Tn=qi.y;var Wn=void 0,On=void 0,Un=void 0;Wn=(Rn=Bn-Ln)*(Nn=(Cn=qi.z)-Pn)-(En=Pn-kn)*(Dn=Tn-Bn);var Hn,Qn,Kn,$n,to,io;Hn=Dn*(Un=(jn=An-wn)*Dn-Rn*(qn=Sn-An))-Nn*(On=En*qn-jn*Nn),Qn=Nn*Wn-qn*Un,Kn=qn*On-Dn*Wn,$n=(Gn=Ln-Tn)*Un-(Jn=kn-Cn)*On,to=Jn*Wn-(Fn=wn-Sn)*Un,io=Fn*On-Gn*Wn;var ao=-1,no=void 0,oo=void 0,so=void 0,ro=0;if(no=0,oo=0,so=0,wn*(Rn*Un-En*On)+Ln*(En*Wn-jn*Un)+kn*(jn*On-Rn*Wn)<0){var eo,_o,ho,lo,co,mo;eo=ji.x,_o=ji.y,ho=ji.z;var vo,bo,fo,uo=(vo=(lo=Ei.x)-eo)*eo+(bo=(co=Ei.y)-_o)*_o+(fo=(mo=Ei.z)-ho)*ho,po=void 0;if((uo=-uo/(vo*vo+bo*bo+fo*fo))<0)c.x=eo,c.y=_o,c.z=ho,po=1;else if(uo>1)c.x=lo,c.y=co,c.z=mo,po=2;else{var xo,yo,go;xo=eo+vo*uo,yo=_o+bo*uo,go=ho+fo*uo,c.x=xo,c.y=yo,c.z=go,po=3}ro=po,ao=c.x*c.x+c.y*c.y+c.z*c.z,no=c.x,oo=c.y,so=c.z}if(An*Hn+Bn*Qn+Pn*Kn<0){var Xo,Yo,zo,Zo,Mo,Io;Xo=Ei.x,Yo=Ei.y,zo=Ei.z;var Vo,wo,Lo,ko=(Vo=(Zo=qi.x)-Xo)*Xo+(wo=(Mo=qi.y)-Yo)*Yo+(Lo=(Io=qi.z)-zo)*zo,Ao=void 0;if((ko=-ko/(Vo*Vo+wo*wo+Lo*Lo))<0)c.x=Xo,c.y=Yo,c.z=zo,Ao=1;else if(ko>1)c.x=Zo,c.y=Mo,c.z=Io,Ao=2;else{var Bo,Po,So;Bo=Xo+Vo*ko,Po=Yo+wo*ko,So=zo+Lo*ko,c.x=Bo,c.y=Po,c.z=So,Ao=3}var To=c.x*c.x+c.y*c.y+c.z*c.z;(ao<0||To<ao)&&(ro=Ao<<1,ao=To,no=c.x,oo=c.y,so=c.z)}if(Sn*$n+Tn*to+Cn*io<0){var Co,jo,Ro,Eo,qo,Do;Co=ji.x,jo=ji.y,Ro=ji.z;var No,Fo,Go,Jo=(No=(Eo=qi.x)-Co)*Co+(Fo=(qo=qi.y)-jo)*jo+(Go=(Do=qi.z)-Ro)*Ro,Wo=void 0;if((Jo=-Jo/(No*No+Fo*Fo+Go*Go))<0)c.x=Co,c.y=jo,c.z=Ro,Wo=1;else if(Jo>1)c.x=Eo,c.y=qo,c.z=Do,Wo=2;else{var Oo,Uo,Ho;Oo=Co+No*Jo,Uo=jo+Fo*Jo,Ho=Ro+Go*Jo,c.x=Oo,c.y=Uo,c.z=Ho,Wo=3}var Qo=c.x*c.x+c.y*c.y+c.z*c.z;(ao<0||Qo<ao)&&(ro=1&Wo|(2&Wo)<<1,ao=Qo,no=c.x,oo=c.y,so=c.z)}var Ko=void 0;if(ao>0)c.x=no,c.y=oo,c.z=so,Ko=ro;else{var $o=Wn*Wn+On*On+Un*Un;$o>0&&($o=1/Math.sqrt($o));var ts=(Wn*=$o)*Wn+(On*=$o)*On+(Un*=$o)*Un;no=Wn*(ts=(wn*Wn+Ln*On+kn*Un)/ts),oo=On*ts,so=Un*ts,c.x=no,c.y=oo,c.z=so,Ko=7}var is=c.x*c.x+c.y*c.y+c.z*c.z;(Ki<0||is<Ki)&&(aa=1&Ko|(6&Ko)<<1,Ki=is,$i=c.x,ta=c.y,ia=c.z)}if((ci*Gi+mi*Ji+vi*Wi)*Qi<0){var as,ns,os,ss,rs,es,_s,hs,ls,cs,ms,vs,bs,fs,us,ps,xs,ys;as=ji.x,ns=ji.y,os=ji.z,ss=Ri.x,rs=Ri.y,es=Ri.z,_s=qi.x,hs=qi.y;var ds=void 0,gs=void 0,Xs=void 0;ds=(ms=rs-ns)*(us=(ls=qi.z)-es)-(vs=es-os)*(fs=hs-rs);var Ys,zs,Zs,Ms,Is,Vs;Ys=fs*(Xs=(cs=ss-as)*fs-ms*(bs=_s-ss))-us*(gs=vs*bs-cs*us),zs=us*ds-bs*Xs,Zs=bs*gs-fs*ds,Ms=(xs=ns-hs)*Xs-(ys=os-ls)*gs,Is=ys*ds-(ps=as-_s)*Xs,Vs=ps*gs-xs*ds;var ws=-1,Ls=void 0,ks=void 0,As=void 0,Bs=0;if(Ls=0,ks=0,As=0,as*(ms*Xs-vs*gs)+ns*(vs*ds-cs*Xs)+os*(cs*gs-ms*ds)<0){var Ps,Ss,Ts,Cs,js,Rs;Ps=ji.x,Ss=ji.y,Ts=ji.z;var Es,qs,Ds,Ns=(Es=(Cs=Ri.x)-Ps)*Ps+(qs=(js=Ri.y)-Ss)*Ss+(Ds=(Rs=Ri.z)-Ts)*Ts,Fs=void 0;if((Ns=-Ns/(Es*Es+qs*qs+Ds*Ds))<0)c.x=Ps,c.y=Ss,c.z=Ts,Fs=1;else if(Ns>1)c.x=Cs,c.y=js,c.z=Rs,Fs=2;else{var Gs,Js,Ws;Gs=Ps+Es*Ns,Js=Ss+qs*Ns,Ws=Ts+Ds*Ns,c.x=Gs,c.y=Js,c.z=Ws,Fs=3}Bs=Fs,ws=c.x*c.x+c.y*c.y+c.z*c.z,Ls=c.x,ks=c.y,As=c.z}if(ss*Ys+rs*zs+es*Zs<0){var Os,Us,Hs,Qs,Ks,$s;Os=Ri.x,Us=Ri.y,Hs=Ri.z;var tr,ir,ar,nr=(tr=(Qs=qi.x)-Os)*Os+(ir=(Ks=qi.y)-Us)*Us+(ar=($s=qi.z)-Hs)*Hs,or=void 0;if((nr=-nr/(tr*tr+ir*ir+ar*ar))<0)c.x=Os,c.y=Us,c.z=Hs,or=1;else if(nr>1)c.x=Qs,c.y=Ks,c.z=$s,or=2;else{var sr,rr,er;sr=Os+tr*nr,rr=Us+ir*nr,er=Hs+ar*nr,c.x=sr,c.y=rr,c.z=er,or=3}var _r=c.x*c.x+c.y*c.y+c.z*c.z;(ws<0||_r<ws)&&(Bs=or<<1,ws=_r,Ls=c.x,ks=c.y,As=c.z)}if(_s*Ms+hs*Is+ls*Vs<0){var hr,lr,cr,mr,vr,br;hr=ji.x,lr=ji.y,cr=ji.z;var fr,ur,pr,xr=(fr=(mr=qi.x)-hr)*hr+(ur=(vr=qi.y)-lr)*lr+(pr=(br=qi.z)-cr)*cr,yr=void 0;if((xr=-xr/(fr*fr+ur*ur+pr*pr))<0)c.x=hr,c.y=lr,c.z=cr,yr=1;else if(xr>1)c.x=mr,c.y=vr,c.z=br,yr=2;else{var dr,gr,Xr;dr=hr+fr*xr,gr=lr+ur*xr,Xr=cr+pr*xr,c.x=dr,c.y=gr,c.z=Xr,yr=3}var Yr=c.x*c.x+c.y*c.y+c.z*c.z;(ws<0||Yr<ws)&&(Bs=1&yr|(2&yr)<<1,ws=Yr,Ls=c.x,ks=c.y,As=c.z)}var zr=void 0;if(ws>0)c.x=Ls,c.y=ks,c.z=As,zr=Bs;else{var Zr=ds*ds+gs*gs+Xs*Xs;Zr>0&&(Zr=1/Math.sqrt(Zr));var Mr=(ds*=Zr)*ds+(gs*=Zr)*gs+(Xs*=Zr)*Xs;Ls=ds*(Mr=(as*ds+ns*gs+os*Xs)/Mr),ks=gs*Mr,As=Xs*Mr,c.x=Ls,c.y=ks,c.z=As,zr=7}var Ir=c.x*c.x+c.y*c.y+c.z*c.z;(Ki<0||Ir<Ki)&&(aa=3&zr|(4&zr)<<1,Ki=Ir,$i=c.x,ta=c.y,ia=c.z)}if((bi*Oi+fi*Ui+ui*Hi)*Qi<0){var Vr,wr,Lr,kr,Ar,Br,Pr,Sr,Tr,Cr,jr,Rr,Er,qr,Dr,Nr,Fr,Gr;Vr=Ri.x,wr=Ri.y,Lr=Ri.z,kr=Ei.x,Ar=Ei.y,Br=Ei.z,Pr=qi.x,Sr=qi.y;var Jr=void 0,Wr=void 0,Or=void 0;Jr=(jr=Ar-wr)*(Dr=(Tr=qi.z)-Br)-(Rr=Br-Lr)*(qr=Sr-Ar);var Ur,Hr,Qr,Kr,$r,te;Ur=qr*(Or=(Cr=kr-Vr)*qr-jr*(Er=Pr-kr))-Dr*(Wr=Rr*Er-Cr*Dr),Hr=Dr*Jr-Er*Or,Qr=Er*Wr-qr*Jr,Kr=(Fr=wr-Sr)*Or-(Gr=Lr-Tr)*Wr,$r=Gr*Jr-(Nr=Vr-Pr)*Or,te=Nr*Wr-Fr*Jr;var ie=-1,ae=void 0,ne=void 0,oe=void 0,se=0;if(ae=0,ne=0,oe=0,Vr*(jr*Or-Rr*Wr)+wr*(Rr*Jr-Cr*Or)+Lr*(Cr*Wr-jr*Jr)<0){var re,ee,_e,he,le,ce;re=Ri.x,ee=Ri.y,_e=Ri.z;var me,ve,be,fe=(me=(he=Ei.x)-re)*re+(ve=(le=Ei.y)-ee)*ee+(be=(ce=Ei.z)-_e)*_e,ue=void 0;if((fe=-fe/(me*me+ve*ve+be*be))<0)c.x=re,c.y=ee,c.z=_e,ue=1;else if(fe>1)c.x=he,c.y=le,c.z=ce,ue=2;else{var pe,xe,ye;pe=re+me*fe,xe=ee+ve*fe,ye=_e+be*fe,c.x=pe,c.y=xe,c.z=ye,ue=3}se=ue,ie=c.x*c.x+c.y*c.y+c.z*c.z,ae=c.x,ne=c.y,oe=c.z}if(kr*Ur+Ar*Hr+Br*Qr<0){var de,ge,Xe,Ye,ze,Ze;de=Ei.x,ge=Ei.y,Xe=Ei.z;var Me,Ie,Ve,we=(Me=(Ye=qi.x)-de)*de+(Ie=(ze=qi.y)-ge)*ge+(Ve=(Ze=qi.z)-Xe)*Xe,Le=void 0;if((we=-we/(Me*Me+Ie*Ie+Ve*Ve))<0)c.x=de,c.y=ge,c.z=Xe,Le=1;else if(we>1)c.x=Ye,c.y=ze,c.z=Ze,Le=2;else{var ke,Ae,Be;ke=de+Me*we,Ae=ge+Ie*we,Be=Xe+Ve*we,c.x=ke,c.y=Ae,c.z=Be,Le=3}var Pe=c.x*c.x+c.y*c.y+c.z*c.z;(ie<0||Pe<ie)&&(se=Le<<1,ie=Pe,ae=c.x,ne=c.y,oe=c.z)}if(Pr*Kr+Sr*$r+Tr*te<0){var Se,Te,Ce,je,Re,Ee;Se=Ri.x,Te=Ri.y,Ce=Ri.z;var qe,De,Ne,Fe=(qe=(je=qi.x)-Se)*Se+(De=(Re=qi.y)-Te)*Te+(Ne=(Ee=qi.z)-Ce)*Ce,Ge=void 0;if((Fe=-Fe/(qe*qe+De*De+Ne*Ne))<0)c.x=Se,c.y=Te,c.z=Ce,Ge=1;else if(Fe>1)c.x=je,c.y=Re,c.z=Ee,Ge=2;else{var Je,We,Oe;Je=Se+qe*Fe,We=Te+De*Fe,Oe=Ce+Ne*Fe,c.x=Je,c.y=We,c.z=Oe,Ge=3}var Ue=c.x*c.x+c.y*c.y+c.z*c.z;(ie<0||Ue<ie)&&(se=1&Ge|(2&Ge)<<1,ie=Ue,ae=c.x,ne=c.y,oe=c.z)}var He=void 0;if(ie>0)c.x=ae,c.y=ne,c.z=oe,He=se;else{var Qe=Jr*Jr+Wr*Wr+Or*Or;Qe>0&&(Qe=1/Math.sqrt(Qe));var Ke=(Jr*=Qe)*Jr+(Wr*=Qe)*Wr+(Or*=Qe)*Or;ae=Jr*(Ke=(Vr*Jr+wr*Wr+Lr*Or)/Ke),ne=Wr*Ke,oe=Or*Ke,c.x=ae,c.y=ne,c.z=oe,He=7}var $e=c.x*c.x+c.y*c.y+c.z*c.z;(Ki<0||$e<Ki)&&(aa=He<<1,Ki=$e,$i=c.x,ta=c.y,ia=c.z)}Ki>0?(c.x=$i,c.y=ta,c.z=ia,g=aa):(c.zero(),g=15)}if(this.shrinkSimplex(g),c.x*c.x+c.y*c.y+c.z*c.z<1e-8){if(0==x||4==this.simplexSize)return r.fraction=x,!1;this.interpolateClosestPoints(),r.fraction=x;var t_=r.normal;t_.x=m.x,t_.y=m.y,t_.z=m.z;var i_=Math.sqrt(t_.x*t_.x+t_.y*t_.y+t_.z*t_.z);i_>0&&(i_=1/i_),t_.x*=i_,t_.y*=i_,t_.z*=i_;var a_=r.position,n_=this.closestPoint1;return a_.x=n_.x,a_.y=n_.y,a_.z=n_.z,a_.x+=o.x*x,a_.y+=o.y*x,a_.z+=o.z*x,!0}if(m.x=c.x,m.y=c.y,m.z=c.z,m.x=-m.x,m.y=-m.y,m.z=-m.z,null!=this.c1)this.computeWitnessPoint1(!0);else{var o_=this.w1[this.simplexSize];o_.x=this.tf1._positionX,o_.y=this.tf1._positionY,o_.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var s_=this.s[this.simplexSize],r_=this.w1[this.simplexSize];s_.x=r_.x,s_.y=r_.y,s_.z=r_.z;var e_=this.w2[this.simplexSize];s_.x-=e_.x,s_.y-=e_.y,s_.z-=e_.z;var __=l[this.simplexSize];if(__.x-=y.x,__.y-=y.y,__.z-=y.z,m.x*m.x+m.y*m.y+m.z*m.z<1e-8)throw new Error("!?");var h_=l[this.simplexSize],l_=h_.x*m.x+h_.y*m.y+h_.z*m.z;if(l_<0){if(d.x*m.x+d.y*m.y+d.z*m.z>=0)return!1;var c_=l_/(d.x*m.x+d.y*m.y+d.z*m.z);if((x+=c_)>=1)return!1;y.x+=d.x*c_,y.y+=d.y*c_,y.z+=d.z*c_;for(var m_=0,v_=this.simplexSize+1;m_<v_;){var b_=l[m_++],f_=-c_;b_.x+=d.x*f_,b_.y+=d.y*f_,b_.z+=d.z*f_}}for(var u_=!1,p_=0,x_=this.simplexSize;p_<x_;){var y_=p_++,d_=l[y_].x-l[this.simplexSize].x,g_=l[y_].y-l[this.simplexSize].y,X_=l[y_].z-l[this.simplexSize].z;if(d_*d_+g_*g_+X_*X_<1e-8){u_=!0;break}}u_||this.simplexSize++,++p}return!1},i.interpolateClosestPoints=function(){switch(this.simplexSize){case 1:var t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;var a=this.closestPoint2,n=this.w2[0];a.x=n.x,a.y=n.y,a.z=n.z;break;case 2:var o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X=this.closest;o=X.x,s=X.y,r=X.z;var Y=this.s[0];e=Y.x,_=Y.y,h=Y.z;var z=this.w1[0];l=z.x,c=z.y,m=z.z;var Z=this.w2[0];v=Z.x,b=Z.y,f=Z.z;var M=this.s[1];u=M.x,p=M.y,x=M.z;var I=this.w1[1];y=I.x,d=I.y,g=I.z;var V,w,L,k=this.w2[1],A=(V=u-e)*V+(w=p-_)*w+(L=x-h)*L;0!=A&&(A=1/A);var B,P,S,T,C,j,R=((o-e)*V+(s-_)*w+(r-h)*L)*A;B=l+(y-l)*R,P=c+(d-c)*R,S=m+(g-m)*R,T=v+(k.x-v)*R,C=b+(k.y-b)*R,j=f+(k.z-f)*R;var E=this.closestPoint1;E.x=B,E.y=P,E.z=S;var q=this.closestPoint2;q.x=T,q.y=C,q.z=j;break;case 3:var D,N,F,G,J,W,O,U,H,Q,K,$,tt,it,at,nt,ot,st,rt,et,_t,ht,lt,ct,mt,vt,bt,ft=this.closest;D=ft.x,N=ft.y,F=ft.z;var ut=this.s[0];G=ut.x,J=ut.y,W=ut.z;var pt=this.w1[0];O=pt.x,U=pt.y,H=pt.z;var xt=this.w2[0];Q=xt.x,K=xt.y,$=xt.z;var yt=this.s[1];tt=yt.x,it=yt.y,at=yt.z;var dt=this.w1[1];nt=dt.x,ot=dt.y,st=dt.z;var gt=this.w2[1];rt=gt.x,et=gt.y,_t=gt.z;var Xt=this.s[2];ht=Xt.x,lt=Xt.y,ct=Xt.z;var Yt=this.w1[2];mt=Yt.x,vt=Yt.y,bt=Yt.z;var zt,Zt,Mt,It,Vt,wt,Lt,kt,At,Bt=this.w2[2],Pt=(zt=tt-G)*zt+(Zt=it-J)*Zt+(Mt=at-W)*Mt,St=zt*(It=ht-G)+Zt*(Vt=lt-J)+Mt*(wt=ct-W),Tt=It*It+Vt*Vt+wt*wt,Ct=zt*(Lt=D-G)+Zt*(kt=N-J)+Mt*(At=F-W),jt=It*Lt+Vt*kt+wt*At,Rt=Pt*Tt-St*St;0!=Rt&&(Rt=1/Rt);var Et,qt,Dt,Nt,Ft,Gt,Jt=(Ct*Tt-jt*St)*Rt,Wt=(-Ct*St+jt*Pt)*Rt;Et=O+(nt-O)*Jt,qt=U+(ot-U)*Jt,Dt=H+(st-H)*Jt,Et+=(mt-O)*Wt,qt+=(vt-U)*Wt,Dt+=(bt-H)*Wt,Nt=Q+(rt-Q)*Jt,Ft=K+(et-K)*Jt,Gt=$+(_t-$)*Jt,Nt+=(Bt.x-Q)*Wt,Ft+=(Bt.y-K)*Wt,Gt+=(Bt.z-$)*Wt;var Ot=this.closestPoint1;Ot.x=Et,Ot.y=qt,Ot.z=Dt;var Ut=this.closestPoint2;Ut.x=Nt,Ut.y=Ft,Ut.z=Gt;break;default:throw new Error("!?")}},i.loadCache=function(t){var i=this.dir,a=t.prevClosestDir;i.x=a.x,i.y=a.y,i.z=a.z},i.saveCache=function(t){var i=t.prevClosestDir,a=this.closest;i.x=a.x,i.y=a.y,i.z=a.z,i.x=-i.x,i.y=-i.y,i.z=-i.z},i.shrinkSimplex=function(t){switch(this.simplexSize=t,this.simplexSize=(5&this.simplexSize)+(this.simplexSize>>1&5),this.simplexSize=(3&this.simplexSize)+(this.simplexSize>>2&3),t){case 2:var i=this.s[0],a=this.s[1];i.x=a.x,i.y=a.y,i.z=a.z;var n=this.w1[0],o=this.w1[1];n.x=o.x,n.y=o.y,n.z=o.z;var s=this.w2[0],r=this.w2[1];s.x=r.x,s.y=r.y,s.z=r.z;break;case 4:var e=this.s[0],_=this.s[2];e.x=_.x,e.y=_.y,e.z=_.z;var h=this.w1[0],l=this.w1[2];h.x=l.x,h.y=l.y,h.z=l.z;var c=this.w2[0],m=this.w2[2];c.x=m.x,c.y=m.y,c.z=m.z;break;case 5:var v=this.s[1],b=this.s[2];v.x=b.x,v.y=b.y,v.z=b.z;var f=this.w1[1],u=this.w1[2];f.x=u.x,f.y=u.y,f.z=u.z;var p=this.w2[1],x=this.w2[2];p.x=x.x,p.y=x.y,p.z=x.z;break;case 6:var y=this.s[0],d=this.s[2];y.x=d.x,y.y=d.y,y.z=d.z;var g=this.w1[0],X=this.w1[2];g.x=X.x,g.y=X.y,g.z=X.z;var Y=this.w2[0],z=this.w2[2];Y.x=z.x,Y.y=z.y,Y.z=z.z;break;case 8:var Z=this.s[0],M=this.s[3];Z.x=M.x,Z.y=M.y,Z.z=M.z;var I=this.w1[0],V=this.w1[3];I.x=V.x,I.y=V.y,I.z=V.z;var w=this.w2[0],L=this.w2[3];w.x=L.x,w.y=L.y,w.z=L.z;break;case 9:var k=this.s[1],A=this.s[3];k.x=A.x,k.y=A.y,k.z=A.z;var B=this.w1[1],P=this.w1[3];B.x=P.x,B.y=P.y,B.z=P.z;var S=this.w2[1],T=this.w2[3];S.x=T.x,S.y=T.y,S.z=T.z;break;case 10:var C=this.s[0],j=this.s[3];C.x=j.x,C.y=j.y,C.z=j.z;var R=this.w1[0],E=this.w1[3];R.x=E.x,R.y=E.y,R.z=E.z;var q=this.w2[0],D=this.w2[3];q.x=D.x,q.y=D.y,q.z=D.z;break;case 11:var N=this.s[2],F=this.s[3];N.x=F.x,N.y=F.y,N.z=F.z;var G=this.w1[2],J=this.w1[3];G.x=J.x,G.y=J.y,G.z=J.z;var W=this.w2[2],O=this.w2[3];W.x=O.x,W.y=O.y,W.z=O.z;break;case 12:var U=this.s[0],H=this.s[2];U.x=H.x,U.y=H.y,U.z=H.z;var Q=this.w1[0],K=this.w1[2];Q.x=K.x,Q.y=K.y,Q.z=K.z;var $=this.w2[0],tt=this.w2[2];$.x=tt.x,$.y=tt.y,$.z=tt.z;var it=this.s[1],at=this.s[3];it.x=at.x,it.y=at.y,it.z=at.z;var nt=this.w1[1],ot=this.w1[3];nt.x=ot.x,nt.y=ot.y,nt.z=ot.z;var st=this.w2[1],rt=this.w2[3];st.x=rt.x,st.y=rt.y,st.z=rt.z;break;case 13:var et=this.s[1],_t=this.s[3];et.x=_t.x,et.y=_t.y,et.z=_t.z;var ht=this.w1[1],lt=this.w1[3];ht.x=lt.x,ht.y=lt.y,ht.z=lt.z;var ct=this.w2[1],mt=this.w2[3];ct.x=mt.x,ct.y=mt.y,ct.z=mt.z;break;case 14:var vt=this.s[0],bt=this.s[3];vt.x=bt.x,vt.y=bt.y,vt.z=bt.z;var ft=this.w1[0],ut=this.w1[3];ft.x=ut.x,ft.y=ut.y,ft.z=ut.z;var pt=this.w2[0],xt=this.w2[3];pt.x=xt.x,pt.y=xt.y,pt.z=xt.z}},i.computeWitnessPoint1=function(t){var i,a,n,o,s,r,e,_,h,l,c,m,v=this.dir;o=v.x,s=v.y,r=v.z,e=this.tf1._rotation00*o+this.tf1._rotation10*s+this.tf1._rotation20*r,_=this.tf1._rotation01*o+this.tf1._rotation11*s+this.tf1._rotation21*r,h=this.tf1._rotation02*o+this.tf1._rotation12*s+this.tf1._rotation22*r;var b=this.dir;if(b.x=e,b.y=_,b.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){var f=this.dir,u=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);u>0&&(u=1/u),f.x*=u,f.y*=u,f.z*=u;var p=this.w1[this.simplexSize],x=this.dir,y=this.c1._gjkMargin;p.x+=x.x*y,p.y+=x.y*y,p.z+=x.z*y}var d=this.w1[this.simplexSize];i=d.x,a=d.y,n=d.z,l=this.tf1._rotation00*i+this.tf1._rotation01*a+this.tf1._rotation02*n,c=this.tf1._rotation10*i+this.tf1._rotation11*a+this.tf1._rotation12*n,m=this.tf1._rotation20*i+this.tf1._rotation21*a+this.tf1._rotation22*n,l+=this.tf1._positionX,c+=this.tf1._positionY,m+=this.tf1._positionZ;var g=this.w1[this.simplexSize];g.x=l,g.y=c,g.z=m;var X=this.dir;X.x=o,X.y=s,X.z=r},i.computeWitnessPoint2=function(t){var i,a,n,o,s,r,e,_,h,l,c,m,v=this.dir;o=v.x,s=v.y,r=v.z,e=-(e=this.tf2._rotation00*o+this.tf2._rotation10*s+this.tf2._rotation20*r),_=-(_=this.tf2._rotation01*o+this.tf2._rotation11*s+this.tf2._rotation21*r),h=-(h=this.tf2._rotation02*o+this.tf2._rotation12*s+this.tf2._rotation22*r);var b=this.dir;if(b.x=e,b.y=_,b.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){var f=this.dir,u=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);u>0&&(u=1/u),f.x*=u,f.y*=u,f.z*=u;var p=this.w2[this.simplexSize],x=this.dir,y=this.c2._gjkMargin;p.x+=x.x*y,p.y+=x.y*y,p.z+=x.z*y}var d=this.w2[this.simplexSize];i=d.x,a=d.y,n=d.z,l=this.tf2._rotation00*i+this.tf2._rotation01*a+this.tf2._rotation02*n,c=this.tf2._rotation10*i+this.tf2._rotation11*a+this.tf2._rotation12*n,m=this.tf2._rotation20*i+this.tf2._rotation21*a+this.tf2._rotation22*n,l+=this.tf2._positionX,c+=this.tf2._positionY,m+=this.tf2._positionZ;var g=this.w2[this.simplexSize];g.x=l,g.y=c,g.z=m;var X=this.dir;X.x=o,X.y=s,X.z=r},i.pointToTetrahedron=function(){for(var t=0;t<3;){var i=this.dir,a=this.baseDirs[t++];i.x=a.x,i.y=a.y,i.z=a.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var n=this.s[this.simplexSize],o=this.w1[this.simplexSize];n.x=o.x,n.y=o.y,n.z=o.z;var s=this.w2[this.simplexSize];if(n.x-=s.x,n.y-=s.y,n.z-=s.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var r=this.dir;r.x=-r.x,r.y=-r.y,r.z=-r.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var e=this.s[this.simplexSize],_=this.w1[this.simplexSize];e.x=_.x,e.y=_.y,e.z=_.z;var h=this.w2[this.simplexSize];if(e.x-=h.x,e.y-=h.y,e.z-=h.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}},i.lineToTetrahedron=function(){var t,i,a,n,o,s,r,e,_,h=this.dir;t=h.x,i=h.y,a=h.z;var l=this.s[0];n=l.x,o=l.y,s=l.z;var c=this.s[1];r=n-c.x,e=o-c.y,_=s-c.z;for(var m=0;m<3;){var v,b,f,u=this.baseDirs[m++];v=u.x,b=u.y;var p,x,y;p=e*(f=u.z)-_*b,x=_*v-r*f,y=r*b-e*v;var d=this.dir;d.x=p,d.y=x,d.z=y,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var g=this.s[this.simplexSize],X=this.w1[this.simplexSize];g.x=X.x,g.y=X.y,g.z=X.z;var Y=this.w2[this.simplexSize];if(g.x-=Y.x,g.y-=Y.y,g.z-=Y.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var z=this.dir;z.x=-z.x,z.y=-z.y,z.z=-z.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var Z=this.s[this.simplexSize],M=this.w1[this.simplexSize];Z.x=M.x,Z.y=M.y,Z.z=M.z;var I=this.w2[this.simplexSize];if(Z.x-=I.x,Z.y-=I.y,Z.z-=I.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}var V=this.dir;V.x=t,V.y=i,V.z=a},i.triangleToTetrahedron=function(){var t,i,a,n=this.dir;for(t=n.x,i=n.y,a=n.z;;){var o,s,r,e,_,h,l,c,m,v,b,f,u,p,x=this.s[0];o=x.x,s=x.y,r=x.z;var y=this.s[1];e=y.x,_=y.y,h=y.z;var d=this.s[2];l=d.x,c=d.y;var g,X,Y;g=(v=_-s)*(p=d.z-r)-(b=h-r)*(u=c-s),X=b*(f=l-o)-(m=e-o)*p,Y=m*u-v*f;var z=this.dir;z.x=g,z.y=X,z.z=Y,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var Z=this.s[this.simplexSize],M=this.w1[this.simplexSize];Z.x=M.x,Z.y=M.y,Z.z=M.z;var I=this.w2[this.simplexSize];if(Z.x-=I.x,Z.y-=I.y,Z.z-=I.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var V=this.dir;V.x=-V.x,V.y=-V.y,V.z=-V.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var w=this.s[this.simplexSize],L=this.w1[this.simplexSize];w.x=L.x,w.y=L.y,w.z=L.z;var k=this.w2[this.simplexSize];if(w.x-=k.x,w.y-=k.y,w.z-=k.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var A=this.dir;A.x=t,A.y=i,A.z=a},i.isValidTetrahedron=function(){var t=this.s[2].x-this.s[0].x,i=this.s[2].y-this.s[0].y,a=this.s[2].z-this.s[0].z,n=this.s[3].x-this.s[0].x,o=this.s[3].y-this.s[0].y,s=this.s[3].z-this.s[0].z,r=(this.s[1].x-this.s[0].x)*(i*s-a*o)-(this.s[1].y-this.s[0].y)*(t*s-a*n)+(this.s[1].z-this.s[0].z)*(t*o-i*n);return r>1e-12||r<-1e-12},i.computeDepth=function(t,i,a,n,o,s,e){for(var _=this.polyhedron;_._numTriangles>0;){var h=_._triangleList;_._numTriangles--;var l=h._prev,c=h._next;null!=l&&(l._next=c),null!=c&&(c._prev=l),h==_._triangleList&&(_._triangleList=_._triangleList._next),h==_._triangleListLast&&(_._triangleListLast=_._triangleListLast._prev),h._next=null,h._prev=null,h.removeReferences(),h._next=_._trianglePool,_._trianglePool=h}for(;_._numVertices>0;){var m=_._vertices[--_._numVertices];m.removeReferences(),m._next=_._vertexPool,_._vertexPool=m}var v=this.polyhedron,b=this.polyhedron,f=b._vertexPool;null!=f?(b._vertexPool=f._next,f._next=null):f=new r.collision.narrowphase.detector.gjkepa.EpaVertex;var u=f.init(o[0],s[0],e[0]),p=this.polyhedron,x=p._vertexPool;null!=x?(p._vertexPool=x._next,x._next=null):x=new r.collision.narrowphase.detector.gjkepa.EpaVertex;var y=x.init(o[1],s[1],e[1]),d=this.polyhedron,g=d._vertexPool;null!=g?(d._vertexPool=g._next,g._next=null):g=new r.collision.narrowphase.detector.gjkepa.EpaVertex;var X=g.init(o[2],s[2],e[2]),Y=this.polyhedron,z=Y._vertexPool;if(null!=z?(Y._vertexPool=z._next,z._next=null):z=new r.collision.narrowphase.detector.gjkepa.EpaVertex,!v._init(u,y,X,z.init(o[3],s[3],e[3])))return r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var Z=this.s[0],M=this.w1[0],I=this.w2[0],V=0;V<40;){for(var w=this.polyhedron._triangleList,L=Infinity,k=null;null!=w;)w._distanceSq<L&&(L=w._distanceSq,k=w),w=w._next;var A=k,B=this.dir,P=A._normal;B.x=P.x,B.y=P.y,B.z=P.z;var S=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);S>0&&(S=1/S),B.x*=S,B.y*=S,B.z*=S,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var T=this.s[this.simplexSize],C=this.w1[this.simplexSize];T.x=C.x,T.y=C.y,T.z=C.z;var j=this.w2[this.simplexSize];T.x-=j.x,T.y-=j.y,T.z-=j.z;var R=A._vertices[0],E=A._vertices[1],q=A._vertices[2],D=R.v,N=this.dir,F=this.dir;if(Z.x*F.x+Z.y*F.y+Z.z*F.z-(D.x*N.x+D.y*N.y+D.z*N.z)<1e-6||39==V){var G=this.closest,J=this.dir;G.x=J.x,G.y=J.y,G.z=J.z;var W=this.dir,O=R.v,U=this.dir,H=(W.x*O.x+W.y*O.y+W.z*O.z)/(U.x*U.x+U.y*U.y+U.z*U.z);G.x*=H,G.y*=H,G.z*=H;var Q,K,$,tt=this.closest;Q=tt.x,K=tt.y,$=tt.z;var it,at,nt,ot,st,rt,et,_t,ht,lt,ct,mt,vt,bt,ft,ut,pt,xt,yt,dt,gt,Xt,Yt,zt,Zt=R.v;it=Zt.x,at=Zt.y,nt=Zt.z;var Mt=R.w1;ot=Mt.x,st=Mt.y,rt=Mt.z;var It=R.w2;et=It.x,_t=It.y,ht=It.z;var Vt=E.v;lt=Vt.x,ct=Vt.y,mt=Vt.z;var wt=E.w1;vt=wt.x,bt=wt.y,ft=wt.z;var Lt=E.w2;ut=Lt.x,pt=Lt.y,xt=Lt.z;var kt=q.v;yt=kt.x,dt=kt.y,gt=kt.z;var At=q.w1;Xt=At.x,Yt=At.y,zt=At.z;var Bt,Pt,St,Tt,Ct,jt,Rt,Et,qt,Dt=q.w2,Nt=(Bt=lt-it)*Bt+(Pt=ct-at)*Pt+(St=mt-nt)*St,Ft=Bt*(Tt=yt-it)+Pt*(Ct=dt-at)+St*(jt=gt-nt),Gt=Tt*Tt+Ct*Ct+jt*jt,Jt=Bt*(Rt=Q-it)+Pt*(Et=K-at)+St*(qt=$-nt),Wt=Tt*Rt+Ct*Et+jt*qt,Ot=Nt*Gt-Ft*Ft;0!=Ot&&(Ot=1/Ot);var Ut=(Jt*Gt-Wt*Ft)*Ot,Ht=(-Jt*Ft+Wt*Nt)*Ot,Qt=void 0,Kt=void 0,$t=void 0,ti=void 0,ii=void 0,ai=void 0;Qt=ot+(vt-ot)*Ut,Kt=st+(bt-st)*Ut,$t=rt+(ft-rt)*Ut,Qt+=(Xt-ot)*Ht,Kt+=(Yt-st)*Ht,$t+=(zt-rt)*Ht,ti=et+(ut-et)*Ut,ii=_t+(pt-_t)*Ut,ai=ht+(xt-ht)*Ut,ti+=(Dt.x-et)*Ht,ii+=(Dt.y-_t)*Ht,ai+=(Dt.z-ht)*Ht;var ni=this.closestPoint1;ni.x=Qt,ni.y=Kt,ni.z=$t;var oi=this.closestPoint2;oi.x=ti,oi.y=ii,oi.z=ai;var si=this.closest;return this.depth=Math.sqrt(si.x*si.x+si.y*si.y+si.z*si.z),r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}var ri=this.polyhedron,ei=ri._vertexPool;null!=ei?(ri._vertexPool=ei._next,ei._next=null):ei=new r.collision.narrowphase.detector.gjkepa.EpaVertex;var _i=ei.init(Z,M,I);if(!this.polyhedron._addVertex(_i,A))return r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++V}return r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE},i.computeClosestPoints=function(t,i,a,n,o){return this.computeClosestPointsImpl(t,i,a,n,o,!0)},i.computeDistance=function(t,i,a,n,o){return this.computeClosestPointsImpl(t,i,a,n,o,!1)},i.convexCast=function(t,i,a,n,o,s,r){return this.convexCastImpl(t,i,a,n,o,s,r)},i.rayCast=function(t,i,a,n,o){var s=this.tempTransform;s._positionX=a.x,s._positionY=a.y,s._positionZ=a.z;var r=this.tl1,e=this.tl2;return r.x=n.x,r.y=n.y,r.z=n.z,r.x-=a.x,r.y-=a.y,r.z-=a.z,e.zero(),this.convexCastImpl(null,t,s,i,r,e,o)},t.getInstance=function(){return r.collision.narrowphase.detector.gjkepa.GjkEpa.instance},t}(),r.collision.narrowphase.detector.gjkepa.GjkEpaLog=function(){},r.collision.narrowphase.detector.gjkepa.GjkEpaResultState=function(){},r.collision.narrowphase.detector.gjkepa.SimplexUtil=function(){function t(){}return t.projectOrigin2=function(t,i,a){var n,o,s,r,e,_,h,l,c;n=t.x,o=t.y,s=t.z;var m,v,b,f=(h=(r=i.x)-n)*n+(l=(e=i.y)-o)*o+(c=(_=i.z)-s)*s;return(f=-f/(h*h+l*l+c*c))<0?(a.x=n,a.y=o,a.z=s,1):f>1?(a.x=r,a.y=e,a.z=_,2):(m=n+h*f,v=o+l*f,b=s+c*f,a.x=m,a.y=v,a.z=b,3)},t.projectOrigin3=function(t,i,a,n){var o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L;o=t.x,s=t.y,r=t.z,e=i.x,_=i.y,h=i.z,l=a.x,Z=(p=(c=a.y)-_)*(z=(v=e-o)*p-(b=_-s)*(u=l-e))-(x=(m=a.z)-h)*(Y=(f=h-r)*u-v*x),M=x*(X=b*x-f*p)-u*z,I=u*Y-p*X,V=(d=s-c)*z-(g=r-m)*Y,w=g*X-(y=o-l)*z,L=y*Y-d*X;var k,A,B,P=-1,S=0;if(k=0,A=0,B=0,o*(b*z-f*Y)+s*(f*X-v*z)+r*(v*Y-b*X)<0){var T,C,j,R,E,q,D,N,F;T=t.x,C=t.y,j=t.z;var G,J=(D=(R=i.x)-T)*T+(N=(E=i.y)-C)*C+(F=(q=i.z)-j)*j;if((J=-J/(D*D+N*N+F*F))<0)n.x=T,n.y=C,n.z=j,G=1;else if(J>1)n.x=R,n.y=E,n.z=q,G=2;else{var W,O,U;W=T+D*J,O=C+N*J,U=j+F*J,n.x=W,n.y=O,n.z=U,G=3}S=G,P=n.x*n.x+n.y*n.y+n.z*n.z,k=n.x,A=n.y,B=n.z}if(e*Z+_*M+h*I<0){var H,Q,K,$,tt,it,at,nt,ot;H=i.x,Q=i.y,K=i.z;var st,rt=(at=($=a.x)-H)*H+(nt=(tt=a.y)-Q)*Q+(ot=(it=a.z)-K)*K;if((rt=-rt/(at*at+nt*nt+ot*ot))<0)n.x=H,n.y=Q,n.z=K,st=1;else if(rt>1)n.x=$,n.y=tt,n.z=it,st=2;else{var et,_t,ht;et=H+at*rt,_t=Q+nt*rt,ht=K+ot*rt,n.x=et,n.y=_t,n.z=ht,st=3}var lt=n.x*n.x+n.y*n.y+n.z*n.z;(P<0||lt<P)&&(S=st<<1,P=lt,k=n.x,A=n.y,B=n.z)}if(l*V+c*w+m*L<0){var ct,mt,vt,bt,ft,ut,pt,xt,yt;ct=t.x,mt=t.y,vt=t.z;var dt,gt=(pt=(bt=a.x)-ct)*ct+(xt=(ft=a.y)-mt)*mt+(yt=(ut=a.z)-vt)*vt;if((gt=-gt/(pt*pt+xt*xt+yt*yt))<0)n.x=ct,n.y=mt,n.z=vt,dt=1;else if(gt>1)n.x=bt,n.y=ft,n.z=ut,dt=2;else{var Xt,Yt,zt;Xt=ct+pt*gt,Yt=mt+xt*gt,zt=vt+yt*gt,n.x=Xt,n.y=Yt,n.z=zt,dt=3}var Zt=n.x*n.x+n.y*n.y+n.z*n.z;(P<0||Zt<P)&&(S=1&dt|(2&dt)<<1,P=Zt,k=n.x,A=n.y,B=n.z)}if(P>0)return n.x=k,n.y=A,n.z=B,S;var Mt=X*X+Y*Y+z*z;Mt>0&&(Mt=1/Math.sqrt(Mt));var It=(X*=Mt)*X+(Y*=Mt)*Y+(z*=Mt)*z;return k=X*(It=(o*X+s*Y+r*z)/It),A=Y*It,B=z*It,n.x=k,n.y=A,n.z=B,7},t.projectOrigin4=function(t,i,a,n,o){var s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,E;s=t.x,r=t.y,e=t.z,_=i.x,h=i.y,l=i.z,c=a.x,m=a.y,v=a.z,b=n.x,f=n.y,A=(g=m-r)*(Z=(u=n.z)-e)-(X=v-e)*(z=f-r),B=X*(Y=b-s)-(d=c-s)*Z,P=d*z-g*Y,S=z*(y=l-e)-Z*(x=h-r),T=Z*(p=_-s)-Y*y,C=Y*x-z*p;var q,D,N,F=p*(j=(L=f-h)*(V=v-l)-(k=u-l)*(I=m-h))+x*(R=k*(M=c-_)-(w=b-_)*V)+y*(E=w*I-L*M)>0?1:-1,G=-1,J=0;if(q=0,D=0,N=0,(s*(x*X-y*g)+r*(y*d-p*X)+e*(p*g-x*d))*F<0){var W,O,U,H,Q,K,$,tt,it,at,nt,ot,st,rt,et,_t,ht,lt,ct,mt,vt,bt,ft,ut,pt,xt,yt;W=t.x,O=t.y,U=t.z,H=i.x,Q=i.y,K=i.z,$=a.x,bt=(rt=(tt=a.y)-Q)*(vt=(at=H-W)*rt-(nt=Q-O)*(st=$-H))-(et=(it=a.z)-K)*(mt=(ot=K-U)*st-at*et),ft=et*(ct=nt*et-ot*rt)-st*vt,ut=st*mt-rt*ct,pt=(ht=O-tt)*vt-(lt=U-it)*mt,xt=lt*ct-(_t=W-$)*vt,yt=_t*mt-ht*ct;var dt,gt,Xt,Yt,zt=-1,Zt=0;if(dt=0,gt=0,Xt=0,W*(nt*vt-ot*mt)+O*(ot*ct-at*vt)+U*(at*mt-nt*ct)<0){var Mt,It,Vt,wt,Lt,kt,At,Bt,Pt;Mt=t.x,It=t.y,Vt=t.z;var St,Tt=(At=(wt=i.x)-Mt)*Mt+(Bt=(Lt=i.y)-It)*It+(Pt=(kt=i.z)-Vt)*Vt;if((Tt=-Tt/(At*At+Bt*Bt+Pt*Pt))<0)o.x=Mt,o.y=It,o.z=Vt,St=1;else if(Tt>1)o.x=wt,o.y=Lt,o.z=kt,St=2;else{var Ct,jt,Rt;Ct=Mt+At*Tt,jt=It+Bt*Tt,Rt=Vt+Pt*Tt,o.x=Ct,o.y=jt,o.z=Rt,St=3}Zt=St,zt=o.x*o.x+o.y*o.y+o.z*o.z,dt=o.x,gt=o.y,Xt=o.z}if(H*bt+Q*ft+K*ut<0){var Et,qt,Dt,Nt,Ft,Gt,Jt,Wt,Ot;Et=i.x,qt=i.y,Dt=i.z;var Ut,Ht=(Jt=(Nt=a.x)-Et)*Et+(Wt=(Ft=a.y)-qt)*qt+(Ot=(Gt=a.z)-Dt)*Dt;if((Ht=-Ht/(Jt*Jt+Wt*Wt+Ot*Ot))<0)o.x=Et,o.y=qt,o.z=Dt,Ut=1;else if(Ht>1)o.x=Nt,o.y=Ft,o.z=Gt,Ut=2;else{var Qt,Kt,$t;Qt=Et+Jt*Ht,Kt=qt+Wt*Ht,$t=Dt+Ot*Ht,o.x=Qt,o.y=Kt,o.z=$t,Ut=3}var ti=o.x*o.x+o.y*o.y+o.z*o.z;(zt<0||ti<zt)&&(Zt=Ut<<1,zt=ti,dt=o.x,gt=o.y,Xt=o.z)}if($*pt+tt*xt+it*yt<0){var ii,ai,ni,oi,si,ri,ei,_i,hi;ii=t.x,ai=t.y,ni=t.z;var li,ci=(ei=(oi=a.x)-ii)*ii+(_i=(si=a.y)-ai)*ai+(hi=(ri=a.z)-ni)*ni;if((ci=-ci/(ei*ei+_i*_i+hi*hi))<0)o.x=ii,o.y=ai,o.z=ni,li=1;else if(ci>1)o.x=oi,o.y=si,o.z=ri,li=2;else{var mi,vi,bi;mi=ii+ei*ci,vi=ai+_i*ci,bi=ni+hi*ci,o.x=mi,o.y=vi,o.z=bi,li=3}var fi=o.x*o.x+o.y*o.y+o.z*o.z;(zt<0||fi<zt)&&(Zt=1&li|(2&li)<<1,zt=fi,dt=o.x,gt=o.y,Xt=o.z)}if(zt>0)o.x=dt,o.y=gt,o.z=Xt,Yt=Zt;else{var ui=ct*ct+mt*mt+vt*vt;ui>0&&(ui=1/Math.sqrt(ui));var pi=(ct*=ui)*ct+(mt*=ui)*mt+(vt*=ui)*vt;dt=ct*(pi=(W*ct+O*mt+U*vt)/pi),gt=mt*pi,Xt=vt*pi,o.x=dt,o.y=gt,o.z=Xt,Yt=7}J=Yt,G=o.x*o.x+o.y*o.y+o.z*o.z,q=o.x,D=o.y,N=o.z}if((s*A+r*B+e*P)*F<0){var xi,yi,di,gi,Xi,Yi,zi,Zi,Mi,Ii,Vi,wi,Li,ki,Ai,Bi,Pi,Si,Ti,Ci,ji,Ri,Ei,qi,Di,Ni,Fi;xi=t.x,yi=t.y,di=t.z,gi=a.x,Xi=a.y,Yi=a.z,zi=n.x,Ri=(ki=(Zi=n.y)-Xi)*(ji=(Ii=gi-xi)*ki-(Vi=Xi-yi)*(Li=zi-gi))-(Ai=(Mi=n.z)-Yi)*(Ci=(wi=Yi-di)*Li-Ii*Ai),Ei=Ai*(Ti=Vi*Ai-wi*ki)-Li*ji,qi=Li*Ci-ki*Ti,Di=(Pi=yi-Zi)*ji-(Si=di-Mi)*Ci,Ni=Si*Ti-(Bi=xi-zi)*ji,Fi=Bi*Ci-Pi*Ti;var Gi,Ji,Wi,Oi,Ui=-1,Hi=0;if(Gi=0,Ji=0,Wi=0,xi*(Vi*ji-wi*Ci)+yi*(wi*Ti-Ii*ji)+di*(Ii*Ci-Vi*Ti)<0){var Qi,Ki,$i,ta,ia,aa,na,oa,sa;Qi=t.x,Ki=t.y,$i=t.z;var ra,ea=(na=(ta=a.x)-Qi)*Qi+(oa=(ia=a.y)-Ki)*Ki+(sa=(aa=a.z)-$i)*$i;if((ea=-ea/(na*na+oa*oa+sa*sa))<0)o.x=Qi,o.y=Ki,o.z=$i,ra=1;else if(ea>1)o.x=ta,o.y=ia,o.z=aa,ra=2;else{var _a,ha,la;_a=Qi+na*ea,ha=Ki+oa*ea,la=$i+sa*ea,o.x=_a,o.y=ha,o.z=la,ra=3}Hi=ra,Ui=o.x*o.x+o.y*o.y+o.z*o.z,Gi=o.x,Ji=o.y,Wi=o.z}if(gi*Ri+Xi*Ei+Yi*qi<0){var ca,ma,va,ba,fa,ua,pa,xa,ya;ca=a.x,ma=a.y,va=a.z;var da,ga=(pa=(ba=n.x)-ca)*ca+(xa=(fa=n.y)-ma)*ma+(ya=(ua=n.z)-va)*va;if((ga=-ga/(pa*pa+xa*xa+ya*ya))<0)o.x=ca,o.y=ma,o.z=va,da=1;else if(ga>1)o.x=ba,o.y=fa,o.z=ua,da=2;else{var Xa,Ya,za;Xa=ca+pa*ga,Ya=ma+xa*ga,za=va+ya*ga,o.x=Xa,o.y=Ya,o.z=za,da=3}var Za=o.x*o.x+o.y*o.y+o.z*o.z;(Ui<0||Za<Ui)&&(Hi=da<<1,Ui=Za,Gi=o.x,Ji=o.y,Wi=o.z)}if(zi*Di+Zi*Ni+Mi*Fi<0){var Ma,Ia,Va,wa,La,ka,Aa,Ba,Pa;Ma=t.x,Ia=t.y,Va=t.z;var Sa,Ta=(Aa=(wa=n.x)-Ma)*Ma+(Ba=(La=n.y)-Ia)*Ia+(Pa=(ka=n.z)-Va)*Va;if((Ta=-Ta/(Aa*Aa+Ba*Ba+Pa*Pa))<0)o.x=Ma,o.y=Ia,o.z=Va,Sa=1;else if(Ta>1)o.x=wa,o.y=La,o.z=ka,Sa=2;else{var Ca,ja,Ra;Ca=Ma+Aa*Ta,ja=Ia+Ba*Ta,Ra=Va+Pa*Ta,o.x=Ca,o.y=ja,o.z=Ra,Sa=3}var Ea=o.x*o.x+o.y*o.y+o.z*o.z;(Ui<0||Ea<Ui)&&(Hi=1&Sa|(2&Sa)<<1,Ui=Ea,Gi=o.x,Ji=o.y,Wi=o.z)}if(Ui>0)o.x=Gi,o.y=Ji,o.z=Wi,Oi=Hi;else{var qa=Ti*Ti+Ci*Ci+ji*ji;qa>0&&(qa=1/Math.sqrt(qa));var Da=(Ti*=qa)*Ti+(Ci*=qa)*Ci+(ji*=qa)*ji;Gi=Ti*(Da=(xi*Ti+yi*Ci+di*ji)/Da),Ji=Ci*Da,Wi=ji*Da,o.x=Gi,o.y=Ji,o.z=Wi,Oi=7}var Na=o.x*o.x+o.y*o.y+o.z*o.z;(G<0||Na<G)&&(J=1&Oi|(6&Oi)<<1,G=Na,q=o.x,D=o.y,N=o.z)}if((s*S+r*T+e*C)*F<0){var Fa,Ga,Ja,Wa,Oa,Ua,Ha,Qa,Ka,$a,tn,an,nn,on,sn,rn,en,_n,hn,ln,cn,mn,vn,bn,fn,un,pn;Fa=t.x,Ga=t.y,Ja=t.z,Wa=i.x,Oa=i.y,Ua=i.z,Ha=n.x,mn=(on=(Qa=n.y)-Oa)*(cn=($a=Wa-Fa)*on-(tn=Oa-Ga)*(nn=Ha-Wa))-(sn=(Ka=n.z)-Ua)*(ln=(an=Ua-Ja)*nn-$a*sn),vn=sn*(hn=tn*sn-an*on)-nn*cn,bn=nn*ln-on*hn,fn=(en=Ga-Qa)*cn-(_n=Ja-Ka)*ln,un=_n*hn-(rn=Fa-Ha)*cn,pn=rn*ln-en*hn;var xn,yn,dn,gn,Xn=-1,Yn=0;if(xn=0,yn=0,dn=0,Fa*(tn*cn-an*ln)+Ga*(an*hn-$a*cn)+Ja*($a*ln-tn*hn)<0){var zn,Zn,Mn,In,Vn,wn,Ln,kn,An;zn=t.x,Zn=t.y,Mn=t.z;var Bn,Pn=(Ln=(In=i.x)-zn)*zn+(kn=(Vn=i.y)-Zn)*Zn+(An=(wn=i.z)-Mn)*Mn;if((Pn=-Pn/(Ln*Ln+kn*kn+An*An))<0)o.x=zn,o.y=Zn,o.z=Mn,Bn=1;else if(Pn>1)o.x=In,o.y=Vn,o.z=wn,Bn=2;else{var Sn,Tn,Cn;Sn=zn+Ln*Pn,Tn=Zn+kn*Pn,Cn=Mn+An*Pn,o.x=Sn,o.y=Tn,o.z=Cn,Bn=3}Yn=Bn,Xn=o.x*o.x+o.y*o.y+o.z*o.z,xn=o.x,yn=o.y,dn=o.z}if(Wa*mn+Oa*vn+Ua*bn<0){var jn,Rn,En,qn,Dn,Nn,Fn,Gn,Jn;jn=i.x,Rn=i.y,En=i.z;var Wn,On=(Fn=(qn=n.x)-jn)*jn+(Gn=(Dn=n.y)-Rn)*Rn+(Jn=(Nn=n.z)-En)*En;if((On=-On/(Fn*Fn+Gn*Gn+Jn*Jn))<0)o.x=jn,o.y=Rn,o.z=En,Wn=1;else if(On>1)o.x=qn,o.y=Dn,o.z=Nn,Wn=2;else{var Un,Hn,Qn;Un=jn+Fn*On,Hn=Rn+Gn*On,Qn=En+Jn*On,o.x=Un,o.y=Hn,o.z=Qn,Wn=3}var Kn=o.x*o.x+o.y*o.y+o.z*o.z;(Xn<0||Kn<Xn)&&(Yn=Wn<<1,Xn=Kn,xn=o.x,yn=o.y,dn=o.z)}if(Ha*fn+Qa*un+Ka*pn<0){var $n,to,io,ao,no,oo,so,ro,eo;$n=t.x,to=t.y,io=t.z;var _o,ho=(so=(ao=n.x)-$n)*$n+(ro=(no=n.y)-to)*to+(eo=(oo=n.z)-io)*io;if((ho=-ho/(so*so+ro*ro+eo*eo))<0)o.x=$n,o.y=to,o.z=io,_o=1;else if(ho>1)o.x=ao,o.y=no,o.z=oo,_o=2;else{var lo,co,mo;lo=$n+so*ho,co=to+ro*ho,mo=io+eo*ho,o.x=lo,o.y=co,o.z=mo,_o=3}var vo=o.x*o.x+o.y*o.y+o.z*o.z;(Xn<0||vo<Xn)&&(Yn=1&_o|(2&_o)<<1,Xn=vo,xn=o.x,yn=o.y,dn=o.z)}if(Xn>0)o.x=xn,o.y=yn,o.z=dn,gn=Yn;else{var bo=hn*hn+ln*ln+cn*cn;bo>0&&(bo=1/Math.sqrt(bo));var fo=(hn*=bo)*hn+(ln*=bo)*ln+(cn*=bo)*cn;xn=hn*(fo=(Fa*hn+Ga*ln+Ja*cn)/fo),yn=ln*fo,dn=cn*fo,o.x=xn,o.y=yn,o.z=dn,gn=7}var uo=o.x*o.x+o.y*o.y+o.z*o.z;(G<0||uo<G)&&(J=3&gn|(4&gn)<<1,G=uo,q=o.x,D=o.y,N=o.z)}if((_*j+h*R+l*E)*F<0){var po,xo,yo,go,Xo,Yo,zo,Zo,Mo,Io,Vo,wo,Lo,ko,Ao,Bo,Po,So,To,Co,jo,Ro,Eo,qo,Do,No,Fo;po=i.x,xo=i.y,yo=i.z,go=a.x,Xo=a.y,Yo=a.z,zo=n.x,Ro=(ko=(Zo=n.y)-Xo)*(jo=(Io=go-po)*ko-(Vo=Xo-xo)*(Lo=zo-go))-(Ao=(Mo=n.z)-Yo)*(Co=(wo=Yo-yo)*Lo-Io*Ao),Eo=Ao*(To=Vo*Ao-wo*ko)-Lo*jo,qo=Lo*Co-ko*To,Do=(Po=xo-Zo)*jo-(So=yo-Mo)*Co,No=So*To-(Bo=po-zo)*jo,Fo=Bo*Co-Po*To;var Go,Jo,Wo,Oo,Uo=-1,Ho=0;if(Go=0,Jo=0,Wo=0,po*(Vo*jo-wo*Co)+xo*(wo*To-Io*jo)+yo*(Io*Co-Vo*To)<0){var Qo,Ko,$o,ts,is,as,ns,os,ss;Qo=i.x,Ko=i.y,$o=i.z;var rs,es=(ns=(ts=a.x)-Qo)*Qo+(os=(is=a.y)-Ko)*Ko+(ss=(as=a.z)-$o)*$o;if((es=-es/(ns*ns+os*os+ss*ss))<0)o.x=Qo,o.y=Ko,o.z=$o,rs=1;else if(es>1)o.x=ts,o.y=is,o.z=as,rs=2;else{var _s,hs,ls;_s=Qo+ns*es,hs=Ko+os*es,ls=$o+ss*es,o.x=_s,o.y=hs,o.z=ls,rs=3}Ho=rs,Uo=o.x*o.x+o.y*o.y+o.z*o.z,Go=o.x,Jo=o.y,Wo=o.z}if(go*Ro+Xo*Eo+Yo*qo<0){var cs,ms,vs,bs,fs,us,ps,xs,ys;cs=a.x,ms=a.y,vs=a.z;var ds,gs=(ps=(bs=n.x)-cs)*cs+(xs=(fs=n.y)-ms)*ms+(ys=(us=n.z)-vs)*vs;if((gs=-gs/(ps*ps+xs*xs+ys*ys))<0)o.x=cs,o.y=ms,o.z=vs,ds=1;else if(gs>1)o.x=bs,o.y=fs,o.z=us,ds=2;else{var Xs,Ys,zs;Xs=cs+ps*gs,Ys=ms+xs*gs,zs=vs+ys*gs,o.x=Xs,o.y=Ys,o.z=zs,ds=3}var Zs=o.x*o.x+o.y*o.y+o.z*o.z;(Uo<0||Zs<Uo)&&(Ho=ds<<1,Uo=Zs,Go=o.x,Jo=o.y,Wo=o.z)}if(zo*Do+Zo*No+Mo*Fo<0){var Ms,Is,Vs,ws,Ls,ks,As,Bs,Ps;Ms=i.x,Is=i.y,Vs=i.z;var Ss,Ts=(As=(ws=n.x)-Ms)*Ms+(Bs=(Ls=n.y)-Is)*Is+(Ps=(ks=n.z)-Vs)*Vs;if((Ts=-Ts/(As*As+Bs*Bs+Ps*Ps))<0)o.x=Ms,o.y=Is,o.z=Vs,Ss=1;else if(Ts>1)o.x=ws,o.y=Ls,o.z=ks,Ss=2;else{var Cs,js,Rs;Cs=Ms+As*Ts,js=Is+Bs*Ts,Rs=Vs+Ps*Ts,o.x=Cs,o.y=js,o.z=Rs,Ss=3}var Es=o.x*o.x+o.y*o.y+o.z*o.z;(Uo<0||Es<Uo)&&(Ho=1&Ss|(2&Ss)<<1,Uo=Es,Go=o.x,Jo=o.y,Wo=o.z)}if(Uo>0)o.x=Go,o.y=Jo,o.z=Wo,Oo=Ho;else{var qs=To*To+Co*Co+jo*jo;qs>0&&(qs=1/Math.sqrt(qs));var Ds=(To*=qs)*To+(Co*=qs)*Co+(jo*=qs)*jo;Go=To*(Ds=(po*To+xo*Co+yo*jo)/Ds),Jo=Co*Ds,Wo=jo*Ds,o.x=Go,o.y=Jo,o.z=Wo,Oo=7}var Ns=o.x*o.x+o.y*o.y+o.z*o.z;(G<0||Ns<G)&&(J=Oo<<1,G=Ns,q=o.x,D=o.y,N=o.z)}return G>0?(o.x=q,o.y=D,o.z=N,J):(o.zero(),15)},t}(),r.common.Mat3=function(){function t(t,i,a,n,o,s,e,_,h){null==h&&(h=1),null==_&&(_=0),null==e&&(e=0),null==s&&(s=0),null==o&&(o=1),null==n&&(n=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e10=n,this.e11=o,this.e12=s,this.e20=e,this.e21=_,this.e22=h,r.common.Mat3.numCreations++}var i=t.prototype;return i.init=function(t,i,a,n,o,s,r,e,_){return this.e00=t,this.e01=i,this.e02=a,this.e10=n,this.e11=o,this.e12=s,this.e20=r,this.e21=e,this.e22=_,this},i.identity=function(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this},i.add=function(t){return new r.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)},i.sub=function(t){return new r.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)},i.scale=function(t){return new r.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)},i.mul=function(t){return new r.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)},i.addEq=function(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this},i.subEq=function(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this},i.scaleEq=function(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e20*=t,this.e21*=t,this.e22*=t,this},i.mulEq=function(t){var i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,a=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,n=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,o=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,s=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,r=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,e=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,_=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=i,this.e02=a,this.e10=n,this.e11=o,this.e12=s,this.e20=r,this.e21=e,this.e22=_,this},i.prependScale=function(t,i,a){return new r.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*a,this.e21*a,this.e22*a)},i.appendScale=function(t,i,a){return new r.common.Mat3(this.e00*t,this.e01*i,this.e02*a,this.e10*t,this.e11*i,this.e12*a,this.e20*t,this.e21*i,this.e22*a)},i.prependRotation=function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),e=1-s,_=i*i*e+s,h=i*a*e-n*o,l=i*n*e+a*o,c=a*i*e+n*o,m=a*a*e+s,v=a*n*e-i*o,b=n*i*e-a*o,f=n*a*e+i*o,u=n*n*e+s;return new r.common.Mat3(_*this.e00+h*this.e10+l*this.e20,_*this.e01+h*this.e11+l*this.e21,_*this.e02+h*this.e12+l*this.e22,c*this.e00+m*this.e10+v*this.e20,c*this.e01+m*this.e11+v*this.e21,c*this.e02+m*this.e12+v*this.e22,b*this.e00+f*this.e10+u*this.e20,b*this.e01+f*this.e11+u*this.e21,b*this.e02+f*this.e12+u*this.e22)},i.appendRotation=function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),e=1-s,_=i*i*e+s,h=i*a*e-n*o,l=i*n*e+a*o,c=a*i*e+n*o,m=a*a*e+s,v=a*n*e-i*o,b=n*i*e-a*o,f=n*a*e+i*o,u=n*n*e+s;return new r.common.Mat3(this.e00*_+this.e01*c+this.e02*b,this.e00*h+this.e01*m+this.e02*f,this.e00*l+this.e01*v+this.e02*u,this.e10*_+this.e11*c+this.e12*b,this.e10*h+this.e11*m+this.e12*f,this.e10*l+this.e11*v+this.e12*u,this.e20*_+this.e21*c+this.e22*b,this.e20*h+this.e21*m+this.e22*f,this.e20*l+this.e21*v+this.e22*u)},i.prependScaleEq=function(t,i,a){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e20*=a,this.e21*=a,this.e22*=a,this},i.appendScaleEq=function(t,i,a){return this.e00*=t,this.e01*=i,this.e02*=a,this.e10*=t,this.e11*=i,this.e12*=a,this.e20*=t,this.e21*=i,this.e22*=a,this},i.prependRotationEq=function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,c=a*a*r+s,m=a*n*r-i*o,v=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s,u=l*this.e00+c*this.e10+m*this.e20,p=l*this.e01+c*this.e11+m*this.e21,x=l*this.e02+c*this.e12+m*this.e22,y=v*this.e00+b*this.e10+f*this.e20,d=v*this.e01+b*this.e11+f*this.e21,g=v*this.e02+b*this.e12+f*this.e22;return this.e00=e*this.e00+_*this.e10+h*this.e20,this.e01=e*this.e01+_*this.e11+h*this.e21,this.e02=e*this.e02+_*this.e12+h*this.e22,this.e10=u,this.e11=p,this.e12=x,this.e20=y,this.e21=d,this.e22=g,this},i.appendRotationEq=function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,c=a*a*r+s,m=a*n*r-i*o,v=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s,u=this.e00*_+this.e01*c+this.e02*b,p=this.e00*h+this.e01*m+this.e02*f,x=this.e10*_+this.e11*c+this.e12*b,y=this.e10*h+this.e11*m+this.e12*f,d=this.e20*_+this.e21*c+this.e22*b,g=this.e20*h+this.e21*m+this.e22*f;return this.e00=this.e00*e+this.e01*l+this.e02*v,this.e01=u,this.e02=p,this.e10=this.e10*e+this.e11*l+this.e12*v,this.e11=x,this.e12=y,this.e20=this.e20*e+this.e21*l+this.e22*v,this.e21=d,this.e22=g,this},i.transpose=function(){return new r.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)},i.transposeEq=function(){var t=this.e01,i=this.e02,a=this.e12;return this.e00=this.e00,this.e01=this.e10,this.e02=this.e20,this.e10=t,this.e11=this.e11,this.e12=this.e21,this.e20=i,this.e21=a,this.e22=this.e22,this},i.determinant=function(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)},i.trace=function(){return this.e00+this.e11+this.e22},i.inverse=function(){var t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,n=this.e00*t-this.e01*i+this.e02*a;return 0!=n&&(n=1/n),new r.common.Mat3(t*n,-(this.e01*this.e22-this.e02*this.e21)*n,(this.e01*this.e12-this.e02*this.e11)*n,-i*n,(this.e00*this.e22-this.e02*this.e20)*n,-(this.e00*this.e12-this.e02*this.e10)*n,a*n,-(this.e00*this.e21-this.e01*this.e20)*n,(this.e00*this.e11-this.e01*this.e10)*n)},i.inverseEq=function(){var t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,n=this.e00*t-this.e01*i+this.e02*a;0!=n&&(n=1/n);var o=(this.e01*this.e12-this.e02*this.e11)*n,s=(this.e00*this.e22-this.e02*this.e20)*n,r=-(this.e00*this.e12-this.e02*this.e10)*n,e=-(this.e00*this.e21-this.e01*this.e20)*n,_=(this.e00*this.e11-this.e01*this.e10)*n;return this.e00=t*n,this.e01=-(this.e01*this.e22-this.e02*this.e21)*n,this.e02=o,this.e10=-i*n,this.e11=s,this.e12=r,this.e20=a*n,this.e21=e,this.e22=_,this},i.toArray=function(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]},i.copyFrom=function(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this},i.clone=function(){return new r.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)},i.fromQuat=function(t){var i=t.x,a=t.y,n=t.z,o=t.w,s=2*i,r=2*a,e=2*n,_=i*s,h=a*r,l=n*e,c=i*r,m=a*e,v=i*e,b=o*s,f=o*r,u=o*e;return this.e00=1-h-l,this.e01=c-u,this.e02=v+f,this.e10=c+u,this.e11=1-_-l,this.e12=m-b,this.e20=v-f,this.e21=m+b,this.e22=1-_-h,this},i.toQuat=function(){var t,i=new r.common.Quat,a=this.e00,n=this.e11,o=this.e22,s=a+n+o;return s>0?(t=Math.sqrt(s+1),i.w=.5*t,t=.5/t,i.x=(this.e21-this.e12)*t,i.y=(this.e02-this.e20)*t,i.z=(this.e10-this.e01)*t):a>n?a>o?(t=Math.sqrt(a-n-o+1),i.x=.5*t,t=.5/t,i.y=(this.e01+this.e10)*t,i.z=(this.e02+this.e20)*t,i.w=(this.e21-this.e12)*t):(t=Math.sqrt(o-a-n+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t):n>o?(t=Math.sqrt(n-o-a+1),i.y=.5*t,t=.5/t,i.x=(this.e01+this.e10)*t,i.z=(this.e12+this.e21)*t,i.w=(this.e02-this.e20)*t):(t=Math.sqrt(o-a-n+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t),i},i.fromEulerXyz=function(t){var i=Math.sin(t.x),a=Math.sin(t.y),n=Math.sin(t.z),o=Math.cos(t.x),s=Math.cos(t.y),r=Math.cos(t.z);return this.e00=s*r,this.e01=-s*n,this.e02=a,this.e10=o*n+r*i*a,this.e11=o*r-i*a*n,this.e12=-s*i,this.e20=i*n-o*r*a,this.e21=r*i+o*a*n,this.e22=o*s,this},i.toEulerXyz=function(){var t=this.e02;if(t<=-1){var i=Math.atan2(this.e21,this.e11);return new r.common.Vec3(.5*i,-1.570796326794895,.5*-i)}if(t>=1){var a=Math.atan2(this.e21,this.e11);return new r.common.Vec3(.5*a,1.570796326794895,.5*a)}return new r.common.Vec3(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))},i.getRow=function(t){return 0==t?new r.common.Vec3(this.e00,this.e01,this.e02):1==t?new r.common.Vec3(this.e10,this.e11,this.e12):2==t?new r.common.Vec3(this.e20,this.e21,this.e22):null},i.getCol=function(t){return 0==t?new r.common.Vec3(this.e00,this.e10,this.e20):1==t?new r.common.Vec3(this.e01,this.e11,this.e21):2==t?new r.common.Vec3(this.e02,this.e12,this.e22):null},i.getRowTo=function(t,i){0==t?i.init(this.e00,this.e01,this.e02):1==t?i.init(this.e10,this.e11,this.e12):2==t?i.init(this.e20,this.e21,this.e22):i.zero()},i.getColTo=function(t,i){0==t?i.init(this.e00,this.e10,this.e20):1==t?i.init(this.e01,this.e11,this.e21):2==t?i.init(this.e02,this.e12,this.e22):i.zero()},i.fromRows=function(t,i,a){return this.e00=t.x,this.e01=t.y,this.e02=t.z,this.e10=i.x,this.e11=i.y,this.e12=i.z,this.e20=a.x,this.e21=a.y,this.e22=a.z,this},i.fromCols=function(t,i,a){return this.e00=t.x,this.e01=i.x,this.e02=a.x,this.e10=t.y,this.e11=i.y,this.e12=a.y,this.e20=t.z,this.e21=i.z,this.e22=a.z,this},i.toString=function(){return"Mat3["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n\t\t "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n\t\t "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"},t}(),r.common.Mat4=function(){function t(t,i,a,n,o,s,e,_,h,l,c,m,v,b,f,u){null==u&&(u=1),null==f&&(f=0),null==b&&(b=0),null==v&&(v=0),null==m&&(m=0),null==c&&(c=1),null==l&&(l=0),null==h&&(h=0),null==_&&(_=0),null==e&&(e=0),null==s&&(s=1),null==o&&(o=0),null==n&&(n=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e03=n,this.e10=o,this.e11=s,this.e12=e,this.e13=_,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=f,this.e33=u,r.common.Mat4.numCreations++}var i=t.prototype;return i.init=function(t,i,a,n,o,s,r,e,_,h,l,c,m,v,b,f){return this.e00=t,this.e01=i,this.e02=a,this.e03=n,this.e10=o,this.e11=s,this.e12=r,this.e13=e,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=v,this.e32=b,this.e33=f,this},i.identity=function(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},i.add=function(t){return new r.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)},i.sub=function(t){return new r.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)},i.scale=function(t){return new r.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)},i.mul=function(t){return new r.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)},i.addEq=function(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e03+=t.e03,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e13+=t.e13,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this.e23+=t.e23,this.e30+=t.e30,this.e31+=t.e31,this.e32+=t.e32,this.e33+=t.e33,this},i.subEq=function(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e03-=t.e03,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e13-=t.e13,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this.e23-=t.e23,this.e30-=t.e30,this.e31-=t.e31,this.e32-=t.e32,this.e33-=t.e33,this},i.scaleEq=function(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e13*=t,this.e20*=t,this.e21*=t,this.e22*=t,this.e23*=t,this.e30*=t,this.e31*=t,this.e32*=t,this.e33*=t,this},i.mulEq=function(t){var i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,a=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,n=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,o=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,s=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,r=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,e=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,_=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,h=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,l=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,c=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,m=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,v=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,b=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,f=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=i,this.e02=a,this.e03=n,this.e10=o,this.e11=s,this.e12=r,this.e13=e,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=v,this.e32=b,this.e33=f,this},i.prependScale=function(t,i,a){return new r.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*a,this.e21*a,this.e22*a,this.e23*a,this.e30,this.e31,this.e32,this.e33)},i.appendScale=function(t,i,a){return new r.common.Mat4(this.e00*t,this.e01*i,this.e02*a,this.e03,this.e10*t,this.e11*i,this.e12*a,this.e13,this.e20*t,this.e21*i,this.e22*a,this.e23,this.e30*t,this.e31*i,this.e32*a,this.e33)},i.prependRotation=function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),e=1-s,_=i*i*e+s,h=i*a*e-n*o,l=i*n*e+a*o,c=a*i*e+n*o,m=a*a*e+s,v=a*n*e-i*o,b=n*i*e-a*o,f=n*a*e+i*o,u=n*n*e+s;return new r.common.Mat4(_*this.e00+h*this.e10+l*this.e20,_*this.e01+h*this.e11+l*this.e21,_*this.e02+h*this.e12+l*this.e22,_*this.e03+h*this.e13+l*this.e23,c*this.e00+m*this.e10+v*this.e20,c*this.e01+m*this.e11+v*this.e21,c*this.e02+m*this.e12+v*this.e22,c*this.e03+m*this.e13+v*this.e23,b*this.e00+f*this.e10+u*this.e20,b*this.e01+f*this.e11+u*this.e21,b*this.e02+f*this.e12+u*this.e22,b*this.e03+f*this.e13+u*this.e23,this.e30,this.e31,this.e32,this.e33)},i.appendRotation=function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),e=1-s,_=i*i*e+s,h=i*a*e-n*o,l=i*n*e+a*o,c=a*i*e+n*o,m=a*a*e+s,v=a*n*e-i*o,b=n*i*e-a*o,f=n*a*e+i*o,u=n*n*e+s;return new r.common.Mat4(this.e00*_+this.e01*c+this.e02*b,this.e00*h+this.e01*m+this.e02*f,this.e00*l+this.e01*v+this.e02*u,this.e03,this.e10*_+this.e11*c+this.e12*b,this.e10*h+this.e11*m+this.e12*f,this.e10*l+this.e11*v+this.e12*u,this.e13,this.e20*_+this.e21*c+this.e22*b,this.e20*h+this.e21*m+this.e22*f,this.e20*l+this.e21*v+this.e22*u,this.e23,this.e30*_+this.e31*c+this.e32*b,this.e30*h+this.e31*m+this.e32*f,this.e30*l+this.e31*v+this.e32*u,this.e33)},i.prependTranslation=function(t,i,a){return new r.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+a*this.e30,this.e21+a*this.e31,this.e22+a*this.e32,this.e23+a*this.e33,this.e30,this.e31,this.e32,this.e33)},i.appendTranslation=function(t,i,a){return new r.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*a+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*a+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*a+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*a+this.e33)},i.prependScaleEq=function(t,i,a){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e13*=i,this.e20*=a,this.e21*=a,this.e22*=a,this.e23*=a,this.e30=this.e30,this.e31=this.e31,this.e32=this.e32,this.e33=this.e33,this},i.appendScaleEq=function(t,i,a){return this.e00*=t,this.e01*=i,this.e02*=a,this.e03=this.e03,this.e10*=t,this.e11*=i,this.e12*=a,this.e13=this.e13,this.e20*=t,this.e21*=i,this.e22*=a,this.e23=this.e23,this.e30*=t,this.e31*=i,this.e32*=a,this.e33=this.e33,this},i.prependRotationEq=function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,c=a*a*r+s,m=a*n*r-i*o,v=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s,u=l*this.e00+c*this.e10+m*this.e20,p=l*this.e01+c*this.e11+m*this.e21,x=l*this.e02+c*this.e12+m*this.e22,y=l*this.e03+c*this.e13+m*this.e23,d=v*this.e00+b*this.e10+f*this.e20,g=v*this.e01+b*this.e11+f*this.e21,X=v*this.e02+b*this.e12+f*this.e22,Y=v*this.e03+b*this.e13+f*this.e23;return this.e00=e*this.e00+_*this.e10+h*this.e20,this.e01=e*this.e01+_*this.e11+h*this.e21,this.e02=e*this.e02+_*this.e12+h*this.e22,this.e03=e*this.e03+_*this.e13+h*this.e23,this.e10=u,this.e11=p,this.e12=x,this.e13=y,this.e20=d,this.e21=g,this.e22=X,this.e23=Y,this.e30=this.e30,this.e31=this.e31,this.e32=this.e32,this.e33=this.e33,this},i.appendRotationEq=function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,c=a*a*r+s,m=a*n*r-i*o,v=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s,u=this.e00*_+this.e01*c+this.e02*b,p=this.e00*h+this.e01*m+this.e02*f,x=this.e10*_+this.e11*c+this.e12*b,y=this.e10*h+this.e11*m+this.e12*f,d=this.e20*_+this.e21*c+this.e22*b,g=this.e20*h+this.e21*m+this.e22*f,X=this.e30*_+this.e31*c+this.e32*b,Y=this.e30*h+this.e31*m+this.e32*f;return this.e00=this.e00*e+this.e01*l+this.e02*v,this.e01=u,this.e02=p,this.e03=this.e03,this.e10=this.e10*e+this.e11*l+this.e12*v,this.e11=x,this.e12=y,this.e13=this.e13,this.e20=this.e20*e+this.e21*l+this.e22*v,this.e21=d,this.e22=g,this.e23=this.e23,this.e30=this.e30*e+this.e31*l+this.e32*v,this.e31=X,this.e32=Y,this.e33=this.e33,this},i.prependTranslationEq=function(t,i,a){return this.e00+=t*this.e30,this.e01+=t*this.e31,this.e02+=t*this.e32,this.e03+=t*this.e33,this.e10+=i*this.e30,this.e11+=i*this.e31,this.e12+=i*this.e32,this.e13+=i*this.e33,this.e20+=a*this.e30,this.e21+=a*this.e31,this.e22+=a*this.e32,this.e23+=a*this.e33,this.e30=this.e30,this.e31=this.e31,this.e32=this.e32,this.e33=this.e33,this},i.appendTranslationEq=function(t,i,a){var n=this.e00*t+this.e01*i+this.e02*a+this.e03,o=this.e10*t+this.e11*i+this.e12*a+this.e13,s=this.e20*t+this.e21*i+this.e22*a+this.e23,r=this.e30*t+this.e31*i+this.e32*a+this.e33;return this.e00=this.e00,this.e01=this.e01,this.e02=this.e02,this.e03=n,this.e10=this.e10,this.e11=this.e11,this.e12=this.e12,this.e13=o,this.e20=this.e20,this.e21=this.e21,this.e22=this.e22,this.e23=s,this.e30=this.e30,this.e31=this.e31,this.e32=this.e32,this.e33=r,this},i.transpose=function(){return new r.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)},i.transposeEq=function(){var t=this.e01,i=this.e02,a=this.e12,n=this.e03,o=this.e13,s=this.e23;return this.e00=this.e00,this.e01=this.e10,this.e02=this.e20,this.e03=this.e30,this.e10=t,this.e11=this.e11,this.e12=this.e21,this.e13=this.e31,this.e20=i,this.e21=a,this.e22=this.e22,this.e23=this.e32,this.e30=n,this.e31=o,this.e32=s,this.e33=this.e33,this},i.determinant=function(){var t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,a=this.e20*this.e33-this.e23*this.e30,n=this.e21*this.e32-this.e22*this.e31,o=this.e21*this.e33-this.e23*this.e31,s=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*s-this.e12*o+this.e13*n)-this.e01*(this.e10*s-this.e12*a+this.e13*i)+this.e02*(this.e10*o-this.e11*a+this.e13*t)-this.e03*(this.e10*n-this.e11*i+this.e12*t)},i.trace=function(){return this.e00+this.e11+this.e22+this.e33},i.inverse=function(){var t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,e=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,h=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,c=this.e21*this.e33-this.e23*this.e31,m=this.e22*this.e33-this.e23*this.e32,v=this.e11*m-this.e12*c+this.e13*l,b=this.e10*m-this.e12*h+this.e13*_,f=this.e10*c-this.e11*h+this.e13*e,u=this.e10*l-this.e11*_+this.e12*e,p=this.e00*v-this.e01*b+this.e02*f-this.e03*u;return 0!=p&&(p=1/p),new r.common.Mat4(v*p,-(this.e01*m-this.e02*c+this.e03*l)*p,(this.e31*s-this.e32*o+this.e33*n)*p,-(this.e21*s-this.e22*o+this.e23*n)*p,-b*p,(this.e00*m-this.e02*h+this.e03*_)*p,-(this.e30*s-this.e32*a+this.e33*i)*p,(this.e20*s-this.e22*a+this.e23*i)*p,f*p,-(this.e00*c-this.e01*h+this.e03*e)*p,(this.e30*o-this.e31*a+this.e33*t)*p,-(this.e20*o-this.e21*a+this.e23*t)*p,-u*p,(this.e00*l-this.e01*_+this.e02*e)*p,-(this.e30*n-this.e31*i+this.e32*t)*p,(this.e20*n-this.e21*i+this.e22*t)*p)},i.inverseEq=function(){var t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,e=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*l+this.e13*h,v=this.e10*c-this.e12*_+this.e13*e,b=this.e10*l-this.e11*_+this.e13*r,f=this.e10*h-this.e11*e+this.e12*r,u=this.e00*m-this.e01*v+this.e02*b-this.e03*f;0!=u&&(u=1/u);var p=(this.e00*c-this.e02*_+this.e03*e)*u,x=-(this.e00*l-this.e01*_+this.e03*r)*u,y=-(this.e20*o-this.e21*a+this.e23*t)*u,d=(this.e00*h-this.e01*e+this.e02*r)*u,g=-(this.e30*n-this.e31*i+this.e32*t)*u,X=(this.e20*n-this.e21*i+this.e22*t)*u;return this.e00=m*u,this.e01=-(this.e01*c-this.e02*l+this.e03*h)*u,this.e02=(this.e31*s-this.e32*o+this.e33*n)*u,this.e03=-(this.e21*s-this.e22*o+this.e23*n)*u,this.e10=-v*u,this.e11=p,this.e12=-(this.e30*s-this.e32*a+this.e33*i)*u,this.e13=(this.e20*s-this.e22*a+this.e23*i)*u,this.e20=b*u,this.e21=x,this.e22=(this.e30*o-this.e31*a+this.e33*t)*u,this.e23=y,this.e30=-f*u,this.e31=d,this.e32=g,this.e33=X,this},i.lookAt=function(t,i,a,n,o,s,r,e,_){var h=t-n,l=i-o,c=a-s,m=1/Math.sqrt(h*h+l*l+c*c),v=e*(c*=m)-_*(l*=m),b=_*(h*=m)-r*c,f=r*l-e*h,u=l*(f*=m=1/Math.sqrt(v*v+b*b+f*f))-c*(b*=m),p=c*(v*=m)-h*f,x=h*b-l*v;return this.e00=v,this.e01=b,this.e02=f,this.e03=-(v*t+b*i+f*a),this.e10=u,this.e11=p,this.e12=x,this.e13=-(u*t+p*i+x*a),this.e20=h,this.e21=l,this.e22=c,this.e23=-(h*t+l*i+c*a),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},i.perspective=function(t,i,a,n){var o=1/Math.tan(.5*t),s=n/(a-n);return this.e00=o/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=o,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=s,this.e23=a*s,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this},i.ortho=function(t,i,a,n){var o=1/(a-n);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=a*o,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},i.toArray=function(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]},i.copyFrom=function(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this},i.fromMat3=function(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=0,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=0,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},i.fromTransform=function(t){return this.e00=t._rotation00,this.e01=t._rotation01,this.e02=t._rotation02,this.e10=t._rotation10,this.e11=t._rotation11,this.e12=t._rotation12,this.e20=t._rotation20,this.e21=t._rotation21,this.e22=t._rotation22,this.e03=t._positionX,this.e13=t._positionY,this.e23=t._positionZ,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},i.clone=function(){return new r.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)},i.toString=function(){return"Mat4["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(this.e03>0?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n\t\t"+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(this.e13>0?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n\t\t"+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(this.e23>0?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n\t\t"+(this.e30>0?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(this.e31>0?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(this.e32>0?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(this.e33>0?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"},t}(),r.common.MathUtil=function(){function t(){}return t.abs=function(t){return t>0?t:-t},t.sin=function(t){return Math.sin(t)},t.cos=function(t){return Math.cos(t)},t.tan=function(t){return Math.tan(t)},t.asin=function(t){return Math.asin(t)},t.acos=function(t){return Math.acos(t)},t.atan=function(t){return Math.atan(t)},t.safeAsin=function(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)},t.safeAcos=function(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)},t.atan2=function(t,i){return Math.atan2(t,i)},t.sqrt=function(t){return Math.sqrt(t)},t.clamp=function(t,i,a){return t<i?i:t>a?a:t},t.rand=function(){return Math.random()},t.randIn=function(t,i){return t+Math.random()*(i-t)},t.randVec3In=function(t,i){return new r.common.Vec3(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))},t.randVec3=function(){return new r.common.Vec3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)},t}(),r.common.Pool=function(){function t(){this.stackVec3=new Array(256),this.sizeVec3=0,this.stackMat3=new Array(256),this.sizeMat3=0,this.stackMat4=new Array(256),this.sizeMat4=0,this.stackQuat=new Array(256),this.sizeQuat=0}var i=t.prototype;return i.vec3=function(){return 0==this.sizeVec3?new r.common.Vec3:this.stackVec3[--this.sizeVec3]},i.mat3=function(){return 0==this.sizeMat3?new r.common.Mat3:this.stackMat3[--this.sizeMat3]},i.mat4=function(){return 0==this.sizeMat4?new r.common.Mat4:this.stackMat4[--this.sizeMat4]},i.quat=function(){return 0==this.sizeQuat?new r.common.Quat:this.stackQuat[--this.sizeQuat]},i.dispose=function(t,i,a,n){if(null!=t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var o=new Array(this.sizeVec3<<1),s=0,r=this.sizeVec3;s<r;){var e=s++;o[e]=this.stackVec3[e],this.stackVec3[e]=null}this.stackVec3=o}this.stackVec3[this.sizeVec3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){for(var _=new Array(this.sizeMat3<<1),h=0,l=this.sizeMat3;h<l;){var c=h++;_[c]=this.stackMat3[c],this.stackMat3[c]=null}this.stackMat3=_}this.stackMat3[this.sizeMat3++]=i}if(null!=a){if(a.e00=1,a.e01=0,a.e02=0,a.e03=0,a.e10=0,a.e11=1,a.e12=0,a.e13=0,a.e20=0,a.e21=0,a.e22=1,a.e23=0,a.e30=0,a.e31=0,a.e32=0,a.e33=1,this.sizeMat4==this.stackMat4.length){for(var m=new Array(this.sizeMat4<<1),v=0,b=this.sizeMat4;v<b;){var f=v++;m[f]=this.stackMat4[f],this.stackMat4[f]=null}this.stackMat4=m}this.stackMat4[this.sizeMat4++]=a}if(null!=n){if(n.x=0,n.y=0,n.z=0,n.w=1,this.sizeQuat==this.stackQuat.length){for(var u=new Array(this.sizeQuat<<1),p=0,x=this.sizeQuat;p<x;){var y=p++;u[y]=this.stackQuat[y],this.stackQuat[y]=null}this.stackQuat=u}this.stackQuat[this.sizeQuat++]=n}},i.disposeVec3=function(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var i=new Array(this.sizeVec3<<1),a=0,n=this.sizeVec3;a<n;){var o=a++;i[o]=this.stackVec3[o],this.stackVec3[o]=null}this.stackVec3=i}this.stackVec3[this.sizeVec3++]=t},i.disposeMat3=function(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){for(var i=new Array(this.sizeMat3<<1),a=0,n=this.sizeMat3;a<n;){var o=a++;i[o]=this.stackMat3[o],this.stackMat3[o]=null}this.stackMat3=i}this.stackMat3[this.sizeMat3++]=t},i.disposeMat4=function(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){for(var i=new Array(this.sizeMat4<<1),a=0,n=this.sizeMat4;a<n;){var o=a++;i[o]=this.stackMat4[o],this.stackMat4[o]=null}this.stackMat4=i}this.stackMat4[this.sizeMat4++]=t},i.disposeQuat=function(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){for(var i=new Array(this.sizeQuat<<1),a=0,n=this.sizeQuat;a<n;){var o=a++;i[o]=this.stackQuat[o],this.stackQuat[o]=null}this.stackQuat=i}this.stackQuat[this.sizeQuat++]=t},t}(),r.common.Quat=function(){function t(t,i,a,n){null==n&&(n=1),null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,this.w=n,r.common.Quat.numCreations++}var i=t.prototype;return i.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},i.init=function(t,i,a,n){return this.x=t,this.y=i,this.z=a,this.w=n,this},i.add=function(t){return new r.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},i.sub=function(t){return new r.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},i.scale=function(t){return new r.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)},i.addEq=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.subEq=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.scaleEq=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},i.normalized=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new r.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)},i.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.setArc=function(t,i){var a=t.x,n=t.y,o=t.z,s=i.x,r=i.y,e=i.z,_=a*s+n*r+o*e;return this.w=Math.sqrt(.5*(1+_)),0==this.w?(e=o*o,(s=a*a)<(r=n*n)?s<e?(_=1/Math.sqrt(r+e),this.x=0,this.y=o*_,this.z=-n*_):(_=1/Math.sqrt(s+r),this.z=0,this.x=n*_,this.y=-a*_):r<e?(_=1/Math.sqrt(e+s),this.y=0,this.z=a*_,this.x=-o*_):(_=1/Math.sqrt(s+r),this.z=0,this.x=n*_,this.y=-a*_),this):(_=.5/this.w,this.x=(n*e-o*r)*_,this.y=(o*s-a*e)*_,this.z=(a*r-n*s)*_,this)},i.slerp=function(t,i){var a,n,o,s,e=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(e<0?(e=-e,a=-t.x,n=-t.y,o=-t.z,s=-t.w):(a=t.x,n=t.y,o=t.z,s=t.w),e>.999999){var _=new r.common.Quat(this.x+(a-this.x)*i,this.y+(n-this.y)*i,this.z+(o-this.z)*i,this.w+(s-this.w)*i),h=Math.sqrt(_.x*_.x+_.y*_.y+_.z*_.z+_.w*_.w);return h>0&&(h=1/h),_.x*=h,_.y*=h,_.z*=h,_.w*=h,_}var l=i*Math.acos(e);a-=this.x*e,n-=this.y*e,o-=this.z*e,s-=this.w*e;var c=1/Math.sqrt(a*a+n*n+o*o+s*s);a*=c,n*=c,o*=c,s*=c;var m=Math.sin(l),v=Math.cos(l);return new r.common.Quat(this.x*v+a*m,this.y*v+n*m,this.z*v+o*m,this.w*v+s*m)},i.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.clone=function(){return new r.common.Quat(this.x,this.y,this.z,this.w)},i.fromMat3=function(t){var i,a=t.e00,n=t.e11,o=t.e22,s=a+n+o;return s>0?(i=Math.sqrt(s+1),this.w=.5*i,i=.5/i,this.x=(t.e21-t.e12)*i,this.y=(t.e02-t.e20)*i,this.z=(t.e10-t.e01)*i):a>n?a>o?(i=Math.sqrt(a-n-o+1),this.x=.5*i,i=.5/i,this.y=(t.e01+t.e10)*i,this.z=(t.e02+t.e20)*i,this.w=(t.e21-t.e12)*i):(i=Math.sqrt(o-a-n+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i):n>o?(i=Math.sqrt(n-o-a+1),this.y=.5*i,i=.5/i,this.x=(t.e01+t.e10)*i,this.z=(t.e12+t.e21)*i,this.w=(t.e02-t.e20)*i):(i=Math.sqrt(o-a-n+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i),this},i.toMat3=function(){var t=new r.common.Mat3,i=this.x,a=this.y,n=this.z,o=this.w,s=2*i,e=2*a,_=2*n,h=i*s,l=a*e,c=n*_,m=i*e,v=a*_,b=i*_,f=o*s,u=o*e,p=o*_;return t.e00=1-l-c,t.e01=m-p,t.e02=b+u,t.e10=m+p,t.e11=1-h-c,t.e12=v-f,t.e20=b-u,t.e21=v+f,t.e22=1-h-l,t},i.toString=function(){return"Quat["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n\t\t"+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n\t\t"+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n\t\t"+(this.w>0?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"},t}(),r.dynamics||(r.dynamics={}),r.dynamics.Contact=function(){function t(){this._next=null,this._prev=null,this._link1=new r.dynamics.ContactLink,this._link2=new r.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new r.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new r.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new r.dynamics.constraint.contact.Manifold,this._updater=new r.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new r.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}var i=t.prototype;return i._updateManifold=function(){if(null!=this._detector){var t=this._touching,i=this._detectorResult;if(this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData),this._touching=i.numPoints>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>r.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=r.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=r.common.Setting.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){var a=this._s1._contactCallback,n=this._s2._contactCallback;a==n&&(n=null),null!=a&&a.beginContact(this),null!=n&&n.beginContact(this)}if(!this._touching&&t){var o=this._s1._contactCallback,s=this._s2._contactCallback;o==s&&(s=null),null!=o&&o.endContact(this),null!=s&&s.endContact(this)}if(this._touching){var e=this._s1._contactCallback,_=this._s2._contactCallback;e==_&&(_=null),null!=e&&e.preSolve(this),null!=_&&_.preSolve(this)}}},i._postSolve=function(){var t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.postSolve(this),null!=i&&i.postSolve(this)},i.getShape1=function(){return this._s1},i.getShape2=function(){return this._s2},i.isTouching=function(){return this._touching},i.getManifold=function(){return this._manifold},i.getContactConstraint=function(){return this._contactConstraint},i.getPrev=function(){return this._prev},i.getNext=function(){return this._next},t}(),r.dynamics.ContactLink=function(){function t(){this._prev=null,this._next=null,this._contact=null,this._other=null}var i=t.prototype;return i.getContact=function(){return this._contact},i.getOther=function(){return this._other},i.getPrev=function(){return this._prev},i.getNext=function(){return this._next},t}(),r.dynamics.ContactManager=function(){function t(t){this._broadPhase=t,this._collisionMatrix=new r.collision.narrowphase.CollisionMatrix,this._numContacts=0}var i=t.prototype;return i.createContacts=function(){for(var t=this._broadPhase._proxyPairList;null!=t;){for(var i=t._next;;){var a=void 0,n=void 0;if(t._p1._id<t._p2._id?(a=t._p1.userData,n=t._p2.userData):(a=t._p2.userData,n=t._p1.userData),!this.shouldCollide(a,n))break;var o=a._rigidBody,s=n._rigidBody,e=void 0;e=o._numContactLinks<s._numContactLinks?o._contactLinkList:s._contactLinkList;for(var _=a._id,h=n._id,l=!1;null!=e;){var c=e._contact;if(c._s1._id==_&&c._s2._id==h){c._latest=!0,l=!0;break}e=e._next}if(!l){var m=this._contactPool;null!=m?(this._contactPool=m._next,m._next=null):m=new r.dynamics.Contact;var v=m;null==this._contactList?(this._contactList=v,this._contactListLast=v):(this._contactListLast._next=v,v._prev=this._contactListLast,this._contactListLast=v),v._latest=!0;var b=this._collisionMatrix.detectors[a._geom._type][n._geom._type];v._s1=a,v._s2=n,v._b1=a._rigidBody,v._b2=n._rigidBody,v._touching=!1,null==v._b1._contactLinkList?(v._b1._contactLinkList=v._link1,v._b1._contactLinkListLast=v._link1):(v._b1._contactLinkListLast._next=v._link1,v._link1._prev=v._b1._contactLinkListLast,v._b1._contactLinkListLast=v._link1),null==v._b2._contactLinkList?(v._b2._contactLinkList=v._link2,v._b2._contactLinkListLast=v._link2):(v._b2._contactLinkListLast._next=v._link2,v._link2._prev=v._b2._contactLinkListLast,v._b2._contactLinkListLast=v._link2),v._b1._numContactLinks++,v._b2._numContactLinks++,v._link1._other=v._b2,v._link2._other=v._b1,v._link1._contact=v,v._link2._contact=v,v._detector=b;var f=v._contactConstraint;f._s1=a,f._s2=n,f._b1=f._s1._rigidBody,f._b2=f._s2._rigidBody,f._tf1=f._b1._transform,f._tf2=f._b2._transform,this._numContacts++}break}t=i}},i.destroyOutdatedContacts=function(){for(var t=this._broadPhase._incremental,i=this._contactList;null!=i;){for(var a=i._next;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){var n=i._prev,o=i._next;if(null!=n&&(n._next=o),null!=o&&(o._prev=n),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var s=i._s1._contactCallback,r=i._s2._contactCallback;s==r&&(r=null),null!=s&&s.endContact(i),null!=r&&r.endContact(i)}var e=i._link1._prev,_=i._link1._next;null!=e&&(e._next=_),null!=_&&(_._prev=e),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var h=i._link2._prev,l=i._link2._next;null!=h&&(h._next=l),null!=l&&(l._prev=h),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var c=i._contactConstraint;c._s1=null,c._s2=null,c._b1=null,c._b2=null,c._tf1=null,c._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}var m=i._s1,v=i._s2,b=m._rigidBody,f=v._rigidBody;if((b._sleeping||1==b._type)&&(f._sleeping||1==f._type)){i._shouldBeSkipped=!0;break}var u=m._aabb,p=v._aabb,x=m._proxy,y=v._proxy;if(!(x._aabbMinX<y._aabbMaxX&&x._aabbMaxX>y._aabbMinX&&x._aabbMinY<y._aabbMaxY&&x._aabbMaxY>y._aabbMinY&&x._aabbMinZ<y._aabbMaxZ&&x._aabbMaxZ>y._aabbMinZ&&this.shouldCollide(m,v))){var d=i._prev,g=i._next;if(null!=d&&(d._next=g),null!=g&&(g._prev=d),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var X=i._s1._contactCallback,Y=i._s2._contactCallback;X==Y&&(Y=null),null!=X&&X.endContact(i),null!=Y&&Y.endContact(i)}var z=i._link1._prev,Z=i._link1._next;null!=z&&(z._next=Z),null!=Z&&(Z._prev=z),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var M=i._link2._prev,I=i._link2._next;null!=M&&(M._next=I),null!=I&&(I._prev=M),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var V=i._contactConstraint;V._s1=null,V._s2=null,V._b1=null,V._b2=null,V._tf1=null,V._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}i._shouldBeSkipped=!(u._minX<p._maxX&&u._maxX>p._minX&&u._minY<p._maxY&&u._maxY>p._minY&&u._minZ<p._maxZ&&u._maxZ>p._minZ);break}i=a}},i.shouldCollide=function(t,i){var a,n,o=t._rigidBody,s=i._rigidBody;if(o==s)return!1;if(0!=o._type&&0!=s._type)return!1;if(0==(t._collisionGroup&i._collisionMask)||0==(i._collisionGroup&t._collisionMask))return!1;for(o._numJointLinks<s._numJointLinks?(a=o._jointLinkList,n=s):(a=s._jointLinkList,n=o);null!=a;){if(a._other==n&&!a._joint._allowCollision)return!1;a=a._next}return!0},i._updateContacts=function(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()},i._postSolve=function(){for(var t=this._contactList;null!=t;){var i=t._next;t._touching&&t._postSolve(),t=i}},i.getNumContacts=function(){return this._numContacts},i.getContactList=function(){return this._contactList},t}(),r.dynamics.Island=function(){function t(){this.rigidBodies=new Array(r.common.Setting.islandInitialRigidBodyArraySize),this.solvers=new Array(r.common.Setting.islandInitialConstraintArraySize),this.solversSi=new Array(r.common.Setting.islandInitialConstraintArraySize),this.solversNgs=new Array(r.common.Setting.islandInitialConstraintArraySize),this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}var i=t.prototype;return i._clear=function(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null},i._addRigidBody=function(t){if(this.numRigidBodies==this.rigidBodies.length){for(var i=new Array(this.numRigidBodies<<1),a=0,n=this.numRigidBodies;a<n;){var o=a++;i[o]=this.rigidBodies[o],this.rigidBodies[o]=null}this.rigidBodies=i}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t},i._addConstraintSolver=function(t,i){if(this.numSolvers==this.solvers.length){for(var a=new Array(this.numSolvers<<1),n=0,o=this.numSolvers;n<o;){var s=n++;a[s]=this.solvers[s],this.solvers[s]=null}this.solvers=a}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==r.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var e=new Array(this.numSolversSi<<1),_=0,h=this.numSolversSi;_<h;){var l=_++;e[l]=this.solversSi[l],this.solversSi[l]=null}this.solversSi=e}this.solversSi[this.numSolversSi++]=t}if(i==r.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var c=new Array(this.numSolversNgs<<1),m=0,v=this.numSolversNgs;m<v;){var b=m++;c[b]=this.solversNgs[b],this.solversNgs[b]=null}this.solversNgs=c}this.solversNgs[this.numSolversNgs++]=t}},i._stepSingleRigidBody=function(t,i){var a=t.dt,n=i._ptransform,o=i._transform;if(n._positionX=o._positionX,n._positionY=o._positionY,n._positionZ=o._positionZ,n._rotation00=o._rotation00,n._rotation01=o._rotation01,n._rotation02=o._rotation02,n._rotation10=o._rotation10,n._rotation11=o._rotation11,n._rotation12=o._rotation12,n._rotation20=o._rotation20,n._rotation21=o._rotation21,n._rotation22=o._rotation22,i._linearContactImpulseX=0,i._linearContactImpulseY=0,i._linearContactImpulseZ=0,i._angularContactImpulseX=0,i._angularContactImpulseY=0,i._angularContactImpulseZ=0,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<r.common.Setting.sleepingVelocityThreshold*r.common.Setting.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<r.common.Setting.sleepingAngularVelocityThreshold*r.common.Setting.sleepingAngularVelocityThreshold?(i._sleepTime+=a,i._sleepTime>r.common.Setting.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(0==i._type){var s,e,_,h,l,c,m=a*i._linearDamping,v=m*m,b=1/(1+m+v*(.5+.16666666666666666*m+.041666666666666664*v)),f=a*i._angularDamping,u=f*f,p=1/(1+f+u*(.5+.16666666666666666*f+.041666666666666664*u));s=this.gravityX*i._gravityScale,e=this.gravityY*i._gravityScale,_=this.gravityZ*i._gravityScale,s+=i._forceX*i._invMass,e+=i._forceY*i._invMass,_+=i._forceZ*i._invMass,h=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,l=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,c=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,i._velX+=s*a,i._velY+=e*a,i._velZ+=_*a,i._velX*=b,i._velY*=b,i._velZ*=b,i._angVelX+=h*a,i._angVelY+=l*a,i._angVelZ+=c*a,i._angVelX*=p,i._angVelY*=p,i._angVelZ*=p}i._integrate(a);for(var x=i._shapeList;null!=x;){var y,d,g,X,Y,z,Z,M,I,V=x._next,w=i._ptransform,L=i._transform,k=x._ptransform,A=x._localTransform;y=w._rotation00*A._rotation00+w._rotation01*A._rotation10+w._rotation02*A._rotation20,d=w._rotation00*A._rotation01+w._rotation01*A._rotation11+w._rotation02*A._rotation21,g=w._rotation00*A._rotation02+w._rotation01*A._rotation12+w._rotation02*A._rotation22,X=w._rotation10*A._rotation00+w._rotation11*A._rotation10+w._rotation12*A._rotation20,Y=w._rotation10*A._rotation01+w._rotation11*A._rotation11+w._rotation12*A._rotation21,z=w._rotation10*A._rotation02+w._rotation11*A._rotation12+w._rotation12*A._rotation22,Z=w._rotation20*A._rotation00+w._rotation21*A._rotation10+w._rotation22*A._rotation20,M=w._rotation20*A._rotation01+w._rotation21*A._rotation11+w._rotation22*A._rotation21,I=w._rotation20*A._rotation02+w._rotation21*A._rotation12+w._rotation22*A._rotation22,k._rotation00=y,k._rotation01=d,k._rotation02=g,k._rotation10=X,k._rotation11=Y,k._rotation12=z,k._rotation20=Z,k._rotation21=M,k._rotation22=I;var B,P,S;B=w._rotation00*A._positionX+w._rotation01*A._positionY+w._rotation02*A._positionZ,P=w._rotation10*A._positionX+w._rotation11*A._positionY+w._rotation12*A._positionZ,S=w._rotation20*A._positionX+w._rotation21*A._positionY+w._rotation22*A._positionZ,k._positionX=B,k._positionY=P,k._positionZ=S,k._positionX+=w._positionX,k._positionY+=w._positionY,k._positionZ+=w._positionZ;var T,C,j,R,E,q,D,N,F,G=x._transform,J=x._localTransform;T=L._rotation00*J._rotation00+L._rotation01*J._rotation10+L._rotation02*J._rotation20,C=L._rotation00*J._rotation01+L._rotation01*J._rotation11+L._rotation02*J._rotation21,j=L._rotation00*J._rotation02+L._rotation01*J._rotation12+L._rotation02*J._rotation22,R=L._rotation10*J._rotation00+L._rotation11*J._rotation10+L._rotation12*J._rotation20,E=L._rotation10*J._rotation01+L._rotation11*J._rotation11+L._rotation12*J._rotation21,q=L._rotation10*J._rotation02+L._rotation11*J._rotation12+L._rotation12*J._rotation22,D=L._rotation20*J._rotation00+L._rotation21*J._rotation10+L._rotation22*J._rotation20,N=L._rotation20*J._rotation01+L._rotation21*J._rotation11+L._rotation22*J._rotation21,F=L._rotation20*J._rotation02+L._rotation21*J._rotation12+L._rotation22*J._rotation22,G._rotation00=T,G._rotation01=C,G._rotation02=j,G._rotation10=R,G._rotation11=E,G._rotation12=q,G._rotation20=D,G._rotation21=N,G._rotation22=F;var W,O,U;W=L._rotation00*J._positionX+L._rotation01*J._positionY+L._rotation02*J._positionZ,O=L._rotation10*J._positionX+L._rotation11*J._positionY+L._rotation12*J._positionZ,U=L._rotation20*J._positionX+L._rotation21*J._positionY+L._rotation22*J._positionZ,G._positionX=W,G._positionY=O,G._positionZ=U,G._positionX+=L._positionX,G._positionY+=L._positionY,G._positionZ+=L._positionZ;var H,Q,K,$,tt,it;if(x._geom._computeAabb(x._aabb,x._ptransform),H=x._aabb._minX,Q=x._aabb._minY,K=x._aabb._minZ,$=x._aabb._maxX,tt=x._aabb._maxY,it=x._aabb._maxZ,x._geom._computeAabb(x._aabb,x._transform),x._aabb._minX=H<x._aabb._minX?H:x._aabb._minX,x._aabb._minY=Q<x._aabb._minY?Q:x._aabb._minY,x._aabb._minZ=K<x._aabb._minZ?K:x._aabb._minZ,x._aabb._maxX=$>x._aabb._maxX?$:x._aabb._maxX,x._aabb._maxY=tt>x._aabb._maxY?tt:x._aabb._maxY,x._aabb._maxZ=it>x._aabb._maxZ?it:x._aabb._maxZ,null!=x._proxy){var at,nt,ot;at=x._transform._positionX-x._ptransform._positionX,nt=x._transform._positionY-x._ptransform._positionY,ot=x._transform._positionZ-x._ptransform._positionZ;var st=x.displacement;st.x=at,st.y=nt,st.z=ot,x._rigidBody._world._broadPhase.moveProxy(x._proxy,x._aabb,x.displacement)}x=V}}},i._step=function(t,i,a){for(var n=t.dt,o=!0,s=0,e=this.numRigidBodies;s<e;){var _=this.rigidBodies[s++],h=_._ptransform,l=_._transform;if(h._positionX=l._positionX,h._positionY=l._positionY,h._positionZ=l._positionZ,h._rotation00=l._rotation00,h._rotation01=l._rotation01,h._rotation02=l._rotation02,h._rotation10=l._rotation10,h._rotation11=l._rotation11,h._rotation12=l._rotation12,h._rotation20=l._rotation20,h._rotation21=l._rotation21,h._rotation22=l._rotation22,_._linearContactImpulseX=0,_._linearContactImpulseY=0,_._linearContactImpulseZ=0,_._angularContactImpulseX=0,_._angularContactImpulseY=0,_._angularContactImpulseZ=0,_._sleeping=!1,_._autoSleep&&_._velX*_._velX+_._velY*_._velY+_._velZ*_._velZ<r.common.Setting.sleepingVelocityThreshold*r.common.Setting.sleepingVelocityThreshold&&_._angVelX*_._angVelX+_._angVelY*_._angVelY+_._angVelZ*_._angVelZ<r.common.Setting.sleepingAngularVelocityThreshold*r.common.Setting.sleepingAngularVelocityThreshold?_._sleepTime+=n:_._sleepTime=0,_._sleepTime<r.common.Setting.sleepingTimeThreshold&&(o=!1),0==_._type){var c,m,v,b=n*_._linearDamping,f=b*b,u=1/(1+b+f*(.5+.16666666666666666*b+.041666666666666664*f)),p=n*_._angularDamping,x=p*p,y=1/(1+p+x*(.5+.16666666666666666*p+.041666666666666664*x)),d=void 0,g=void 0,X=void 0;d=this.gravityX*_._gravityScale,g=this.gravityY*_._gravityScale,X=this.gravityZ*_._gravityScale,d+=_._forceX*_._invMass,g+=_._forceY*_._invMass,X+=_._forceZ*_._invMass;c=_._invInertia00*_._torqueX+_._invInertia01*_._torqueY+_._invInertia02*_._torqueZ,m=_._invInertia10*_._torqueX+_._invInertia11*_._torqueY+_._invInertia12*_._torqueZ,v=_._invInertia20*_._torqueX+_._invInertia21*_._torqueY+_._invInertia22*_._torqueZ,_._velX+=d*n,_._velY+=g*n,_._velZ+=X*n,_._velX*=u,_._velY*=u,_._velZ*=u,_._angVelX+=c*n,_._angVelY+=m*n,_._angVelZ+=v*n,_._angVelX*=y,_._angVelY*=y,_._angVelZ*=y}}if(o)for(var Y=0,z=this.numRigidBodies;Y<z;){var Z=this.rigidBodies[Y++];Z._sleeping=!0,Z._sleepTime=0}else{for(var M=0,I=this.numSolvers;M<I;)this.solvers[M++].preSolveVelocity(t);for(var V=0,w=this.numSolvers;V<w;)this.solvers[V++].warmStart(t);for(var L=0;L<i;){++L;for(var k=0,A=this.numSolvers;k<A;)this.solvers[k++].solveVelocity()}for(var B=0,P=this.numSolvers;B<P;)this.solvers[B++].postSolveVelocity(t);for(var S=0,T=this.numRigidBodies;S<T;)this.rigidBodies[S++]._integrate(n);for(var C=0,j=this.numSolversSi;C<j;)this.solversSi[C++].preSolvePosition(t);for(var R=0;R<a;){++R;for(var E=0,q=this.numSolversSi;E<q;)this.solversSi[E++].solvePositionSplitImpulse()}for(var D=0,N=this.numRigidBodies;D<N;)this.rigidBodies[D++]._integratePseudoVelocity();for(var F=0,G=this.numSolversNgs;F<G;)this.solversNgs[F++].preSolvePosition(t);for(var J=0;J<a;){++J;for(var W=0,O=this.numSolversNgs;W<O;)this.solversNgs[W++].solvePositionNgs(t)}for(var U=0,H=this.numSolvers;U<H;)this.solvers[U++].postSolve();for(var Q=0,K=this.numRigidBodies;Q<K;)for(var $=this.rigidBodies[Q++],tt=$._shapeList;null!=tt;){var it,at,nt,ot,st,rt,et,_t,ht,lt=tt._next,ct=$._ptransform,mt=$._transform,vt=tt._ptransform,bt=tt._localTransform;it=ct._rotation00*bt._rotation00+ct._rotation01*bt._rotation10+ct._rotation02*bt._rotation20,at=ct._rotation00*bt._rotation01+ct._rotation01*bt._rotation11+ct._rotation02*bt._rotation21,nt=ct._rotation00*bt._rotation02+ct._rotation01*bt._rotation12+ct._rotation02*bt._rotation22,ot=ct._rotation10*bt._rotation00+ct._rotation11*bt._rotation10+ct._rotation12*bt._rotation20,st=ct._rotation10*bt._rotation01+ct._rotation11*bt._rotation11+ct._rotation12*bt._rotation21,rt=ct._rotation10*bt._rotation02+ct._rotation11*bt._rotation12+ct._rotation12*bt._rotation22,et=ct._rotation20*bt._rotation00+ct._rotation21*bt._rotation10+ct._rotation22*bt._rotation20,_t=ct._rotation20*bt._rotation01+ct._rotation21*bt._rotation11+ct._rotation22*bt._rotation21,ht=ct._rotation20*bt._rotation02+ct._rotation21*bt._rotation12+ct._rotation22*bt._rotation22,vt._rotation00=it,vt._rotation01=at,vt._rotation02=nt,vt._rotation10=ot,vt._rotation11=st,vt._rotation12=rt,vt._rotation20=et,vt._rotation21=_t,vt._rotation22=ht;var ft,ut,pt;ft=ct._rotation00*bt._positionX+ct._rotation01*bt._positionY+ct._rotation02*bt._positionZ,ut=ct._rotation10*bt._positionX+ct._rotation11*bt._positionY+ct._rotation12*bt._positionZ,pt=ct._rotation20*bt._positionX+ct._rotation21*bt._positionY+ct._rotation22*bt._positionZ,vt._positionX=ft,vt._positionY=ut,vt._positionZ=pt,vt._positionX+=ct._positionX,vt._positionY+=ct._positionY,vt._positionZ+=ct._positionZ;var xt,yt,dt,gt,Xt,Yt,zt,Zt,Mt,It=tt._transform,Vt=tt._localTransform;xt=mt._rotation00*Vt._rotation00+mt._rotation01*Vt._rotation10+mt._rotation02*Vt._rotation20,yt=mt._rotation00*Vt._rotation01+mt._rotation01*Vt._rotation11+mt._rotation02*Vt._rotation21,dt=mt._rotation00*Vt._rotation02+mt._rotation01*Vt._rotation12+mt._rotation02*Vt._rotation22,gt=mt._rotation10*Vt._rotation00+mt._rotation11*Vt._rotation10+mt._rotation12*Vt._rotation20,Xt=mt._rotation10*Vt._rotation01+mt._rotation11*Vt._rotation11+mt._rotation12*Vt._rotation21,Yt=mt._rotation10*Vt._rotation02+mt._rotation11*Vt._rotation12+mt._rotation12*Vt._rotation22,zt=mt._rotation20*Vt._rotation00+mt._rotation21*Vt._rotation10+mt._rotation22*Vt._rotation20,Zt=mt._rotation20*Vt._rotation01+mt._rotation21*Vt._rotation11+mt._rotation22*Vt._rotation21,Mt=mt._rotation20*Vt._rotation02+mt._rotation21*Vt._rotation12+mt._rotation22*Vt._rotation22,It._rotation00=xt,It._rotation01=yt,It._rotation02=dt,It._rotation10=gt,It._rotation11=Xt,It._rotation12=Yt,It._rotation20=zt,It._rotation21=Zt,It._rotation22=Mt;var wt,Lt,kt;wt=mt._rotation00*Vt._positionX+mt._rotation01*Vt._positionY+mt._rotation02*Vt._positionZ,Lt=mt._rotation10*Vt._positionX+mt._rotation11*Vt._positionY+mt._rotation12*Vt._positionZ,kt=mt._rotation20*Vt._positionX+mt._rotation21*Vt._positionY+mt._rotation22*Vt._positionZ,It._positionX=wt,It._positionY=Lt,It._positionZ=kt,It._positionX+=mt._positionX,It._positionY+=mt._positionY,It._positionZ+=mt._positionZ;var At,Bt,Pt,St,Tt,Ct;if(tt._geom._computeAabb(tt._aabb,tt._ptransform),At=tt._aabb._minX,Bt=tt._aabb._minY,Pt=tt._aabb._minZ,St=tt._aabb._maxX,Tt=tt._aabb._maxY,Ct=tt._aabb._maxZ,tt._geom._computeAabb(tt._aabb,tt._transform),tt._aabb._minX=At<tt._aabb._minX?At:tt._aabb._minX,tt._aabb._minY=Bt<tt._aabb._minY?Bt:tt._aabb._minY,tt._aabb._minZ=Pt<tt._aabb._minZ?Pt:tt._aabb._minZ,tt._aabb._maxX=St>tt._aabb._maxX?St:tt._aabb._maxX,tt._aabb._maxY=Tt>tt._aabb._maxY?Tt:tt._aabb._maxY,tt._aabb._maxZ=Ct>tt._aabb._maxZ?Ct:tt._aabb._maxZ,null!=tt._proxy){var jt,Rt,Et;jt=tt._transform._positionX-tt._ptransform._positionX,Rt=tt._transform._positionY-tt._ptransform._positionY,Et=tt._transform._positionZ-tt._ptransform._positionZ;var qt=tt.displacement;qt.x=jt,qt.y=Rt,qt.z=Et,tt._rigidBody._world._broadPhase.moveProxy(tt._proxy,tt._aabb,tt.displacement)}tt=lt}}},t}(),r.dynamics.TimeStep=function(){this.dt=0,this.invDt=0,this.dtRatio=1},r.dynamics.World=function(){function t(t,i){switch(null==t&&(t=2),t){case 1:this._broadPhase=new r.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new r.collision.broadphase.bvh.BvhBroadPhase}this._contactManager=new r.dynamics.ContactManager(this._broadPhase),null==i&&(i=new r.common.Vec3(0,-9.80665,0)),this._gravity=new r.common.Vec3(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new r.dynamics._World.RayCastWrapper,this._convexCastWrapper=new r.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new r.dynamics._World.AabbTestWrapper,this._island=new r.dynamics.Island,this._solversInIslands=new Array(r.common.Setting.islandInitialConstraintArraySize),this._rigidBodyStack=new Array(r.common.Setting.islandInitialRigidBodyArraySize),this._timeStep=new r.dynamics.TimeStep,this._pool=new r.common.Pool,this._shapeIdCount=0}var i=t.prototype;return i._updateContacts=function(){var t=s.now()/1e3;this._contactManager._updateContacts(),r.dynamics.common.Performance.broadPhaseCollisionTime=1e3*(s.now()/1e3-t);for(var i=s.now()/1e3,a=this._contactManager._contactList;null!=a;){var n=a._next;a._shouldBeSkipped||a._updateManifold(),a=n}r.dynamics.common.Performance.narrowPhaseCollisionTime=1e3*(s.now()/1e3-i)},i._solveIslands=function(){var t=s.now()/1e3;if(r.common.Setting.disableSleeping)for(var i=this._rigidBodyList;null!=i;)i._sleeping=!1,i._sleepTime=0,i=i._next;if(this._rigidBodyStack.length<this._numRigidBodies){for(var a=this._rigidBodyStack.length<<1;a<this._numRigidBodies;)a<<=1;this._rigidBodyStack=new Array(a)}this._numIslands=0;var n=this._island,o=this._gravity;n.gravityX=o.x,n.gravityY=o.y,n.gravityZ=o.z;var e=this._rigidBodyList;for(this._numSolversInIslands=0;null!=e;){for(var _=e._next;!e._addedToIsland&&!e._sleeping&&1!=e._type;){if(0==e._numContactLinks&&0==e._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,e),this._numIslands++;break}this.buildIsland(e),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}e=_}for(this._contactManager._postSolve(),e=this._rigidBodyList;null!=e;)e._addedToIsland=!1,e=e._next;for(e=this._rigidBodyList;null!=e;)e._forceX=0,e._forceY=0,e._forceZ=0,e._torqueX=0,e._torqueY=0,e._torqueZ=0,e=e._next;for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;r.dynamics.common.Performance.dynamicsTime=1e3*(s.now()/1e3-t)},i.buildIsland=function(t){var i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){var a=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,1!=a._type){for(var n=a._contactLinkList;null!=n;){var o=n._next,s=n._contact._contactConstraint,r=n._contact._contactConstraint._solver;if(s.isTouching()&&!r._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var e=new Array(this._numSolversInIslands<<1),_=0,h=this._numSolversInIslands;_<h;){var l=_++;e[l]=this._solversInIslands[l],this._solversInIslands[l]=null}this._solversInIslands=e}this._solversInIslands[this._numSolversInIslands++]=r,this._island._addConstraintSolver(r,s._positionCorrectionAlgorithm);var c=n._other;c._addedToIsland||(this._island._addRigidBody(c),this._rigidBodyStack[i++]=c)}n=o}for(var m=a._jointLinkList;null!=m;){var v=m._next,b=m._joint,f=b._solver;if(!f._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var u=new Array(this._numSolversInIslands<<1),p=0,x=this._numSolversInIslands;p<x;){var y=p++;u[y]=this._solversInIslands[y],this._solversInIslands[y]=null}this._solversInIslands=u}this._solversInIslands[this._numSolversInIslands++]=f,this._island._addConstraintSolver(f,b._positionCorrectionAlgorithm);var d=m._other;d._addedToIsland||(this._island._addRigidBody(d),this._rigidBodyStack[i++]=d)}m=v}}}},i._drawBvh=function(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)},i._drawBvhNode=function(t,i,a,n){if(null!=i){if(a>=t.drawBvhMinLevel&&a<=t.drawBvhMaxLevel){var o=this._pool,s=0==o.sizeVec3?new r.common.Vec3:o.stackVec3[--o.sizeVec3],e=this._pool,_=0==e.sizeVec3?new r.common.Vec3:e.stackVec3[--e.sizeVec3],h=s;h.x=i._aabbMinX,h.y=i._aabbMinY,h.z=i._aabbMinZ;var l=_;l.x=i._aabbMaxX,l.y=i._aabbMaxY,l.z=i._aabbMaxZ,t.aabb(s,_,n);var c=this._pool;if(null!=s){if(s.zero(),c.sizeVec3==c.stackVec3.length){for(var m=new Array(c.sizeVec3<<1),v=0,b=c.sizeVec3;v<b;){var f=v++;m[f]=c.stackVec3[f],c.stackVec3[f]=null}c.stackVec3=m}c.stackVec3[c.sizeVec3++]=s}var u=this._pool;if(null!=_){if(_.zero(),u.sizeVec3==u.stackVec3.length){for(var p=new Array(u.sizeVec3<<1),x=0,y=u.sizeVec3;x<y;){var d=x++;p[d]=u.stackVec3[d],u.stackVec3[d]=null}u.stackVec3=p}u.stackVec3[u.sizeVec3++]=_}}this._drawBvhNode(t,i._children[0],a+1,n),this._drawBvhNode(t,i._children[1],a+1,n)}},i._drawRigidBodies=function(t){for(var i=t.style,a=this._rigidBodyList;null!=a;){var n=a._next;if(t.drawBases){var o=t.style;t.basis(a._transform,o.basisLength,o.basisColorX,o.basisColorY,o.basisColorZ)}var s=null,e=0==a._type;e||(s=2==a._type?i.kinematicShapeColor:i.staticShapeColor);for(var _=a._shapeList;null!=_;){var h=_._next;if(e&&(s=0==(1&_._id)?a._sleeping?i.sleepingShapeColor1:a._sleepTime>r.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor1:i.shapeColor1:a._sleeping?i.sleepingShapeColor2:a._sleepTime>r.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor2:i.shapeColor2),t.drawShapes){var l=_._geom,c=_._transform;switch(l._type){case 0:t.sphere(c,l._radius,s);break;case 1:var m=l,v=this._pool,b=0==v.sizeVec3?new r.common.Vec3:v.stackVec3[--v.sizeVec3],f=b;f.x=m._halfExtentsX,f.y=m._halfExtentsY,f.z=m._halfExtentsZ,t.box(c,b,s);var u=this._pool;if(null!=b){if(b.zero(),u.sizeVec3==u.stackVec3.length){for(var p=new Array(u.sizeVec3<<1),x=0,y=u.sizeVec3;x<y;){var d=x++;p[d]=u.stackVec3[d],u.stackVec3[d]=null}u.stackVec3=p}u.stackVec3[u.sizeVec3++]=b}break;case 2:var g=l;t.cylinder(c,g._radius,g._halfHeight,s);break;case 3:var X=l;t.cone(c,X._radius,X._halfHeight,s);break;case 4:var Y=l;t.capsule(c,Y._radius,Y._halfHeight,s);break;case 5:var z=l,Z=z._numVertices,M=this._pool,I=0==M.sizeVec3?new r.common.Vec3:M.stackVec3[--M.sizeVec3],V=this._pool,w=0==V.sizeVec3?new r.common.Vec3:V.stackVec3[--V.sizeVec3],L=this._pool,k=0==L.sizeVec3?new r.common.Vec3:L.stackVec3[--L.sizeVec3],A=this._pool,B=0==A.sizeVec3?new r.common.Vec3:A.stackVec3[--A.sizeVec3],P=this._pool,S=0==P.sizeVec3?new r.common.Vec3:P.stackVec3[--P.sizeVec3],T=this._pool,C=0==T.sizeVec3?new r.common.Vec3:T.stackVec3[--T.sizeVec3],j=this._pool,R=0==j.sizeMat3?new r.common.Mat3:j.stackMat3[--j.sizeMat3],E=this._pool,q=0==E.sizeVec3?new r.common.Vec3:E.stackVec3[--E.sizeVec3],D=R;D.e00=c._rotation00,D.e01=c._rotation01,D.e02=c._rotation02,D.e10=c._rotation10,D.e11=c._rotation11,D.e12=c._rotation12,D.e20=c._rotation20,D.e21=c._rotation21,D.e22=c._rotation22;var N=q;N.x=c._positionX,N.y=c._positionY,N.z=c._positionZ;for(var F=0;F<Z;){var G=F++,J=z._tmpVertices[G],W=z._vertices[G];J.x=W.x,J.y=W.y,J.z=W.z;var O=J.x*R.e10+J.y*R.e11+J.z*R.e12,U=J.x*R.e20+J.y*R.e21+J.z*R.e22;J.x=J.x*R.e00+J.y*R.e01+J.z*R.e02,J.y=O,J.z=U,J.x+=q.x,J.y+=q.y,J.z+=q.z}if(Z>30)for(var H=0;H<Z;){var Q=H++,K=z._tmpVertices[Q];I.x=K.x,I.y=K.y,I.z=K.z;var $=z._tmpVertices[(Q+1)%Z];w.x=$.x,w.y=$.y,w.z=$.z,t.line(I,w,s)}else if(this._debugDraw.wireframe||Z>10)for(var tt=0;tt<Z;){var it=tt++,at=z._tmpVertices[it];I.x=at.x,I.y=at.y,I.z=at.z;for(var nt=0;nt<it;){var ot=z._tmpVertices[nt++];w.x=ot.x,w.y=ot.y,w.z=ot.z,t.line(I,w,s)}}else for(var st=0;st<Z;){var rt=st++,et=z._tmpVertices[rt];I.x=et.x,I.y=et.y,I.z=et.z;for(var _t=0;_t<rt;){var ht=_t++,lt=z._tmpVertices[ht];w.x=lt.x,w.y=lt.y,w.z=lt.z;for(var ct=0;ct<ht;){var mt=z._tmpVertices[ct++];k.x=mt.x,k.y=mt.y,k.z=mt.z,B.x=w.x,B.y=w.y,B.z=w.z;var vt=B;vt.x-=I.x,vt.y-=I.y,vt.z-=I.z,S.x=k.x,S.y=k.y,S.z=k.z;var bt=S;bt.x-=I.x,bt.y-=I.y,bt.z-=I.z,C.x=B.x,C.y=B.y,C.z=B.z;var ft=C,ut=ft.z*S.x-ft.x*S.z,pt=ft.x*S.y-ft.y*S.x;ft.x=ft.y*S.z-ft.z*S.y,ft.y=ut,ft.z=pt;var xt=Math.sqrt(ft.x*ft.x+ft.y*ft.y+ft.z*ft.z);xt>0&&(xt=1/xt),ft.x*=xt,ft.y*=xt,ft.z*=xt,t.triangle(I,w,k,C,C,C,s),C.x=-C.x,C.y=-C.y,C.z=-C.z,t.triangle(I,k,w,C,C,C,s)}}}var yt=this._pool;if(null!=I){if(I.zero(),yt.sizeVec3==yt.stackVec3.length){for(var dt=new Array(yt.sizeVec3<<1),gt=0,Xt=yt.sizeVec3;gt<Xt;){var Yt=gt++;dt[Yt]=yt.stackVec3[Yt],yt.stackVec3[Yt]=null}yt.stackVec3=dt}yt.stackVec3[yt.sizeVec3++]=I}var zt=this._pool;if(null!=w){if(w.zero(),zt.sizeVec3==zt.stackVec3.length){for(var Zt=new Array(zt.sizeVec3<<1),Mt=0,It=zt.sizeVec3;Mt<It;){var Vt=Mt++;Zt[Vt]=zt.stackVec3[Vt],zt.stackVec3[Vt]=null}zt.stackVec3=Zt}zt.stackVec3[zt.sizeVec3++]=w}var wt=this._pool;if(null!=k){if(k.zero(),wt.sizeVec3==wt.stackVec3.length){for(var Lt=new Array(wt.sizeVec3<<1),kt=0,At=wt.sizeVec3;kt<At;){var Bt=kt++;Lt[Bt]=wt.stackVec3[Bt],wt.stackVec3[Bt]=null}wt.stackVec3=Lt}wt.stackVec3[wt.sizeVec3++]=k}var Pt=this._pool;if(null!=B){if(B.zero(),Pt.sizeVec3==Pt.stackVec3.length){for(var St=new Array(Pt.sizeVec3<<1),Tt=0,Ct=Pt.sizeVec3;Tt<Ct;){var jt=Tt++;St[jt]=Pt.stackVec3[jt],Pt.stackVec3[jt]=null}Pt.stackVec3=St}Pt.stackVec3[Pt.sizeVec3++]=B}var Rt=this._pool;if(null!=S){if(S.zero(),Rt.sizeVec3==Rt.stackVec3.length){for(var Et=new Array(Rt.sizeVec3<<1),qt=0,Dt=Rt.sizeVec3;qt<Dt;){var Nt=qt++;Et[Nt]=Rt.stackVec3[Nt],Rt.stackVec3[Nt]=null}Rt.stackVec3=Et}Rt.stackVec3[Rt.sizeVec3++]=S}var Ft=this._pool;if(null!=C){if(C.zero(),Ft.sizeVec3==Ft.stackVec3.length){for(var Gt=new Array(Ft.sizeVec3<<1),Jt=0,Wt=Ft.sizeVec3;Jt<Wt;){var Ot=Jt++;Gt[Ot]=Ft.stackVec3[Ot],Ft.stackVec3[Ot]=null}Ft.stackVec3=Gt}Ft.stackVec3[Ft.sizeVec3++]=C}var Ut=this._pool;if(null!=R){if(R.e00=1,R.e01=0,R.e02=0,R.e10=0,R.e11=1,R.e12=0,R.e20=0,R.e21=0,R.e22=1,Ut.sizeMat3==Ut.stackMat3.length){for(var Ht=new Array(Ut.sizeMat3<<1),Qt=0,Kt=Ut.sizeMat3;Qt<Kt;){var $t=Qt++;Ht[$t]=Ut.stackMat3[$t],Ut.stackMat3[$t]=null}Ut.stackMat3=Ht}Ut.stackMat3[Ut.sizeMat3++]=R}var ti=this._pool;if(null!=q){if(q.zero(),ti.sizeVec3==ti.stackVec3.length){for(var ii=new Array(ti.sizeVec3<<1),ai=0,ni=ti.sizeVec3;ai<ni;){var oi=ai++;ii[oi]=ti.stackVec3[oi],ti.stackVec3[oi]=null}ti.stackVec3=ii}ti.stackVec3[ti.sizeVec3++]=q}}}if(t.drawAabbs){var si=_._aabb,ri=i.aabbColor,ei=this._pool,_i=0==ei.sizeVec3?new r.common.Vec3:ei.stackVec3[--ei.sizeVec3],hi=this._pool,li=0==hi.sizeVec3?new r.common.Vec3:hi.stackVec3[--hi.sizeVec3],ci=_i;ci.x=si._minX,ci.y=si._minY,ci.z=si._minZ;var mi=li;mi.x=si._maxX,mi.y=si._maxY,mi.z=si._maxZ,t.aabb(_i,li,ri);var vi=this._pool;if(null!=_i){if(_i.zero(),vi.sizeVec3==vi.stackVec3.length){for(var bi=new Array(vi.sizeVec3<<1),fi=0,ui=vi.sizeVec3;fi<ui;){var pi=fi++;bi[pi]=vi.stackVec3[pi],vi.stackVec3[pi]=null}vi.stackVec3=bi}vi.stackVec3[vi.sizeVec3++]=_i}var xi=this._pool;if(null!=li){if(li.zero(),xi.sizeVec3==xi.stackVec3.length){for(var yi=new Array(xi.sizeVec3<<1),di=0,gi=xi.sizeVec3;di<gi;){var Xi=di++;yi[Xi]=xi.stackVec3[Xi],xi.stackVec3[Xi]=null}xi.stackVec3=yi}xi.stackVec3[xi.sizeVec3++]=li}}_=h}a=n}},i._drawConstraints=function(t){var i=t.style;if(t.drawPairs||t.drawContacts)for(var a=this._contactManager._contactList;null!=a;){var n=a._next;if(t.drawPairs){var o=i.pairColor,s=this._pool,e=0==s.sizeVec3?new r.common.Vec3:s.stackVec3[--s.sizeVec3],_=this._pool,h=0==_.sizeVec3?new r.common.Vec3:_.stackVec3[--_.sizeVec3],l=e;l.x=a._s1._transform._positionX,l.y=a._s1._transform._positionY,l.z=a._s1._transform._positionZ;var c=h;c.x=a._s2._transform._positionX,c.y=a._s2._transform._positionY,c.z=a._s2._transform._positionZ,t.line(e,h,o);var m=this._pool;if(null!=e){if(e.zero(),m.sizeVec3==m.stackVec3.length){for(var v=new Array(m.sizeVec3<<1),b=0,f=m.sizeVec3;b<f;){var u=b++;v[u]=m.stackVec3[u],m.stackVec3[u]=null}m.stackVec3=v}m.stackVec3[m.sizeVec3++]=e}var p=this._pool;if(null!=h){if(h.zero(),p.sizeVec3==p.stackVec3.length){for(var x=new Array(p.sizeVec3<<1),y=0,d=p.sizeVec3;y<d;){var g=y++;x[g]=p.stackVec3[g],p.stackVec3[g]=null}p.stackVec3=x}p.stackVec3[p.sizeVec3++]=h}}if(t.drawContacts)for(var X=a._contactConstraint,Y=a._contactConstraint._manifold._points,z=0,Z=a._contactConstraint._manifold._numPoints;z<Z;){var M=Y[z++],I=t.style,V=this._pool,w=0==V.sizeVec3?new r.common.Vec3:V.stackVec3[--V.sizeVec3],L=this._pool,k=0==L.sizeVec3?new r.common.Vec3:L.stackVec3[--L.sizeVec3],A=this._pool,B=0==A.sizeVec3?new r.common.Vec3:A.stackVec3[--A.sizeVec3],P=this._pool,S=0==P.sizeVec3?new r.common.Vec3:P.stackVec3[--P.sizeVec3],T=this._pool,C=0==T.sizeVec3?new r.common.Vec3:T.stackVec3[--T.sizeVec3],j=w;j.x=M._pos1X,j.y=M._pos1Y,j.z=M._pos1Z;var R=k;R.x=M._pos2X,R.y=M._pos2Y,R.z=M._pos2Z;var E=B;E.x=X._manifold._normalX,E.y=X._manifold._normalY,E.z=X._manifold._normalZ;var q=S;q.x=X._manifold._tangentX,q.y=X._manifold._tangentY,q.z=X._manifold._tangentZ;var D=C;if(D.x=X._manifold._binormalX,D.y=X._manifold._binormalY,D.z=X._manifold._binormalZ,M._disabled)t.point(w,I.disabledContactColor),t.point(k,I.disabledContactColor),t.line(w,k,I.disabledContactColor);else if(M._warmStarted){var N=void 0;switch(3&M._id){case 0:N=I.contactColor;break;case 1:N=I.contactColor2;break;case 2:N=I.contactColor3;break;default:N=I.contactColor4}t.point(w,N),t.point(k,N),t.line(w,k,I.contactColor)}else t.point(w,I.newContactColor),t.point(k,I.newContactColor),t.line(w,k,I.newContactColor);k.x=w.x,k.y=w.y,k.z=w.z;var F=k,G=I.contactNormalLength;if(F.x+=B.x*G,F.y+=B.y*G,F.z+=B.z*G,t.line(w,k,I.contactNormalColor),t.drawContactBases){k.x=w.x,k.y=w.y,k.z=w.z;var J=k,W=I.contactTangentLength;J.x+=S.x*W,J.y+=S.y*W,J.z+=S.z*W,t.line(w,k,I.contactTangentColor),k.x=w.x,k.y=w.y,k.z=w.z;var O=k,U=I.contactBinormalLength;O.x+=C.x*U,O.y+=C.y*U,O.z+=C.z*U,t.line(w,k,I.contactBinormalColor)}var H=this._pool;if(null!=w){if(w.zero(),H.sizeVec3==H.stackVec3.length){for(var Q=new Array(H.sizeVec3<<1),K=0,$=H.sizeVec3;K<$;){var tt=K++;Q[tt]=H.stackVec3[tt],H.stackVec3[tt]=null}H.stackVec3=Q}H.stackVec3[H.sizeVec3++]=w}var it=this._pool;if(null!=k){if(k.zero(),it.sizeVec3==it.stackVec3.length){for(var at=new Array(it.sizeVec3<<1),nt=0,ot=it.sizeVec3;nt<ot;){var st=nt++;at[st]=it.stackVec3[st],it.stackVec3[st]=null}it.stackVec3=at}it.stackVec3[it.sizeVec3++]=k}var rt=this._pool;if(null!=B){if(B.zero(),rt.sizeVec3==rt.stackVec3.length){for(var et=new Array(rt.sizeVec3<<1),_t=0,ht=rt.sizeVec3;_t<ht;){var lt=_t++;et[lt]=rt.stackVec3[lt],rt.stackVec3[lt]=null}rt.stackVec3=et}rt.stackVec3[rt.sizeVec3++]=B}var ct=this._pool;if(null!=S){if(S.zero(),ct.sizeVec3==ct.stackVec3.length){for(var mt=new Array(ct.sizeVec3<<1),vt=0,bt=ct.sizeVec3;vt<bt;){var ft=vt++;mt[ft]=ct.stackVec3[ft],ct.stackVec3[ft]=null}ct.stackVec3=mt}ct.stackVec3[ct.sizeVec3++]=S}var ut=this._pool;if(null!=C){if(C.zero(),ut.sizeVec3==ut.stackVec3.length){for(var pt=new Array(ut.sizeVec3<<1),xt=0,yt=ut.sizeVec3;xt<yt;){var dt=xt++;pt[dt]=ut.stackVec3[dt],ut.stackVec3[dt]=null}ut.stackVec3=pt}ut.stackVec3[ut.sizeVec3++]=C}}a=n}if(t.drawJoints)for(var gt=this._jointList;null!=gt;){var Xt=gt._next,Yt=this._pool,zt=0==Yt.sizeVec3?new r.common.Vec3:Yt.stackVec3[--Yt.sizeVec3],Zt=this._pool,Mt=0==Zt.sizeVec3?new r.common.Vec3:Zt.stackVec3[--Zt.sizeVec3],It=zt;It.x=gt._b1._transform._positionX,It.y=gt._b1._transform._positionY,It.z=gt._b1._transform._positionZ;var Vt=Mt;Vt.x=gt._b2._transform._positionX,Vt.y=gt._b2._transform._positionY,Vt.z=gt._b2._transform._positionZ;var wt=this._pool,Lt=0==wt.sizeVec3?new r.common.Vec3:wt.stackVec3[--wt.sizeVec3],kt=this._pool,At=0==kt.sizeVec3?new r.common.Vec3:kt.stackVec3[--kt.sizeVec3],Bt=this._pool,Pt=0==Bt.sizeVec3?new r.common.Vec3:Bt.stackVec3[--Bt.sizeVec3],St=this._pool,Tt=0==St.sizeVec3?new r.common.Vec3:St.stackVec3[--St.sizeVec3],Ct=this._pool,jt=0==Ct.sizeVec3?new r.common.Vec3:Ct.stackVec3[--Ct.sizeVec3],Rt=this._pool,Et=0==Rt.sizeVec3?new r.common.Vec3:Rt.stackVec3[--Rt.sizeVec3],qt=this._pool,Dt=0==qt.sizeVec3?new r.common.Vec3:qt.stackVec3[--qt.sizeVec3],Nt=this._pool,Ft=0==Nt.sizeVec3?new r.common.Vec3:Nt.stackVec3[--Nt.sizeVec3],Gt=Lt;Gt.x=gt._anchor1X,Gt.y=gt._anchor1Y,Gt.z=gt._anchor1Z;var Jt=At;Jt.x=gt._anchor2X,Jt.y=gt._anchor2Y,Jt.z=gt._anchor2Z;var Wt=Pt;Wt.x=gt._basisX1X,Wt.y=gt._basisX1Y,Wt.z=gt._basisX1Z;var Ot=Tt;Ot.x=gt._basisY1X,Ot.y=gt._basisY1Y,Ot.z=gt._basisY1Z;var Ut=jt;Ut.x=gt._basisZ1X,Ut.y=gt._basisZ1Y,Ut.z=gt._basisZ1Z;var Ht=Et;Ht.x=gt._basisX2X,Ht.y=gt._basisX2Y,Ht.z=gt._basisX2Z;var Qt=Dt;Qt.x=gt._basisY2X,Qt.y=gt._basisY2Y,Qt.z=gt._basisY2Z;var Kt=Ft;if(Kt.x=gt._basisZ2X,Kt.y=gt._basisZ2Y,Kt.z=gt._basisZ2Z,t.line(zt,Lt,t.style.jointLineColor),t.line(Mt,At,t.style.jointLineColor),t.drawJointLimits)switch(gt._type){case 0:break;case 1:var $t=gt._lm;this._drawRotationalLimit(t,Lt,Tt,jt,Dt,t.style.jointRotationalConstraintRadius,$t.lowerLimit,$t.upperLimit,t.style.jointLineColor);break;case 2:var ti=gt,ii=t.style.jointLineColor,ai=ti._rotLm,ni=ti._translLm;this._drawRotationalLimit(t,At,Tt,jt,Dt,t.style.jointRotationalConstraintRadius,ai.lowerLimit,ai.upperLimit,ii),this._drawTranslationalLimit(t,Lt,Pt,ni.lowerLimit,ni.upperLimit,ii);break;case 3:var oi=gt._lm;this._drawTranslationalLimit(t,Lt,Pt,oi.lowerLimit,oi.upperLimit,t.style.jointLineColor);break;case 4:var si=gt,ri=t.style.jointRotationalConstraintRadius,ei=t.style.jointLineColor,_i=si._lm1,hi=si._lm2;this._drawRotationalLimit(t,Lt,Tt,jt,Tt,ri,si._angleX-_i.upperLimit,si._angleX-_i.lowerLimit,ei),this._drawRotationalLimit(t,At,Et,Dt,Et,ri,hi.lowerLimit-si._angleZ,hi.upperLimit-si._angleZ,ei);break;case 5:var li=gt,ci=t.style.jointRotationalConstraintRadius,mi=t.style.jointLineColor,vi=li._twistLm;this._drawRotationalLimit(t,At,Dt,Ft,Dt,ci,vi.lowerLimit-li._twistAngle,vi.upperLimit-li._twistAngle,mi),this._drawEllipseOnSphere(t,Lt,Pt,Tt,jt,li._maxSwingAngle1,li._maxSwingAngle2,ci,mi);var bi=this._pool,fi=0==bi.sizeVec3?new r.common.Vec3:bi.stackVec3[--bi.sizeVec3];fi.x=At.x,fi.y=At.y,fi.z=At.z;var ui=fi;ui.x+=Et.x*ci,ui.y+=Et.y*ci,ui.z+=Et.z*ci,t.line(At,ui,mi);var pi=this._pool;if(null!=ui){if(ui.zero(),pi.sizeVec3==pi.stackVec3.length){for(var xi=new Array(pi.sizeVec3<<1),yi=0,di=pi.sizeVec3;yi<di;){var gi=yi++;xi[gi]=pi.stackVec3[gi],pi.stackVec3[gi]=null}pi.stackVec3=xi}pi.stackVec3[pi.sizeVec3++]=ui}break;case 6:var Xi=gt,Yi=t.style.jointRotationalConstraintRadius,zi=t.style.jointLineColor,Zi=Xi._rotLms[0],Mi=Xi._rotLms[1],Ii=Xi._rotLms[2];this._drawTranslationalLimit3D(t,Lt,Pt,Tt,jt,Xi._translLms[0],Xi._translLms[1],Xi._translLms[2],zi);var Vi=this._pool,wi=0==Vi.sizeVec3?new r.common.Vec3:Vi.stackVec3[--Vi.sizeVec3],Li=wi;Li.x=Xi._axisYX,Li.y=Xi._axisYY,Li.z=Xi._axisYZ;var ki=this._pool,Ai=0==ki.sizeVec3?new r.common.Vec3:ki.stackVec3[--ki.sizeVec3];Ai.x=Pt.x,Ai.y=Pt.y,Ai.z=Pt.z;var Bi=Ai,Pi=this._pool,Si=0==Pi.sizeVec3?new r.common.Vec3:Pi.stackVec3[--Pi.sizeVec3];Si.x=Pt.x,Si.y=Pt.y,Si.z=Pt.z;var Ti=Si,Ci=Ti.z*wi.x-Ti.x*wi.z,ji=Ti.x*wi.y-Ti.y*wi.x;Ti.x=Ti.y*wi.z-Ti.z*wi.y,Ti.y=Ci,Ti.z=ji,this._drawRotationalLimit(t,At,Tt,jt,Tt,Yi,Xi._angleX-Zi.upperLimit,Xi._angleX-Zi.lowerLimit,zi),this._drawRotationalLimit(t,At,Bi,Ti,Bi,Yi,Mi.lowerLimit-Xi._angleY,Mi.upperLimit-Xi._angleY,zi),this._drawRotationalLimit(t,At,Et,Dt,Et,Yi,Ii.lowerLimit-Xi._angleZ,Ii.upperLimit-Xi._angleZ,zi)}t.line(Lt,At,t.style.jointErrorColor);var Ri=this._pool;if(null!=zt){if(zt.zero(),Ri.sizeVec3==Ri.stackVec3.length){for(var Ei=new Array(Ri.sizeVec3<<1),qi=0,Di=Ri.sizeVec3;qi<Di;){var Ni=qi++;Ei[Ni]=Ri.stackVec3[Ni],Ri.stackVec3[Ni]=null}Ri.stackVec3=Ei}Ri.stackVec3[Ri.sizeVec3++]=zt}var Fi=this._pool;if(null!=Mt){if(Mt.zero(),Fi.sizeVec3==Fi.stackVec3.length){for(var Gi=new Array(Fi.sizeVec3<<1),Ji=0,Wi=Fi.sizeVec3;Ji<Wi;){var Oi=Ji++;Gi[Oi]=Fi.stackVec3[Oi],Fi.stackVec3[Oi]=null}Fi.stackVec3=Gi}Fi.stackVec3[Fi.sizeVec3++]=Mt}var Ui=this._pool;if(null!=Lt){if(Lt.zero(),Ui.sizeVec3==Ui.stackVec3.length){for(var Hi=new Array(Ui.sizeVec3<<1),Qi=0,Ki=Ui.sizeVec3;Qi<Ki;){var $i=Qi++;Hi[$i]=Ui.stackVec3[$i],Ui.stackVec3[$i]=null}Ui.stackVec3=Hi}Ui.stackVec3[Ui.sizeVec3++]=Lt}var ta=this._pool;if(null!=At){if(At.zero(),ta.sizeVec3==ta.stackVec3.length){for(var ia=new Array(ta.sizeVec3<<1),aa=0,na=ta.sizeVec3;aa<na;){var oa=aa++;ia[oa]=ta.stackVec3[oa],ta.stackVec3[oa]=null}ta.stackVec3=ia}ta.stackVec3[ta.sizeVec3++]=At}var sa=this._pool;if(null!=Pt){if(Pt.zero(),sa.sizeVec3==sa.stackVec3.length){for(var ra=new Array(sa.sizeVec3<<1),ea=0,_a=sa.sizeVec3;ea<_a;){var ha=ea++;ra[ha]=sa.stackVec3[ha],sa.stackVec3[ha]=null}sa.stackVec3=ra}sa.stackVec3[sa.sizeVec3++]=Pt}var la=this._pool;if(null!=Tt){if(Tt.zero(),la.sizeVec3==la.stackVec3.length){for(var ca=new Array(la.sizeVec3<<1),ma=0,va=la.sizeVec3;ma<va;){var ba=ma++;ca[ba]=la.stackVec3[ba],la.stackVec3[ba]=null}la.stackVec3=ca}la.stackVec3[la.sizeVec3++]=Tt}var fa=this._pool;if(null!=jt){if(jt.zero(),fa.sizeVec3==fa.stackVec3.length){for(var ua=new Array(fa.sizeVec3<<1),pa=0,xa=fa.sizeVec3;pa<xa;){var ya=pa++;ua[ya]=fa.stackVec3[ya],fa.stackVec3[ya]=null}fa.stackVec3=ua}fa.stackVec3[fa.sizeVec3++]=jt}var da=this._pool;if(null!=Et){if(Et.zero(),da.sizeVec3==da.stackVec3.length){for(var ga=new Array(da.sizeVec3<<1),Xa=0,Ya=da.sizeVec3;Xa<Ya;){var za=Xa++;ga[za]=da.stackVec3[za],da.stackVec3[za]=null}da.stackVec3=ga}da.stackVec3[da.sizeVec3++]=Et}var Za=this._pool;if(null!=Dt){if(Dt.zero(),Za.sizeVec3==Za.stackVec3.length){for(var Ma=new Array(Za.sizeVec3<<1),Ia=0,Va=Za.sizeVec3;Ia<Va;){var wa=Ia++;Ma[wa]=Za.stackVec3[wa],Za.stackVec3[wa]=null}Za.stackVec3=Ma}Za.stackVec3[Za.sizeVec3++]=Dt}var La=this._pool;if(null!=Ft){if(Ft.zero(),La.sizeVec3==La.stackVec3.length){for(var ka=new Array(La.sizeVec3<<1),Aa=0,Ba=La.sizeVec3;Aa<Ba;){var Pa=Aa++;ka[Pa]=La.stackVec3[Pa],La.stackVec3[Pa]=null}La.stackVec3=ka}La.stackVec3[La.sizeVec3++]=Ft}gt=Xt}},i._drawRotationalLimit=function(t,i,a,n,o,s,e,_,h){if(e!=_){var l=this._pool,c=0==l.sizeVec3?new r.common.Vec3:l.stackVec3[--l.sizeVec3];c.x=i.x,c.y=i.y,c.z=i.z;var m=c;m.x+=o.x*s,m.y+=o.y*s,m.z+=o.z*s,t.line(i,m,h);var v=this._pool;if(null!=m){if(m.zero(),v.sizeVec3==v.stackVec3.length){for(var b=new Array(v.sizeVec3<<1),f=0,u=v.sizeVec3;f<u;){var p=f++;b[p]=v.stackVec3[p],v.stackVec3[p]=null}v.stackVec3=b}v.stackVec3[v.sizeVec3++]=m}e>_?t.ellipse(i,a,n,s,s,h):t.arc(i,a,n,s,s,e,_,!0,h)}},i._drawTranslationalLimit=function(t,i,a,n,o,s){if(n<o){var e=this._pool,_=0==e.sizeVec3?new r.common.Vec3:e.stackVec3[--e.sizeVec3];_.x=i.x,_.y=i.y,_.z=i.z;var h=_;h.x+=a.x*n,h.y+=a.y*n,h.z+=a.z*n;var l=this._pool,c=0==l.sizeVec3?new r.common.Vec3:l.stackVec3[--l.sizeVec3];c.x=i.x,c.y=i.y,c.z=i.z;var m=c;m.x+=a.x*o,m.y+=a.y*o,m.z+=a.z*o,t.line(h,m,s);var v=this._pool;if(null!=h){if(h.zero(),v.sizeVec3==v.stackVec3.length){for(var b=new Array(v.sizeVec3<<1),f=0,u=v.sizeVec3;f<u;){var p=f++;b[p]=v.stackVec3[p],v.stackVec3[p]=null}v.stackVec3=b}v.stackVec3[v.sizeVec3++]=h}var x=this._pool;if(null!=m){if(m.zero(),x.sizeVec3==x.stackVec3.length){for(var y=new Array(x.sizeVec3<<1),d=0,g=x.sizeVec3;d<g;){var X=d++;y[X]=x.stackVec3[X],x.stackVec3[X]=null}x.stackVec3=y}x.stackVec3[x.sizeVec3++]=m}}},i._drawTranslationalLimit3D=function(t,i,a,n,o,s,e,_,h){var l=s.lowerLimit,c=s.upperLimit,m=e.lowerLimit,v=e.upperLimit,b=_.lowerLimit,f=_.upperLimit,u=this._pool;0==u.sizeVec3?new r.common.Vec3:--u.sizeVec3;var p=this._pool;0==p.sizeVec3?new r.common.Vec3:--p.sizeVec3;var x=this._pool,y=0==x.sizeVec3?new r.common.Vec3:x.stackVec3[--x.sizeVec3];y.x=i.x,y.y=i.y,y.z=i.z;var d=y;d.x+=a.x*l,d.y+=a.y*l,d.z+=a.z*l,d.x+=n.x*m,d.y+=n.y*m,d.z+=n.z*m,d.x+=o.x*b,d.y+=o.y*b,d.z+=o.z*b;var g=this._pool,X=0==g.sizeVec3?new r.common.Vec3:g.stackVec3[--g.sizeVec3];X.x=i.x,X.y=i.y,X.z=i.z;var Y=X;Y.x+=a.x*l,Y.y+=a.y*l,Y.z+=a.z*l,Y.x+=n.x*m,Y.y+=n.y*m,Y.z+=n.z*m,Y.x+=o.x*f,Y.y+=o.y*f,Y.z+=o.z*f;var z=this._pool,Z=0==z.sizeVec3?new r.common.Vec3:z.stackVec3[--z.sizeVec3];Z.x=i.x,Z.y=i.y,Z.z=i.z;var M=Z;M.x+=a.x*l,M.y+=a.y*l,M.z+=a.z*l,M.x+=n.x*v,M.y+=n.y*v,M.z+=n.z*v,M.x+=o.x*b,M.y+=o.y*b,M.z+=o.z*b;var I=this._pool,V=0==I.sizeVec3?new r.common.Vec3:I.stackVec3[--I.sizeVec3];V.x=i.x,V.y=i.y,V.z=i.z;var w=V;w.x+=a.x*l,w.y+=a.y*l,w.z+=a.z*l,w.x+=n.x*v,w.y+=n.y*v,w.z+=n.z*v,w.x+=o.x*f,w.y+=o.y*f,w.z+=o.z*f;var L=this._pool,k=0==L.sizeVec3?new r.common.Vec3:L.stackVec3[--L.sizeVec3];k.x=i.x,k.y=i.y,k.z=i.z;var A=k;A.x+=a.x*c,A.y+=a.y*c,A.z+=a.z*c,A.x+=n.x*m,A.y+=n.y*m,A.z+=n.z*m,A.x+=o.x*b,A.y+=o.y*b,A.z+=o.z*b;var B=this._pool,P=0==B.sizeVec3?new r.common.Vec3:B.stackVec3[--B.sizeVec3];P.x=i.x,P.y=i.y,P.z=i.z;var S=P;S.x+=a.x*c,S.y+=a.y*c,S.z+=a.z*c,S.x+=n.x*m,S.y+=n.y*m,S.z+=n.z*m,S.x+=o.x*f,S.y+=o.y*f,S.z+=o.z*f;var T=this._pool,C=0==T.sizeVec3?new r.common.Vec3:T.stackVec3[--T.sizeVec3];C.x=i.x,C.y=i.y,C.z=i.z;var j=C;j.x+=a.x*c,j.y+=a.y*c,j.z+=a.z*c,j.x+=n.x*v,j.y+=n.y*v,j.z+=n.z*v,j.x+=o.x*b,j.y+=o.y*b,j.z+=o.z*b;var R=this._pool,E=0==R.sizeVec3?new r.common.Vec3:R.stackVec3[--R.sizeVec3];E.x=i.x,E.y=i.y,E.z=i.z;var q=E;q.x+=a.x*c,q.y+=a.y*c,q.z+=a.z*c,q.x+=n.x*v,q.y+=n.y*v,q.z+=n.z*v,q.x+=o.x*f,q.y+=o.y*f,q.z+=o.z*f,t.line(d,A,h),t.line(M,j,h),t.line(Y,S,h),t.line(w,q,h),t.line(d,M,h),t.line(A,j,h),t.line(Y,w,h),t.line(S,q,h),t.line(d,Y,h),t.line(A,S,h),t.line(M,w,h),t.line(j,q,h);var D=this._pool;if(null!=d){if(d.zero(),D.sizeVec3==D.stackVec3.length){for(var N=new Array(D.sizeVec3<<1),F=0,G=D.sizeVec3;F<G;){var J=F++;N[J]=D.stackVec3[J],D.stackVec3[J]=null}D.stackVec3=N}D.stackVec3[D.sizeVec3++]=d}var W=this._pool;if(null!=Y){if(Y.zero(),W.sizeVec3==W.stackVec3.length){for(var O=new Array(W.sizeVec3<<1),U=0,H=W.sizeVec3;U<H;){var Q=U++;O[Q]=W.stackVec3[Q],W.stackVec3[Q]=null}W.stackVec3=O}W.stackVec3[W.sizeVec3++]=Y}var K=this._pool;if(null!=M){if(M.zero(),K.sizeVec3==K.stackVec3.length){for(var $=new Array(K.sizeVec3<<1),tt=0,it=K.sizeVec3;tt<it;){var at=tt++;$[at]=K.stackVec3[at],K.stackVec3[at]=null}K.stackVec3=$}K.stackVec3[K.sizeVec3++]=M}var nt=this._pool;if(null!=w){if(w.zero(),nt.sizeVec3==nt.stackVec3.length){for(var ot=new Array(nt.sizeVec3<<1),st=0,rt=nt.sizeVec3;st<rt;){var et=st++;ot[et]=nt.stackVec3[et],nt.stackVec3[et]=null}nt.stackVec3=ot}nt.stackVec3[nt.sizeVec3++]=w}var _t=this._pool;if(null!=A){if(A.zero(),_t.sizeVec3==_t.stackVec3.length){for(var ht=new Array(_t.sizeVec3<<1),lt=0,ct=_t.sizeVec3;lt<ct;){var mt=lt++;ht[mt]=_t.stackVec3[mt],_t.stackVec3[mt]=null}_t.stackVec3=ht}_t.stackVec3[_t.sizeVec3++]=A}var vt=this._pool;if(null!=S){if(S.zero(),vt.sizeVec3==vt.stackVec3.length){for(var bt=new Array(vt.sizeVec3<<1),ft=0,ut=vt.sizeVec3;ft<ut;){var pt=ft++;bt[pt]=vt.stackVec3[pt],vt.stackVec3[pt]=null}vt.stackVec3=bt}vt.stackVec3[vt.sizeVec3++]=S}var xt=this._pool;if(null!=j){if(j.zero(),xt.sizeVec3==xt.stackVec3.length){for(var yt=new Array(xt.sizeVec3<<1),dt=0,gt=xt.sizeVec3;dt<gt;){var Xt=dt++;yt[Xt]=xt.stackVec3[Xt],xt.stackVec3[Xt]=null}xt.stackVec3=yt}xt.stackVec3[xt.sizeVec3++]=j}var Yt=this._pool;if(null!=q){if(q.zero(),Yt.sizeVec3==Yt.stackVec3.length){for(var zt=new Array(Yt.sizeVec3<<1),Zt=0,Mt=Yt.sizeVec3;Zt<Mt;){var It=Zt++;zt[It]=Yt.stackVec3[It],Yt.stackVec3[It]=null}Yt.stackVec3=zt}Yt.stackVec3[Yt.sizeVec3++]=q}},i._drawEllipseOnSphere=function(t,i,a,n,o,s,e,_,h){for(var l=0,c=this._pool,m=0==c.sizeVec3?new r.common.Vec3:c.stackVec3[--c.sizeVec3],v=this._pool,b=0==v.sizeQuat?new r.common.Quat:v.stackQuat[--v.sizeQuat],f=this._pool,u=0==f.sizeMat3?new r.common.Mat3:f.stackMat3[--f.sizeMat3],p=this._pool,x=0==p.sizeVec3?new r.common.Vec3:p.stackVec3[--p.sizeVec3],y=0;y<17;){var d=y++,g=Math.cos(l)*s,X=Math.sin(l)*e,Y=Math.sqrt(g*g+X*X),z=Math.sin(.5*Y),Z=Math.cos(.5*Y),M=m.zero();M.x+=n.x*g,M.y+=n.y*g,M.z+=n.z*g,M.x+=o.x*X,M.y+=o.y*X,M.z+=o.z*X;var I=1/Y*z;m.x*=I,m.y*=I,m.z*=I,b.x=m.x,b.y=m.y,b.z=m.z,b.w=Z;var V=b.x,w=b.y,L=b.z,k=b.w,A=2*V,B=2*w,P=2*L,S=V*A,T=w*B,C=L*P,j=V*B,R=w*P,E=V*P,q=k*A,D=k*B,N=k*P;u.e00=1-T-C,u.e01=j-N,u.e02=E+D,u.e10=j+N,u.e11=1-S-C,u.e12=R-q,u.e20=E-D,u.e21=R+q,u.e22=1-S-T;var F=this._pool,G=0==F.sizeVec3?new r.common.Vec3:F.stackVec3[--F.sizeVec3];G.x+=a.x*_,G.y+=a.y*_,G.z+=a.z*_;var J=G,W=J.x*u.e10+J.y*u.e11+J.z*u.e12,O=J.x*u.e20+J.y*u.e21+J.z*u.e22;J.x=J.x*u.e00+J.y*u.e01+J.z*u.e02,J.y=W,J.z=O,J.x+=i.x,J.y+=i.y,J.z+=i.z,d>=1&&t.line(x,J,h);var U=this._pool;if(null!=x){if(x.zero(),U.sizeVec3==U.stackVec3.length){for(var H=new Array(U.sizeVec3<<1),Q=0,K=U.sizeVec3;Q<K;){var $=Q++;H[$]=U.stackVec3[$],U.stackVec3[$]=null}U.stackVec3=H}U.stackVec3[U.sizeVec3++]=x}x=J,l+=.39269908169872375}var tt=this._pool;if(null!=m){if(m.zero(),tt.sizeVec3==tt.stackVec3.length){for(var it=new Array(tt.sizeVec3<<1),at=0,nt=tt.sizeVec3;at<nt;){var ot=at++;it[ot]=tt.stackVec3[ot],tt.stackVec3[ot]=null}tt.stackVec3=it}tt.stackVec3[tt.sizeVec3++]=m}var st=this._pool;if(null!=b){if(b.x=0,b.y=0,b.z=0,b.w=1,st.sizeQuat==st.stackQuat.length){for(var rt=new Array(st.sizeQuat<<1),et=0,_t=st.sizeQuat;et<_t;){var ht=et++;rt[ht]=st.stackQuat[ht],st.stackQuat[ht]=null}st.stackQuat=rt}st.stackQuat[st.sizeQuat++]=b}var lt=this._pool;if(null!=u){if(u.e00=1,u.e01=0,u.e02=0,u.e10=0,u.e11=1,u.e12=0,u.e20=0,u.e21=0,u.e22=1,lt.sizeMat3==lt.stackMat3.length){for(var ct=new Array(lt.sizeMat3<<1),mt=0,vt=lt.sizeMat3;mt<vt;){var bt=mt++;ct[bt]=lt.stackMat3[bt],lt.stackMat3[bt]=null}lt.stackMat3=ct}lt.stackMat3[lt.sizeMat3++]=u}var ft=this._pool;if(null!=x){if(x.zero(),ft.sizeVec3==ft.stackVec3.length){for(var ut=new Array(ft.sizeVec3<<1),pt=0,xt=ft.sizeVec3;pt<xt;){var yt=pt++;ut[yt]=ft.stackVec3[yt],ft.stackVec3[yt]=null}ft.stackVec3=ut}ft.stackVec3[ft.sizeVec3++]=x}},i.step=function(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;var i=s.now()/1e3;this._updateContacts(),this._solveIslands(),r.dynamics.common.Performance.totalTime=1e3*(s.now()/1e3-i)},i.addRigidBody=function(t){if(null!=t._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;for(var i=t._shapeList;null!=i;){var a=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=a}this._numRigidBodies++},i.removeRigidBody=function(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;for(var n=t._shapeList;null!=n;){var o=n._next;this._broadPhase.destroyProxy(n._proxy),n._proxy=null,n._id=-1;for(var s=n._rigidBody._contactLinkList;null!=s;){var r=s._next,e=s._contact;if(e._s1==n||e._s2==n){var _=s._other;_._sleeping=!1,_._sleepTime=0;var h=this._contactManager,l=e._prev,c=e._next;if(null!=l&&(l._next=c),null!=c&&(c._prev=l),e==h._contactList&&(h._contactList=h._contactList._next),e==h._contactListLast&&(h._contactListLast=h._contactListLast._prev),e._next=null,e._prev=null,e._touching){var m=e._s1._contactCallback,v=e._s2._contactCallback;m==v&&(v=null),null!=m&&m.endContact(e),null!=v&&v.endContact(e)}var b=e._link1._prev,f=e._link1._next;null!=b&&(b._next=f),null!=f&&(f._prev=b),e._link1==e._b1._contactLinkList&&(e._b1._contactLinkList=e._b1._contactLinkList._next),e._link1==e._b1._contactLinkListLast&&(e._b1._contactLinkListLast=e._b1._contactLinkListLast._prev),e._link1._next=null,e._link1._prev=null;var u=e._link2._prev,p=e._link2._next;null!=u&&(u._next=p),null!=p&&(p._prev=u),e._link2==e._b2._contactLinkList&&(e._b2._contactLinkList=e._b2._contactLinkList._next),e._link2==e._b2._contactLinkListLast&&(e._b2._contactLinkListLast=e._b2._contactLinkListLast._prev),e._link2._next=null,e._link2._prev=null,e._b1._numContactLinks--,e._b2._numContactLinks--,e._link1._other=null,e._link2._other=null,e._link1._contact=null,e._link2._contact=null,e._s1=null,e._s2=null,e._b1=null,e._b2=null,e._touching=!1,e._cachedDetectorData._clear(),e._manifold._clear(),e._detector=null;var x=e._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,e._next=h._contactPool,h._contactPool=e,h._numContacts--}s=r}this._numShapes--,n=o}this._numRigidBodies--},i.addJoint=function(t){if(null!=t._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,null==t._b1._jointLinkList?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),null==t._b2._jointLinkList?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;var i=t._b1;i._sleeping=!1,i._sleepTime=0;var a=t._b2;a._sleeping=!1,a._sleepTime=0,t._syncAnchors(),this._numJoints++},i.removeJoint=function(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;var n=t._link1._prev,o=t._link1._next;null!=n&&(n._next=o),null!=o&&(o._prev=n),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var s=t._link2._prev,r=t._link2._next;null!=s&&(s._next=r),null!=r&&(r._prev=s),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;var e=t._b1;e._sleeping=!1,e._sleepTime=0;var _=t._b2;_._sleeping=!1,_._sleepTime=0,this._numJoints--},i.setDebugDraw=function(t){this._debugDraw=t},i.getDebugDraw=function(){return this._debugDraw},i.debugDraw=function(){null!=this._debugDraw&&(2==this._broadPhase._type&&this._drawBvh(this._debugDraw,this._broadPhase._tree),this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw))},i.rayCast=function(t,i,a){var n=this._rayCastWrapper.begin;n.x=t.x,n.y=t.y,n.z=t.z;var o=this._rayCastWrapper.end;o.x=i.x,o.y=i.y,o.z=i.z,this._rayCastWrapper.callback=a,this._broadPhase.rayCast(t,i,this._rayCastWrapper)},i.convexCast=function(t,i,a,n){this._convexCastWrapper.convex=t;var o=this._convexCastWrapper.begin;o._positionX=i._positionX,o._positionY=i._positionY,o._positionZ=i._positionZ,o._rotation00=i._rotation00,o._rotation01=i._rotation01,o._rotation02=i._rotation02,o._rotation10=i._rotation10,o._rotation11=i._rotation11,o._rotation12=i._rotation12,o._rotation20=i._rotation20,o._rotation21=i._rotation21,o._rotation22=i._rotation22;var s=this._convexCastWrapper.translation;s.x=a.x,s.y=a.y,s.z=a.z,this._convexCastWrapper.callback=n,this._broadPhase.convexCast(t,i,a,this._convexCastWrapper)},i.aabbTest=function(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)},i.getRigidBodyList=function(){return this._rigidBodyList},i.getJointList=function(){return this._jointList},i.getBroadPhase=function(){return this._broadPhase},i.getContactManager=function(){return this._contactManager},i.getNumRigidBodies=function(){return this._numRigidBodies},i.getNumJoints=function(){return this._numJoints},i.getNumShapes=function(){return this._numShapes},i.getNumIslands=function(){return this._numIslands},i.getNumVelocityIterations=function(){return this._numVelocityIterations},i.setNumVelocityIterations=function(t){this._numVelocityIterations=t},i.getNumPositionIterations=function(){return this._numPositionIterations},i.setNumPositionIterations=function(t){this._numPositionIterations=t},i.getGravity=function(){return this._gravity},i.setGravity=function(t){var i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z},t}(),r.dynamics._World||(r.dynamics._World={}),r.dynamics._World.RayCastWrapper=function(t){function i(){var i;return(i=t.call(this)||this).rayCastHit=new r.collision.geometry.RayCastHit,i.begin=new r.common.Vec3,i.end=new r.common.Vec3,i.callback=null,i}return a(i,t),i.prototype.process=function(t){var i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)},i}(r.collision.broadphase.BroadPhaseProxyCallback),r.dynamics._World.ConvexCastWrapper=function(t){function i(){var i;return(i=t.call(this)||this).rayCastHit=new r.collision.geometry.RayCastHit,i.begin=new r.common.Transform,i.translation=new r.common.Vec3,i.zero=new r.common.Vec3,i.callback=null,i.convex=null,i}return a(i,t),i.prototype.process=function(t){var i=t.userData,a=i._geom._type;a<0||a>5||r.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,i._geom,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)},i}(r.collision.broadphase.BroadPhaseProxyCallback),r.dynamics._World.AabbTestWrapper=function(t){function i(){var i;return(i=t.call(this)||this)._aabb=new r.collision.geometry.Aabb,i._callback=null,i}return a(i,t),i.prototype.process=function(t){var i=t.userData,a=i._aabb;a._minX<this._aabb._maxX&&a._maxX>this._aabb._minX&&a._minY<this._aabb._maxY&&a._maxY>this._aabb._minY&&a._minZ<this._aabb._maxZ&&a._maxZ>this._aabb._minZ&&this._callback.process(i)},i}(r.collision.broadphase.BroadPhaseProxyCallback),r.dynamics.callback||(r.dynamics.callback={}),r.dynamics.callback.AabbTestCallback=function(){function t(){}return t.prototype.process=function(t){},t}(),r.dynamics.callback.ContactCallback=function(){function t(){}var i=t.prototype;return i.beginContact=function(t){},i.preSolve=function(t){},i.postSolve=function(t){},i.endContact=function(t){},t}(),r.dynamics.callback.RayCastCallback=function(){function t(){}return t.prototype.process=function(t,i){},t}(),r.dynamics.callback.RayCastClosest=function(t){function i(){var i;return(i=t.call(this)||this).position=new r.common.Vec3,i.normal=new r.common.Vec3,i.shape=null,i.fraction=1,i.position.zero(),i.normal.zero(),i.hit=!1,i}a(i,t);var n=i.prototype;return n.clear=function(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1},n.process=function(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;var a=this.position,n=i.position;a.x=n.x,a.y=n.y,a.z=n.z;var o=this.normal,s=i.normal;o.x=s.x,o.y=s.y,o.z=s.z}},i}(r.dynamics.callback.RayCastCallback),r.dynamics.common||(r.dynamics.common={}),r.dynamics.common.DebugDraw=function(){function t(){this.p=new r.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1,this.sphereCoords=new Array(5),this.tmpSphereVerts=new Array(5),this.tmpSphereNorms=new Array(5);for(var t=0;t<5;){var i=t++,a=0==i||4==i?1:8;this.sphereCoords[i]=new Array(a),this.tmpSphereVerts[i]=new Array(a),this.tmpSphereNorms[i]=new Array(a);for(var n=0;n<8;){var o=n++,s=.7853981633974475*i,e=.7853981633974475*o;this.sphereCoords[i][o]=new r.common.Vec3(Math.sin(s)*Math.cos(e),Math.cos(s),-Math.sin(s)*Math.sin(e)),this.tmpSphereVerts[i][o]=new r.common.Vec3,this.tmpSphereNorms[i][o]=new r.common.Vec3}}this.circleCoords=new Array(8),this.circleCoordsShift=new Array(8),this.tmpCircleVerts1=new Array(8),this.tmpCircleVerts2=new Array(8),this.tmpCircleNorms=new Array(8);for(var _=0;_<8;){var h=_++;this.circleCoords[h]=new r.common.Vec3(Math.cos(.7853981633974475*h),0,-Math.sin(.7853981633974475*h)),this.circleCoordsShift[h]=new r.common.Vec3(Math.cos(.7853981633974475*(h+.5)),0,-Math.sin(.7853981633974475*(h+.5))),this.tmpCircleVerts1[h]=new r.common.Vec3,this.tmpCircleVerts2[h]=new r.common.Vec3,this.tmpCircleNorms[h]=new r.common.Vec3}this.style=new r.dynamics.common.DebugDrawStyle}var i=t.prototype;return i.aabb=function(t,i,a){var n=this.p,o=(0==n.sizeVec3?new r.common.Vec3:n.stackVec3[--n.sizeVec3]).init(t.x,t.y,t.z),s=this.p,e=(0==s.sizeVec3?new r.common.Vec3:s.stackVec3[--s.sizeVec3]).init(t.x,t.y,i.z),_=this.p,h=(0==_.sizeVec3?new r.common.Vec3:_.stackVec3[--_.sizeVec3]).init(t.x,i.y,t.z),l=this.p,c=(0==l.sizeVec3?new r.common.Vec3:l.stackVec3[--l.sizeVec3]).init(t.x,i.y,i.z),m=this.p,v=(0==m.sizeVec3?new r.common.Vec3:m.stackVec3[--m.sizeVec3]).init(i.x,t.y,t.z),b=this.p,f=(0==b.sizeVec3?new r.common.Vec3:b.stackVec3[--b.sizeVec3]).init(i.x,t.y,i.z),u=this.p,p=(0==u.sizeVec3?new r.common.Vec3:u.stackVec3[--u.sizeVec3]).init(i.x,i.y,t.z),x=this.p,y=(0==x.sizeVec3?new r.common.Vec3:x.stackVec3[--x.sizeVec3]).init(i.x,i.y,i.z);this.line(o,e,a),this.line(h,c,a),this.line(v,f,a),this.line(p,y,a),this.line(o,h,a),this.line(e,c,a),this.line(v,p,a),this.line(f,y,a),this.line(o,v,a),this.line(e,f,a),this.line(h,p,a),this.line(c,y,a);var d=this.p;if(null!=o){if(o.zero(),d.sizeVec3==d.stackVec3.length){for(var g=new Array(d.sizeVec3<<1),X=0,Y=d.sizeVec3;X<Y;){var z=X++;g[z]=d.stackVec3[z],d.stackVec3[z]=null}d.stackVec3=g}d.stackVec3[d.sizeVec3++]=o}var Z=this.p;if(null!=e){if(e.zero(),Z.sizeVec3==Z.stackVec3.length){for(var M=new Array(Z.sizeVec3<<1),I=0,V=Z.sizeVec3;I<V;){var w=I++;M[w]=Z.stackVec3[w],Z.stackVec3[w]=null}Z.stackVec3=M}Z.stackVec3[Z.sizeVec3++]=e}var L=this.p;if(null!=h){if(h.zero(),L.sizeVec3==L.stackVec3.length){for(var k=new Array(L.sizeVec3<<1),A=0,B=L.sizeVec3;A<B;){var P=A++;k[P]=L.stackVec3[P],L.stackVec3[P]=null}L.stackVec3=k}L.stackVec3[L.sizeVec3++]=h}var S=this.p;if(null!=c){if(c.zero(),S.sizeVec3==S.stackVec3.length){for(var T=new Array(S.sizeVec3<<1),C=0,j=S.sizeVec3;C<j;){var R=C++;T[R]=S.stackVec3[R],S.stackVec3[R]=null}S.stackVec3=T}S.stackVec3[S.sizeVec3++]=c}var E=this.p;if(null!=v){if(v.zero(),E.sizeVec3==E.stackVec3.length){for(var q=new Array(E.sizeVec3<<1),D=0,N=E.sizeVec3;D<N;){var F=D++;q[F]=E.stackVec3[F],E.stackVec3[F]=null}E.stackVec3=q}E.stackVec3[E.sizeVec3++]=v}var G=this.p;if(null!=f){if(f.zero(),G.sizeVec3==G.stackVec3.length){for(var J=new Array(G.sizeVec3<<1),W=0,O=G.sizeVec3;W<O;){var U=W++;J[U]=G.stackVec3[U],G.stackVec3[U]=null}G.stackVec3=J}G.stackVec3[G.sizeVec3++]=f}var H=this.p;if(null!=p){if(p.zero(),H.sizeVec3==H.stackVec3.length){for(var Q=new Array(H.sizeVec3<<1),K=0,$=H.sizeVec3;K<$;){var tt=K++;Q[tt]=H.stackVec3[tt],H.stackVec3[tt]=null}H.stackVec3=Q}H.stackVec3[H.sizeVec3++]=p}var it=this.p;if(null!=y){if(y.zero(),it.sizeVec3==it.stackVec3.length){for(var at=new Array(it.sizeVec3<<1),nt=0,ot=it.sizeVec3;nt<ot;){var st=nt++;at[st]=it.stackVec3[st],it.stackVec3[st]=null}it.stackVec3=at}it.stackVec3[it.sizeVec3++]=y}},i.basis=function(t,i,a,n,o){var s=this.p,e=0==s.sizeVec3?new r.common.Vec3:s.stackVec3[--s.sizeVec3],_=this.p,h=0==_.sizeMat3?new r.common.Mat3:_.stackMat3[--_.sizeMat3],l=this.p,c=0==l.sizeVec3?new r.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,v=0==m.sizeVec3?new r.common.Vec3:m.stackVec3[--m.sizeVec3],b=this.p,f=0==b.sizeVec3?new r.common.Vec3:b.stackVec3[--b.sizeVec3],u=e;u.x=t._positionX,u.y=t._positionY,u.z=t._positionZ;var p=h;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,c.init(h.e00,h.e10,h.e20),v.init(h.e01,h.e11,h.e21),f.init(h.e02,h.e12,h.e22),c.x*=i,c.y*=i,c.z*=i;var x=c;x.x+=e.x,x.y+=e.y,x.z+=e.z,v.x*=i,v.y*=i,v.z*=i;var y=v;y.x+=e.x,y.y+=e.y,y.z+=e.z,f.x*=i,f.y*=i,f.z*=i;var d=f;d.x+=e.x,d.y+=e.y,d.z+=e.z,this.line(e,c,a),this.line(e,v,n),this.line(e,f,o);var g=this.p;if(null!=e){if(e.zero(),g.sizeVec3==g.stackVec3.length){for(var X=new Array(g.sizeVec3<<1),Y=0,z=g.sizeVec3;Y<z;){var Z=Y++;X[Z]=g.stackVec3[Z],g.stackVec3[Z]=null}g.stackVec3=X}g.stackVec3[g.sizeVec3++]=e}var M=this.p;if(null!=h){if(h.e00=1,h.e01=0,h.e02=0,h.e10=0,h.e11=1,h.e12=0,h.e20=0,h.e21=0,h.e22=1,M.sizeMat3==M.stackMat3.length){for(var I=new Array(M.sizeMat3<<1),V=0,w=M.sizeMat3;V<w;){var L=V++;I[L]=M.stackMat3[L],M.stackMat3[L]=null}M.stackMat3=I}M.stackMat3[M.sizeMat3++]=h}var k=this.p;if(null!=c){if(c.zero(),k.sizeVec3==k.stackVec3.length){for(var A=new Array(k.sizeVec3<<1),B=0,P=k.sizeVec3;B<P;){var S=B++;A[S]=k.stackVec3[S],k.stackVec3[S]=null}k.stackVec3=A}k.stackVec3[k.sizeVec3++]=c}var T=this.p;if(null!=v){if(v.zero(),T.sizeVec3==T.stackVec3.length){for(var C=new Array(T.sizeVec3<<1),j=0,R=T.sizeVec3;j<R;){var E=j++;C[E]=T.stackVec3[E],T.stackVec3[E]=null}T.stackVec3=C}T.stackVec3[T.sizeVec3++]=v}var q=this.p;if(null!=f){if(f.zero(),q.sizeVec3==q.stackVec3.length){for(var D=new Array(q.sizeVec3<<1),N=0,F=q.sizeVec3;N<F;){var G=N++;D[G]=q.stackVec3[G],q.stackVec3[G]=null}q.stackVec3=D}q.stackVec3[q.sizeVec3++]=f}},i.ellipse=function(t,i,a,n,o,s){this.arc(t,i,a,n,o,0,6.28318530717958,!1,s)},i.arc=function(t,i,a,n,o,s,e,_,h){var l=this.p,c=0==l.sizeVec3?new r.common.Vec3:l.stackVec3[--l.sizeVec3];c.x=i.x,c.y=i.y,c.z=i.z;var m=c;m.x*=n,m.y*=n,m.z*=n,i=m;var v=this.p,b=0==v.sizeVec3?new r.common.Vec3:v.stackVec3[--v.sizeVec3];b.x=a.x,b.y=a.y,b.z=a.z;var f=b;f.x*=o,f.y*=o,f.z*=o,a=f;var u=e-s;u<0&&(u=-u);var p=u/.5235987755982984+.5|0;0==p&&(p=1);var x=s,y=(e-s)/p,d=this.p,g=0==d.sizeVec3?new r.common.Vec3:d.stackVec3[--d.sizeVec3];g.x=t.x,g.y=t.y,g.z=t.z;var X=g,Y=Math.cos(s);X.x+=m.x*Y,X.y+=m.y*Y,X.z+=m.z*Y;var z=Math.sin(s);X.x+=f.x*z,X.y+=f.y*z,X.z+=f.z*z;var Z=X;_&&this.line(t,X,h);for(var M=0,I=p;M<I;){++M,x+=y;var V=this.p,w=0==V.sizeVec3?new r.common.Vec3:V.stackVec3[--V.sizeVec3];w.x=t.x,w.y=t.y,w.z=t.z;var L=w,k=Math.cos(x);L.x+=m.x*k,L.y+=m.y*k,L.z+=m.z*k;var A=Math.sin(x);L.x+=f.x*A,L.y+=f.y*A,L.z+=f.z*A,this.line(Z,L,h);var B=this.p;if(null!=Z){if(Z.zero(),B.sizeVec3==B.stackVec3.length){for(var P=new Array(B.sizeVec3<<1),S=0,T=B.sizeVec3;S<T;){var C=S++;P[C]=B.stackVec3[C],B.stackVec3[C]=null}B.stackVec3=P}B.stackVec3[B.sizeVec3++]=Z}Z=L}_&&this.line(t,Z,h);var j=this.p;if(null!=Z){if(Z.zero(),j.sizeVec3==j.stackVec3.length){for(var R=new Array(j.sizeVec3<<1),E=0,q=j.sizeVec3;E<q;){var D=E++;R[D]=j.stackVec3[D],j.stackVec3[D]=null}j.stackVec3=R}j.stackVec3[j.sizeVec3++]=Z}var N=this.p;if(null!=m){if(m.zero(),N.sizeVec3==N.stackVec3.length){for(var F=new Array(N.sizeVec3<<1),G=0,J=N.sizeVec3;G<J;){var W=G++;F[W]=N.stackVec3[W],N.stackVec3[W]=null}N.stackVec3=F}N.stackVec3[N.sizeVec3++]=m}var O=this.p;if(null!=f){if(f.zero(),O.sizeVec3==O.stackVec3.length){for(var U=new Array(O.sizeVec3<<1),H=0,Q=O.sizeVec3;H<Q;){var K=H++;U[K]=O.stackVec3[K],O.stackVec3[K]=null}O.stackVec3=U}O.stackVec3[O.sizeVec3++]=f}},i.cone=function(t,i,a,n){var o=this.p,s=0==o.sizeVec3?new r.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,_=0==e.sizeVec3?new r.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,l=0==h.sizeVec3?new r.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeVec3?new r.common.Vec3:c.stackVec3[--c.sizeVec3],v=this.p,b=0==v.sizeMat3?new r.common.Mat3:v.stackMat3[--v.sizeMat3],f=m;f.x=t._positionX,f.y=t._positionY,f.z=t._positionZ;var u=b;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,s.init(b.e00,b.e10,b.e20),_.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);var p=this.p,x=0==p.sizeVec3?new r.common.Vec3:p.stackVec3[--p.sizeVec3];x.x=m.x,x.y=m.y,x.z=m.z;var y=x;y.x+=_.x*a,y.y+=_.y*a,y.z+=_.z*a;var d=this.p,g=0==d.sizeVec3?new r.common.Vec3:d.stackVec3[--d.sizeVec3];g.x=m.x,g.y=m.y,g.z=m.z;var X=g,Y=-a;if(X.x+=_.x*Y,X.y+=_.y*Y,X.z+=_.z*Y,this.wireframe){var z=this.p,Z=0==z.sizeVec3?new r.common.Vec3:z.stackVec3[--z.sizeVec3];Z.x=X.x,Z.y=X.y,Z.z=X.z;var M=Z,I=-i;M.x+=s.x*I,M.y+=s.y*I,M.z+=s.z*I,M.x+=0*l.x,M.y+=0*l.y,M.z+=0*l.z;var V=this.p,w=0==V.sizeVec3?new r.common.Vec3:V.stackVec3[--V.sizeVec3];w.x=X.x,w.y=X.y,w.z=X.z;var L=w;L.x+=s.x*i,L.y+=s.y*i,L.z+=s.z*i,L.x+=0*l.x,L.y+=0*l.y,L.z+=0*l.z;var k=this.p,A=0==k.sizeVec3?new r.common.Vec3:k.stackVec3[--k.sizeVec3];A.x=X.x,A.y=X.y,A.z=X.z;var B=A;B.x+=0*s.x,B.y+=0*s.y,B.z+=0*s.z;var P=-i;B.x+=l.x*P,B.y+=l.y*P,B.z+=l.z*P;var S=this.p,T=0==S.sizeVec3?new r.common.Vec3:S.stackVec3[--S.sizeVec3];T.x=X.x,T.y=X.y,T.z=X.z;var C=T;C.x+=0*s.x,C.y+=0*s.y,C.z+=0*s.z,C.x+=l.x*i,C.y+=l.y*i,C.z+=l.z*i,this.ellipse(X,s,l,i,i,n),this.line(y,M,n),this.line(y,L,n),this.line(y,B,n),this.line(y,C,n);var j=this.p;if(null!=M){if(M.zero(),j.sizeVec3==j.stackVec3.length){for(var R=new Array(j.sizeVec3<<1),E=0,q=j.sizeVec3;E<q;){var D=E++;R[D]=j.stackVec3[D],j.stackVec3[D]=null}j.stackVec3=R}j.stackVec3[j.sizeVec3++]=M}var N=this.p;if(null!=L){if(L.zero(),N.sizeVec3==N.stackVec3.length){for(var F=new Array(N.sizeVec3<<1),G=0,J=N.sizeVec3;G<J;){var W=G++;F[W]=N.stackVec3[W],N.stackVec3[W]=null}N.stackVec3=F}N.stackVec3[N.sizeVec3++]=L}var O=this.p;if(null!=B){if(B.zero(),O.sizeVec3==O.stackVec3.length){for(var U=new Array(O.sizeVec3<<1),H=0,Q=O.sizeVec3;H<Q;){var K=H++;U[K]=O.stackVec3[K],O.stackVec3[K]=null}O.stackVec3=U}O.stackVec3[O.sizeVec3++]=B}var $=this.p;if(null!=C){if(C.zero(),$.sizeVec3==$.stackVec3.length){for(var tt=new Array($.sizeVec3<<1),it=0,at=$.sizeVec3;it<at;){var nt=it++;tt[nt]=$.stackVec3[nt],$.stackVec3[nt]=null}$.stackVec3=tt}$.stackVec3[$.sizeVec3++]=C}}else{for(var ot=1/Math.sqrt(i*i+4*a*a),st=2*a*ot,rt=i*ot,et=0;et<8;){var _t=et++,ht=this.tmpCircleNorms[_t],lt=this.circleCoords[_t];ht.x=lt.x,ht.y=lt.y,ht.z=lt.z,ht.x*=st,ht.y*=st,ht.z*=st,ht.y+=rt;var ct=this.tmpCircleNorms[_t],mt=ct.x*b.e10+ct.y*b.e11+ct.z*b.e12,vt=ct.x*b.e20+ct.y*b.e21+ct.z*b.e22;ct.x=ct.x*b.e00+ct.y*b.e01+ct.z*b.e02,ct.y=mt,ct.z=vt;var bt=this.tmpCircleVerts1[_t],ft=this.circleCoordsShift[_t];bt.x=ft.x,bt.y=ft.y,bt.z=ft.z,bt.x*=st,bt.y*=st,bt.z*=st,bt.y+=rt;var ut=this.tmpCircleVerts1[_t],pt=ut.x*b.e10+ut.y*b.e11+ut.z*b.e12,xt=ut.x*b.e20+ut.y*b.e21+ut.z*b.e22;ut.x=ut.x*b.e00+ut.y*b.e01+ut.z*b.e02,ut.y=pt,ut.z=xt;var yt=this.tmpCircleVerts2[_t],dt=this.circleCoords[_t];yt.x=dt.x,yt.y=dt.y,yt.z=dt.z;var gt=yt.x*b.e10+yt.y*b.e11+yt.z*b.e12,Xt=yt.x*b.e20+yt.y*b.e21+yt.z*b.e22;yt.x=yt.x*b.e00+yt.y*b.e01+yt.z*b.e02,yt.y=gt,yt.z=Xt,yt.x*=i,yt.y*=i,yt.z*=i,yt.x+=m.x,yt.y+=m.y,yt.z+=m.z;var Yt=this.tmpCircleVerts2[_t],zt=-a;Yt.x+=_.x*zt,Yt.y+=_.y*zt,Yt.z+=_.z*zt}for(var Zt=0;Zt<8;){var Mt=Zt++,It=this.tmpCircleVerts2[Mt],Vt=this.tmpCircleVerts2[(Mt+1)%8],wt=this.tmpCircleVerts1[Mt];this.triangle(y,It,Vt,wt,this.tmpCircleNorms[Mt],this.tmpCircleNorms[(Mt+1)%8],n),It=this.tmpCircleVerts2[(Mt+1)%8],Vt=this.tmpCircleVerts2[Mt];var Lt=this.p,kt=0==Lt.sizeVec3?new r.common.Vec3:Lt.stackVec3[--Lt.sizeVec3];kt.x=_.x,kt.y=_.y,kt.z=_.z;var At=kt;At.x=-At.x,At.y=-At.y,At.z=-At.z,wt=At,this.triangle(X,It,Vt,At,At,At,n);var Bt=this.p;if(null!=At){if(At.zero(),Bt.sizeVec3==Bt.stackVec3.length){for(var Pt=new Array(Bt.sizeVec3<<1),St=0,Tt=Bt.sizeVec3;St<Tt;){var Ct=St++;Pt[Ct]=Bt.stackVec3[Ct],Bt.stackVec3[Ct]=null}Bt.stackVec3=Pt}Bt.stackVec3[Bt.sizeVec3++]=At}}}var jt=this.p;if(null!=y){if(y.zero(),jt.sizeVec3==jt.stackVec3.length){for(var Rt=new Array(jt.sizeVec3<<1),Et=0,qt=jt.sizeVec3;Et<qt;){var Dt=Et++;Rt[Dt]=jt.stackVec3[Dt],jt.stackVec3[Dt]=null}jt.stackVec3=Rt}jt.stackVec3[jt.sizeVec3++]=y}var Nt=this.p;if(null!=X){if(X.zero(),Nt.sizeVec3==Nt.stackVec3.length){for(var Ft=new Array(Nt.sizeVec3<<1),Gt=0,Jt=Nt.sizeVec3;Gt<Jt;){var Wt=Gt++;Ft[Wt]=Nt.stackVec3[Wt],Nt.stackVec3[Wt]=null}Nt.stackVec3=Ft}Nt.stackVec3[Nt.sizeVec3++]=X}var Ot=this.p;if(null!=m){if(m.zero(),Ot.sizeVec3==Ot.stackVec3.length){for(var Ut=new Array(Ot.sizeVec3<<1),Ht=0,Qt=Ot.sizeVec3;Ht<Qt;){var Kt=Ht++;Ut[Kt]=Ot.stackVec3[Kt],Ot.stackVec3[Kt]=null}Ot.stackVec3=Ut}Ot.stackVec3[Ot.sizeVec3++]=m}var $t=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,$t.sizeMat3==$t.stackMat3.length){for(var ti=new Array($t.sizeMat3<<1),ii=0,ai=$t.sizeMat3;ii<ai;){var ni=ii++;ti[ni]=$t.stackMat3[ni],$t.stackMat3[ni]=null}$t.stackMat3=ti}$t.stackMat3[$t.sizeMat3++]=b}var oi=this.p;if(null!=s){if(s.zero(),oi.sizeVec3==oi.stackVec3.length){for(var si=new Array(oi.sizeVec3<<1),ri=0,ei=oi.sizeVec3;ri<ei;){var _i=ri++;si[_i]=oi.stackVec3[_i],oi.stackVec3[_i]=null}oi.stackVec3=si}oi.stackVec3[oi.sizeVec3++]=s}var hi=this.p;if(null!=_){if(_.zero(),hi.sizeVec3==hi.stackVec3.length){for(var li=new Array(hi.sizeVec3<<1),ci=0,mi=hi.sizeVec3;ci<mi;){var vi=ci++;li[vi]=hi.stackVec3[vi],hi.stackVec3[vi]=null}hi.stackVec3=li}hi.stackVec3[hi.sizeVec3++]=_}var bi=this.p;if(null!=l){if(l.zero(),bi.sizeVec3==bi.stackVec3.length){for(var fi=new Array(bi.sizeVec3<<1),ui=0,pi=bi.sizeVec3;ui<pi;){var xi=ui++;fi[xi]=bi.stackVec3[xi],bi.stackVec3[xi]=null}bi.stackVec3=fi}bi.stackVec3[bi.sizeVec3++]=l}},i.cylinder=function(t,i,a,n){var o=this.p,s=0==o.sizeVec3?new r.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,_=0==e.sizeVec3?new r.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,l=0==h.sizeVec3?new r.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeVec3?new r.common.Vec3:c.stackVec3[--c.sizeVec3],v=this.p,b=0==v.sizeMat3?new r.common.Mat3:v.stackMat3[--v.sizeMat3],f=m;f.x=t._positionX,f.y=t._positionY,f.z=t._positionZ;var u=b;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,s.init(b.e00,b.e10,b.e20),_.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);var p=this.p,x=0==p.sizeVec3?new r.common.Vec3:p.stackVec3[--p.sizeVec3];x.x=m.x,x.y=m.y,x.z=m.z;var y=x;y.x+=_.x*a,y.y+=_.y*a,y.z+=_.z*a;var d=this.p,g=0==d.sizeVec3?new r.common.Vec3:d.stackVec3[--d.sizeVec3];g.x=m.x,g.y=m.y,g.z=m.z;var X=g,Y=-a;if(X.x+=_.x*Y,X.y+=_.y*Y,X.z+=_.z*Y,this.wireframe){var z=this.p,Z=0==z.sizeVec3?new r.common.Vec3:z.stackVec3[--z.sizeVec3];Z.x=y.x,Z.y=y.y,Z.z=y.z;var M=Z,I=-i;M.x+=s.x*I,M.y+=s.y*I,M.z+=s.z*I,M.x+=0*l.x,M.y+=0*l.y,M.z+=0*l.z;var V=this.p,w=0==V.sizeVec3?new r.common.Vec3:V.stackVec3[--V.sizeVec3];w.x=y.x,w.y=y.y,w.z=y.z;var L=w;L.x+=s.x*i,L.y+=s.y*i,L.z+=s.z*i,L.x+=0*l.x,L.y+=0*l.y,L.z+=0*l.z;var k=this.p,A=0==k.sizeVec3?new r.common.Vec3:k.stackVec3[--k.sizeVec3];A.x=y.x,A.y=y.y,A.z=y.z;var B=A;B.x+=0*s.x,B.y+=0*s.y,B.z+=0*s.z;var P=-i;B.x+=l.x*P,B.y+=l.y*P,B.z+=l.z*P;var S=this.p,T=0==S.sizeVec3?new r.common.Vec3:S.stackVec3[--S.sizeVec3];T.x=y.x,T.y=y.y,T.z=y.z;var C=T;C.x+=0*s.x,C.y+=0*s.y,C.z+=0*s.z,C.x+=l.x*i,C.y+=l.y*i,C.z+=l.z*i;var j=this.p,R=0==j.sizeVec3?new r.common.Vec3:j.stackVec3[--j.sizeVec3];R.x=X.x,R.y=X.y,R.z=X.z;var E=R,q=-i;E.x+=s.x*q,E.y+=s.y*q,E.z+=s.z*q,E.x+=0*l.x,E.y+=0*l.y,E.z+=0*l.z;var D=this.p,N=0==D.sizeVec3?new r.common.Vec3:D.stackVec3[--D.sizeVec3];N.x=X.x,N.y=X.y,N.z=X.z;var F=N;F.x+=s.x*i,F.y+=s.y*i,F.z+=s.z*i,F.x+=0*l.x,F.y+=0*l.y,F.z+=0*l.z;var G=this.p,J=0==G.sizeVec3?new r.common.Vec3:G.stackVec3[--G.sizeVec3];J.x=X.x,J.y=X.y,J.z=X.z;var W=J;W.x+=0*s.x,W.y+=0*s.y,W.z+=0*s.z;var O=-i;W.x+=l.x*O,W.y+=l.y*O,W.z+=l.z*O;var U=this.p,H=0==U.sizeVec3?new r.common.Vec3:U.stackVec3[--U.sizeVec3];H.x=X.x,H.y=X.y,H.z=X.z;var Q=H;Q.x+=0*s.x,Q.y+=0*s.y,Q.z+=0*s.z,Q.x+=l.x*i,Q.y+=l.y*i,Q.z+=l.z*i,this.ellipse(y,s,l,i,i,n),this.ellipse(X,s,l,i,i,n),this.line(M,E,n),this.line(L,F,n),this.line(B,W,n),this.line(C,Q,n);var K=this.p;if(null!=M){if(M.zero(),K.sizeVec3==K.stackVec3.length){for(var $=new Array(K.sizeVec3<<1),tt=0,it=K.sizeVec3;tt<it;){var at=tt++;$[at]=K.stackVec3[at],K.stackVec3[at]=null}K.stackVec3=$}K.stackVec3[K.sizeVec3++]=M}var nt=this.p;if(null!=L){if(L.zero(),nt.sizeVec3==nt.stackVec3.length){for(var ot=new Array(nt.sizeVec3<<1),st=0,rt=nt.sizeVec3;st<rt;){var et=st++;ot[et]=nt.stackVec3[et],nt.stackVec3[et]=null}nt.stackVec3=ot}nt.stackVec3[nt.sizeVec3++]=L}var _t=this.p;if(null!=B){if(B.zero(),_t.sizeVec3==_t.stackVec3.length){for(var ht=new Array(_t.sizeVec3<<1),lt=0,ct=_t.sizeVec3;lt<ct;){var mt=lt++;ht[mt]=_t.stackVec3[mt],_t.stackVec3[mt]=null}_t.stackVec3=ht}_t.stackVec3[_t.sizeVec3++]=B}var vt=this.p;if(null!=C){if(C.zero(),vt.sizeVec3==vt.stackVec3.length){for(var bt=new Array(vt.sizeVec3<<1),ft=0,ut=vt.sizeVec3;ft<ut;){var pt=ft++;bt[pt]=vt.stackVec3[pt],vt.stackVec3[pt]=null}vt.stackVec3=bt}vt.stackVec3[vt.sizeVec3++]=C}var xt=this.p;if(null!=E){if(E.zero(),xt.sizeVec3==xt.stackVec3.length){for(var yt=new Array(xt.sizeVec3<<1),dt=0,gt=xt.sizeVec3;dt<gt;){var Xt=dt++;yt[Xt]=xt.stackVec3[Xt],xt.stackVec3[Xt]=null}xt.stackVec3=yt}xt.stackVec3[xt.sizeVec3++]=E}var Yt=this.p;if(null!=F){if(F.zero(),Yt.sizeVec3==Yt.stackVec3.length){for(var zt=new Array(Yt.sizeVec3<<1),Zt=0,Mt=Yt.sizeVec3;Zt<Mt;){var It=Zt++;zt[It]=Yt.stackVec3[It],Yt.stackVec3[It]=null}Yt.stackVec3=zt}Yt.stackVec3[Yt.sizeVec3++]=F}var Vt=this.p;if(null!=W){if(W.zero(),Vt.sizeVec3==Vt.stackVec3.length){for(var wt=new Array(Vt.sizeVec3<<1),Lt=0,kt=Vt.sizeVec3;Lt<kt;){var At=Lt++;wt[At]=Vt.stackVec3[At],Vt.stackVec3[At]=null}Vt.stackVec3=wt}Vt.stackVec3[Vt.sizeVec3++]=W}var Bt=this.p;if(null!=Q){if(Q.zero(),Bt.sizeVec3==Bt.stackVec3.length){for(var Pt=new Array(Bt.sizeVec3<<1),St=0,Tt=Bt.sizeVec3;St<Tt;){var Ct=St++;Pt[Ct]=Bt.stackVec3[Ct],Bt.stackVec3[Ct]=null}Bt.stackVec3=Pt}Bt.stackVec3[Bt.sizeVec3++]=Q}}else{for(var jt=0;jt<8;){var Rt=jt++,Et=this.tmpCircleNorms[Rt],qt=this.circleCoords[Rt];Et.x=qt.x,Et.y=qt.y,Et.z=qt.z;var Dt=Et.x*b.e10+Et.y*b.e11+Et.z*b.e12,Nt=Et.x*b.e20+Et.y*b.e21+Et.z*b.e22;Et.x=Et.x*b.e00+Et.y*b.e01+Et.z*b.e02,Et.y=Dt,Et.z=Nt;var Ft=this.tmpCircleVerts1[Rt],Gt=this.tmpCircleNorms[Rt];Ft.x=Gt.x,Ft.y=Gt.y,Ft.z=Gt.z,Ft.x*=i,Ft.y*=i,Ft.z*=i,Ft.x+=m.x,Ft.y+=m.y,Ft.z+=m.z;var Jt=this.tmpCircleVerts2[Rt],Wt=this.tmpCircleVerts1[Rt];Jt.x=Wt.x,Jt.y=Wt.y,Jt.z=Wt.z;var Ot=this.tmpCircleVerts1[Rt];Ot.x+=_.x*a,Ot.y+=_.y*a,Ot.z+=_.z*a;var Ut=this.tmpCircleVerts2[Rt],Ht=-a;Ut.x+=_.x*Ht,Ut.y+=_.y*Ht,Ut.z+=_.z*Ht}for(var Qt=0;Qt<8;){var Kt,$t=Qt++,ti=this.tmpCircleVerts1[$t],ii=this.tmpCircleVerts1[($t+1)%8],ai=_;this.triangle(y,ti,ii,ai,ai,ai,n),X,ti=this.tmpCircleVerts2[($t+1)%8],ii=this.tmpCircleVerts2[$t];var ni=this.p,oi=0==ni.sizeVec3?new r.common.Vec3:ni.stackVec3[--ni.sizeVec3];oi.x=_.x,oi.y=_.y,oi.z=_.z;var si=oi;si.x=-si.x,si.y=-si.y,si.z=-si.z,ai=si,this.triangle(X,ti,ii,si,si,si,n);var ri=this.p;if(null!=si){if(si.zero(),ri.sizeVec3==ri.stackVec3.length){for(var ei=new Array(ri.sizeVec3<<1),_i=0,hi=ri.sizeVec3;_i<hi;){var li=_i++;ei[li]=ri.stackVec3[li],ri.stackVec3[li]=null}ri.stackVec3=ei}ri.stackVec3[ri.sizeVec3++]=si}Kt=this.tmpCircleVerts1[$t],ti=this.tmpCircleVerts2[$t],ii=this.tmpCircleVerts2[($t+1)%8],ai=this.tmpCircleNorms[$t];var ci=this.tmpCircleNorms[($t+1)%8];this.rect(Kt,ti,ii,this.tmpCircleVerts1[($t+1)%8],ai,ai,ci,ci,n)}}var mi=this.p;if(null!=y){if(y.zero(),mi.sizeVec3==mi.stackVec3.length){for(var vi=new Array(mi.sizeVec3<<1),bi=0,fi=mi.sizeVec3;bi<fi;){var ui=bi++;vi[ui]=mi.stackVec3[ui],mi.stackVec3[ui]=null}mi.stackVec3=vi}mi.stackVec3[mi.sizeVec3++]=y}var pi=this.p;if(null!=X){if(X.zero(),pi.sizeVec3==pi.stackVec3.length){for(var xi=new Array(pi.sizeVec3<<1),yi=0,di=pi.sizeVec3;yi<di;){var gi=yi++;xi[gi]=pi.stackVec3[gi],pi.stackVec3[gi]=null}pi.stackVec3=xi}pi.stackVec3[pi.sizeVec3++]=X}var Xi=this.p;if(null!=m){if(m.zero(),Xi.sizeVec3==Xi.stackVec3.length){for(var Yi=new Array(Xi.sizeVec3<<1),zi=0,Zi=Xi.sizeVec3;zi<Zi;){var Mi=zi++;Yi[Mi]=Xi.stackVec3[Mi],Xi.stackVec3[Mi]=null}Xi.stackVec3=Yi}Xi.stackVec3[Xi.sizeVec3++]=m}var Ii=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,Ii.sizeMat3==Ii.stackMat3.length){for(var Vi=new Array(Ii.sizeMat3<<1),wi=0,Li=Ii.sizeMat3;wi<Li;){var ki=wi++;Vi[ki]=Ii.stackMat3[ki],Ii.stackMat3[ki]=null}Ii.stackMat3=Vi}Ii.stackMat3[Ii.sizeMat3++]=b}var Ai=this.p;if(null!=s){if(s.zero(),Ai.sizeVec3==Ai.stackVec3.length){for(var Bi=new Array(Ai.sizeVec3<<1),Pi=0,Si=Ai.sizeVec3;Pi<Si;){var Ti=Pi++;Bi[Ti]=Ai.stackVec3[Ti],Ai.stackVec3[Ti]=null}Ai.stackVec3=Bi}Ai.stackVec3[Ai.sizeVec3++]=s}var Ci=this.p;if(null!=_){if(_.zero(),Ci.sizeVec3==Ci.stackVec3.length){for(var ji=new Array(Ci.sizeVec3<<1),Ri=0,Ei=Ci.sizeVec3;Ri<Ei;){var qi=Ri++;ji[qi]=Ci.stackVec3[qi],Ci.stackVec3[qi]=null}Ci.stackVec3=ji}Ci.stackVec3[Ci.sizeVec3++]=_}var Di=this.p;if(null!=l){if(l.zero(),Di.sizeVec3==Di.stackVec3.length){for(var Ni=new Array(Di.sizeVec3<<1),Fi=0,Gi=Di.sizeVec3;Fi<Gi;){var Ji=Fi++;Ni[Ji]=Di.stackVec3[Ji],Di.stackVec3[Ji]=null}Di.stackVec3=Ni}Di.stackVec3[Di.sizeVec3++]=l}},i.capsule=function(t,i,a,n){var o=this.p,s=0==o.sizeVec3?new r.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,_=0==e.sizeVec3?new r.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,l=0==h.sizeVec3?new r.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeVec3?new r.common.Vec3:c.stackVec3[--c.sizeVec3],v=this.p,b=0==v.sizeMat3?new r.common.Mat3:v.stackMat3[--v.sizeMat3],f=m;f.x=t._positionX,f.y=t._positionY,f.z=t._positionZ;var u=b;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,s.init(b.e00,b.e10,b.e20),_.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);for(var p=this.tmpSphereVerts,x=this.tmpSphereNorms,y=0;y<5;)for(var d=y++,g=this.tmpSphereVerts[d].length,X=0;X<g;){var Y=X++,z=x[d][Y],Z=this.sphereCoords[d][Y];z.x=Z.x,z.y=Z.y,z.z=Z.z;var M=z.x*b.e10+z.y*b.e11+z.z*b.e12,I=z.x*b.e20+z.y*b.e21+z.z*b.e22;z.x=z.x*b.e00+z.y*b.e01+z.z*b.e02,z.y=M,z.z=I}for(var V=0;V<4;){var w=V++;if(0==w)for(var L=0;L<3;)for(var k=L++,A=this.tmpSphereVerts[k].length,B=0;B<A;){var P=B++,S=p[k][P],T=x[k][P];S.x=T.x,S.y=T.y,S.z=T.z,S.x*=i,S.y*=i,S.z*=i,S.x+=m.x,S.y+=m.y,S.z+=m.z,S.x+=_.x*a,S.y+=_.y*a,S.z+=_.z*a}if(2==w)for(var C=2;C<5;)for(var j=C++,R=this.tmpSphereVerts[j].length,E=0;E<R;){var q=E++,D=p[j][q],N=x[j][q];D.x=N.x,D.y=N.y,D.z=N.z,D.x*=i,D.y*=i,D.z*=i,D.x+=m.x,D.y+=m.y,D.z+=m.z;var F=-a;D.x+=_.x*F,D.y+=_.y*F,D.z+=_.z*F}for(var G=0;G<8;){var J=G++,W=void 0,O=void 0,U=void 0,H=void 0,Q=void 0,K=void 0,$=void 0,tt=void 0;0==w?this.wireframe?(W=p[0][0],O=p[1][J],this.line(W,O,n)):(W=p[0][0],O=p[1][J],U=p[1][(J+1)%8],Q=x[0][0],K=x[1][J],$=x[1][(J+1)%8],this.triangle(W,O,U,Q,K,$,n)):3==w?this.wireframe?(W=p[4][0],O=p[w][(J+1)%8],U=p[w][J],this.line(W,O,n),this.line(O,U,n)):(W=p[4][0],O=p[w][(J+1)%8],U=p[w][J],Q=x[4][0],K=x[w][(J+1)%8],$=x[w][J],this.triangle(W,O,U,Q,K,$,n)):this.wireframe?(W=p[w][J],O=p[w][(J+1)%8],U=p[w+1][J],this.line(W,O,n),this.line(W,U,n)):(W=p[w][J],O=p[w][(J+1)%8],U=p[w+1][J],H=p[w+1][(J+1)%8],Q=x[w][J],K=x[w][(J+1)%8],$=x[w+1][J],tt=x[w+1][(J+1)%8],this.rect(W,U,H,O,Q,$,tt,K,n))}}var it=this.p,at=0==it.sizeVec3?new r.common.Vec3:it.stackVec3[--it.sizeVec3];at.x=m.x,at.y=m.y,at.z=m.z;var nt=at;nt.x+=_.x*a,nt.y+=_.y*a,nt.z+=_.z*a;var ot=this.p,st=0==ot.sizeVec3?new r.common.Vec3:ot.stackVec3[--ot.sizeVec3];st.x=m.x,st.y=m.y,st.z=m.z;var rt=st,et=-a;if(rt.x+=_.x*et,rt.y+=_.y*et,rt.z+=_.z*et,this.wireframe){var _t=this.p,ht=0==_t.sizeVec3?new r.common.Vec3:_t.stackVec3[--_t.sizeVec3];ht.x=nt.x,ht.y=nt.y,ht.z=nt.z;var lt=ht,ct=-i;lt.x+=s.x*ct,lt.y+=s.y*ct,lt.z+=s.z*ct,lt.x+=0*l.x,lt.y+=0*l.y,lt.z+=0*l.z;var mt=this.p,vt=0==mt.sizeVec3?new r.common.Vec3:mt.stackVec3[--mt.sizeVec3];vt.x=nt.x,vt.y=nt.y,vt.z=nt.z;var bt=vt;bt.x+=s.x*i,bt.y+=s.y*i,bt.z+=s.z*i,bt.x+=0*l.x,bt.y+=0*l.y,bt.z+=0*l.z;var ft=this.p,ut=0==ft.sizeVec3?new r.common.Vec3:ft.stackVec3[--ft.sizeVec3];ut.x=nt.x,ut.y=nt.y,ut.z=nt.z;var pt=ut;pt.x+=0*s.x,pt.y+=0*s.y,pt.z+=0*s.z;var xt=-i;pt.x+=l.x*xt,pt.y+=l.y*xt,pt.z+=l.z*xt;var yt=this.p,dt=0==yt.sizeVec3?new r.common.Vec3:yt.stackVec3[--yt.sizeVec3];dt.x=nt.x,dt.y=nt.y,dt.z=nt.z;var gt=dt;gt.x+=0*s.x,gt.y+=0*s.y,gt.z+=0*s.z,gt.x+=l.x*i,gt.y+=l.y*i,gt.z+=l.z*i;var Xt=this.p,Yt=0==Xt.sizeVec3?new r.common.Vec3:Xt.stackVec3[--Xt.sizeVec3];Yt.x=rt.x,Yt.y=rt.y,Yt.z=rt.z;var zt=Yt,Zt=-i;zt.x+=s.x*Zt,zt.y+=s.y*Zt,zt.z+=s.z*Zt,zt.x+=0*l.x,zt.y+=0*l.y,zt.z+=0*l.z;var Mt=this.p,It=0==Mt.sizeVec3?new r.common.Vec3:Mt.stackVec3[--Mt.sizeVec3];It.x=rt.x,It.y=rt.y,It.z=rt.z;var Vt=It;Vt.x+=s.x*i,Vt.y+=s.y*i,Vt.z+=s.z*i,Vt.x+=0*l.x,Vt.y+=0*l.y,Vt.z+=0*l.z;var wt=this.p,Lt=0==wt.sizeVec3?new r.common.Vec3:wt.stackVec3[--wt.sizeVec3];Lt.x=rt.x,Lt.y=rt.y,Lt.z=rt.z;var kt=Lt;kt.x+=0*s.x,kt.y+=0*s.y,kt.z+=0*s.z;var At=-i;kt.x+=l.x*At,kt.y+=l.y*At,kt.z+=l.z*At;var Bt=this.p,Pt=0==Bt.sizeVec3?new r.common.Vec3:Bt.stackVec3[--Bt.sizeVec3];Pt.x=rt.x,Pt.y=rt.y,Pt.z=rt.z;var St=Pt;St.x+=0*s.x,St.y+=0*s.y,St.z+=0*s.z,St.x+=l.x*i,St.y+=l.y*i,St.z+=l.z*i,this.ellipse(nt,s,l,i,i,n),this.ellipse(rt,s,l,i,i,n),this.line(lt,zt,n),this.line(bt,Vt,n),this.line(pt,kt,n),this.line(gt,St,n);var Tt=this.p;if(null!=lt){if(lt.zero(),Tt.sizeVec3==Tt.stackVec3.length){for(var Ct=new Array(Tt.sizeVec3<<1),jt=0,Rt=Tt.sizeVec3;jt<Rt;){var Et=jt++;Ct[Et]=Tt.stackVec3[Et],Tt.stackVec3[Et]=null}Tt.stackVec3=Ct}Tt.stackVec3[Tt.sizeVec3++]=lt}var qt=this.p;if(null!=bt){if(bt.zero(),qt.sizeVec3==qt.stackVec3.length){for(var Dt=new Array(qt.sizeVec3<<1),Nt=0,Ft=qt.sizeVec3;Nt<Ft;){var Gt=Nt++;Dt[Gt]=qt.stackVec3[Gt],qt.stackVec3[Gt]=null}qt.stackVec3=Dt}qt.stackVec3[qt.sizeVec3++]=bt}var Jt=this.p;if(null!=pt){if(pt.zero(),Jt.sizeVec3==Jt.stackVec3.length){for(var Wt=new Array(Jt.sizeVec3<<1),Ot=0,Ut=Jt.sizeVec3;Ot<Ut;){var Ht=Ot++;Wt[Ht]=Jt.stackVec3[Ht],Jt.stackVec3[Ht]=null}Jt.stackVec3=Wt}Jt.stackVec3[Jt.sizeVec3++]=pt}var Qt=this.p;if(null!=gt){if(gt.zero(),Qt.sizeVec3==Qt.stackVec3.length){for(var Kt=new Array(Qt.sizeVec3<<1),$t=0,ti=Qt.sizeVec3;$t<ti;){var ii=$t++;Kt[ii]=Qt.stackVec3[ii],Qt.stackVec3[ii]=null}Qt.stackVec3=Kt}Qt.stackVec3[Qt.sizeVec3++]=gt}var ai=this.p;if(null!=zt){if(zt.zero(),ai.sizeVec3==ai.stackVec3.length){for(var ni=new Array(ai.sizeVec3<<1),oi=0,si=ai.sizeVec3;oi<si;){var ri=oi++;ni[ri]=ai.stackVec3[ri],ai.stackVec3[ri]=null}ai.stackVec3=ni}ai.stackVec3[ai.sizeVec3++]=zt}var ei=this.p;if(null!=Vt){if(Vt.zero(),ei.sizeVec3==ei.stackVec3.length){for(var _i=new Array(ei.sizeVec3<<1),hi=0,li=ei.sizeVec3;hi<li;){var ci=hi++;_i[ci]=ei.stackVec3[ci],ei.stackVec3[ci]=null}ei.stackVec3=_i}ei.stackVec3[ei.sizeVec3++]=Vt}var mi=this.p;if(null!=kt){if(kt.zero(),mi.sizeVec3==mi.stackVec3.length){for(var vi=new Array(mi.sizeVec3<<1),bi=0,fi=mi.sizeVec3;bi<fi;){var ui=bi++;vi[ui]=mi.stackVec3[ui],mi.stackVec3[ui]=null}mi.stackVec3=vi}mi.stackVec3[mi.sizeVec3++]=kt}var pi=this.p;if(null!=St){if(St.zero(),pi.sizeVec3==pi.stackVec3.length){for(var xi=new Array(pi.sizeVec3<<1),yi=0,di=pi.sizeVec3;yi<di;){var gi=yi++;xi[gi]=pi.stackVec3[gi],pi.stackVec3[gi]=null}pi.stackVec3=xi}pi.stackVec3[pi.sizeVec3++]=St}}else{for(var Xi=0;Xi<8;){var Yi=Xi++,zi=this.tmpCircleNorms[Yi],Zi=this.circleCoords[Yi];zi.x=Zi.x,zi.y=Zi.y,zi.z=Zi.z;var Mi=zi.x*b.e10+zi.y*b.e11+zi.z*b.e12,Ii=zi.x*b.e20+zi.y*b.e21+zi.z*b.e22;zi.x=zi.x*b.e00+zi.y*b.e01+zi.z*b.e02,zi.y=Mi,zi.z=Ii;var Vi=this.tmpCircleVerts1[Yi],wi=this.tmpCircleNorms[Yi];Vi.x=wi.x,Vi.y=wi.y,Vi.z=wi.z,Vi.x*=i,Vi.y*=i,Vi.z*=i,Vi.x+=m.x,Vi.y+=m.y,Vi.z+=m.z;var Li=this.tmpCircleVerts2[Yi],ki=this.tmpCircleVerts1[Yi];Li.x=ki.x,Li.y=ki.y,Li.z=ki.z;var Ai=this.tmpCircleVerts1[Yi];Ai.x+=_.x*a,Ai.y+=_.y*a,Ai.z+=_.z*a;var Bi=this.tmpCircleVerts2[Yi],Pi=-a;Bi.x+=_.x*Pi,Bi.y+=_.y*Pi,Bi.z+=_.z*Pi}for(var Si=0;Si<8;){var Ti=Si++,Ci=this.tmpCircleNorms[Ti],ji=this.tmpCircleNorms[(Ti+1)%8];this.rect(this.tmpCircleVerts1[Ti],this.tmpCircleVerts2[Ti],this.tmpCircleVerts2[(Ti+1)%8],this.tmpCircleVerts1[(Ti+1)%8],Ci,Ci,ji,ji,n)}}var Ri=this.p;if(null!=nt){if(nt.zero(),Ri.sizeVec3==Ri.stackVec3.length){for(var Ei=new Array(Ri.sizeVec3<<1),qi=0,Di=Ri.sizeVec3;qi<Di;){var Ni=qi++;Ei[Ni]=Ri.stackVec3[Ni],Ri.stackVec3[Ni]=null}Ri.stackVec3=Ei}Ri.stackVec3[Ri.sizeVec3++]=nt}var Fi=this.p;if(null!=rt){if(rt.zero(),Fi.sizeVec3==Fi.stackVec3.length){for(var Gi=new Array(Fi.sizeVec3<<1),Ji=0,Wi=Fi.sizeVec3;Ji<Wi;){var Oi=Ji++;Gi[Oi]=Fi.stackVec3[Oi],Fi.stackVec3[Oi]=null}Fi.stackVec3=Gi}Fi.stackVec3[Fi.sizeVec3++]=rt}var Ui=this.p;if(null!=m){if(m.zero(),Ui.sizeVec3==Ui.stackVec3.length){for(var Hi=new Array(Ui.sizeVec3<<1),Qi=0,Ki=Ui.sizeVec3;Qi<Ki;){var $i=Qi++;Hi[$i]=Ui.stackVec3[$i],Ui.stackVec3[$i]=null}Ui.stackVec3=Hi}Ui.stackVec3[Ui.sizeVec3++]=m}var ta=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,ta.sizeMat3==ta.stackMat3.length){for(var ia=new Array(ta.sizeMat3<<1),aa=0,na=ta.sizeMat3;aa<na;){var oa=aa++;ia[oa]=ta.stackMat3[oa],ta.stackMat3[oa]=null}ta.stackMat3=ia}ta.stackMat3[ta.sizeMat3++]=b}var sa=this.p;if(null!=s){if(s.zero(),sa.sizeVec3==sa.stackVec3.length){for(var ra=new Array(sa.sizeVec3<<1),ea=0,_a=sa.sizeVec3;ea<_a;){var ha=ea++;ra[ha]=sa.stackVec3[ha],sa.stackVec3[ha]=null}sa.stackVec3=ra}sa.stackVec3[sa.sizeVec3++]=s}var la=this.p;if(null!=_){if(_.zero(),la.sizeVec3==la.stackVec3.length){for(var ca=new Array(la.sizeVec3<<1),ma=0,va=la.sizeVec3;ma<va;){var ba=ma++;ca[ba]=la.stackVec3[ba],la.stackVec3[ba]=null}la.stackVec3=ca}la.stackVec3[la.sizeVec3++]=_}var fa=this.p;if(null!=l){if(l.zero(),fa.sizeVec3==fa.stackVec3.length){for(var ua=new Array(fa.sizeVec3<<1),pa=0,xa=fa.sizeVec3;pa<xa;){var ya=pa++;ua[ya]=fa.stackVec3[ya],fa.stackVec3[ya]=null}fa.stackVec3=ua}fa.stackVec3[fa.sizeVec3++]=l}},i.sphere=function(t,i,a){var n=this.p,o=0==n.sizeVec3?new r.common.Vec3:n.stackVec3[--n.sizeVec3],s=this.p,e=0==s.sizeMat3?new r.common.Mat3:s.stackMat3[--s.sizeMat3],_=o;_.x=t._positionX,_.y=t._positionY,_.z=t._positionZ;var h=e;h.e00=t._rotation00,h.e01=t._rotation01,h.e02=t._rotation02,h.e10=t._rotation10,h.e11=t._rotation11,h.e12=t._rotation12,h.e20=t._rotation20,h.e21=t._rotation21,h.e22=t._rotation22;for(var l=this.tmpSphereVerts,c=this.tmpSphereNorms,m=0;m<5;)for(var v=m++,b=this.tmpSphereVerts[v].length,f=0;f<b;){var u=f++,p=c[v][u],x=this.sphereCoords[v][u];p.x=x.x,p.y=x.y,p.z=x.z;var y=p.x*e.e10+p.y*e.e11+p.z*e.e12,d=p.x*e.e20+p.y*e.e21+p.z*e.e22;p.x=p.x*e.e00+p.y*e.e01+p.z*e.e02,p.y=y,p.z=d;var g=l[v][u],X=c[v][u];g.x=X.x,g.y=X.y,g.z=X.z,g.x*=i,g.y*=i,g.z*=i,g.x+=o.x,g.y+=o.y,g.z+=o.z}for(var Y=0;Y<4;)for(var z=Y++,Z=0;Z<8;){var M=Z++,I=void 0,V=void 0,w=void 0,L=void 0,k=void 0,A=void 0,B=void 0,P=void 0;0==z?this.wireframe?(I=l[0][0],V=l[1][M],this.line(I,V,a)):(I=l[0][0],V=l[1][M],w=l[1][(M+1)%8],k=c[0][0],A=c[1][M],B=c[1][(M+1)%8],this.triangle(I,V,w,k,A,B,a)):3==z?this.wireframe?(I=l[4][0],V=l[z][(M+1)%8],w=l[z][M],this.line(I,V,a),this.line(V,w,a)):(I=l[4][0],V=l[z][(M+1)%8],w=l[z][M],k=c[4][0],A=c[z][(M+1)%8],B=c[z][M],this.triangle(I,V,w,k,A,B,a)):this.wireframe?(I=l[z][M],V=l[z][(M+1)%8],w=l[z+1][M],this.line(I,V,a),this.line(I,w,a)):(I=l[z][M],V=l[z][(M+1)%8],w=l[z+1][M],L=l[z+1][(M+1)%8],k=c[z][M],A=c[z][(M+1)%8],B=c[z+1][M],P=c[z+1][(M+1)%8],this.rect(I,w,L,V,k,B,P,A,a))}var S=this.p;if(null!=o){if(o.zero(),S.sizeVec3==S.stackVec3.length){for(var T=new Array(S.sizeVec3<<1),C=0,j=S.sizeVec3;C<j;){var R=C++;T[R]=S.stackVec3[R],S.stackVec3[R]=null}S.stackVec3=T}S.stackVec3[S.sizeVec3++]=o}var E=this.p;if(null!=e){if(e.e00=1,e.e01=0,e.e02=0,e.e10=0,e.e11=1,e.e12=0,e.e20=0,e.e21=0,e.e22=1,E.sizeMat3==E.stackMat3.length){for(var q=new Array(E.sizeMat3<<1),D=0,N=E.sizeMat3;D<N;){var F=D++;q[F]=E.stackMat3[F],E.stackMat3[F]=null}E.stackMat3=q}E.stackMat3[E.sizeMat3++]=e}},i.box=function(t,i,a){var n=this.p,o=0==n.sizeVec3?new r.common.Vec3:n.stackVec3[--n.sizeVec3],s=this.p,e=0==s.sizeVec3?new r.common.Vec3:s.stackVec3[--s.sizeVec3],_=this.p,h=0==_.sizeVec3?new r.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new r.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,v=0==m.sizeMat3?new r.common.Mat3:m.stackMat3[--m.sizeMat3],b=c;b.x=t._positionX,b.y=t._positionY,b.z=t._positionZ;var f=v;f.e00=t._rotation00,f.e01=t._rotation01,f.e02=t._rotation02,f.e10=t._rotation10,f.e11=t._rotation11,f.e12=t._rotation12,f.e20=t._rotation20,f.e21=t._rotation21,f.e22=t._rotation22,o.init(v.e00,v.e10,v.e20),e.init(v.e01,v.e11,v.e21),h.init(v.e02,v.e12,v.e22);var u=i.x,p=i.y,x=i.z,y=this.p,d=0==y.sizeVec3?new r.common.Vec3:y.stackVec3[--y.sizeVec3];d.x=c.x,d.y=c.y,d.z=c.z;var g=d,X=-u;g.x+=o.x*X,g.y+=o.y*X,g.z+=o.z*X;var Y=-p;g.x+=e.x*Y,g.y+=e.y*Y,g.z+=e.z*Y;var z=-x;g.x+=h.x*z,g.y+=h.y*z,g.z+=h.z*z;var Z=this.p,M=0==Z.sizeVec3?new r.common.Vec3:Z.stackVec3[--Z.sizeVec3];M.x=c.x,M.y=c.y,M.z=c.z;var I=M,V=-u;I.x+=o.x*V,I.y+=o.y*V,I.z+=o.z*V;var w=-p;I.x+=e.x*w,I.y+=e.y*w,I.z+=e.z*w,I.x+=h.x*x,I.y+=h.y*x,I.z+=h.z*x;var L=this.p,k=0==L.sizeVec3?new r.common.Vec3:L.stackVec3[--L.sizeVec3];k.x=c.x,k.y=c.y,k.z=c.z;var A=k,B=-u;A.x+=o.x*B,A.y+=o.y*B,A.z+=o.z*B,A.x+=e.x*p,A.y+=e.y*p,A.z+=e.z*p;var P=-x;A.x+=h.x*P,A.y+=h.y*P,A.z+=h.z*P;var S=this.p,T=0==S.sizeVec3?new r.common.Vec3:S.stackVec3[--S.sizeVec3];T.x=c.x,T.y=c.y,T.z=c.z;var C=T,j=-u;C.x+=o.x*j,C.y+=o.y*j,C.z+=o.z*j,C.x+=e.x*p,C.y+=e.y*p,C.z+=e.z*p,C.x+=h.x*x,C.y+=h.y*x,C.z+=h.z*x;var R=this.p,E=0==R.sizeVec3?new r.common.Vec3:R.stackVec3[--R.sizeVec3];E.x=c.x,E.y=c.y,E.z=c.z;var q=E;q.x+=o.x*u,q.y+=o.y*u,q.z+=o.z*u;var D=-p;q.x+=e.x*D,q.y+=e.y*D,q.z+=e.z*D;var N=-x;q.x+=h.x*N,q.y+=h.y*N,q.z+=h.z*N;var F=this.p,G=0==F.sizeVec3?new r.common.Vec3:F.stackVec3[--F.sizeVec3];G.x=c.x,G.y=c.y,G.z=c.z;var J=G;J.x+=o.x*u,J.y+=o.y*u,J.z+=o.z*u;var W=-p;J.x+=e.x*W,J.y+=e.y*W,J.z+=e.z*W,J.x+=h.x*x,J.y+=h.y*x,J.z+=h.z*x;var O=this.p,U=0==O.sizeVec3?new r.common.Vec3:O.stackVec3[--O.sizeVec3];U.x=c.x,U.y=c.y,U.z=c.z;var H=U;H.x+=o.x*u,H.y+=o.y*u,H.z+=o.z*u,H.x+=e.x*p,H.y+=e.y*p,H.z+=e.z*p;var Q=-x;H.x+=h.x*Q,H.y+=h.y*Q,H.z+=h.z*Q;var K=this.p,$=0==K.sizeVec3?new r.common.Vec3:K.stackVec3[--K.sizeVec3];$.x=c.x,$.y=c.y,$.z=c.z;var tt=$;if(tt.x+=o.x*u,tt.y+=o.y*u,tt.z+=o.z*u,tt.x+=e.x*p,tt.y+=e.y*p,tt.z+=e.z*p,tt.x+=h.x*x,tt.y+=h.y*x,tt.z+=h.z*x,this.wireframe)this.line(g,I,a),this.line(A,C,a),this.line(q,J,a),this.line(H,tt,a),this.line(g,A,a),this.line(I,C,a),this.line(q,H,a),this.line(J,tt,a),this.line(g,q,a),this.line(I,J,a),this.line(A,H,a),this.line(C,tt,a);else{var it=this.p,at=0==it.sizeVec3?new r.common.Vec3:it.stackVec3[--it.sizeVec3];at.x=o.x,at.y=o.y,at.z=o.z;var nt=at;nt.x=-nt.x,nt.y=-nt.y,nt.z=-nt.z;var ot=this.p,st=0==ot.sizeVec3?new r.common.Vec3:ot.stackVec3[--ot.sizeVec3];st.x=e.x,st.y=e.y,st.z=e.z;var rt=st;rt.x=-rt.x,rt.y=-rt.y,rt.z=-rt.z;var et=this.p,_t=0==et.sizeVec3?new r.common.Vec3:et.stackVec3[--et.sizeVec3];_t.x=h.x,_t.y=h.y,_t.z=h.z;var ht=_t;ht.x=-ht.x,ht.y=-ht.y,ht.z=-ht.z,this.rect(g,I,C,A,nt,nt,nt,nt,a),this.rect(q,H,tt,J,o,o,o,o,a),this.rect(g,q,J,I,rt,rt,rt,rt,a),this.rect(A,C,tt,H,e,e,e,e,a),this.rect(g,A,H,q,ht,ht,ht,ht,a),this.rect(I,J,tt,C,h,h,h,h,a);var lt=this.p;if(null!=nt){if(nt.zero(),lt.sizeVec3==lt.stackVec3.length){for(var ct=new Array(lt.sizeVec3<<1),mt=0,vt=lt.sizeVec3;mt<vt;){var bt=mt++;ct[bt]=lt.stackVec3[bt],lt.stackVec3[bt]=null}lt.stackVec3=ct}lt.stackVec3[lt.sizeVec3++]=nt}var ft=this.p;if(null!=rt){if(rt.zero(),ft.sizeVec3==ft.stackVec3.length){for(var ut=new Array(ft.sizeVec3<<1),pt=0,xt=ft.sizeVec3;pt<xt;){var yt=pt++;ut[yt]=ft.stackVec3[yt],ft.stackVec3[yt]=null}ft.stackVec3=ut}ft.stackVec3[ft.sizeVec3++]=rt}var dt=this.p;if(null!=ht){if(ht.zero(),dt.sizeVec3==dt.stackVec3.length){for(var gt=new Array(dt.sizeVec3<<1),Xt=0,Yt=dt.sizeVec3;Xt<Yt;){var zt=Xt++;gt[zt]=dt.stackVec3[zt],dt.stackVec3[zt]=null}dt.stackVec3=gt}dt.stackVec3[dt.sizeVec3++]=ht}}var Zt=this.p;if(null!=g){if(g.zero(),Zt.sizeVec3==Zt.stackVec3.length){for(var Mt=new Array(Zt.sizeVec3<<1),It=0,Vt=Zt.sizeVec3;It<Vt;){var wt=It++;Mt[wt]=Zt.stackVec3[wt],Zt.stackVec3[wt]=null}Zt.stackVec3=Mt}Zt.stackVec3[Zt.sizeVec3++]=g}var Lt=this.p;if(null!=I){if(I.zero(),Lt.sizeVec3==Lt.stackVec3.length){for(var kt=new Array(Lt.sizeVec3<<1),At=0,Bt=Lt.sizeVec3;At<Bt;){var Pt=At++;kt[Pt]=Lt.stackVec3[Pt],Lt.stackVec3[Pt]=null}Lt.stackVec3=kt}Lt.stackVec3[Lt.sizeVec3++]=I}var St=this.p;if(null!=A){if(A.zero(),St.sizeVec3==St.stackVec3.length){for(var Tt=new Array(St.sizeVec3<<1),Ct=0,jt=St.sizeVec3;Ct<jt;){var Rt=Ct++;Tt[Rt]=St.stackVec3[Rt],St.stackVec3[Rt]=null}St.stackVec3=Tt}St.stackVec3[St.sizeVec3++]=A}var Et=this.p;if(null!=C){if(C.zero(),Et.sizeVec3==Et.stackVec3.length){for(var qt=new Array(Et.sizeVec3<<1),Dt=0,Nt=Et.sizeVec3;Dt<Nt;){var Ft=Dt++;qt[Ft]=Et.stackVec3[Ft],Et.stackVec3[Ft]=null}Et.stackVec3=qt}Et.stackVec3[Et.sizeVec3++]=C}var Gt=this.p;if(null!=q){if(q.zero(),Gt.sizeVec3==Gt.stackVec3.length){for(var Jt=new Array(Gt.sizeVec3<<1),Wt=0,Ot=Gt.sizeVec3;Wt<Ot;){var Ut=Wt++;Jt[Ut]=Gt.stackVec3[Ut],Gt.stackVec3[Ut]=null}Gt.stackVec3=Jt}Gt.stackVec3[Gt.sizeVec3++]=q}var Ht=this.p;if(null!=J){if(J.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Qt=new Array(Ht.sizeVec3<<1),Kt=0,$t=Ht.sizeVec3;Kt<$t;){var ti=Kt++;Qt[ti]=Ht.stackVec3[ti],Ht.stackVec3[ti]=null}Ht.stackVec3=Qt}Ht.stackVec3[Ht.sizeVec3++]=J}var ii=this.p;if(null!=H){if(H.zero(),ii.sizeVec3==ii.stackVec3.length){for(var ai=new Array(ii.sizeVec3<<1),ni=0,oi=ii.sizeVec3;ni<oi;){var si=ni++;ai[si]=ii.stackVec3[si],ii.stackVec3[si]=null}ii.stackVec3=ai}ii.stackVec3[ii.sizeVec3++]=H}var ri=this.p;if(null!=tt){if(tt.zero(),ri.sizeVec3==ri.stackVec3.length){for(var ei=new Array(ri.sizeVec3<<1),_i=0,hi=ri.sizeVec3;_i<hi;){var li=_i++;ei[li]=ri.stackVec3[li],ri.stackVec3[li]=null}ri.stackVec3=ei}ri.stackVec3[ri.sizeVec3++]=tt}var ci=this.p;if(null!=c){if(c.zero(),ci.sizeVec3==ci.stackVec3.length){for(var mi=new Array(ci.sizeVec3<<1),vi=0,bi=ci.sizeVec3;vi<bi;){var fi=vi++;mi[fi]=ci.stackVec3[fi],ci.stackVec3[fi]=null}ci.stackVec3=mi}ci.stackVec3[ci.sizeVec3++]=c}var ui=this.p;if(null!=v){if(v.e00=1,v.e01=0,v.e02=0,v.e10=0,v.e11=1,v.e12=0,v.e20=0,v.e21=0,v.e22=1,ui.sizeMat3==ui.stackMat3.length){for(var pi=new Array(ui.sizeMat3<<1),xi=0,yi=ui.sizeMat3;xi<yi;){var di=xi++;pi[di]=ui.stackMat3[di],ui.stackMat3[di]=null}ui.stackMat3=pi}ui.stackMat3[ui.sizeMat3++]=v}var gi=this.p;if(null!=o){if(o.zero(),gi.sizeVec3==gi.stackVec3.length){for(var Xi=new Array(gi.sizeVec3<<1),Yi=0,zi=gi.sizeVec3;Yi<zi;){var Zi=Yi++;Xi[Zi]=gi.stackVec3[Zi],gi.stackVec3[Zi]=null}gi.stackVec3=Xi}gi.stackVec3[gi.sizeVec3++]=o}var Mi=this.p;if(null!=e){if(e.zero(),Mi.sizeVec3==Mi.stackVec3.length){for(var Ii=new Array(Mi.sizeVec3<<1),Vi=0,wi=Mi.sizeVec3;Vi<wi;){var Li=Vi++;Ii[Li]=Mi.stackVec3[Li],Mi.stackVec3[Li]=null}Mi.stackVec3=Ii}Mi.stackVec3[Mi.sizeVec3++]=e}var ki=this.p;if(null!=h){if(h.zero(),ki.sizeVec3==ki.stackVec3.length){for(var Ai=new Array(ki.sizeVec3<<1),Bi=0,Pi=ki.sizeVec3;Bi<Pi;){var Si=Bi++;Ai[Si]=ki.stackVec3[Si],ki.stackVec3[Si]=null}ki.stackVec3=Ai}ki.stackVec3[ki.sizeVec3++]=h}},i.rect=function(t,i,a,n,o,s,r,e,_){this.triangle(t,i,a,o,s,r,_),this.triangle(t,a,n,o,r,e,_)},i.point=function(t,i){},i.triangle=function(t,i,a,n,o,s,r){},i.line=function(t,i,a){},t}(),r.dynamics.common.DebugDrawStyle=function(){this.basisColorZ=new r.common.Vec3(0,0,1),this.basisColorY=new r.common.Vec3(0,1,0),this.basisColorX=new r.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new r.common.Vec3(1,.1,.1),this.jointLineColor=new r.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new r.common.Vec3(.2,.2,1),this.contactTangentColor=new r.common.Vec3(.1,.8,.1),this.contactNormalColor=new r.common.Vec3(1,.1,.1),this.disabledContactColor=new r.common.Vec3(.5,.1,.1),this.newContactColor=new r.common.Vec3(1,1,.1),this.contactColor4=new r.common.Vec3(.8,.1,1),this.contactColor3=new r.common.Vec3(.1,.8,.6),this.contactColor2=new r.common.Vec3(1,.6,.1),this.contactColor=new r.common.Vec3(1,.1,.1),this.pairColor=new r.common.Vec3(1,1,.1),this.bvhNodeColor=new r.common.Vec3(.4,.4,.4),this.aabbColor=new r.common.Vec3(1,.1,.1),this.kinematicShapeColor=new r.common.Vec3(1,.5,.1),this.staticShapeColor=new r.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new r.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new r.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new r.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new r.common.Vec3(.5,.25,.6),this.shapeColor2=new r.common.Vec3(1,.8,.1),this.shapeColor1=new r.common.Vec3(.7,.2,.4)},r.dynamics.common.Performance=function(){},r.dynamics.constraint||(r.dynamics.constraint={}),r.dynamics.constraint.ConstraintSolver=function(){function t(){this._b1=null,this._b2=null,this._addedToIsland=!1}var i=t.prototype;return i.preSolveVelocity=function(t){},i.warmStart=function(t){},i.solveVelocity=function(){},i.postSolveVelocity=function(t){},i.preSolvePosition=function(t){},i.solvePositionSplitImpulse=function(){},i.solvePositionNgs=function(t){},i.postSolve=function(){},t}(),r.dynamics.constraint.PositionCorrectionAlgorithm=function(){},r.dynamics.constraint.contact||(r.dynamics.constraint.contact={}),r.dynamics.constraint.contact.ContactConstraint=function(){function t(t){this._solver=new r.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}var i=t.prototype;return i._getVelocitySolverInfo=function(t,i){var a,n,o,s,e,_,h,l,c;i.b1=this._b1,i.b2=this._b2,a=this._manifold._normalX,n=this._manifold._normalY,o=this._manifold._normalZ,s=this._manifold._tangentX,e=this._manifold._tangentY,_=this._manifold._tangentZ,h=this._manifold._binormalX,l=this._manifold._binormalY,c=this._manifold._binormalZ;var m=Math.sqrt(this._s1._friction*this._s2._friction),v=Math.sqrt(this._s1._restitution*this._s2._restitution),b=this._manifold._numPoints;i.numRows=0;for(var f=0;f<b;){var u=this._manifold._points[f++];if(u._depth<0){u._disabled=!0;var p=u._impulse;p.impulseN=0,p.impulseT=0,p.impulseB=0,p.impulseP=0,p.impulseLX=0,p.impulseLY=0,p.impulseLZ=0}else{u._disabled=!1;var x=i.rows[i.numRows++];x.friction=m,x.cfm=0;var y=x.jacobianN;y.lin1X=a,y.lin1Y=n,y.lin1Z=o,y.lin2X=a,y.lin2Y=n,y.lin2Z=o,y.ang1X=u._relPos1Y*o-u._relPos1Z*n,y.ang1Y=u._relPos1Z*a-u._relPos1X*o,y.ang1Z=u._relPos1X*n-u._relPos1Y*a,y.ang2X=u._relPos2Y*o-u._relPos2Z*n,y.ang2Y=u._relPos2Z*a-u._relPos2X*o,y.ang2Z=u._relPos2X*n-u._relPos2Y*a,(y=x.jacobianT).lin1X=s,y.lin1Y=e,y.lin1Z=_,y.lin2X=s,y.lin2Y=e,y.lin2Z=_,y.ang1X=u._relPos1Y*_-u._relPos1Z*e,y.ang1Y=u._relPos1Z*s-u._relPos1X*_,y.ang1Z=u._relPos1X*e-u._relPos1Y*s,y.ang2X=u._relPos2Y*_-u._relPos2Z*e,y.ang2Y=u._relPos2Z*s-u._relPos2X*_,y.ang2Z=u._relPos2X*e-u._relPos2Y*s,(y=x.jacobianB).lin1X=h,y.lin1Y=l,y.lin1Z=c,y.lin2X=h,y.lin2Y=l,y.lin2Z=c,y.ang1X=u._relPos1Y*c-u._relPos1Z*l,y.ang1Y=u._relPos1Z*h-u._relPos1X*c,y.ang1Z=u._relPos1X*l-u._relPos1Y*h,y.ang2X=u._relPos2Y*c-u._relPos2Z*l,y.ang2Y=u._relPos2Z*h-u._relPos2X*c,y.ang2Z=u._relPos2X*l-u._relPos2Y*h;var d=(y=x.jacobianN).lin1X*this._b1._velX+y.lin1Y*this._b1._velY+y.lin1Z*this._b1._velZ+(y.ang1X*this._b1._angVelX+y.ang1Y*this._b1._angVelY+y.ang1Z*this._b1._angVelZ)-(y.lin2X*this._b2._velX+y.lin2Y*this._b2._velY+y.lin2Z*this._b2._velZ+(y.ang2X*this._b2._angVelX+y.ang2Y*this._b2._angVelY+y.ang2Z*this._b2._angVelZ));if(d<-r.common.Setting.contactEnableBounceThreshold&&!u._warmStarted?x.rhs=-d*v:x.rhs=0,this._positionCorrectionAlgorithm==r.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&u._depth>r.common.Setting.linearSlop){var g=(u._depth-r.common.Setting.linearSlop)*r.common.Setting.velocityBaumgarte*t.invDt;x.rhs<g&&(x.rhs=g)}if(!u._warmStarted){var X=u._impulse;X.impulseN=0,X.impulseT=0,X.impulseB=0,X.impulseP=0,X.impulseLX=0,X.impulseLY=0,X.impulseLZ=0}x.impulse=u._impulse}}},i._getPositionSolverInfo=function(t){var i,a,n;t.b1=this._b1,t.b2=this._b2,i=this._manifold._normalX,a=this._manifold._normalY,n=this._manifold._normalZ;var o=this._manifold._numPoints;t.numRows=0;for(var s=0;s<o;){var e=this._manifold._points[s++];if(!e._disabled){var _=t.rows[t.numRows++],h=_.jacobianN;h.lin1X=i,h.lin1Y=a,h.lin1Z=n,h.lin2X=i,h.lin2Y=a,h.lin2Z=n,h.ang1X=e._relPos1Y*n-e._relPos1Z*a,h.ang1Y=e._relPos1Z*i-e._relPos1X*n,h.ang1Z=e._relPos1X*a-e._relPos1Y*i,h.ang2X=e._relPos2Y*n-e._relPos2Z*a,h.ang2Y=e._relPos2Z*i-e._relPos2X*n,h.ang2Z=e._relPos2X*a-e._relPos2Y*i,_.rhs=e._depth-r.common.Setting.linearSlop,_.rhs<0&&(_.rhs=0),_.impulse=e._impulse}}},i._syncManifold=function(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)},i.getShape1=function(){return this._s1},i.getShape2=function(){return this._s2},i.getManifold=function(){return this._manifold},i.isTouching=function(){for(var t=0,i=this._manifold._numPoints;t<i;)if(this._manifold._points[t++]._depth>=0)return!0;return!1},t}(),r.dynamics.constraint.contact.ContactImpulse=function(){function t(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}return t.prototype.copyFrom=function(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ},t}(),r.dynamics.constraint.contact.Manifold=function(){function t(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0,this._points=new Array(r.common.Setting.maxManifoldPoints);for(var t=0,i=r.common.Setting.maxManifoldPoints;t<i;)this._points[t++]=new r.dynamics.constraint.contact.ManifoldPoint}var i=t.prototype;return i._clear=function(){for(var t=0,i=this._numPoints;t<i;){var a=this._points[t++];a._localPos1X=0,a._localPos1Y=0,a._localPos1Z=0,a._localPos2X=0,a._localPos2Y=0,a._localPos2Z=0,a._relPos1X=0,a._relPos1Y=0,a._relPos1Z=0,a._relPos2X=0,a._relPos2Y=0,a._relPos2Z=0,a._pos1X=0,a._pos1Y=0,a._pos1Z=0,a._pos2X=0,a._pos2Y=0,a._pos2Z=0,a._depth=0;var n=a._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,a._warmStarted=!1,a._disabled=!1,a._id=-1}this._numPoints=0},i._buildBasis=function(t){this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;var i,a,n,o,s,r,e=t.x,_=t.y,h=t.z,l=e*e,c=_*_,m=h*h;if(l<c)if(l<m){var v=1/Math.sqrt(c+m);i=0,o=_*(n=_*v)-h*(a=-h*v),s=-e*n,r=e*a}else{var b=1/Math.sqrt(l+c);n=0,o=-h*(a=e*b),s=h*(i=-_*b),r=e*a-_*i}else if(c<m){var f=1/Math.sqrt(l+m);a=0,o=_*(n=-e*f),s=h*(i=h*f)-e*n,r=-_*i}else{var u=1/Math.sqrt(l+c);n=0,o=-h*(a=e*u),s=h*(i=-_*u),r=e*a-_*i}this._tangentX=i,this._tangentY=a,this._tangentZ=n,this._binormalX=o,this._binormalY=s,this._binormalZ=r},i._updateDepthsAndPositions=function(t,i){for(var a=0,n=this._numPoints;a<n;){var o,s,r,e=this._points[a++];o=t._rotation00*e._localPos1X+t._rotation01*e._localPos1Y+t._rotation02*e._localPos1Z,s=t._rotation10*e._localPos1X+t._rotation11*e._localPos1Y+t._rotation12*e._localPos1Z,r=t._rotation20*e._localPos1X+t._rotation21*e._localPos1Y+t._rotation22*e._localPos1Z,e._relPos1X=o,e._relPos1Y=s,e._relPos1Z=r;var _,h,l;_=i._rotation00*e._localPos2X+i._rotation01*e._localPos2Y+i._rotation02*e._localPos2Z,h=i._rotation10*e._localPos2X+i._rotation11*e._localPos2Y+i._rotation12*e._localPos2Z,l=i._rotation20*e._localPos2X+i._rotation21*e._localPos2Y+i._rotation22*e._localPos2Z,e._relPos2X=_,e._relPos2Y=h,e._relPos2Z=l,e._pos1X=e._relPos1X+t._positionX,e._pos1Y=e._relPos1Y+t._positionY,e._pos1Z=e._relPos1Z+t._positionZ,e._pos2X=e._relPos2X+i._positionX,e._pos2Y=e._relPos2Y+i._positionY,e._pos2Z=e._relPos2Z+i._positionZ;var c,m,v;c=e._pos1X-e._pos2X,m=e._pos1Y-e._pos2Y,v=e._pos1Z-e._pos2Z,e._depth=-(c*this._normalX+m*this._normalY+v*this._normalZ)}},i.getNormal=function(){var t=new r.common.Vec3;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,t},i.getNormalTo=function(t){t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ},i.getTangent=function(){var t=new r.common.Vec3;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,t},i.getTangentTo=function(t){t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ},i.getBinormal=function(){var t=new r.common.Vec3;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,t},i.getBinormalTo=function(t){t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ},i.getPoints=function(){return this._points},i.getNumPoints=function(){return this._numPoints},t}(),r.dynamics.constraint.contact.ManifoldPoint=function(){function t(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new r.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}var i=t.prototype;return i.getPosition1=function(){var t=new r.common.Vec3;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,t},i.getPosition1To=function(t){t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z},i.getPosition2=function(){var t=new r.common.Vec3;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,t},i.getPosition2To=function(t){t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z},i.getDepth=function(){return this._depth},i.isWarmStarted=function(){return this._warmStarted},i.getNormalImpulse=function(){return this._impulse.impulseN},i.getTangentImpulse=function(){return this._impulse.impulseT},i.getBinormalImpulse=function(){return this._impulse.impulseB},i.isEnabled=function(){return!this._disabled},t}(),r.dynamics.constraint.contact.ManifoldUpdater=function(){function t(t){this._manifold=t,this.numOldPoints=0,this.oldPoints=new Array(r.common.Setting.maxManifoldPoints);for(var i=0,a=r.common.Setting.maxManifoldPoints;i<a;)this.oldPoints[i++]=new r.dynamics.constraint.contact.ManifoldPoint}var i=t.prototype;return i.removeOutdatedPoints=function(){for(var t=this._manifold._numPoints;--t>=0;){var i=this._manifold._points[t],a=void 0,n=void 0,o=void 0;a=i._pos1X-i._pos2X,n=i._pos1Y-i._pos2Y,o=i._pos1Z-i._pos2Z;var s=this._manifold._normalX*a+this._manifold._normalY*n+this._manifold._normalZ*o;s>r.common.Setting.contactPersistenceThreshold?this.removeManifoldPoint(t):(a+=this._manifold._normalX*-s)*a+(n+=this._manifold._normalY*-s)*n+(o+=this._manifold._normalZ*-s)*o>r.common.Setting.contactPersistenceThreshold*r.common.Setting.contactPersistenceThreshold&&this.removeManifoldPoint(t)}},i.removeManifoldPoint=function(t){var i=--this._manifold._numPoints;if(t!=i){var a=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=a}var n=this._manifold._points[i];n._localPos1X=0,n._localPos1Y=0,n._localPos1Z=0,n._localPos2X=0,n._localPos2Y=0,n._localPos2Z=0,n._relPos1X=0,n._relPos1Y=0,n._relPos1Z=0,n._relPos2X=0,n._relPos2Y=0,n._relPos2Z=0,n._pos1X=0,n._pos1Y=0,n._pos1Z=0,n._pos2X=0,n._pos2Y=0,n._pos2Z=0,n._depth=0;var o=n._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,n._warmStarted=!1,n._disabled=!1,n._id=-1},i.addManifoldPoint=function(t,i,a){var n=this._manifold._numPoints;if(n==r.common.Setting.maxManifoldPoints){var o=this.computeTargetIndex(t,i,a),s=this._manifold._points[o],e=t.position1;s._pos1X=e.x,s._pos1Y=e.y,s._pos1Z=e.z;var _,h,l,c,m,v,b=t.position2;s._pos2X=b.x,s._pos2Y=b.y,s._pos2Z=b.z,s._relPos1X=s._pos1X-i._positionX,s._relPos1Y=s._pos1Y-i._positionY,s._relPos1Z=s._pos1Z-i._positionZ,s._relPos2X=s._pos2X-a._positionX,s._relPos2Y=s._pos2Y-a._positionY,s._relPos2Z=s._pos2Z-a._positionZ,_=i._rotation00*s._relPos1X+i._rotation10*s._relPos1Y+i._rotation20*s._relPos1Z,h=i._rotation01*s._relPos1X+i._rotation11*s._relPos1Y+i._rotation21*s._relPos1Z,l=i._rotation02*s._relPos1X+i._rotation12*s._relPos1Y+i._rotation22*s._relPos1Z,s._localPos1X=_,s._localPos1Y=h,s._localPos1Z=l,c=a._rotation00*s._relPos2X+a._rotation10*s._relPos2Y+a._rotation20*s._relPos2Z,m=a._rotation01*s._relPos2X+a._rotation11*s._relPos2Y+a._rotation21*s._relPos2Z,v=a._rotation02*s._relPos2X+a._rotation12*s._relPos2Y+a._rotation22*s._relPos2Z,s._localPos2X=c,s._localPos2Y=m,s._localPos2Z=v,s._depth=t.depth;var f=s._impulse;return f.impulseN=0,f.impulseT=0,f.impulseB=0,f.impulseP=0,f.impulseLX=0,f.impulseLY=0,f.impulseLZ=0,s._id=t.id,s._warmStarted=!1,void(s._disabled=!1)}var u=this._manifold._points[n],p=t.position1;u._pos1X=p.x,u._pos1Y=p.y,u._pos1Z=p.z;var x,y,d,g,X,Y,z=t.position2;u._pos2X=z.x,u._pos2Y=z.y,u._pos2Z=z.z,u._relPos1X=u._pos1X-i._positionX,u._relPos1Y=u._pos1Y-i._positionY,u._relPos1Z=u._pos1Z-i._positionZ,u._relPos2X=u._pos2X-a._positionX,u._relPos2Y=u._pos2Y-a._positionY,u._relPos2Z=u._pos2Z-a._positionZ,x=i._rotation00*u._relPos1X+i._rotation10*u._relPos1Y+i._rotation20*u._relPos1Z,y=i._rotation01*u._relPos1X+i._rotation11*u._relPos1Y+i._rotation21*u._relPos1Z,d=i._rotation02*u._relPos1X+i._rotation12*u._relPos1Y+i._rotation22*u._relPos1Z,u._localPos1X=x,u._localPos1Y=y,u._localPos1Z=d,g=a._rotation00*u._relPos2X+a._rotation10*u._relPos2Y+a._rotation20*u._relPos2Z,X=a._rotation01*u._relPos2X+a._rotation11*u._relPos2Y+a._rotation21*u._relPos2Z,Y=a._rotation02*u._relPos2X+a._rotation12*u._relPos2Y+a._rotation22*u._relPos2Z,u._localPos2X=g,u._localPos2Y=X,u._localPos2Z=Y,u._depth=t.depth;var Z=u._impulse;Z.impulseN=0,Z.impulseT=0,Z.impulseB=0,Z.impulseP=0,Z.impulseLX=0,Z.impulseLY=0,Z.impulseLZ=0,u._id=t.id,u._warmStarted=!1,u._disabled=!1,this._manifold._numPoints++},i.computeTargetIndex=function(t,i,a){var n,o,s,r=this._manifold._points[0],e=this._manifold._points[1],_=this._manifold._points[2],h=this._manifold._points[3],l=r._depth,c=0;e._depth>l&&(l=e._depth,c=1),_._depth>l&&(l=_._depth,c=2),h._depth>l&&(l=h._depth,c=3);var m=t.position1;n=m.x,o=m.y,s=m.z,n-=i._positionX,o-=i._positionY,s-=i._positionZ;var v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,E,q,D,N,F,G,J,W,O,U,H,Q,K,$,tt,it,at,nt,ot,st,rt,et,_t,ht,lt,ct,mt,vt,bt,ft,ut,pt,xt,yt,dt,gt,Xt,Yt,zt,Zt,Mt,It,Vt,wt,Lt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt,Et,qt,Dt,Nt,Ft,Gt,Jt,Wt,Ot,Ut,Ht,Qt,Kt,$t,ti,ii,ai,ni,oi,si,ri,ei,_i,hi,li,ci,mi,vi=e._relPos1X,bi=e._relPos1Y,fi=e._relPos1Z,ui=_._relPos1X,pi=_._relPos1Y,xi=_._relPos1Z,yi=h._relPos1X,di=h._relPos1Y,gi=h._relPos1Z,Xi=(k=(b=pi-bi)*(x=s-gi)-(f=xi-fi)*(p=o-di))*k+(A=f*(u=n-yi)-(v=ui-vi)*x)*A+(B=v*p-b*u)*B,Yi=(P=(d=di-bi)*(z=s-xi)-(g=gi-fi)*(Y=o-pi))*P+(S=g*(X=n-ui)-(y=yi-vi)*z)*S+(T=y*Y-d*X)*T,zi=(C=(M=o-bi)*(L=gi-xi)-(I=s-fi)*(w=di-pi))*C+(j=I*(V=yi-ui)-(Z=n-vi)*L)*j+(R=Z*w-M*V)*R,Zi=r._relPos1X,Mi=r._relPos1Y,Ii=r._relPos1Z,Vi=_._relPos1X,wi=_._relPos1Y,Li=_._relPos1Z,ki=h._relPos1X,Ai=h._relPos1Y,Bi=h._relPos1Z,Pi=(ot=(q=wi-Mi)*(G=s-Bi)-(D=Li-Ii)*(F=o-Ai))*ot+(st=D*(N=n-ki)-(E=Vi-Zi)*G)*st+(rt=E*F-q*N)*rt,Si=(et=(W=Ai-Mi)*(Q=s-Li)-(O=Bi-Ii)*(H=o-wi))*et+(_t=O*(U=n-Vi)-(J=ki-Zi)*Q)*_t+(ht=J*H-W*U)*ht,Ti=(lt=($=o-Mi)*(nt=Bi-Li)-(tt=s-Ii)*(at=Ai-wi))*lt+(ct=tt*(it=ki-Vi)-(K=n-Zi)*nt)*ct+(mt=K*at-$*it)*mt,Ci=Pi>Si?Pi>Ti?Pi:Ti:Si>Ti?Si:Ti,ji=r._relPos1X,Ri=r._relPos1Y,Ei=r._relPos1Z,qi=e._relPos1X,Di=e._relPos1Y,Ni=e._relPos1Z,Fi=h._relPos1X,Gi=h._relPos1Y,Ji=h._relPos1Z,Wi=(kt=(bt=Di-Ri)*(xt=s-Ji)-(ft=Ni-Ei)*(pt=o-Gi))*kt+(At=ft*(ut=n-Fi)-(vt=qi-ji)*xt)*At+(Bt=vt*pt-bt*ut)*Bt,Oi=(Pt=(dt=Gi-Ri)*(zt=s-Ni)-(gt=Ji-Ei)*(Yt=o-Di))*Pt+(St=gt*(Xt=n-qi)-(yt=Fi-ji)*zt)*St+(Tt=yt*Yt-dt*Xt)*Tt,Ui=(Ct=(Mt=o-Ri)*(Lt=Ji-Ni)-(It=s-Ei)*(wt=Gi-Di))*Ct+(jt=It*(Vt=Fi-qi)-(Zt=n-ji)*Lt)*jt+(Rt=Zt*wt-Mt*Vt)*Rt,Hi=Wi>Oi?Wi>Ui?Wi:Ui:Oi>Ui?Oi:Ui,Qi=r._relPos1X,Ki=r._relPos1Y,$i=r._relPos1Z,ta=e._relPos1X,ia=e._relPos1Y,aa=e._relPos1Z,na=_._relPos1X,oa=_._relPos1Y,sa=_._relPos1Z,ra=(oi=(qt=ia-Ki)*(Gt=s-sa)-(Dt=aa-$i)*(Ft=o-oa))*oi+(si=Dt*(Nt=n-na)-(Et=ta-Qi)*Gt)*si+(ri=Et*Ft-qt*Nt)*ri,ea=(ei=(Wt=oa-Ki)*(Qt=s-aa)-(Ot=sa-$i)*(Ht=o-ia))*ei+(_i=Ot*(Ut=n-ta)-(Jt=na-Qi)*Qt)*_i+(hi=Jt*Ht-Wt*Ut)*hi,_a=(li=($t=o-Ki)*(ni=sa-aa)-(ti=s-$i)*(ai=oa-ia))*li+(ci=ti*(ii=na-ta)-(Kt=n-Qi)*ni)*ci+(mi=Kt*ai-$t*ii)*mi,ha=ra>ea?ra>_a?ra:_a:ea>_a?ea:_a,la=Xi>Yi?Xi>zi?Xi:zi:Yi>zi?Yi:zi,ca=0;return(Ci>la&&1!=c||0==c)&&(la=Ci,ca=1),Hi>la&&2!=c&&(la=Hi,ca=2),ha>la&&3!=c&&(la=ha,ca=3),ca},i.computeRelativePositions=function(t,i){for(var a=this._manifold._numPoints,n=0;n<a;){var o,s,r,e=this._manifold._points[n++];o=t._rotation00*e._localPos1X+t._rotation01*e._localPos1Y+t._rotation02*e._localPos1Z,s=t._rotation10*e._localPos1X+t._rotation11*e._localPos1Y+t._rotation12*e._localPos1Z,r=t._rotation20*e._localPos1X+t._rotation21*e._localPos1Y+t._rotation22*e._localPos1Z,e._relPos1X=o,e._relPos1Y=s,e._relPos1Z=r;var _,h,l;_=i._rotation00*e._localPos2X+i._rotation01*e._localPos2Y+i._rotation02*e._localPos2Z,h=i._rotation10*e._localPos2X+i._rotation11*e._localPos2Y+i._rotation12*e._localPos2Z,l=i._rotation20*e._localPos2X+i._rotation21*e._localPos2Y+i._rotation22*e._localPos2Z,e._relPos2X=_,e._relPos2Y=h,e._relPos2Z=l,e._warmStarted=!0}},i.findNearestContactPointIndex=function(t,i,a){for(var n=r.common.Setting.contactPersistenceThreshold*r.common.Setting.contactPersistenceThreshold,o=-1,s=0,e=this._manifold._numPoints;s<e;){var _=s++,h=this._manifold._points[_],l=void 0,c=void 0,m=void 0,v=void 0,b=void 0,f=void 0,u=t.position1;l=u.x,c=u.y,m=u.z;var p=t.position2;v=p.x,b=p.y,f=p.z,l-=i._positionX,c-=i._positionY,m-=i._positionZ,v-=a._positionX,b-=a._positionY,f-=a._positionZ;var x,y,d,g,X,Y,z=(x=h._relPos1X-l)*x+(y=h._relPos1Y-c)*y+(d=h._relPos1Z-m)*d,Z=(g=h._relPos2X-v)*g+(X=h._relPos2Y-b)*X+(Y=h._relPos2Z-f)*Y,M=z<Z?z:Z;M<n&&(n=M,o=_)}return o},i.totalUpdate=function(t,i,a){this.numOldPoints=this._manifold._numPoints;for(var n=0,o=this.numOldPoints;n<o;){var s=n++,r=this.oldPoints[s],e=this._manifold._points[s];r._localPos1X=e._localPos1X,r._localPos1Y=e._localPos1Y,r._localPos1Z=e._localPos1Z,r._localPos2X=e._localPos2X,r._localPos2Y=e._localPos2Y,r._localPos2Z=e._localPos2Z,r._relPos1X=e._relPos1X,r._relPos1Y=e._relPos1Y,r._relPos1Z=e._relPos1Z,r._relPos2X=e._relPos2X,r._relPos2Y=e._relPos2Y,r._relPos2Z=e._relPos2Z,r._pos1X=e._pos1X,r._pos1Y=e._pos1Y,r._pos1Z=e._pos1Z,r._pos2X=e._pos2X,r._pos2Y=e._pos2Y,r._pos2Z=e._pos2Z,r._depth=e._depth,r._impulse.copyFrom(e._impulse),r._id=e._id,r._warmStarted=e._warmStarted,r._disabled=!1}var _=t.numPoints;this._manifold._numPoints=_;for(var h=0;h<_;){var l=h++,c=this._manifold._points[l],m=t.points[l],v=m.position1;c._pos1X=v.x,c._pos1Y=v.y,c._pos1Z=v.z;var b=m.position2;c._pos2X=b.x,c._pos2Y=b.y,c._pos2Z=b.z,c._relPos1X=c._pos1X-i._positionX,c._relPos1Y=c._pos1Y-i._positionY,c._relPos1Z=c._pos1Z-i._positionZ,c._relPos2X=c._pos2X-a._positionX,c._relPos2Y=c._pos2Y-a._positionY,c._relPos2Z=c._pos2Z-a._positionZ;var f,u,p;f=i._rotation00*c._relPos1X+i._rotation10*c._relPos1Y+i._rotation20*c._relPos1Z,u=i._rotation01*c._relPos1X+i._rotation11*c._relPos1Y+i._rotation21*c._relPos1Z,p=i._rotation02*c._relPos1X+i._rotation12*c._relPos1Y+i._rotation22*c._relPos1Z,c._localPos1X=f,c._localPos1Y=u,c._localPos1Z=p;var x,y,d;x=a._rotation00*c._relPos2X+a._rotation10*c._relPos2Y+a._rotation20*c._relPos2Z,y=a._rotation01*c._relPos2X+a._rotation11*c._relPos2Y+a._rotation21*c._relPos2Z,d=a._rotation02*c._relPos2X+a._rotation12*c._relPos2Y+a._rotation22*c._relPos2Z,c._localPos2X=x,c._localPos2Y=y,c._localPos2Z=d,c._depth=m.depth;var g=c._impulse;g.impulseN=0,g.impulseT=0,g.impulseB=0,g.impulseP=0,g.impulseLX=0,g.impulseLY=0,g.impulseLZ=0,c._id=m.id,c._warmStarted=!1,c._disabled=!1;for(var X=0,Y=this.numOldPoints;X<Y;){var z=this.oldPoints[X++];if(c._id==z._id){c._impulse.copyFrom(z._impulse),c._warmStarted=!0;break}}}},i.incrementalUpdate=function(t,i,a){this._manifold._updateDepthsAndPositions(i,a);for(var n=0,o=this._manifold._numPoints;n<o;)this._manifold._points[n++]._warmStarted=!0;var s=t.points[0],r=this.findNearestContactPointIndex(s,i,a);if(-1==r)this.addManifoldPoint(s,i,a);else{var e=this._manifold._points[r],_=s.position1;e._pos1X=_.x,e._pos1Y=_.y,e._pos1Z=_.z;var h,l,c,m,v,b,f=s.position2;e._pos2X=f.x,e._pos2Y=f.y,e._pos2Z=f.z,e._relPos1X=e._pos1X-i._positionX,e._relPos1Y=e._pos1Y-i._positionY,e._relPos1Z=e._pos1Z-i._positionZ,e._relPos2X=e._pos2X-a._positionX,e._relPos2Y=e._pos2Y-a._positionY,e._relPos2Z=e._pos2Z-a._positionZ,h=i._rotation00*e._relPos1X+i._rotation10*e._relPos1Y+i._rotation20*e._relPos1Z,l=i._rotation01*e._relPos1X+i._rotation11*e._relPos1Y+i._rotation21*e._relPos1Z,c=i._rotation02*e._relPos1X+i._rotation12*e._relPos1Y+i._rotation22*e._relPos1Z,e._localPos1X=h,e._localPos1Y=l,e._localPos1Z=c,m=a._rotation00*e._relPos2X+a._rotation10*e._relPos2Y+a._rotation20*e._relPos2Z,v=a._rotation01*e._relPos2X+a._rotation11*e._relPos2Y+a._rotation21*e._relPos2Z,b=a._rotation02*e._relPos2X+a._rotation12*e._relPos2Y+a._rotation22*e._relPos2Z,e._localPos2X=m,e._localPos2Y=v,e._localPos2Z=b,e._depth=s.depth}this.removeOutdatedPoints()},t}(),r.dynamics.constraint.info||(r.dynamics.constraint.info={}),r.dynamics.constraint.info.JacobianRow=function(){function t(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}return t.prototype.updateSparsity=function(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)},t}(),r.dynamics.constraint.info.contact||(r.dynamics.constraint.info.contact={}),r.dynamics.constraint.info.contact.ContactSolverInfo=function(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(r.common.Setting.maxManifoldPoints);for(var t=0,i=this.rows.length;t<i;)this.rows[t++]=new r.dynamics.constraint.info.contact.ContactSolverInfoRow},r.dynamics.constraint.info.contact.ContactSolverInfoRow=function(){this.jacobianN=new r.dynamics.constraint.info.JacobianRow,this.jacobianT=new r.dynamics.constraint.info.JacobianRow,this.jacobianB=new r.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null},r.dynamics.constraint.info.joint||(r.dynamics.constraint.info.joint={}),r.dynamics.constraint.info.joint.JointSolverInfo=function(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(r.common.Setting.maxJacobianRows);for(var t=0,i=this.rows.length;t<i;)this.rows[t++]=new r.dynamics.constraint.info.joint.JointSolverInfoRow},r.dynamics.constraint.info.joint.JointSolverInfoRow=function(){this.jacobian=new r.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null},r.dynamics.constraint.joint||(r.dynamics.constraint.joint={}),r.dynamics.constraint.joint.BasisTracker=function(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0},r.dynamics.constraint.joint.Joint=function(){function t(t,i){switch(this._link1=new r.dynamics.constraint.joint.JointLink(this),this._link2=new r.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=r.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new r.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new r.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this)}var a=t.localAnchor1;this._localAnchor1X=a.x,this._localAnchor1Y=a.y,this._localAnchor1Z=a.z;var n=t.localAnchor2;this._localAnchor2X=n.x,this._localAnchor2Y=n.y,this._localAnchor2Z=n.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0,this._impulses=new Array(r.common.Setting.maxJacobianRows);for(var o=0,s=r.common.Setting.maxJacobianRows;o<s;)this._impulses[o++]=new r.dynamics.constraint.joint.JointImpulse}var i=t.prototype;return i.buildLocalBasesFromX=function(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var i=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;i>0&&(i=1/Math.sqrt(i)),this._localBasisX2X*=i,this._localBasisX2Y*=i,this._localBasisX2Z*=i}var a,n,o,s,r,e,_,h,l,c,m,v,b,f=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(f<-.999999999){var u,p,x,y,d=this._localBasisX1X,g=this._localBasisX1Y,X=this._localBasisX1Z,Y=d*d,z=g*g,Z=X*X;Y<z?Y<Z?(u=0,p=X*(y=1/Math.sqrt(z+Z)),x=-g*y):(u=g*(y=1/Math.sqrt(Y+z)),p=-d*y,x=0):z<Z?(u=-X*(y=1/Math.sqrt(Z+Y)),p=0,x=d*y):(u=g*(y=1/Math.sqrt(Y+z)),p=-d*y,x=0),a=u,n=p,o=x,s=0}else{var M,I,V;M=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,I=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,V=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var w=Math.sqrt(.5*(1+f));a=M*=f=.5/w,n=I*=f,o=V*=f,s=w}var L=2*a,k=2*n,A=2*o,B=a*L,P=n*k,S=o*A,T=a*k,C=n*A,j=a*A,R=s*L,E=s*k,q=s*A;r=1-P-S,e=T-q,_=j+E,h=T+q,l=1-B-S,c=C-R,m=j-E,v=C+R,b=1-B-P;var D,N,F,G,J,W,O,U,H,Q,K=this._localBasisX1X,$=this._localBasisX1Y,tt=this._localBasisX1Z,it=K*K,at=$*$,nt=tt*tt;it<at?it<nt?(D=1/Math.sqrt(at+nt),this._localBasisY1X=0,this._localBasisY1Y=tt*D,this._localBasisY1Z=-$*D):(D=1/Math.sqrt(it+at),this._localBasisY1X=$*D,this._localBasisY1Y=-K*D,this._localBasisY1Z=0):at<nt?(D=1/Math.sqrt(nt+it),this._localBasisY1X=-tt*D,this._localBasisY1Y=0,this._localBasisY1Z=K*D):(D=1/Math.sqrt(it+at),this._localBasisY1X=$*D,this._localBasisY1Y=-K*D,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,N=r*this._localBasisX1X+e*this._localBasisX1Y+_*this._localBasisX1Z,F=h*this._localBasisX1X+l*this._localBasisX1Y+c*this._localBasisX1Z,G=m*this._localBasisX1X+v*this._localBasisX1Y+b*this._localBasisX1Z,this._localBasisX2X=N,this._localBasisX2Y=F,this._localBasisX2Z=G,J=r*this._localBasisY1X+e*this._localBasisY1Y+_*this._localBasisY1Z,W=h*this._localBasisY1X+l*this._localBasisY1Y+c*this._localBasisY1Z,O=m*this._localBasisY1X+v*this._localBasisY1Y+b*this._localBasisY1Z,this._localBasisY2X=J,this._localBasisY2Y=W,this._localBasisY2Z=O,U=r*this._localBasisZ1X+e*this._localBasisZ1Y+_*this._localBasisZ1Z,H=h*this._localBasisZ1X+l*this._localBasisZ1Y+c*this._localBasisZ1Z,Q=m*this._localBasisZ1X+v*this._localBasisZ1Y+b*this._localBasisZ1Z,this._localBasisZ2X=U,this._localBasisZ2Y=H,this._localBasisZ2Z=Q},i.buildLocalBasesFromXY=function(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var i=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;i>0&&(i=1/Math.sqrt(i)),this._localBasisX2X*=i,this._localBasisX2Y*=i,this._localBasisX2Z*=i}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var a,n=this._localBasisX1X,o=this._localBasisX1Y,s=this._localBasisX1Z,r=n*n,e=o*o,_=s*s;r<e?r<_?(a=1/Math.sqrt(e+_),this._localBasisY1X=0,this._localBasisY1Y=s*a,this._localBasisY1Z=-o*a):(a=1/Math.sqrt(r+e),this._localBasisY1X=o*a,this._localBasisY1Y=-n*a,this._localBasisY1Z=0):e<_?(a=1/Math.sqrt(_+r),this._localBasisY1X=-s*a,this._localBasisY1Y=0,this._localBasisY1Z=n*a):(a=1/Math.sqrt(r+e),this._localBasisY1X=o*a,this._localBasisY1Y=-n*a,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var h=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;h>0&&(h=1/Math.sqrt(h)),this._localBasisZ1X*=h,this._localBasisZ1Y*=h,this._localBasisZ1Z*=h,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){var l,c=this._localBasisX2X,m=this._localBasisX2Y,v=this._localBasisX2Z,b=c*c,f=m*m,u=v*v;b<f?b<u?(l=1/Math.sqrt(f+u),this._localBasisY2X=0,this._localBasisY2Y=v*l,this._localBasisY2Z=-m*l):(l=1/Math.sqrt(b+f),this._localBasisY2X=m*l,this._localBasisY2Y=-c*l,this._localBasisY2Z=0):f<u?(l=1/Math.sqrt(u+b),this._localBasisY2X=-v*l,this._localBasisY2Y=0,this._localBasisY2Z=c*l):(l=1/Math.sqrt(b+f),this._localBasisY2X=m*l,this._localBasisY2Y=-c*l,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{var p=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;p>0&&(p=1/Math.sqrt(p)),this._localBasisZ2X*=p,this._localBasisZ2Y*=p,this._localBasisZ2Z*=p,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}},i.buildLocalBasesFromX1Z2=function(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var i=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;i>0&&(i=1/Math.sqrt(i)),this._localBasisZ2X*=i,this._localBasisZ2Y*=i,this._localBasisZ2Z*=i}var a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T=this._b1._transform,C=this._b2._transform;if(a=T._rotation00*this._localBasisX1X+T._rotation01*this._localBasisX1Y+T._rotation02*this._localBasisX1Z,n=T._rotation10*this._localBasisX1X+T._rotation11*this._localBasisX1Y+T._rotation12*this._localBasisX1Z,o=T._rotation20*this._localBasisX1X+T._rotation21*this._localBasisX1Y+T._rotation22*this._localBasisX1Z,p=C._rotation00*this._localBasisZ2X+C._rotation01*this._localBasisZ2Y+C._rotation02*this._localBasisZ2Z,(_=(f=C._rotation10*this._localBasisZ2X+C._rotation11*this._localBasisZ2Y+C._rotation12*this._localBasisZ2Z)*o-(u=C._rotation20*this._localBasisZ2X+C._rotation21*this._localBasisZ2Y+C._rotation22*this._localBasisZ2Z)*n)*_+(h=u*a-(b=p)*o)*h+(l=b*n-f*a)*l==0){var j,R=a,E=n,q=o,D=R*R,N=E*E,F=q*q;D<N?D<F?(_=0,h=q*(j=1/Math.sqrt(N+F)),l=-E*j):(_=E*(j=1/Math.sqrt(D+N)),h=-R*j,l=0):N<F?(_=-q*(j=1/Math.sqrt(F+D)),h=0,l=R*j):(_=E*(j=1/Math.sqrt(D+N)),h=-R*j,l=0)}s=n*l-o*h,r=o*_-a*l,e=a*h-n*_,c=h*u-l*f,m=l*b-_*u,v=_*f-h*b,x=T._rotation00*a+T._rotation10*n+T._rotation20*o,y=T._rotation01*a+T._rotation11*n+T._rotation21*o,d=T._rotation02*a+T._rotation12*n+T._rotation22*o,this._localBasisX1X=x,this._localBasisX1Y=y,this._localBasisX1Z=d,g=T._rotation00*_+T._rotation10*h+T._rotation20*l,X=T._rotation01*_+T._rotation11*h+T._rotation21*l,Y=T._rotation02*_+T._rotation12*h+T._rotation22*l,this._localBasisY1X=g,this._localBasisY1Y=X,this._localBasisY1Z=Y,z=T._rotation00*s+T._rotation10*r+T._rotation20*e,Z=T._rotation01*s+T._rotation11*r+T._rotation21*e,M=T._rotation02*s+T._rotation12*r+T._rotation22*e,this._localBasisZ1X=z,this._localBasisZ1Y=Z,this._localBasisZ1Z=M,I=C._rotation00*c+C._rotation10*m+C._rotation20*v,V=C._rotation01*c+C._rotation11*m+C._rotation21*v,w=C._rotation02*c+C._rotation12*m+C._rotation22*v,this._localBasisX2X=I,this._localBasisX2Y=V,this._localBasisX2Z=w,L=C._rotation00*_+C._rotation10*h+C._rotation20*l,k=C._rotation01*_+C._rotation11*h+C._rotation21*l,A=C._rotation02*_+C._rotation12*h+C._rotation22*l,this._localBasisY2X=L,this._localBasisY2Y=k,this._localBasisY2Z=A,B=C._rotation00*b+C._rotation10*f+C._rotation20*u,P=C._rotation01*b+C._rotation11*f+C._rotation21*u,S=C._rotation02*b+C._rotation12*f+C._rotation22*u,this._localBasisZ2X=B,this._localBasisZ2Y=P,this._localBasisZ2Z=S},i.buildLocalBasesFromXY1X2=function(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var i,a=this._localBasisX1X,n=this._localBasisX1Y,o=this._localBasisX1Z,s=a*a,r=n*n,e=o*o;s<r?s<e?(i=1/Math.sqrt(r+e),this._localBasisY1X=0,this._localBasisY1Y=o*i,this._localBasisY1Z=-n*i):(i=1/Math.sqrt(s+r),this._localBasisY1X=n*i,this._localBasisY1Y=-a*i,this._localBasisY1Z=0):r<e?(i=1/Math.sqrt(e+s),this._localBasisY1X=-o*i,this._localBasisY1Y=0,this._localBasisY1Z=a*i):(i=1/Math.sqrt(s+r),this._localBasisY1X=n*i,this._localBasisY1Y=-a*i,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var _=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;_>0&&(_=1/Math.sqrt(_)),this._localBasisZ1X*=_,this._localBasisZ1Y*=_,this._localBasisZ1Z*=_,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var h,l,c,m,v,b,f,u,p,x,y,d,g,X=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(X<-.999999999){var Y,z,Z,M,I=this._localBasisX1X,V=this._localBasisX1Y,w=this._localBasisX1Z,L=I*I,k=V*V,A=w*w;L<k?L<A?(Y=0,z=w*(M=1/Math.sqrt(k+A)),Z=-V*M):(Y=V*(M=1/Math.sqrt(L+k)),z=-I*M,Z=0):k<A?(Y=-w*(M=1/Math.sqrt(A+L)),z=0,Z=I*M):(Y=V*(M=1/Math.sqrt(L+k)),z=-I*M,Z=0),h=Y,l=z,c=Z,m=0}else{var B,P,S;B=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,P=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,S=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var T=Math.sqrt(.5*(1+X));h=B*=X=.5/T,l=P*=X,c=S*=X,m=T}var C,j,R,E,q,D,N,F,G,J=2*h,W=2*l,O=2*c,U=h*J,H=l*W,Q=c*O,K=h*W,$=l*O,tt=h*O,it=m*J,at=m*W,nt=m*O;b=K-nt,f=tt+at,u=K+nt,p=1-U-Q,x=$-it,y=tt-at,d=$+it,g=1-U-H,C=(v=1-H-Q)*this._localBasisX1X+b*this._localBasisX1Y+f*this._localBasisX1Z,j=u*this._localBasisX1X+p*this._localBasisX1Y+x*this._localBasisX1Z,R=y*this._localBasisX1X+d*this._localBasisX1Y+g*this._localBasisX1Z,this._localBasisX2X=C,this._localBasisX2Y=j,this._localBasisX2Z=R,E=v*this._localBasisY1X+b*this._localBasisY1Y+f*this._localBasisY1Z,q=u*this._localBasisY1X+p*this._localBasisY1Y+x*this._localBasisY1Z,D=y*this._localBasisY1X+d*this._localBasisY1Y+g*this._localBasisY1Z,this._localBasisY2X=E,this._localBasisY2Y=q,this._localBasisY2Z=D,N=v*this._localBasisZ1X+b*this._localBasisZ1Y+f*this._localBasisZ1Z,F=u*this._localBasisZ1X+p*this._localBasisZ1Y+x*this._localBasisZ1Z,G=y*this._localBasisZ1X+d*this._localBasisZ1Y+g*this._localBasisZ1Z,this._localBasisZ2X=N,this._localBasisZ2Y=F,this._localBasisZ2Z=G},i.setSolverInfoRowLinear=function(t,i,a,n,o,s,e){var _,h,l=r.common.Setting.linearSlop;if(e)_=0,h=1;else{if(o.frequency>0){l=0;var c=6.28318530717958*o.frequency,m=o.dampingRatio;m<r.common.Setting.minSpringDamperDampingRatio&&(m=r.common.Setting.minSpringDamperDampingRatio);var v=s.dt,b=2*m*c,f=c*c;o.useSymplecticEuler?(_=1/(v*b),h=f/b):(_=1/(v*(v*f+b)),h=f/(v*f+b))}else _=0,h=this.getErp(s,!1);a.motorForce>0?(t.motorSpeed=a.motorSpeed,t.motorMaxImpulse=a.motorForce*s.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}var u,p,x,y=a.lowerLimit,d=a.upperLimit;y>d?(u=0,p=0,x=0):y==d?(u=-Infinity,p=Infinity,x=i-y):i<y?(u=-Infinity,p=0,(x=i-y+l)>0&&(x=0)):i>d?(u=0,p=Infinity,(x=i-d-l)<0&&(x=0)):(u=0,p=0,x=0),t.minImpulse=u,t.maxImpulse=p,t.cfm=_*(0==n?0:1/n),t.rhs=x*h},i.setSolverInfoRowAngular=function(t,i,a,n,o,s,e){var _,h,l=r.common.Setting.angularSlop;if(e)_=0,h=1;else{if(o.frequency>0){l=0;var c=6.28318530717958*o.frequency,m=o.dampingRatio;m<r.common.Setting.minSpringDamperDampingRatio&&(m=r.common.Setting.minSpringDamperDampingRatio);var v=s.dt,b=2*m*c,f=c*c;o.useSymplecticEuler?(_=1/(v*b),h=f/b):(_=1/(v*(v*f+b)),h=f/(v*f+b))}else _=0,h=this.getErp(s,!1);a.motorTorque>0?(t.motorSpeed=a.motorSpeed,t.motorMaxImpulse=a.motorTorque*s.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}var u,p,x,y=a.lowerLimit,d=a.upperLimit,g=.5*(y+d);i=(((i-=g)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,i+=g,y>d?(u=0,p=0,x=0):y==d?(u=-Infinity,p=Infinity,x=i-y):i<y?(u=-Infinity,p=0,(x=i-y+l)>0&&(x=0)):i>d?(u=0,p=Infinity,(x=i-d-l)<0&&(x=0)):(u=0,p=0,x=0),t.minImpulse=u,t.maxImpulse=p,t.cfm=_*(0==n?0:1/n),t.rhs=x*h},i.getErp=function(t,i){return i?1:this._positionCorrectionAlgorithm==r.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*r.common.Setting.velocityBaumgarte:0},i.computeEffectiveInertiaMoment=function(t,i,a){var n=(this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*a)*t+(this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*a)*i+(this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*a)*a,o=(this._b2._invInertia00*t+this._b2._invInertia01*i+this._b2._invInertia02*a)*t+(this._b2._invInertia10*t+this._b2._invInertia11*i+this._b2._invInertia12*a)*i+(this._b2._invInertia20*t+this._b2._invInertia21*i+this._b2._invInertia22*a)*a;if(n>0){var s=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+a*this._relativeAnchor1Z,r=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z-s*s;r>0&&(n=this._b1._invMass>0?1/(1/n+this._b1._mass*r):0)}if(o>0){var e=t*this._relativeAnchor2X+i*this._relativeAnchor2Y+a*this._relativeAnchor2Z,_=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z-e*e;_>0&&(o=this._b2._invMass>0?1/(1/o+this._b2._mass*_):0)}return n+o==0?0:1/(n+o)},i.computeEffectiveInertiaMoment2=function(t,i,a,n,o,s){var r=(this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*a)*t+(this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*a)*i+(this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*a)*a,e=(this._b2._invInertia00*n+this._b2._invInertia01*o+this._b2._invInertia02*s)*n+(this._b2._invInertia10*n+this._b2._invInertia11*o+this._b2._invInertia12*s)*o+(this._b2._invInertia20*n+this._b2._invInertia21*o+this._b2._invInertia22*s)*s;if(r>0){var _=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,h=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+a*this._relativeAnchor1Z,l=_*_-h*h;l>0&&(r=this._b1._invMass>0?1/(1/r+this._b1._mass*l):0)}if(e>0){var c=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,m=n*this._relativeAnchor2X+o*this._relativeAnchor2Y+s*this._relativeAnchor2Z,v=c*c-m*m;v>0&&(e=this._b2._invMass>0?1/(1/e+this._b2._mass*v):0)}return r+e==0?0:1/(r+e)},i._syncAnchors=function(){var t,i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z=this._b1._transform,Z=this._b2._transform;t=z._rotation00*this._localAnchor1X+z._rotation01*this._localAnchor1Y+z._rotation02*this._localAnchor1Z,i=z._rotation10*this._localAnchor1X+z._rotation11*this._localAnchor1Y+z._rotation12*this._localAnchor1Z,a=z._rotation20*this._localAnchor1X+z._rotation21*this._localAnchor1Y+z._rotation22*this._localAnchor1Z,this._relativeAnchor1X=t,this._relativeAnchor1Y=i,this._relativeAnchor1Z=a,n=Z._rotation00*this._localAnchor2X+Z._rotation01*this._localAnchor2Y+Z._rotation02*this._localAnchor2Z,o=Z._rotation10*this._localAnchor2X+Z._rotation11*this._localAnchor2Y+Z._rotation12*this._localAnchor2Z,s=Z._rotation20*this._localAnchor2X+Z._rotation21*this._localAnchor2Y+Z._rotation22*this._localAnchor2Z,this._relativeAnchor2X=n,this._relativeAnchor2Y=o,this._relativeAnchor2Z=s,this._anchor1X=this._relativeAnchor1X+z._positionX,this._anchor1Y=this._relativeAnchor1Y+z._positionY,this._anchor1Z=this._relativeAnchor1Z+z._positionZ,this._anchor2X=this._relativeAnchor2X+Z._positionX,this._anchor2Y=this._relativeAnchor2Y+Z._positionY,this._anchor2Z=this._relativeAnchor2Z+Z._positionZ,r=z._rotation00*this._localBasisX1X+z._rotation01*this._localBasisX1Y+z._rotation02*this._localBasisX1Z,e=z._rotation10*this._localBasisX1X+z._rotation11*this._localBasisX1Y+z._rotation12*this._localBasisX1Z,_=z._rotation20*this._localBasisX1X+z._rotation21*this._localBasisX1Y+z._rotation22*this._localBasisX1Z,this._basisX1X=r,this._basisX1Y=e,this._basisX1Z=_,h=z._rotation00*this._localBasisY1X+z._rotation01*this._localBasisY1Y+z._rotation02*this._localBasisY1Z,l=z._rotation10*this._localBasisY1X+z._rotation11*this._localBasisY1Y+z._rotation12*this._localBasisY1Z,c=z._rotation20*this._localBasisY1X+z._rotation21*this._localBasisY1Y+z._rotation22*this._localBasisY1Z,this._basisY1X=h,this._basisY1Y=l,this._basisY1Z=c,m=z._rotation00*this._localBasisZ1X+z._rotation01*this._localBasisZ1Y+z._rotation02*this._localBasisZ1Z,v=z._rotation10*this._localBasisZ1X+z._rotation11*this._localBasisZ1Y+z._rotation12*this._localBasisZ1Z,b=z._rotation20*this._localBasisZ1X+z._rotation21*this._localBasisZ1Y+z._rotation22*this._localBasisZ1Z,this._basisZ1X=m,this._basisZ1Y=v,this._basisZ1Z=b,f=Z._rotation00*this._localBasisX2X+Z._rotation01*this._localBasisX2Y+Z._rotation02*this._localBasisX2Z,u=Z._rotation10*this._localBasisX2X+Z._rotation11*this._localBasisX2Y+Z._rotation12*this._localBasisX2Z,p=Z._rotation20*this._localBasisX2X+Z._rotation21*this._localBasisX2Y+Z._rotation22*this._localBasisX2Z,this._basisX2X=f,this._basisX2Y=u,this._basisX2Z=p,x=Z._rotation00*this._localBasisY2X+Z._rotation01*this._localBasisY2Y+Z._rotation02*this._localBasisY2Z,y=Z._rotation10*this._localBasisY2X+Z._rotation11*this._localBasisY2Y+Z._rotation12*this._localBasisY2Z,d=Z._rotation20*this._localBasisY2X+Z._rotation21*this._localBasisY2Y+Z._rotation22*this._localBasisY2Z,this._basisY2X=x,this._basisY2Y=y,this._basisY2Z=d,g=Z._rotation00*this._localBasisZ2X+Z._rotation01*this._localBasisZ2Y+Z._rotation02*this._localBasisZ2Z,X=Z._rotation10*this._localBasisZ2X+Z._rotation11*this._localBasisZ2Y+Z._rotation12*this._localBasisZ2Z,Y=Z._rotation20*this._localBasisZ2X+Z._rotation21*this._localBasisZ2Y+Z._rotation22*this._localBasisZ2Z,this._basisZ2X=g,this._basisZ2Y=X,this._basisZ2Z=Y},i._getVelocitySolverInfo=function(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0},i._getPositionSolverInfo=function(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0},i._checkDestruction=function(){var t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;(this._breakForce>0&&this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ>this._breakForce*this._breakForce||this._breakTorque>0&&t>this._breakTorque*this._breakTorque)&&this._world.removeJoint(this)},i.getRigidBody1=function(){return this._b1},i.getRigidBody2=function(){return this._b2},i.getType=function(){return this._type},i.getAnchor1=function(){var t=new r.common.Vec3;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,t},i.getAnchor2=function(){var t=new r.common.Vec3;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,t},i.getAnchor1To=function(t){t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z},i.getAnchor2To=function(t){t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z},i.getLocalAnchor1=function(){var t=new r.common.Vec3;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,t},i.getLocalAnchor2=function(){var t=new r.common.Vec3;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,t},i.getLocalAnchor1To=function(t){t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z},i.getLocalAnchor2To=function(t){t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z},i.getBasis1=function(){var t,i,a,n,o,s,e,_,h,l=new r.common.Mat3;return t=this._basisX1X,i=this._basisY1X,a=this._basisZ1X,n=this._basisX1Y,o=this._basisY1Y,s=this._basisZ1Y,e=this._basisX1Z,_=this._basisY1Z,h=this._basisZ1Z,l.e00=t,l.e01=i,l.e02=a,l.e10=n,l.e11=o,l.e12=s,l.e20=e,l.e21=_,l.e22=h,l},i.getBasis2=function(){var t,i,a,n,o,s,e,_,h,l=new r.common.Mat3;return t=this._basisX2X,i=this._basisY2X,a=this._basisZ2X,n=this._basisX2Y,o=this._basisY2Y,s=this._basisZ2Y,e=this._basisX2Z,_=this._basisY2Z,h=this._basisZ2Z,l.e00=t,l.e01=i,l.e02=a,l.e10=n,l.e11=o,l.e12=s,l.e20=e,l.e21=_,l.e22=h,l},i.getBasis1To=function(t){var i,a,n,o,s,r,e,_,h;i=this._basisX1X,a=this._basisY1X,n=this._basisZ1X,o=this._basisX1Y,s=this._basisY1Y,r=this._basisZ1Y,e=this._basisX1Z,_=this._basisY1Z,h=this._basisZ1Z,t.e00=i,t.e01=a,t.e02=n,t.e10=o,t.e11=s,t.e12=r,t.e20=e,t.e21=_,t.e22=h},i.getBasis2To=function(t){var i,a,n,o,s,r,e,_,h;i=this._basisX2X,a=this._basisY2X,n=this._basisZ2X,o=this._basisX2Y,s=this._basisY2Y,r=this._basisZ2Y,e=this._basisX2Z,_=this._basisY2Z,h=this._basisZ2Z,t.e00=i,t.e01=a,t.e02=n,t.e10=o,t.e11=s,t.e12=r,t.e20=e,t.e21=_,t.e22=h},i.getAllowCollision=function(){return this._allowCollision},i.setAllowCollision=function(t){this._allowCollision=t},i.getBreakForce=function(){return this._breakForce},i.setBreakForce=function(t){this._breakForce=t},i.getBreakTorque=function(){return this._breakTorque},i.setBreakTorque=function(t){this._breakTorque=t},i.getPositionCorrectionAlgorithm=function(){return this._positionCorrectionAlgorithm},i.setPositionCorrectionAlgorithm=function(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t},i.getAppliedForce=function(){var t=new r.common.Vec3;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,t},i.getAppliedForceTo=function(t){t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ},i.getAppliedTorque=function(){var t=new r.common.Vec3;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,t},i.getAppliedTorqueTo=function(t){t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ},i.getPrev=function(){return this._prev},i.getNext=function(){return this._next},t}(),r.dynamics.constraint.joint.CylindricalJoint=function(t){function i(i){var a;a=t.call(this,i,2)||this;var n=i.localAxis1;a._localBasisX1X=n.x,a._localBasisX1Y=n.y,a._localBasisX1Z=n.z;var s=i.localAxis2;return a._localBasisX2X=s.x,a._localBasisX2Y=s.y,a._localBasisX2Z=s.z,a.buildLocalBasesFromX(),a.angle=0,a.angularErrorY=0,a.angularErrorZ=0,a.translation=0,a.linearErrorY=0,a.linearErrorZ=0,a._basis=new r.dynamics.constraint.joint.BasisTracker(o(a)),a._translSd=i.translationalSpringDamper.clone(),a._translLm=i.translationalLimitMotor.clone(),a._rotSd=i.rotationalSpringDamper.clone(),a._rotLm=i.rotationalLimitMotor.clone(),a}a(i,t);var n=i.prototype;return n.getInfo=function(t,i,a){var n,o=this.getErp(i,a),s=this.linearErrorY*o,r=this.linearErrorZ*o,e=this.angularErrorY*o,_=this.angularErrorZ*o,h=1/(this._b1._invMass+this._b2._invMass),l=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!a){var c=this._impulses[0],m=t.rows[t.numRows++],v=m.jacobian;v.lin1X=0,v.lin1Y=0,v.lin1Z=0,v.lin2X=0,v.lin2Y=0,v.lin2Z=0,v.ang1X=0,v.ang1Y=0,v.ang1Z=0,v.ang2X=0,v.ang2Y=0,v.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=c,this.setSolverInfoRowLinear(m,this.translation,this._translLm,h,this._translSd,i,a),(n=m.jacobian).lin1X=this._basis.xX,n.lin1Y=this._basis.xY,n.lin1Z=this._basis.xZ,n.lin2X=this._basis.xX,n.lin2Y=this._basis.xY,n.lin2Z=this._basis.xZ,n.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,n.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,n.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,n.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,n.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,n.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var b=this._impulses[1],f=t.rows[t.numRows++],u=f.jacobian;u.lin1X=0,u.lin1Y=0,u.lin1Z=0,u.lin2X=0,u.lin2Y=0,u.lin2Z=0,u.ang1X=0,u.ang1Y=0,u.ang1Z=0,u.ang2X=0,u.ang2Y=0,u.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,f.rhs=s,f.cfm=0,f.minImpulse=-Infinity,f.maxImpulse=Infinity,(n=f.jacobian).lin1X=this._basis.yX,n.lin1Y=this._basis.yY,n.lin1Z=this._basis.yZ,n.lin2X=this._basis.yX,n.lin2Y=this._basis.yY,n.lin2Z=this._basis.yZ,n.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,n.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,n.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,n.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,n.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,n.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var p=this._impulses[2],x=t.rows[t.numRows++],y=x.jacobian;if(y.lin1X=0,y.lin1Y=0,y.lin1Z=0,y.lin2X=0,y.lin2Y=0,y.lin2Z=0,y.ang1X=0,y.ang1Y=0,y.ang1Z=0,y.ang2X=0,y.ang2Y=0,y.ang2Z=0,x.rhs=0,x.cfm=0,x.minImpulse=0,x.maxImpulse=0,x.motorSpeed=0,x.motorMaxImpulse=0,x.impulse=null,x.impulse=p,x.rhs=r,x.cfm=0,x.minImpulse=-Infinity,x.maxImpulse=Infinity,(n=x.jacobian).lin1X=this._basis.zX,n.lin1Y=this._basis.zY,n.lin1Z=this._basis.zZ,n.lin2X=this._basis.zX,n.lin2Y=this._basis.zY,n.lin2Z=this._basis.zZ,n.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,n.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,n.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,n.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,n.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,n.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!a){var d=this._impulses[3],g=t.rows[t.numRows++],X=g.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,g.rhs=0,g.cfm=0,g.minImpulse=0,g.maxImpulse=0,g.motorSpeed=0,g.motorMaxImpulse=0,g.impulse=null,g.impulse=d,this.setSolverInfoRowAngular(g,this.angle,this._rotLm,l,this._rotSd,i,a),(n=g.jacobian).ang1X=this._basis.xX,n.ang1Y=this._basis.xY,n.ang1Z=this._basis.xZ,n.ang2X=this._basis.xX,n.ang2Y=this._basis.xY,n.ang2Z=this._basis.xZ}var Y=this._impulses[4],z=t.rows[t.numRows++],Z=z.jacobian;Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=0,Z.ang1Y=0,Z.ang1Z=0,Z.ang2X=0,Z.ang2Y=0,Z.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=Y,z.rhs=e,z.cfm=0,z.minImpulse=-Infinity,z.maxImpulse=Infinity,(n=z.jacobian).ang1X=this._basis.yX,n.ang1Y=this._basis.yY,n.ang1Z=this._basis.yZ,n.ang2X=this._basis.yX,n.ang2Y=this._basis.yY,n.ang2Z=this._basis.yZ;var M=this._impulses[5],I=t.rows[t.numRows++],V=I.jacobian;V.lin1X=0,V.lin1Y=0,V.lin1Z=0,V.lin2X=0,V.lin2Y=0,V.lin2Z=0,V.ang1X=0,V.ang1Y=0,V.ang1Z=0,V.ang2X=0,V.ang2Y=0,V.ang2Z=0,I.rhs=0,I.cfm=0,I.minImpulse=0,I.maxImpulse=0,I.motorSpeed=0,I.motorMaxImpulse=0,I.impulse=null,I.impulse=M,I.rhs=_,I.cfm=0,I.minImpulse=-Infinity,I.maxImpulse=Infinity,(n=I.jacobian).ang1X=this._basis.zX,n.ang1Y=this._basis.zY,n.ang1Z=this._basis.zZ,n.ang2X=this._basis.zX,n.ang2Y=this._basis.zY,n.ang2Z=this._basis.zZ},n._syncAnchors=function(){t.prototype._syncAnchors.call(this);var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,E=this._basis,q=E.joint._b1._invMass,D=E.joint._b2._invMass,N=E.joint._basisX1X*E.joint._basisX2X+E.joint._basisX1Y*E.joint._basisX2Y+E.joint._basisX1Z*E.joint._basisX2Z;if(N<-.999999999){var F,G,J,W,O=E.joint._basisX1X,U=E.joint._basisX1Y,H=E.joint._basisX1Z,Q=O*O,K=U*U,$=H*H;Q<K?Q<$?(F=0,G=H*(W=1/Math.sqrt(K+$)),J=-U*W):(F=U*(W=1/Math.sqrt(Q+K)),G=-O*W,J=0):K<$?(F=-H*(W=1/Math.sqrt($+Q)),G=0,J=O*W):(F=U*(W=1/Math.sqrt(Q+K)),G=-O*W,J=0),i=F,a=G,n=J,o=0}else{var tt,it,at;tt=E.joint._basisX1Y*E.joint._basisX2Z-E.joint._basisX1Z*E.joint._basisX2Y,it=E.joint._basisX1Z*E.joint._basisX2X-E.joint._basisX1X*E.joint._basisX2Z,at=E.joint._basisX1X*E.joint._basisX2Y-E.joint._basisX1Y*E.joint._basisX2X;var nt=Math.sqrt(.5*(1+N));i=tt*=N=.5/nt,a=it*=N,n=at*=N,o=nt}var ot=(A=0)*(T=i)+(B=0)*(C=a)+(P=0)*(j=n)+(S=1)*(R=o);if(ot<0&&(ot=-ot,T=-T,C=-C,j=-j,R=-R),ot>.999999){var st=(T=A+(T-A)*(q/(q+D)))*T+(C=B+(C-B)*(q/(q+D)))*C+(j=P+(j-P)*(q/(q+D)))*j+(R=S+(R-S)*(q/(q+D)))*R;st>1e-32&&(st=1/Math.sqrt(st)),s=T*st,r=C*st,e=j*st,_=R*st}else{var rt=q/(q+D)*Math.acos(ot),et=(T+=A*-ot)*T+(C+=B*-ot)*C+(j+=P*-ot)*j+(R+=S*-ot)*R;et>1e-32&&(et=1/Math.sqrt(et)),T*=et,C*=et,j*=et,R*=et;var _t=Math.sin(rt),ht=Math.cos(rt);s=(A*=ht)+T*_t,r=(B*=ht)+C*_t,e=(P*=ht)+j*_t,_=(S*=ht)+R*_t}var lt=2*s,ct=2*r,mt=2*e,vt=s*lt,bt=r*ct,ft=e*mt,ut=s*ct,pt=r*mt,xt=s*mt,yt=_*lt,dt=_*ct,gt=_*mt;h=ut-gt,l=xt+dt,c=ut+gt,m=1-vt-ft,v=pt-yt,b=xt-dt,f=pt+yt,u=1-vt-bt,p=(1-bt-ft)*E.joint._basisX1X+h*E.joint._basisX1Y+l*E.joint._basisX1Z,x=c*E.joint._basisX1X+m*E.joint._basisX1Y+v*E.joint._basisX1Z,y=b*E.joint._basisX1X+f*E.joint._basisX1Y+u*E.joint._basisX1Z,M=E.xX,I=E.xY,V=E.xZ,w=E.yX,L=E.yY,k=E.yZ;var Xt=M*p+I*x+V*y;if(Xt<-.999999999){var Yt,zt,Zt,Mt,It=M,Vt=I,wt=V,Lt=It*It,kt=Vt*Vt,At=wt*wt;Lt<kt?Lt<At?(Yt=0,zt=wt*(Mt=1/Math.sqrt(kt+At)),Zt=-Vt*Mt):(Yt=Vt*(Mt=1/Math.sqrt(Lt+kt)),zt=-It*Mt,Zt=0):kt<At?(Yt=-wt*(Mt=1/Math.sqrt(At+Lt)),zt=0,Zt=It*Mt):(Yt=Vt*(Mt=1/Math.sqrt(Lt+kt)),zt=-It*Mt,Zt=0),s=Yt,r=zt,e=Zt,_=0}else{var Bt,Pt,St;Bt=I*y-V*x,Pt=V*p-M*y,St=M*x-I*p;var Tt=Math.sqrt(.5*(1+Xt));s=Bt*=Xt=.5/Tt,r=Pt*=Xt,e=St*=Xt,_=Tt}var Ct,jt,Rt,Et=2*s,qt=2*r,Dt=2*e,Nt=s*Et,Ft=r*qt,Gt=e*Dt,Jt=s*qt,Wt=r*Dt,Ot=s*Dt,Ut=_*Et,Ht=_*qt,Qt=_*Dt;if((Y=x*(X=(b=Ot-Ht)*w+(f=Wt+Ut)*L+(u=1-Nt-Ft)*k)-y*(g=(c=Jt+Qt)*w+(m=1-Nt-Gt)*L+(v=Wt-Ut)*k))*Y+(z=y*(d=(1-Ft-Gt)*w+(h=Jt-Qt)*L+(l=Ot+Ht)*k)-p*X)*z+(Z=p*g-x*d)*Z>1e-6){var Kt=Y*Y+z*z+Z*Z;Kt>0&&(Kt=1/Math.sqrt(Kt)),Y*=Kt,z*=Kt,Z*=Kt}else{var $t,ti=p,ii=x,ai=y,ni=ti*ti,oi=ii*ii,si=ai*ai;ni<oi?ni<si?(Y=0,z=ai*($t=1/Math.sqrt(oi+si)),Z=-ii*$t):(Y=ii*($t=1/Math.sqrt(ni+oi)),z=-ti*$t,Z=0):oi<si?(Y=-ai*($t=1/Math.sqrt(si+ni)),z=0,Z=ti*$t):(Y=ii*($t=1/Math.sqrt(ni+oi)),z=-ti*$t,Z=0)}d=z*y-Z*x,g=Z*p-Y*y,X=Y*x-z*p,E.xX=p,E.xY=x,E.xZ=y,E.yX=d,E.yY=g,E.yZ=X,E.zX=Y,E.zY=z,E.zZ=Z,Ct=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,jt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,Rt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ri,ei,_i,hi,li,ci,mi=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,vi=mi<=-1?3.14159265358979:mi>=1?0:Math.acos(mi),bi=Ct*Ct+jt*jt+Rt*Rt;bi>0&&(bi=1/Math.sqrt(bi)),Ct*=bi,jt*=bi,Rt*=bi,Ct*=vi,jt*=vi,Rt*=vi,this.angularErrorY=Ct*this._basis.yX+jt*this._basis.yY+Rt*this._basis.yZ,this.angularErrorZ=Ct*this._basis.zX+jt*this._basis.zY+Rt*this._basis.zZ,ri=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ei=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,_i=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,mi=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=mi<=-1?3.14159265358979:mi>=1?0:Math.acos(mi),ri*this._basis.xX+ei*this._basis.xY+_i*this._basis.xZ<0&&(this.angle=-this.angle),hi=this._anchor2X-this._anchor1X,li=this._anchor2Y-this._anchor1Y,ci=this._anchor2Z-this._anchor1Z,this.translation=hi*this._basis.xX+li*this._basis.xY+ci*this._basis.xZ,this.linearErrorY=hi*this._basis.yX+li*this._basis.yY+ci*this._basis.yZ,this.linearErrorZ=hi*this._basis.zX+li*this._basis.zY+ci*this._basis.zZ},n._getVelocitySolverInfo=function(i,a){t.prototype._getVelocitySolverInfo.call(this,i,a),this.getInfo(a,i,!1)},n._getPositionSolverInfo=function(i){t.prototype._getPositionSolverInfo.call(this,i),this.getInfo(i,null,!0)},n.getAxis1=function(){var t=new r.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t},n.getAxis2=function(){var t=new r.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t},n.getAxis1To=function(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},n.getAxis2To=function(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z},n.getLocalAxis1=function(){var t=new r.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t},n.getLocalAxis2=function(){var t=new r.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t},n.getLocalAxis1To=function(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},n.getLocalAxis2To=function(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z},n.getTranslationalSpringDamper=function(){return this._translSd},n.getRotationalSpringDamper=function(){return this._rotSd},n.getTranslationalLimitMotor=function(){return this._translLm},n.getRotationalLimitMotor=function(){return this._rotLm},n.getAngle=function(){return this.angle},n.getTranslation=function(){return this.translation},i}(r.dynamics.constraint.joint.Joint),r.dynamics.constraint.joint.JointConfig=function(){function t(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new r.common.Vec3,this.localAnchor2=new r.common.Vec3,this.allowCollision=!1,this.solverType=r.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=r.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}return t.prototype._init=function(t,i,a){this.rigidBody1=t,this.rigidBody2=i;var n,o,s,r,e,_,h=this.rigidBody1,l=this.localAnchor1;n=a.x,o=a.y,s=a.z,n-=h._transform._positionX,o-=h._transform._positionY,s-=h._transform._positionZ,r=h._transform._rotation00*n+h._transform._rotation10*o+h._transform._rotation20*s,e=h._transform._rotation01*n+h._transform._rotation11*o+h._transform._rotation21*s,_=h._transform._rotation02*n+h._transform._rotation12*o+h._transform._rotation22*s,n=r,o=e,s=_,l.x=n,l.y=o,l.z=s;var c,m,v,b,f,u,p=this.rigidBody2,x=this.localAnchor2;c=a.x,m=a.y,v=a.z,c-=p._transform._positionX,m-=p._transform._positionY,v-=p._transform._positionZ,b=p._transform._rotation00*c+p._transform._rotation10*m+p._transform._rotation20*v,f=p._transform._rotation01*c+p._transform._rotation11*m+p._transform._rotation21*v,u=p._transform._rotation02*c+p._transform._rotation12*m+p._transform._rotation22*v,c=b,m=f,v=u,x.x=c,x.y=m,x.z=v},t}(),r.dynamics.constraint.joint.CylindricalJointConfig=function(t){function i(){var i;return(i=t.call(this)||this).localAxis1=new r.common.Vec3(1,0,0),i.localAxis2=new r.common.Vec3(1,0,0),i.translationalLimitMotor=new r.dynamics.constraint.joint.TranslationalLimitMotor,i.translationalSpringDamper=new r.dynamics.constraint.joint.SpringDamper,i.rotationalLimitMotor=new r.dynamics.constraint.joint.RotationalLimitMotor,i.rotationalSpringDamper=new r.dynamics.constraint.joint.SpringDamper,i}return a(i,t),i.prototype.init=function(t,i,a,n){this._init(t,i,a);var o,s,r,e,_,h,l=this.localAxis1;o=n.x,s=n.y,r=n.z,e=t._transform._rotation00*o+t._transform._rotation10*s+t._transform._rotation20*r,_=t._transform._rotation01*o+t._transform._rotation11*s+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*s+t._transform._rotation22*r,o=e,s=_,r=h,l.x=o,l.y=s,l.z=r;var c,m,v,b,f,u,p=this.localAxis2;return c=n.x,m=n.y,v=n.z,b=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*v,f=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*v,u=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*v,c=b,m=f,v=u,p.x=c,p.y=m,p.z=v,this},i}(r.dynamics.constraint.joint.JointConfig),r.dynamics.constraint.joint.GenericJoint=function(t){function i(i){var a,n;a=t.call(this,i,r.dynamics.constraint.joint.JointType.GENERIC)||this;var o,s,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y=i.localBasis1;if(Y.e00*(Y.e11*Y.e22-Y.e12*Y.e21)-Y.e01*(Y.e10*Y.e22-Y.e12*Y.e20)+Y.e02*(Y.e10*Y.e21-Y.e11*Y.e20)<0)n=!0;else{var z=i.localBasis2;n=z.e00*(z.e11*z.e22-z.e12*z.e21)-z.e01*(z.e10*z.e22-z.e12*z.e20)+z.e02*(z.e10*z.e21-z.e11*z.e20)<0}n&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");var Z=i.localBasis1;o=Z.e00,s=Z.e01,e=Z.e02,_=Z.e10,h=Z.e11,l=Z.e12,c=Z.e20,m=Z.e21,v=Z.e22;var M=i.localBasis2;return b=M.e00,f=M.e01,u=M.e02,p=M.e10,x=M.e11,y=M.e12,d=M.e20,g=M.e21,X=M.e22,a._localBasisX1X=o,a._localBasisX1Y=_,a._localBasisX1Z=c,a._localBasisY1X=s,a._localBasisY1Y=h,a._localBasisY1Z=m,a._localBasisZ1X=e,a._localBasisZ1Y=l,a._localBasisZ1Z=v,a._localBasisX2X=b,a._localBasisX2Y=p,a._localBasisX2Z=d,a._localBasisY2X=f,a._localBasisY2Y=x,a._localBasisY2Z=g,a._localBasisZ2X=u,a._localBasisZ2Y=y,a._localBasisZ2Z=X,a._angleX=0,a._angleY=0,a._angleZ=0,a.translationX=0,a.translationY=0,a.translationZ=0,a.xSingular=!1,a.ySingular=!1,a.zSingular=!1,a._translLms=new Array(3),a._translSds=new Array(3),a._rotLms=new Array(3),a._rotSds=new Array(3),a._translLms[0]=i.translationalLimitMotors[0].clone(),a._translLms[1]=i.translationalLimitMotors[1].clone(),a._translLms[2]=i.translationalLimitMotors[2].clone(),a._translSds[0]=i.translationalSpringDampers[0].clone(),a._translSds[1]=i.translationalSpringDampers[1].clone(),a._translSds[2]=i.translationalSpringDampers[2].clone(),a._rotLms[0]=i.rotationalLimitMotors[0].clone(),a._rotLms[1]=i.rotationalLimitMotors[1].clone(),a._rotLms[2]=i.rotationalLimitMotors[2].clone(),a._rotSds[0]=i.rotationalSpringDampers[0].clone(),a._rotSds[1]=i.rotationalSpringDampers[1].clone(),a._rotSds[2]=i.rotationalSpringDampers[2].clone(),a}a(i,t);var n=i.prototype;return n.getInfo=function(t,i,a){var n,o=1/(this._b1._invMass+this._b2._invMass),s=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),r=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),e=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!a){var _=this._impulses[0],h=t.rows[t.numRows++],l=h.jacobian;l.lin1X=0,l.lin1Y=0,l.lin1Z=0,l.lin2X=0,l.lin2Y=0,l.lin2Z=0,l.ang1X=0,l.ang1Y=0,l.ang1Z=0,l.ang2X=0,l.ang2Y=0,l.ang2Z=0,h.rhs=0,h.cfm=0,h.minImpulse=0,h.maxImpulse=0,h.motorSpeed=0,h.motorMaxImpulse=0,h.impulse=null,h.impulse=_,this.setSolverInfoRowLinear(h,this.translationX,this._translLms[0],o,this._translSds[0],i,a),(n=h.jacobian).lin1X=this._basisX1X,n.lin1Y=this._basisX1Y,n.lin1Z=this._basisX1Z,n.lin2X=this._basisX1X,n.lin2Y=this._basisX1Y,n.lin2Z=this._basisX1Z,n.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,n.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,n.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,n.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,n.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,n.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!a){var c=this._impulses[1],m=t.rows[t.numRows++],v=m.jacobian;v.lin1X=0,v.lin1Y=0,v.lin1Z=0,v.lin2X=0,v.lin2Y=0,v.lin2Z=0,v.ang1X=0,v.ang1Y=0,v.ang1Z=0,v.ang2X=0,v.ang2Y=0,v.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=c,this.setSolverInfoRowLinear(m,this.translationY,this._translLms[1],o,this._translSds[1],i,a),(n=m.jacobian).lin1X=this._basisY1X,n.lin1Y=this._basisY1Y,n.lin1Z=this._basisY1Z,n.lin2X=this._basisY1X,n.lin2Y=this._basisY1Y,n.lin2Z=this._basisY1Z,n.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,n.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,n.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,n.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,n.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,n.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!a){var b=this._impulses[2],f=t.rows[t.numRows++],u=f.jacobian;u.lin1X=0,u.lin1Y=0,u.lin1Z=0,u.lin2X=0,u.lin2Y=0,u.lin2Z=0,u.ang1X=0,u.ang1Y=0,u.ang1Z=0,u.ang2X=0,u.ang2Y=0,u.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,this.setSolverInfoRowLinear(f,this.translationZ,this._translLms[2],o,this._translSds[2],i,a),(n=f.jacobian).lin1X=this._basisZ1X,n.lin1Y=this._basisZ1Y,n.lin1Z=this._basisZ1Z,n.lin2X=this._basisZ1X,n.lin2Y=this._basisZ1Y,n.lin2Z=this._basisZ1Z,n.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,n.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,n.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,n.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,n.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,n.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!a)){var p=this._impulses[3],x=t.rows[t.numRows++],y=x.jacobian;y.lin1X=0,y.lin1Y=0,y.lin1Z=0,y.lin2X=0,y.lin2Y=0,y.lin2Z=0,y.ang1X=0,y.ang1Y=0,y.ang1Z=0,y.ang2X=0,y.ang2Y=0,y.ang2Z=0,x.rhs=0,x.cfm=0,x.minImpulse=0,x.maxImpulse=0,x.motorSpeed=0,x.motorMaxImpulse=0,x.impulse=null,x.impulse=p,this.setSolverInfoRowAngular(x,this._angleX,this._rotLms[0],s,this._rotSds[0],i,a),(n=x.jacobian).ang1X=this._axisXX,n.ang1Y=this._axisXY,n.ang1Z=this._axisXZ,n.ang2X=this._axisXX,n.ang2Y=this._axisXY,n.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!a)){var d=this._impulses[4],g=t.rows[t.numRows++],X=g.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,g.rhs=0,g.cfm=0,g.minImpulse=0,g.maxImpulse=0,g.motorSpeed=0,g.motorMaxImpulse=0,g.impulse=null,g.impulse=d,this.setSolverInfoRowAngular(g,this._angleY,this._rotLms[1],r,this._rotSds[1],i,a),(n=g.jacobian).ang1X=this._axisYX,n.ang1Y=this._axisYY,n.ang1Z=this._axisYZ,n.ang2X=this._axisYX,n.ang2Y=this._axisYY,n.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!a)){var Y=this._impulses[5],z=t.rows[t.numRows++],Z=z.jacobian;Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=0,Z.ang1Y=0,Z.ang1Z=0,Z.ang2X=0,Z.ang2Y=0,Z.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=Y,this.setSolverInfoRowAngular(z,this._angleZ,this._rotLms[2],e,this._rotSds[2],i,a),(n=z.jacobian).ang1X=this._axisZX,n.ang1Y=this._axisZY,n.ang1Z=this._axisZZ,n.ang2X=this._axisZX,n.ang2Y=this._axisZY,n.ang2Z=this._axisZZ}},n._syncAnchors=function(){var i,a,n,o,s,r,e,_,h;t.prototype._syncAnchors.call(this),i=this._basisX1X,a=this._basisX1Y,n=this._basisX1Z,e=this._basisZ2X,o=(_=this._basisZ2Y)*n-(h=this._basisZ2Z)*a,s=h*i-e*n,r=e*a-_*i,this._axisXX=s*h-r*_,this._axisXY=r*e-o*h,this._axisXZ=o*_-s*e,this._axisYX=o,this._axisYY=s,this._axisYZ=r,this._axisZX=a*r-n*s,this._axisZY=n*o-i*r,this._axisZZ=i*s-a*o;var l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;var c=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;c>0&&(c=1/Math.sqrt(c)),this._axisYX*=c,this._axisYY*=c,this._axisYZ*=c;var m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T,C,j=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;j>0&&(j=1/Math.sqrt(j)),this._axisZX*=j,this._axisZY*=j,this._axisZZ*=j,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,m=this._basisX1X,v=this._basisY1X,b=this._basisZ1X,f=this._basisX1Y,u=this._basisY1Y,p=this._basisZ1Y,x=this._basisX1Z,y=this._basisY1Z,d=this._basisZ1Z,g=this._basisX2X,X=this._basisY2X,Y=this._basisZ2X,z=this._basisX2Y,Z=this._basisY2Y,M=this._basisZ2Y,w=m*g+f*z+x*this._basisX2Z,L=m*X+f*Z+x*(I=this._basisY2Z),k=v*X+u*Z+y*I,A=v*Y+u*M+y*(V=this._basisZ2Z),B=b*X+p*Z+d*I,P=b*Y+p*M+d*V;var R,E,q,D=m*Y+f*M+x*V;if(D<=-1){var N=Math.atan2(B,k);S=.5*N,T=-1.570796326794895,C=.5*-N}else if(D>=1){var F=Math.atan2(B,k);S=.5*F,T=1.570796326794895,C=.5*F}else S=Math.atan2(-A,P),T=Math.asin(D),C=Math.atan2(-L,w);this._angleX=S,this._angleY=T,this._angleZ=C,R=this._anchor2X-this._anchor1X,E=this._anchor2Y-this._anchor1Y,q=this._anchor2Z-this._anchor1Z,this.translationX=R*this._basisX1X+E*this._basisX1Y+q*this._basisX1Z,this.translationY=R*this._basisY1X+E*this._basisY1Y+q*this._basisY1Z,this.translationZ=R*this._basisZ1X+E*this._basisZ1Y+q*this._basisZ1Z},n._getVelocitySolverInfo=function(i,a){t.prototype._getVelocitySolverInfo.call(this,i,a),this.getInfo(a,i,!1)},n._getPositionSolverInfo=function(i){t.prototype._getPositionSolverInfo.call(this,i),this.getInfo(i,null,!0)},n.getAxisX=function(){var t=new r.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t},n.getAxisY=function(){var t=new r.common.Vec3;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,t},n.getAxisZ=function(){var t=new r.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t},n.getTranslationalSpringDampers=function(){return this._translSds.slice(0)},n.getRotationalSpringDampers=function(){return this._translSds.slice(0)},n.getTranslationalLimitMotors=function(){return this._translLms.slice(0)},n.getRotationalLimitMotors=function(){return this._rotLms.slice(0)},n.getAngles=function(){return new r.common.Vec3(this._angleX,this._angleY,this._angleZ)},n.getTranslations=function(){return new r.common.Vec3(this.translationX,this.translationY,this.translationZ)},i}(r.dynamics.constraint.joint.Joint),r.dynamics.constraint.joint.GenericJointConfig=function(t){function i(){var i;(i=t.call(this)||this).localBasis1=new r.common.Mat3,i.localBasis2=new r.common.Mat3;var a=[];a.push((new r.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),a.push((new r.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),a.push((new r.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),i.translationalLimitMotors=a;var n=[];return n.push((new r.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),n.push((new r.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),n.push((new r.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.rotationalLimitMotors=n,i.translationalSpringDampers=[new r.dynamics.constraint.joint.SpringDamper,new r.dynamics.constraint.joint.SpringDamper,new r.dynamics.constraint.joint.SpringDamper],i.rotationalSpringDampers=[new r.dynamics.constraint.joint.SpringDamper,new r.dynamics.constraint.joint.SpringDamper,new r.dynamics.constraint.joint.SpringDamper],i}return a(i,t),i.prototype.init=function(t,i,a,n,o){this._init(t,i,a);var s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,E,q=t._transform,D=i._transform;s=n.e00,r=n.e01,e=n.e02,_=n.e10,h=n.e11,l=n.e12,c=n.e20,m=n.e21,v=n.e22,b=o.e00,f=o.e01,u=o.e02,p=o.e10,x=o.e11,y=o.e12,d=o.e20,g=o.e21,X=o.e22,Y=q._rotation00*s+q._rotation10*_+q._rotation20*c,z=q._rotation00*r+q._rotation10*h+q._rotation20*m,Z=q._rotation00*e+q._rotation10*l+q._rotation20*v,M=q._rotation01*s+q._rotation11*_+q._rotation21*c,I=q._rotation01*r+q._rotation11*h+q._rotation21*m,V=q._rotation01*e+q._rotation11*l+q._rotation21*v,w=q._rotation02*s+q._rotation12*_+q._rotation22*c,L=q._rotation02*r+q._rotation12*h+q._rotation22*m,k=q._rotation02*e+q._rotation12*l+q._rotation22*v,A=D._rotation00*b+D._rotation10*p+D._rotation20*d,B=D._rotation00*f+D._rotation10*x+D._rotation20*g,P=D._rotation00*u+D._rotation10*y+D._rotation20*X,S=D._rotation01*b+D._rotation11*p+D._rotation21*d,T=D._rotation01*f+D._rotation11*x+D._rotation21*g,C=D._rotation01*u+D._rotation11*y+D._rotation21*X,j=D._rotation02*b+D._rotation12*p+D._rotation22*d,R=D._rotation02*f+D._rotation12*x+D._rotation22*g,E=D._rotation02*u+D._rotation12*y+D._rotation22*X;var N=this.localBasis1;N.e00=Y,N.e01=z,N.e02=Z,N.e10=M,N.e11=I,N.e12=V,N.e20=w,N.e21=L,N.e22=k;var F=this.localBasis2;return F.e00=A,F.e01=B,F.e02=P,F.e10=S,F.e11=T,F.e12=C,F.e20=j,F.e21=R,F.e22=E,this},i}(r.dynamics.constraint.joint.JointConfig),r.dynamics.constraint.joint.JointImpulse=function(){this.impulse=0,this.impulseM=0,this.impulseP=0},r.dynamics.constraint.joint.JointLink=function(){function t(t){this._joint=t}var i=t.prototype;return i.getContact=function(){return this._joint},i.getOther=function(){return this._other},i.getPrev=function(){return this._prev},i.getNext=function(){return this._next},t}(),r.dynamics.constraint.joint.JointMacro=function(){},r.dynamics.constraint.joint.JointType=function(){},r.dynamics.constraint.joint.PrismaticJoint=function(t){function i(i){var a;a=t.call(this,i,r.dynamics.constraint.joint.JointType.PRISMATIC)||this;var n=i.localAxis1;a._localBasisX1X=n.x,a._localBasisX1Y=n.y,a._localBasisX1Z=n.z;var s=i.localAxis2;return a._localBasisX2X=s.x,a._localBasisX2Y=s.y,a._localBasisX2Z=s.z,a.buildLocalBasesFromX(),a._basis=new r.dynamics.constraint.joint.BasisTracker(o(a)),a.translation=0,a.linearErrorY=0,a.linearErrorZ=0,a.angularErrorX=0,a.angularErrorY=0,a.angularErrorZ=0,a._sd=i.springDamper.clone(),a._lm=i.limitMotor.clone(),a}a(i,t);var n=i.prototype;return n.getInfo=function(t,i,a){var n,o=this.getErp(i,a),s=this.linearErrorY*o,r=this.linearErrorZ*o,e=this.angularErrorX*o,_=this.angularErrorY*o,h=this.angularErrorZ*o;if(this._sd.frequency<=0||!a){var l=this._impulses[0],c=t.rows[t.numRows++],m=c.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,c.rhs=0,c.cfm=0,c.minImpulse=0,c.maxImpulse=0,c.motorSpeed=0,c.motorMaxImpulse=0,c.impulse=null,c.impulse=l,this.setSolverInfoRowLinear(c,this.translation,this._lm,1/(this._b1._invMass+this._b2._invMass),this._sd,i,a),(n=c.jacobian).lin1X=this._basis.xX,n.lin1Y=this._basis.xY,n.lin1Z=this._basis.xZ,n.lin2X=this._basis.xX,n.lin2Y=this._basis.xY,n.lin2Z=this._basis.xZ,n.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,n.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,n.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,n.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,n.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,n.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var v=this._impulses[1],b=t.rows[t.numRows++],f=b.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,b.rhs=0,b.cfm=0,b.minImpulse=0,b.maxImpulse=0,b.motorSpeed=0,b.motorMaxImpulse=0,b.impulse=null,b.impulse=v,b.rhs=s,b.cfm=0,b.minImpulse=-Infinity,b.maxImpulse=Infinity,(n=b.jacobian).lin1X=this._basis.yX,n.lin1Y=this._basis.yY,n.lin1Z=this._basis.yZ,n.lin2X=this._basis.yX,n.lin2Y=this._basis.yY,n.lin2Z=this._basis.yZ,n.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,n.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,n.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,n.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,n.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,n.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var u=this._impulses[2],p=t.rows[t.numRows++],x=p.jacobian;x.lin1X=0,x.lin1Y=0,x.lin1Z=0,x.lin2X=0,x.lin2Y=0,x.lin2Z=0,x.ang1X=0,x.ang1Y=0,x.ang1Z=0,x.ang2X=0,x.ang2Y=0,x.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=u,p.rhs=r,p.cfm=0,p.minImpulse=-Infinity,p.maxImpulse=Infinity,(n=p.jacobian).lin1X=this._basis.zX,n.lin1Y=this._basis.zY,n.lin1Z=this._basis.zZ,n.lin2X=this._basis.zX,n.lin2Y=this._basis.zY,n.lin2Z=this._basis.zZ,n.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,n.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,n.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,n.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,n.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,n.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;var y=this._impulses[3],d=t.rows[t.numRows++],g=d.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=y,d.rhs=e,d.cfm=0,d.minImpulse=-Infinity,d.maxImpulse=Infinity,(n=d.jacobian).ang1X=1,n.ang1Y=0,n.ang1Z=0,n.ang2X=1,n.ang2Y=0,n.ang2Z=0;var X=this._impulses[4],Y=t.rows[t.numRows++],z=Y.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=X,Y.rhs=_,Y.cfm=0,Y.minImpulse=-Infinity,Y.maxImpulse=Infinity,(n=Y.jacobian).ang1X=0,n.ang1Y=1,n.ang1Z=0,n.ang2X=0,n.ang2Y=1,n.ang2Z=0;var Z=this._impulses[5],M=t.rows[t.numRows++],I=M.jacobian;I.lin1X=0,I.lin1Y=0,I.lin1Z=0,I.lin2X=0,I.lin2Y=0,I.lin2Z=0,I.ang1X=0,I.ang1Y=0,I.ang1Z=0,I.ang2X=0,I.ang2Y=0,I.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=Z,M.rhs=h,M.cfm=0,M.minImpulse=-Infinity,M.maxImpulse=Infinity,(n=M.jacobian).ang1X=0,n.ang1Y=0,n.ang1Z=1,n.ang2X=0,n.ang2Y=0,n.ang2Z=1},n._syncAnchors=function(){t.prototype._syncAnchors.call(this);var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,E=this._basis,q=E.joint._b1._invMass,D=E.joint._b2._invMass,N=E.joint._basisX1X*E.joint._basisX2X+E.joint._basisX1Y*E.joint._basisX2Y+E.joint._basisX1Z*E.joint._basisX2Z;if(N<-.999999999){var F,G,J,W,O=E.joint._basisX1X,U=E.joint._basisX1Y,H=E.joint._basisX1Z,Q=O*O,K=U*U,$=H*H;Q<K?Q<$?(F=0,G=H*(W=1/Math.sqrt(K+$)),J=-U*W):(F=U*(W=1/Math.sqrt(Q+K)),G=-O*W,J=0):K<$?(F=-H*(W=1/Math.sqrt($+Q)),G=0,J=O*W):(F=U*(W=1/Math.sqrt(Q+K)),G=-O*W,J=0),i=F,a=G,n=J,o=0}else{var tt,it,at;tt=E.joint._basisX1Y*E.joint._basisX2Z-E.joint._basisX1Z*E.joint._basisX2Y,it=E.joint._basisX1Z*E.joint._basisX2X-E.joint._basisX1X*E.joint._basisX2Z,at=E.joint._basisX1X*E.joint._basisX2Y-E.joint._basisX1Y*E.joint._basisX2X;var nt=Math.sqrt(.5*(1+N));i=tt*=N=.5/nt,a=it*=N,n=at*=N,o=nt}var ot=(A=0)*(T=i)+(B=0)*(C=a)+(P=0)*(j=n)+(S=1)*(R=o);if(ot<0&&(ot=-ot,T=-T,C=-C,j=-j,R=-R),ot>.999999){var st=(T=A+(T-A)*(q/(q+D)))*T+(C=B+(C-B)*(q/(q+D)))*C+(j=P+(j-P)*(q/(q+D)))*j+(R=S+(R-S)*(q/(q+D)))*R;st>1e-32&&(st=1/Math.sqrt(st)),s=T*st,r=C*st,e=j*st,_=R*st}else{var rt=q/(q+D)*Math.acos(ot),et=(T+=A*-ot)*T+(C+=B*-ot)*C+(j+=P*-ot)*j+(R+=S*-ot)*R;et>1e-32&&(et=1/Math.sqrt(et)),T*=et,C*=et,j*=et,R*=et;var _t=Math.sin(rt),ht=Math.cos(rt);s=(A*=ht)+T*_t,r=(B*=ht)+C*_t,e=(P*=ht)+j*_t,_=(S*=ht)+R*_t}var lt=2*s,ct=2*r,mt=2*e,vt=s*lt,bt=r*ct,ft=e*mt,ut=s*ct,pt=r*mt,xt=s*mt,yt=_*lt,dt=_*ct,gt=_*mt;h=ut-gt,l=xt+dt,c=ut+gt,m=1-vt-ft,v=pt-yt,b=xt-dt,f=pt+yt,u=1-vt-bt,p=(1-bt-ft)*E.joint._basisX1X+h*E.joint._basisX1Y+l*E.joint._basisX1Z,x=c*E.joint._basisX1X+m*E.joint._basisX1Y+v*E.joint._basisX1Z,y=b*E.joint._basisX1X+f*E.joint._basisX1Y+u*E.joint._basisX1Z,M=E.xX,I=E.xY,V=E.xZ,w=E.yX,L=E.yY,k=E.yZ;var Xt=M*p+I*x+V*y;if(Xt<-.999999999){var Yt,zt,Zt,Mt,It=M,Vt=I,wt=V,Lt=It*It,kt=Vt*Vt,At=wt*wt;Lt<kt?Lt<At?(Yt=0,zt=wt*(Mt=1/Math.sqrt(kt+At)),Zt=-Vt*Mt):(Yt=Vt*(Mt=1/Math.sqrt(Lt+kt)),zt=-It*Mt,Zt=0):kt<At?(Yt=-wt*(Mt=1/Math.sqrt(At+Lt)),zt=0,Zt=It*Mt):(Yt=Vt*(Mt=1/Math.sqrt(Lt+kt)),zt=-It*Mt,Zt=0),s=Yt,r=zt,e=Zt,_=0}else{var Bt,Pt,St;Bt=I*y-V*x,Pt=V*p-M*y,St=M*x-I*p;var Tt=Math.sqrt(.5*(1+Xt));s=Bt*=Xt=.5/Tt,r=Pt*=Xt,e=St*=Xt,_=Tt}var Ct,jt,Rt,Et,qt,Dt,Nt,Ft,Gt,Jt,Wt,Ot,Ut,Ht,Qt,Kt,$t,ti,ii,ai,ni,oi,si,ri,ei,_i,hi,li,ci=2*s,mi=2*r,vi=2*e,bi=s*ci,fi=r*mi,ui=e*vi,pi=s*mi,xi=r*vi,yi=s*vi,di=_*ci,gi=_*mi,Xi=_*vi;if((Y=x*(X=(b=yi-gi)*w+(f=xi+di)*L+(u=1-bi-fi)*k)-y*(g=(c=pi+Xi)*w+(m=1-bi-ui)*L+(v=xi-di)*k))*Y+(z=y*(d=(1-fi-ui)*w+(h=pi-Xi)*L+(l=yi+gi)*k)-p*X)*z+(Z=p*g-x*d)*Z>1e-6){var Yi=Y*Y+z*z+Z*Z;Yi>0&&(Yi=1/Math.sqrt(Yi)),Y*=Yi,z*=Yi,Z*=Yi}else{var zi,Zi=p,Mi=x,Ii=y,Vi=Zi*Zi,wi=Mi*Mi,Li=Ii*Ii;Vi<wi?Vi<Li?(Y=0,z=Ii*(zi=1/Math.sqrt(wi+Li)),Z=-Mi*zi):(Y=Mi*(zi=1/Math.sqrt(Vi+wi)),z=-Zi*zi,Z=0):wi<Li?(Y=-Ii*(zi=1/Math.sqrt(Li+Vi)),z=0,Z=Zi*zi):(Y=Mi*(zi=1/Math.sqrt(Vi+wi)),z=-Zi*zi,Z=0)}d=z*y-Z*x,g=Z*p-Y*y,X=Y*x-z*p,E.xX=p,E.xY=x,E.xZ=y,E.yX=d,E.yY=g,E.yZ=X,E.zX=Y,E.zY=z,E.zZ=Z,Ct=this._basisX1X,jt=this._basisY1X,Rt=this._basisZ1X,Et=this._basisX1Y,qt=this._basisY1Y,Dt=this._basisZ1Y,Nt=this._basisX1Z,Ft=this._basisY1Z,Gt=this._basisZ1Z,ii=(Jt=this._basisX2X)*Et+(Wt=this._basisY2X)*qt+(Ot=this._basisZ2X)*Dt,ai=Jt*Nt+Wt*Ft+Ot*Gt,ni=(Ut=this._basisX2Y)*Ct+(Ht=this._basisY2Y)*jt+(Qt=this._basisZ2Y)*Rt,oi=Ut*Nt+Ht*Ft+Qt*Gt,si=(Kt=this._basisX2Z)*Ct+($t=this._basisY2Z)*jt+(ti=this._basisZ2Z)*Rt,ri=Kt*Et+$t*qt+ti*Dt;var ki,Ai=Jt*Ct+Wt*jt+Ot*Rt,Bi=Ut*Et+Ht*qt+Qt*Dt,Pi=Kt*Nt+$t*Ft+ti*Gt,Si=Ai+Bi+Pi;Si>0?(li=.5*(ki=Math.sqrt(Si+1)),ei=(ri-oi)*(ki=.5/ki),_i=(ai-si)*ki,hi=(ni-ii)*ki):Ai>Bi?Ai>Pi?(ei=.5*(ki=Math.sqrt(Ai-Bi-Pi+1)),_i=(ii+ni)*(ki=.5/ki),hi=(ai+si)*ki,li=(ri-oi)*ki):(hi=.5*(ki=Math.sqrt(Pi-Ai-Bi+1)),ei=(ai+si)*(ki=.5/ki),_i=(oi+ri)*ki,li=(ni-ii)*ki):Bi>Pi?(_i=.5*(ki=Math.sqrt(Bi-Pi-Ai+1)),ei=(ii+ni)*(ki=.5/ki),hi=(oi+ri)*ki,li=(ai-si)*ki):(hi=.5*(ki=Math.sqrt(Pi-Ai-Bi+1)),ei=(ai+si)*(ki=.5/ki),_i=(oi+ri)*ki,li=(ni-ii)*ki);var Ti=li,Ci=2*(Ti<=-1?3.14159265358979:Ti>=1?0:Math.acos(Ti));this.angularErrorX=ei,this.angularErrorY=_i,this.angularErrorZ=hi;var ji,Ri,Ei,qi=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;qi>0&&(qi=1/Math.sqrt(qi)),this.angularErrorX*=qi,this.angularErrorY*=qi,this.angularErrorZ*=qi,this.angularErrorX*=Ci,this.angularErrorY*=Ci,this.angularErrorZ*=Ci,ji=this._anchor2X-this._anchor1X,Ri=this._anchor2Y-this._anchor1Y,Ei=this._anchor2Z-this._anchor1Z,this.translation=ji*this._basis.xX+Ri*this._basis.xY+Ei*this._basis.xZ,this.linearErrorY=ji*this._basis.yX+Ri*this._basis.yY+Ei*this._basis.yZ,this.linearErrorZ=ji*this._basis.zX+Ri*this._basis.zY+Ei*this._basis.zZ},n._getVelocitySolverInfo=function(i,a){t.prototype._getVelocitySolverInfo.call(this,i,a),this.getInfo(a,i,!1)},n._getPositionSolverInfo=function(i){t.prototype._getPositionSolverInfo.call(this,i),this.getInfo(i,null,!0)},n.getAxis1=function(){var t=new r.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t},n.getAxis2=function(){var t=new r.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t},n.getAxis1To=function(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},n.getAxis2To=function(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z},n.getLocalAxis1=function(){var t=new r.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t},n.getLocalAxis2=function(){var t=new r.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t},n.getLocalAxis1To=function(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},n.getLocalAxis2To=function(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z},n.getSpringDamper=function(){return this._sd},n.getLimitMotor=function(){return this._lm},n.getTranslation=function(){return this.translation},i}(r.dynamics.constraint.joint.Joint),r.dynamics.constraint.joint.PrismaticJointConfig=function(t){function i(){var i;return(i=t.call(this)||this).localAxis1=new r.common.Vec3(1,0,0),i.localAxis2=new r.common.Vec3(1,0,0),i.limitMotor=new r.dynamics.constraint.joint.TranslationalLimitMotor,i.springDamper=new r.dynamics.constraint.joint.SpringDamper,i}return a(i,t),i.prototype.init=function(t,i,a,n){this._init(t,i,a);var o,s,r,e,_,h,l=this.localAxis1;o=n.x,s=n.y,r=n.z,e=t._transform._rotation00*o+t._transform._rotation10*s+t._transform._rotation20*r,_=t._transform._rotation01*o+t._transform._rotation11*s+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*s+t._transform._rotation22*r,o=e,s=_,r=h,l.x=o,l.y=s,l.z=r;var c,m,v,b,f,u,p=this.localAxis2;return c=n.x,m=n.y,v=n.z,b=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*v,f=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*v,u=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*v,c=b,m=f,v=u,p.x=c,p.y=m,p.z=v,this},i}(r.dynamics.constraint.joint.JointConfig),r.dynamics.constraint.joint.RagdollJoint=function(t){function i(i){var a;a=t.call(this,i,r.dynamics.constraint.joint.JointType.RAGDOLL)||this;var n=i.localTwistAxis1;a._localBasisX1X=n.x,a._localBasisX1Y=n.y,a._localBasisX1Z=n.z;var o=i.localSwingAxis1;a._localBasisY1X=o.x,a._localBasisY1Y=o.y,a._localBasisY1Z=o.z;var s=i.localTwistAxis2;return a._localBasisX2X=s.x,a._localBasisX2Y=s.y,a._localBasisX2Z=s.z,a.buildLocalBasesFromXY1X2(),a._twistSd=i.twistSpringDamper.clone(),a._twistLm=i.twistLimitMotor.clone(),a._swingSd=i.swingSpringDamper.clone(),a._maxSwingAngle1=i.maxSwingAngle1,a._maxSwingAngle2=i.maxSwingAngle2,a._maxSwingAngle1<r.common.Setting.minRagdollMaxSwingAngle&&(a._maxSwingAngle1=r.common.Setting.minRagdollMaxSwingAngle),a._maxSwingAngle2<r.common.Setting.minRagdollMaxSwingAngle&&(a._maxSwingAngle2=r.common.Setting.minRagdollMaxSwingAngle),a.dummySwingLm=new r.dynamics.constraint.joint.RotationalLimitMotor,a.dummySwingLm.lowerLimit=-1,a.dummySwingLm.upperLimit=0,a._swingAngle=0,a._twistAngle=0,a.swingError=0,a.swingAxisX=0,a.swingAxisY=0,a.swingAxisZ=0,a.twistAxisX=0,a.twistAxisY=0,a.twistAxisZ=0,a}a(i,t);var n=i.prototype;return n.getInfo=function(t,i,a){var n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z=this.getErp(i,a);n=this.linearErrorX*z,o=this.linearErrorY*z,s=this.linearErrorZ*z,r=-(r=0),e=-(e=-this._relativeAnchor1Z),_=-(_=this._relativeAnchor1Y),h=-(h=this._relativeAnchor1Z),l=-(l=0),c=-(c=-this._relativeAnchor1X),m=-(m=-this._relativeAnchor1Y),v=-(v=this._relativeAnchor1X),b=-(b=0),f=-(f=0),u=-(u=-this._relativeAnchor2Z),p=-(p=this._relativeAnchor2Y),x=-(x=this._relativeAnchor2Z),y=-(y=0),d=-(d=-this._relativeAnchor2X),g=-(g=-this._relativeAnchor2Y),X=-(X=this._relativeAnchor2X),Y=-(Y=0);var Z=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),M=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),I=this._impulses[0],V=t.rows[t.numRows++],w=V.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,V.rhs=n,V.cfm=0,V.minImpulse=-Infinity,V.maxImpulse=Infinity;var L=V.jacobian;L.lin1X=1,L.lin1Y=0,L.lin1Z=0,L.lin2X=1,L.lin2Y=0,L.lin2Z=0,L.ang1X=r,L.ang1Y=e,L.ang1Z=_,L.ang2X=f,L.ang2Y=u,L.ang2Z=p;var k=this._impulses[1],A=t.rows[t.numRows++],B=A.jacobian;B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=k,A.rhs=o,A.cfm=0,A.minImpulse=-Infinity,A.maxImpulse=Infinity,(L=A.jacobian).lin1X=0,L.lin1Y=1,L.lin1Z=0,L.lin2X=0,L.lin2Y=1,L.lin2Z=0,L.ang1X=h,L.ang1Y=l,L.ang1Z=c,L.ang2X=x,L.ang2Y=y,L.ang2Z=d;var P=this._impulses[2],S=t.rows[t.numRows++],T=S.jacobian;if(T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=P,S.rhs=s,S.cfm=0,S.minImpulse=-Infinity,S.maxImpulse=Infinity,(L=S.jacobian).lin1X=0,L.lin1Y=0,L.lin1Z=1,L.lin2X=0,L.lin2Y=0,L.lin2Z=1,L.ang1X=m,L.ang1Y=v,L.ang1Z=b,L.ang2X=g,L.ang2Y=X,L.ang2Z=Y,this.swingError>0&&(this._swingSd.frequency<=0||!a)){var C=this._impulses[3],j=t.rows[t.numRows++],R=j.jacobian;R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=C,this.setSolverInfoRowAngular(j,this.swingError,this.dummySwingLm,Z,this._swingSd,i,a),(L=j.jacobian).ang1X=this.swingAxisX,L.ang1Y=this.swingAxisY,L.ang1Z=this.swingAxisZ,L.ang2X=this.swingAxisX,L.ang2Y=this.swingAxisY,L.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!a){var E=this._impulses[4],q=t.rows[t.numRows++],D=q.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,q.rhs=0,q.cfm=0,q.minImpulse=0,q.maxImpulse=0,q.motorSpeed=0,q.motorMaxImpulse=0,q.impulse=null,q.impulse=E,this.setSolverInfoRowAngular(q,this._twistAngle,this._twistLm,M,this._twistSd,i,a),(L=q.jacobian).ang1X=this.twistAxisX,L.ang1Y=this.twistAxisY,L.ang1Z=this.twistAxisZ,L.ang2X=this.twistAxisX,L.ang2Y=this.twistAxisY,L.ang2Z=this.twistAxisZ}},n._syncAnchors=function(){var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k;t.prototype._syncAnchors.call(this),i=this._basisX1X,a=this._basisX1Y,n=this._basisX1Z,o=this._basisX2X,s=this._basisX2Y,r=this._basisX2Z,e=this._basisX1X,_=this._basisY1X,h=this._basisZ1X,l=this._basisX1Y,c=this._basisY1Y,m=this._basisZ1Y,v=this._basisX1Z,b=this._basisY1Z,f=this._basisZ1Z;var A=i*o+a*s+n*r;if(A<-.999999999){var B,P,S,T,C=i,j=a,R=n,E=C*C,q=j*j,D=R*R;E<q?E<D?(B=0,P=R*(T=1/Math.sqrt(q+D)),S=-j*T):(B=j*(T=1/Math.sqrt(E+q)),P=-C*T,S=0):q<D?(B=-R*(T=1/Math.sqrt(D+E)),P=0,S=C*T):(B=j*(T=1/Math.sqrt(E+q)),P=-C*T,S=0),u=B,p=P,x=S,y=0}else{var N,F,G;N=a*r-n*s,F=n*o-i*r,G=i*s-a*o;var J=Math.sqrt(.5*(1+A));u=N*=A=.5/J,p=F*=A,x=G*=A,y=J}var W,O,U,H=2*u,Q=2*p,K=2*x,$=u*H,tt=p*Q,it=x*K,at=u*Q,nt=p*K,ot=u*K,st=y*H,rt=y*Q,et=y*K;d=1-tt-it,g=at-et,X=ot+rt,Y=at+et,z=1-$-it,Z=nt-st,M=ot-rt,I=nt+st,V=1-$-tt,this._swingAngle=2*(y<=-1?3.14159265358979:y>=1?0:Math.acos(y)),w=u,L=p,k=x,W=d*this._basisY2X+Y*this._basisY2Y+M*this._basisY2Z,O=g*this._basisY2X+z*this._basisY2Y+I*this._basisY2Z,U=X*this._basisY2X+Z*this._basisY2Y+V*this._basisY2Z,this._twistAngle=Math.atan2(this._basisZ1X*W+this._basisZ1Y*O+this._basisZ1Z*U,this._basisY1X*W+this._basisY1Y*O+this._basisY1Z*U),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var _t=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;_t>0&&(_t=1/Math.sqrt(_t)),this.twistAxisX*=_t,this.twistAxisY*=_t,this.twistAxisZ*=_t;var ht,lt,ct=Math.sqrt(w*w+L*L+k*k);ct>0&&(ct=1/ct),ht=_*(w*=ct*this._swingAngle)+c*(L*=ct*this._swingAngle)+b*(k*=ct*this._swingAngle),lt=h*w+m*L+f*k,w=e*w+l*L+v*k;var mt=L=ht,vt=k=lt,bt=this._maxSwingAngle1,ft=this._maxSwingAngle2,ut=1/(bt*bt),pt=1/(ft*ft),xt=mt*mt*ut+vt*vt*pt;if(0==xt)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var yt,dt,gt,Xt,Yt,zt,Zt=Math.sqrt(1/xt),Mt=mt*Zt,It=vt*Zt,Vt=Mt*ut,wt=It*pt,Lt=(mt-Mt)*(Vt*=ct=1/Math.sqrt(Vt*Vt+wt*wt))+(vt-It)*(wt*=ct);if(Lt>0)this.swingError=Lt,this.swingAxisX=0,this.swingAxisY=Vt,this.swingAxisZ=wt,yt=e*this.swingAxisX+_*this.swingAxisY+h*this.swingAxisZ,dt=l*this.swingAxisX+c*this.swingAxisY+m*this.swingAxisZ,gt=v*this.swingAxisX+b*this.swingAxisY+f*this.swingAxisZ,this.swingAxisX=yt,this.swingAxisY=dt,this.swingAxisZ=gt,Xt=d*this.swingAxisX+g*this.swingAxisY+X*this.swingAxisZ,Yt=Y*this.swingAxisX+z*this.swingAxisY+Z*this.swingAxisZ,zt=M*this.swingAxisX+I*this.swingAxisY+V*this.swingAxisZ,this.swingAxisX=Xt,this.swingAxisY=Yt,this.swingAxisZ=zt;else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},n._getVelocitySolverInfo=function(i,a){t.prototype._getVelocitySolverInfo.call(this,i,a),this.getInfo(a,i,!1)},n._getPositionSolverInfo=function(i){t.prototype._getPositionSolverInfo.call(this,i),this.getInfo(i,null,!0)},n.getAxis1=function(){var t=new r.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t},n.getAxis2=function(){var t=new r.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t},n.getAxis1To=function(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},n.getAxis2To=function(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z},n.getLocalAxis1=function(){var t=new r.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t},n.getLocalAxis2=function(){var t=new r.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t},n.getLocalAxis1To=function(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},n.getLocalAxis2To=function(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z},n.getTwistSpringDamper=function(){return this._twistSd},n.getTwistLimitMotor=function(){return this._twistLm},n.getSwingSpringDamper=function(){return this._swingSd},n.getSwingAxis=function(){var t=new r.common.Vec3;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,t},n.getSwingAxisTo=function(t){t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ},n.getSwingAngle=function(){return this._swingAngle},n.getTwistAngle=function(){return this._twistAngle},i}(r.dynamics.constraint.joint.Joint),r.dynamics.constraint.joint.RagdollJointConfig=function(t){function i(){var i;return(i=t.call(this)||this).localTwistAxis1=new r.common.Vec3(1,0,0),i.localTwistAxis2=new r.common.Vec3(1,0,0),i.localSwingAxis1=new r.common.Vec3(0,1,0),i.twistSpringDamper=new r.dynamics.constraint.joint.SpringDamper,i.swingSpringDamper=new r.dynamics.constraint.joint.SpringDamper,i.twistLimitMotor=new r.dynamics.constraint.joint.RotationalLimitMotor,i.maxSwingAngle1=3.14159265358979,i.maxSwingAngle2=3.14159265358979,i}return a(i,t),i.prototype.init=function(t,i,a,n,o){this._init(t,i,a);var s,r,e,_,h,l,c=this.localTwistAxis1;s=n.x,r=n.y,e=n.z,_=t._transform._rotation00*s+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*s+t._transform._rotation11*r+t._transform._rotation21*e,l=t._transform._rotation02*s+t._transform._rotation12*r+t._transform._rotation22*e,s=_,r=h,e=l,c.x=s,c.y=r,c.z=e;var m,v,b,f,u,p,x=this.localTwistAxis2;m=n.x,v=n.y,b=n.z,f=i._transform._rotation00*m+i._transform._rotation10*v+i._transform._rotation20*b,u=i._transform._rotation01*m+i._transform._rotation11*v+i._transform._rotation21*b,p=i._transform._rotation02*m+i._transform._rotation12*v+i._transform._rotation22*b,m=f,v=u,b=p,x.x=m,x.y=v,x.z=b;var y,d,g,X,Y,z,Z=this.localSwingAxis1;return y=o.x,d=o.y,g=o.z,X=t._transform._rotation00*y+t._transform._rotation10*d+t._transform._rotation20*g,Y=t._transform._rotation01*y+t._transform._rotation11*d+t._transform._rotation21*g,z=t._transform._rotation02*y+t._transform._rotation12*d+t._transform._rotation22*g,y=X,d=Y,g=z,Z.x=y,Z.y=d,Z.z=g,this},i}(r.dynamics.constraint.joint.JointConfig),r.dynamics.constraint.joint.RevoluteJoint=function(t){function i(i){var a;a=t.call(this,i,1)||this;var n=i.localAxis1;a._localBasisX1X=n.x,a._localBasisX1Y=n.y,a._localBasisX1Z=n.z;var s=i.localAxis2;return a._localBasisX2X=s.x,a._localBasisX2Y=s.y,a._localBasisX2Z=s.z,a.buildLocalBasesFromX(),a.angle=0,a.angularErrorY=0,a.angularErrorZ=0,a._basis=new r.dynamics.constraint.joint.BasisTracker(o(a)),a._sd=i.springDamper.clone(),a._lm=i.limitMotor.clone(),a}a(i,t);var n=i.prototype;return n.getInfo=function(t,i,a){var n,o,s,r=this.getErp(i,a);n=this.linearErrorX*r,o=this.linearErrorY*r,s=this.linearErrorZ*r;var e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z=this.angularErrorY*r,M=this.angularErrorZ*r;e=-(e=0),_=-(_=-this._relativeAnchor1Z),h=-(h=this._relativeAnchor1Y),l=-(l=this._relativeAnchor1Z),c=-(c=0),m=-(m=-this._relativeAnchor1X),v=-(v=-this._relativeAnchor1Y),b=-(b=this._relativeAnchor1X),f=-(f=0),u=-(u=0),p=-(p=-this._relativeAnchor2Z),x=-(x=this._relativeAnchor2Y),y=-(y=this._relativeAnchor2Z),d=-(d=0),g=-(g=-this._relativeAnchor2X),X=-(X=-this._relativeAnchor2Y),Y=-(Y=this._relativeAnchor2X),z=-(z=0);var I=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),V=this._impulses[0],w=t.rows[t.numRows++],L=w.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=V,w.rhs=n,w.cfm=0,w.minImpulse=-Infinity,w.maxImpulse=Infinity;var k=w.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=e,k.ang1Y=_,k.ang1Z=h,k.ang2X=u,k.ang2Y=p,k.ang2Z=x;var A=this._impulses[1],B=t.rows[t.numRows++],P=B.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=A,B.rhs=o,B.cfm=0,B.minImpulse=-Infinity,B.maxImpulse=Infinity,(k=B.jacobian).lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=l,k.ang1Y=c,k.ang1Z=m,k.ang2X=y,k.ang2Y=d,k.ang2Z=g;var S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,T.rhs=s,T.cfm=0,T.minImpulse=-Infinity,T.maxImpulse=Infinity,(k=T.jacobian).lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=v,k.ang1Y=b,k.ang1Z=f,k.ang2X=X,k.ang2Y=Y,k.ang2Z=z,this._sd.frequency<=0||!a){var j=this._impulses[3],R=t.rows[t.numRows++],E=R.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=j,this.setSolverInfoRowAngular(R,this.angle,this._lm,I,this._sd,i,a),(k=R.jacobian).ang1X=this._basis.xX,k.ang1Y=this._basis.xY,k.ang1Z=this._basis.xZ,k.ang2X=this._basis.xX,k.ang2Y=this._basis.xY,k.ang2Z=this._basis.xZ}var q=this._impulses[4],D=t.rows[t.numRows++],N=D.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,D.rhs=0,D.cfm=0,D.minImpulse=0,D.maxImpulse=0,D.motorSpeed=0,D.motorMaxImpulse=0,D.impulse=null,D.impulse=q,D.rhs=Z,D.cfm=0,D.minImpulse=-Infinity,D.maxImpulse=Infinity,(k=D.jacobian).ang1X=this._basis.yX,k.ang1Y=this._basis.yY,k.ang1Z=this._basis.yZ,k.ang2X=this._basis.yX,k.ang2Y=this._basis.yY,k.ang2Z=this._basis.yZ;var F=this._impulses[5],G=t.rows[t.numRows++],J=G.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=F,G.rhs=M,G.cfm=0,G.minImpulse=-Infinity,G.maxImpulse=Infinity,(k=G.jacobian).ang1X=this._basis.zX,k.ang1Y=this._basis.zY,k.ang1Z=this._basis.zZ,k.ang2X=this._basis.zX,k.ang2Y=this._basis.zY,k.ang2Z=this._basis.zZ},n._syncAnchors=function(){t.prototype._syncAnchors.call(this);var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,E=this._basis,q=E.joint._b1._invMass,D=E.joint._b2._invMass,N=E.joint._basisX1X*E.joint._basisX2X+E.joint._basisX1Y*E.joint._basisX2Y+E.joint._basisX1Z*E.joint._basisX2Z;if(N<-.999999999){var F,G,J,W,O=E.joint._basisX1X,U=E.joint._basisX1Y,H=E.joint._basisX1Z,Q=O*O,K=U*U,$=H*H;Q<K?Q<$?(F=0,G=H*(W=1/Math.sqrt(K+$)),J=-U*W):(F=U*(W=1/Math.sqrt(Q+K)),G=-O*W,J=0):K<$?(F=-H*(W=1/Math.sqrt($+Q)),G=0,J=O*W):(F=U*(W=1/Math.sqrt(Q+K)),G=-O*W,J=0),i=F,a=G,n=J,o=0}else{var tt,it,at;tt=E.joint._basisX1Y*E.joint._basisX2Z-E.joint._basisX1Z*E.joint._basisX2Y,it=E.joint._basisX1Z*E.joint._basisX2X-E.joint._basisX1X*E.joint._basisX2Z,at=E.joint._basisX1X*E.joint._basisX2Y-E.joint._basisX1Y*E.joint._basisX2X;var nt=Math.sqrt(.5*(1+N));i=tt*=N=.5/nt,a=it*=N,n=at*=N,o=nt}var ot=(A=0)*(T=i)+(B=0)*(C=a)+(P=0)*(j=n)+(S=1)*(R=o);if(ot<0&&(ot=-ot,T=-T,C=-C,j=-j,R=-R),ot>.999999){var st=(T=A+(T-A)*(q/(q+D)))*T+(C=B+(C-B)*(q/(q+D)))*C+(j=P+(j-P)*(q/(q+D)))*j+(R=S+(R-S)*(q/(q+D)))*R;st>1e-32&&(st=1/Math.sqrt(st)),s=T*st,r=C*st,e=j*st,_=R*st}else{var rt=q/(q+D)*Math.acos(ot),et=(T+=A*-ot)*T+(C+=B*-ot)*C+(j+=P*-ot)*j+(R+=S*-ot)*R;et>1e-32&&(et=1/Math.sqrt(et)),T*=et,C*=et,j*=et,R*=et;var _t=Math.sin(rt),ht=Math.cos(rt);s=(A*=ht)+T*_t,r=(B*=ht)+C*_t,e=(P*=ht)+j*_t,_=(S*=ht)+R*_t}var lt=2*s,ct=2*r,mt=2*e,vt=s*lt,bt=r*ct,ft=e*mt,ut=s*ct,pt=r*mt,xt=s*mt,yt=_*lt,dt=_*ct,gt=_*mt;h=ut-gt,l=xt+dt,c=ut+gt,m=1-vt-ft,v=pt-yt,b=xt-dt,f=pt+yt,u=1-vt-bt,p=(1-bt-ft)*E.joint._basisX1X+h*E.joint._basisX1Y+l*E.joint._basisX1Z,x=c*E.joint._basisX1X+m*E.joint._basisX1Y+v*E.joint._basisX1Z,y=b*E.joint._basisX1X+f*E.joint._basisX1Y+u*E.joint._basisX1Z,M=E.xX,I=E.xY,V=E.xZ,w=E.yX,L=E.yY,k=E.yZ;var Xt=M*p+I*x+V*y;if(Xt<-.999999999){var Yt,zt,Zt,Mt,It=M,Vt=I,wt=V,Lt=It*It,kt=Vt*Vt,At=wt*wt;Lt<kt?Lt<At?(Yt=0,zt=wt*(Mt=1/Math.sqrt(kt+At)),Zt=-Vt*Mt):(Yt=Vt*(Mt=1/Math.sqrt(Lt+kt)),zt=-It*Mt,Zt=0):kt<At?(Yt=-wt*(Mt=1/Math.sqrt(At+Lt)),zt=0,Zt=It*Mt):(Yt=Vt*(Mt=1/Math.sqrt(Lt+kt)),zt=-It*Mt,Zt=0),s=Yt,r=zt,e=Zt,_=0}else{var Bt,Pt,St;Bt=I*y-V*x,Pt=V*p-M*y,St=M*x-I*p;var Tt=Math.sqrt(.5*(1+Xt));s=Bt*=Xt=.5/Tt,r=Pt*=Xt,e=St*=Xt,_=Tt}var Ct,jt,Rt,Et=2*s,qt=2*r,Dt=2*e,Nt=s*Et,Ft=r*qt,Gt=e*Dt,Jt=s*qt,Wt=r*Dt,Ot=s*Dt,Ut=_*Et,Ht=_*qt,Qt=_*Dt;if((Y=x*(X=(b=Ot-Ht)*w+(f=Wt+Ut)*L+(u=1-Nt-Ft)*k)-y*(g=(c=Jt+Qt)*w+(m=1-Nt-Gt)*L+(v=Wt-Ut)*k))*Y+(z=y*(d=(1-Ft-Gt)*w+(h=Jt-Qt)*L+(l=Ot+Ht)*k)-p*X)*z+(Z=p*g-x*d)*Z>1e-6){var Kt=Y*Y+z*z+Z*Z;Kt>0&&(Kt=1/Math.sqrt(Kt)),Y*=Kt,z*=Kt,Z*=Kt}else{var $t,ti=p,ii=x,ai=y,ni=ti*ti,oi=ii*ii,si=ai*ai;ni<oi?ni<si?(Y=0,z=ai*($t=1/Math.sqrt(oi+si)),Z=-ii*$t):(Y=ii*($t=1/Math.sqrt(ni+oi)),z=-ti*$t,Z=0):oi<si?(Y=-ai*($t=1/Math.sqrt(si+ni)),z=0,Z=ti*$t):(Y=ii*($t=1/Math.sqrt(ni+oi)),z=-ti*$t,Z=0)}d=z*y-Z*x,g=Z*p-Y*y,X=Y*x-z*p,E.xX=p,E.xY=x,E.xZ=y,E.yX=d,E.yY=g,E.yZ=X,E.zX=Y,E.zY=z,E.zZ=Z,Ct=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,jt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,Rt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ri,ei,_i,hi=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,li=hi<=-1?3.14159265358979:hi>=1?0:Math.acos(hi),ci=Ct*Ct+jt*jt+Rt*Rt;ci>0&&(ci=1/Math.sqrt(ci)),Ct*=ci,jt*=ci,Rt*=ci,Ct*=li,jt*=li,Rt*=li,this.angularErrorY=Ct*this._basis.yX+jt*this._basis.yY+Rt*this._basis.yZ,this.angularErrorZ=Ct*this._basis.zX+jt*this._basis.zY+Rt*this._basis.zZ,ri=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ei=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,_i=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,hi=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=hi<=-1?3.14159265358979:hi>=1?0:Math.acos(hi),ri*this._basis.xX+ei*this._basis.xY+_i*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},n._getVelocitySolverInfo=function(i,a){t.prototype._getVelocitySolverInfo.call(this,i,a),this.getInfo(a,i,!1)},n._getPositionSolverInfo=function(i){t.prototype._getPositionSolverInfo.call(this,i),this.getInfo(i,null,!0)},n.getAxis1=function(){var t=new r.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t},n.getAxis2=function(){var t=new r.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t},n.getAxis1To=function(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},n.getAxis2To=function(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z},n.getLocalAxis1=function(){var t=new r.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t},n.getLocalAxis2=function(){var t=new r.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t},n.getLocalAxis1To=function(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},n.getLocalAxis2To=function(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z},n.getSpringDamper=function(){return this._sd},n.getLimitMotor=function(){return this._lm},n.getAngle=function(){return this.angle},i}(r.dynamics.constraint.joint.Joint),r.dynamics.constraint.joint.RevoluteJointConfig=function(t){function i(){var i;return(i=t.call(this)||this).localAxis1=new r.common.Vec3(1,0,0),i.localAxis2=new r.common.Vec3(1,0,0),i.springDamper=new r.dynamics.constraint.joint.SpringDamper,i.limitMotor=new r.dynamics.constraint.joint.RotationalLimitMotor,i}return a(i,t),i.prototype.init=function(t,i,a,n){this._init(t,i,a);var o,s,r,e,_,h,l=this.localAxis1;o=n.x,s=n.y,r=n.z,e=t._transform._rotation00*o+t._transform._rotation10*s+t._transform._rotation20*r,_=t._transform._rotation01*o+t._transform._rotation11*s+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*s+t._transform._rotation22*r,o=e,s=_,r=h,l.x=o,l.y=s,l.z=r;var c,m,v,b,f,u,p=this.localAxis2;return c=n.x,m=n.y,v=n.z,b=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*v,f=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*v,u=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*v,c=b,m=f,v=u,p.x=c,p.y=m,p.z=v,this},i}(r.dynamics.constraint.joint.JointConfig),r.dynamics.constraint.joint.RotationalLimitMotor=function(){function t(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}var i=t.prototype;return i.setLimits=function(t,i){return this.lowerLimit=t,this.upperLimit=i,this},i.setMotor=function(t,i){return this.motorSpeed=t,this.motorTorque=i,this},i.clone=function(){var t=new r.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t},t}(),r.dynamics.constraint.joint.SphericalJoint=function(t){function i(i){var a;return(a=t.call(this,i,0)||this)._sd=i.springDamper.clone(),a}a(i,t);var n=i.prototype;return n.getInfo=function(t,i,a){if(!(this._sd.frequency>0&&a)){var n,o,s,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w;if(n=this._anchor2X-this._anchor1X,o=this._anchor2Y-this._anchor1Y,s=this._anchor2Z-this._anchor1Z,this._sd.frequency>0){var L=6.28318530717958*this._sd.frequency,k=this._sd.dampingRatio;k<r.common.Setting.minSpringDamperDampingRatio&&(k=r.common.Setting.minSpringDamperDampingRatio);var A=i.dt,B=2*k*L,P=L*L;this._sd.useSymplecticEuler?(e=1/(A*B),_=P/B):(e=1/(A*(A*P+B)),_=P/(A*P+B)),e*=this._b1._invMass+this._b2._invMass}else e=0,_=this.getErp(i,a);h=n*_,l=o*_,c=s*_,m=-(m=0),v=-(v=-this._relativeAnchor1Z),b=-(b=this._relativeAnchor1Y),f=-(f=this._relativeAnchor1Z),u=-(u=0),p=-(p=-this._relativeAnchor1X),x=-(x=-this._relativeAnchor1Y),y=-(y=this._relativeAnchor1X),d=-(d=0),g=-(g=0),X=-(X=-this._relativeAnchor2Z),Y=-(Y=this._relativeAnchor2Y),z=-(z=this._relativeAnchor2Z),Z=-(Z=0),M=-(M=-this._relativeAnchor2X),I=-(I=-this._relativeAnchor2Y),V=-(V=this._relativeAnchor2X),w=-(w=0);var S=this._impulses[0],T=t.rows[t.numRows++],C=T.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,T.rhs=h,T.cfm=e,T.minImpulse=-Infinity,T.maxImpulse=Infinity;var j=T.jacobian;j.lin1X=1,j.lin1Y=0,j.lin1Z=0,j.lin2X=1,j.lin2Y=0,j.lin2Z=0,j.ang1X=m,j.ang1Y=v,j.ang1Z=b,j.ang2X=g,j.ang2Y=X,j.ang2Z=Y;var R=this._impulses[1],E=t.rows[t.numRows++],q=E.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=R,E.rhs=l,E.cfm=e,E.minImpulse=-Infinity,E.maxImpulse=Infinity,(j=E.jacobian).lin1X=0,j.lin1Y=1,j.lin1Z=0,j.lin2X=0,j.lin2Y=1,j.lin2Z=0,j.ang1X=f,j.ang1Y=u,j.ang1Z=p,j.ang2X=z,j.ang2Y=Z,j.ang2Z=M;var D=this._impulses[2],N=t.rows[t.numRows++],F=N.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,N.rhs=0,N.cfm=0,N.minImpulse=0,N.maxImpulse=0,N.motorSpeed=0,N.motorMaxImpulse=0,N.impulse=null,N.impulse=D,N.rhs=c,N.cfm=e,N.minImpulse=-Infinity,N.maxImpulse=Infinity,(j=N.jacobian).lin1X=0,j.lin1Y=0,j.lin1Z=1,j.lin2X=0,j.lin2Y=0,j.lin2Z=1,j.ang1X=x,j.ang1Y=y,j.ang1Z=d,j.ang2X=I,j.ang2Y=V,j.ang2Z=w}},n._getVelocitySolverInfo=function(i,a){t.prototype._getVelocitySolverInfo.call(this,i,a),this.getInfo(a,i,!1)},n._getPositionSolverInfo=function(i){t.prototype._getPositionSolverInfo.call(this,i),this.getInfo(i,null,!0)},n.getSpringDamper=function(){return this._sd},i}(r.dynamics.constraint.joint.Joint),r.dynamics.constraint.joint.SphericalJointConfig=function(t){function i(){var i;return(i=t.call(this)||this).springDamper=new r.dynamics.constraint.joint.SpringDamper,i}return a(i,t),i.prototype.init=function(t,i,a){return this._init(t,i,a),this},i}(r.dynamics.constraint.joint.JointConfig),r.dynamics.constraint.joint.SpringDamper=function(){function t(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}var i=t.prototype;return i.setSpring=function(t,i){return this.frequency=t,this.dampingRatio=i,this},i.setSymplecticEuler=function(t){return this.useSymplecticEuler=t,this},i.clone=function(){var t=new r.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t},t}(),r.dynamics.constraint.joint.TranslationalLimitMotor=function(){function t(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}var i=t.prototype;return i.setLimits=function(t,i){return this.lowerLimit=t,this.upperLimit=i,this},i.setMotor=function(t,i){return this.motorSpeed=t,this.motorForce=i,this},i.clone=function(){var t=new r.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t},t}(),r.dynamics.constraint.joint.UniversalJoint=function(t){function i(i){var a;a=t.call(this,i,r.dynamics.constraint.joint.JointType.UNIVERSAL)||this;var n=i.localAxis1;a._localBasisX1X=n.x,a._localBasisX1Y=n.y,a._localBasisX1Z=n.z;var o=i.localAxis2;return a._localBasisZ2X=o.x,a._localBasisZ2Y=o.y,a._localBasisZ2Z=o.z,a.buildLocalBasesFromX1Z2(),a._angleX=0,a._angleY=0,a._angleZ=0,a.xSingular=!1,a.ySingular=!1,a.zSingular=!1,a._sd1=i.springDamper1.clone(),a._sd2=i.springDamper2.clone(),a._lm1=i.limitMotor1.clone(),a._lm2=i.limitMotor2.clone(),a}a(i,t);var n=i.prototype;return n.getInfo=function(t,i,a){var n,o,s,r=this.getErp(i,a);n=this.linearErrorX*r,o=this.linearErrorY*r,s=this.linearErrorZ*r;var e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z=this._angleY*r;e=-(e=0),_=-(_=-this._relativeAnchor1Z),h=-(h=this._relativeAnchor1Y),l=-(l=this._relativeAnchor1Z),c=-(c=0),m=-(m=-this._relativeAnchor1X),v=-(v=-this._relativeAnchor1Y),b=-(b=this._relativeAnchor1X),f=-(f=0),u=-(u=0),p=-(p=-this._relativeAnchor2Z),x=-(x=this._relativeAnchor2Y),y=-(y=this._relativeAnchor2Z),d=-(d=0),g=-(g=-this._relativeAnchor2X),X=-(X=-this._relativeAnchor2Y),Y=-(Y=this._relativeAnchor2X),z=-(z=0);var M=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),I=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),V=this._impulses[0],w=t.rows[t.numRows++],L=w.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=V,w.rhs=n,w.cfm=0,w.minImpulse=-Infinity,w.maxImpulse=Infinity;var k=w.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=e,k.ang1Y=_,k.ang1Z=h,k.ang2X=u,k.ang2Y=p,k.ang2Z=x;var A=this._impulses[1],B=t.rows[t.numRows++],P=B.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=A,B.rhs=o,B.cfm=0,B.minImpulse=-Infinity,B.maxImpulse=Infinity,(k=B.jacobian).lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=l,k.ang1Y=c,k.ang1Z=m,k.ang2X=y,k.ang2Y=d,k.ang2Z=g;var S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,T.rhs=s,T.cfm=0,T.minImpulse=-Infinity,T.maxImpulse=Infinity,(k=T.jacobian).lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=v,k.ang1Y=b,k.ang1Z=f,k.ang2X=X,k.ang2Y=Y,k.ang2Z=z,!this.xSingular&&(this._sd1.frequency<=0||!a)){var j=this._impulses[3],R=t.rows[t.numRows++],E=R.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=j,this.setSolverInfoRowAngular(R,this._angleX,this._lm1,M,this._sd1,i,a),(k=R.jacobian).ang1X=this._axisXX,k.ang1Y=this._axisXY,k.ang1Z=this._axisXZ,k.ang2X=this._axisXX,k.ang2Y=this._axisXY,k.ang2Z=this._axisXZ}if(!this.ySingular){var q=this._impulses[4],D=t.rows[t.numRows++],N=D.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,D.rhs=0,D.cfm=0,D.minImpulse=0,D.maxImpulse=0,D.motorSpeed=0,D.motorMaxImpulse=0,D.impulse=null,D.impulse=q,D.rhs=Z,D.cfm=0,D.minImpulse=-Infinity,D.maxImpulse=Infinity,(k=D.jacobian).ang1X=this._axisYX,k.ang1Y=this._axisYY,k.ang1Z=this._axisYZ,k.ang2X=this._axisYX,k.ang2Y=this._axisYY,k.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!a)){var F=this._impulses[5],G=t.rows[t.numRows++],J=G.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=F,this.setSolverInfoRowAngular(G,this._angleZ,this._lm2,I,this._sd2,i,a),(k=G.jacobian).ang1X=this._axisZX,k.ang1Y=this._axisZY,k.ang1Z=this._axisZZ,k.ang2X=this._axisZX,k.ang2Y=this._axisZY,k.ang2Z=this._axisZZ}},n._syncAnchors=function(){var i,a,n,o,s,r,e,_,h;t.prototype._syncAnchors.call(this),i=this._basisX1X,a=this._basisX1Y,n=this._basisX1Z,e=this._basisZ2X,o=(_=this._basisZ2Y)*n-(h=this._basisZ2Z)*a,s=h*i-e*n,r=e*a-_*i,this._axisXX=s*h-r*_,this._axisXY=r*e-o*h,this._axisXZ=o*_-s*e,this._axisYX=o,this._axisYY=s,this._axisYZ=r,this._axisZX=a*r-n*s,this._axisZY=n*o-i*r,this._axisZZ=i*s-a*o;var l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;var c=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;c>0&&(c=1/Math.sqrt(c)),this._axisYX*=c,this._axisYY*=c,this._axisYZ*=c;var m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T,C,j=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;j>0&&(j=1/Math.sqrt(j)),this._axisZX*=j,this._axisZY*=j,this._axisZZ*=j,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,m=this._basisX1X,v=this._basisY1X,b=this._basisZ1X,f=this._basisX1Y,u=this._basisY1Y,p=this._basisZ1Y,x=this._basisX1Z,y=this._basisY1Z,d=this._basisZ1Z,g=this._basisX2X,X=this._basisY2X,Y=this._basisZ2X,z=this._basisX2Y,Z=this._basisY2Y,M=this._basisZ2Y,w=m*g+f*z+x*this._basisX2Z,L=m*X+f*Z+x*(I=this._basisY2Z),k=v*X+u*Z+y*I,A=v*Y+u*M+y*(V=this._basisZ2Z),B=b*X+p*Z+d*I,P=b*Y+p*M+d*V;var R=m*Y+f*M+x*V;if(R<=-1){var E=Math.atan2(B,k);S=.5*E,T=-1.570796326794895,C=.5*-E}else if(R>=1){var q=Math.atan2(B,k);S=.5*q,T=1.570796326794895,C=.5*q}else S=Math.atan2(-A,P),T=Math.asin(R),C=Math.atan2(-L,w);this._angleX=S,this._angleY=T,this._angleZ=C,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},n._getVelocitySolverInfo=function(i,a){t.prototype._getVelocitySolverInfo.call(this,i,a),this.getInfo(a,i,!1)},n._getPositionSolverInfo=function(i){t.prototype._getPositionSolverInfo.call(this,i),this.getInfo(i,null,!0)},n.getAxis1=function(){var t=new r.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t},n.getAxis2=function(){var t=new r.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t},n.getAxis1To=function(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z},n.getAxis2To=function(t){t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z},n.getLocalAxis1=function(){var t=new r.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t},n.getLocalAxis2=function(){var t=new r.common.Vec3;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,t},n.getLocalAxis1To=function(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z},n.getLocalAxis2To=function(t){t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z},n.getSpringDamper1=function(){return this._sd1},n.getSpringDamper2=function(){return this._sd2},n.getLimitMotor1=function(){return this._lm1},n.getLimitMotor2=function(){return this._lm2},n.getAngle1=function(){return this._angleX},n.getAngle2=function(){return this._angleZ},i}(r.dynamics.constraint.joint.Joint),r.dynamics.constraint.joint.UniversalJointConfig=function(t){function i(){var i;return(i=t.call(this)||this).localAxis1=new r.common.Vec3(1,0,0),i.localAxis2=new r.common.Vec3(1,0,0),i.springDamper1=new r.dynamics.constraint.joint.SpringDamper,i.springDamper2=new r.dynamics.constraint.joint.SpringDamper,i.limitMotor1=new r.dynamics.constraint.joint.RotationalLimitMotor,i.limitMotor2=new r.dynamics.constraint.joint.RotationalLimitMotor,i}return a(i,t),i.prototype.init=function(t,i,a,n,o){this._init(t,i,a);var s,r,e,_,h,l,c=this.localAxis1;s=n.x,r=n.y,e=n.z,_=t._transform._rotation00*s+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*s+t._transform._rotation11*r+t._transform._rotation21*e,l=t._transform._rotation02*s+t._transform._rotation12*r+t._transform._rotation22*e,s=_,r=h,e=l,c.x=s,c.y=r,c.z=e;var m,v,b,f,u,p,x=this.localAxis2;return m=o.x,v=o.y,b=o.z,f=i._transform._rotation00*m+i._transform._rotation10*v+i._transform._rotation20*b,u=i._transform._rotation01*m+i._transform._rotation11*v+i._transform._rotation21*b,p=i._transform._rotation02*m+i._transform._rotation12*v+i._transform._rotation22*b,m=f,v=u,b=p,x.x=m,x.y=v,x.z=b,this},i}(r.dynamics.constraint.joint.JointConfig),r.dynamics.constraint.solver||(r.dynamics.constraint.solver={}),r.dynamics.constraint.solver.ConstraintSolverType=function(){},r.dynamics.constraint.solver.common||(r.dynamics.constraint.solver.common={}),r.dynamics.constraint.solver.common.ContactSolverMassDataRow=function(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0},r.dynamics.constraint.solver.common.JointSolverMassDataRow=function(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0},r.dynamics.constraint.solver.direct||(r.dynamics.constraint.solver.direct={}),r.dynamics.constraint.solver.direct.Boundary=function(){function t(t){this.iBounded=new Array(t),this.iUnbounded=new Array(t),this.signs=new Array(t),this.b=new Array(t),this.numBounded=0,this.numUnbounded=0,this.matrixId=0}var i=t.prototype;return i.init=function(t){this.numBounded=t.numBounded;for(var i=0,a=this.numBounded;i<a;){var n=i++;this.iBounded[n]=t.iBounded[n],this.signs[n]=t.signs[n]}this.numUnbounded=t.numUnbounded,this.matrixId=0;for(var o=0,s=this.numUnbounded;o<s;){var r=o++,e=t.iUnbounded[r];this.iUnbounded[r]=e,this.matrixId|=1<<e}},i.computeImpulses=function(t,i,a,n,o,s,e){for(var _=0,h=this.numUnbounded;_<h;){var l=this.iUnbounded[_++],c=t.rows[l];this.b[l]=c.rhs*s-a[l]-c.cfm*n[l]}for(var m=i._invMassWithoutCfm,v=0,b=this.numBounded;v<b;){var f=v++,u=this.iBounded[f],p=this.signs[f],x=t.rows[u],y=(p<0?x.minImpulse:p>0?x.maxImpulse:0)-n[u];if(o[u]=y,0!=y)for(var d=0,g=this.numUnbounded;d<g;){var X=this.iUnbounded[d++];this.b[X]-=m[u][X]*y}}for(var Y,z=this.iUnbounded,Z=this.numUnbounded,M=0,I=0;I<Z;)M|=1<<z[I++];i._cacheComputed[M]||(i.computeSubmatrix(M,z,Z),i._cacheComputed[M]=!0),Y=i._cachedSubmatrices[M];for(var V=!0,w=0,L=this.numUnbounded;w<L;){for(var k=w++,A=this.iUnbounded[k],B=t.rows[A],P=n[A],S=P,T=0,C=this.numUnbounded;T<C;){var j=T++;S+=this.b[this.iUnbounded[j]]*Y[k][j]}if(S<B.minImpulse-r.common.Setting.directMlcpSolverEps||S>B.maxImpulse+r.common.Setting.directMlcpSolverEps){V=!1;break}o[A]=S-P}if(e)return!0;if(!V)return!1;for(var R=0,E=this.numBounded;R<E;){for(var q,D=R++,N=this.iBounded[D],F=t.rows[N],G=this.signs[D],J=n[N]+o[N],W=a[N],O=0,U=t.numRows;O<U;){var H=O++;W+=m[N][H]*o[H]}if(q=F.rhs*s-W-F.cfm*J,G<0&&q>r.common.Setting.directMlcpSolverEps||G>0&&q<-r.common.Setting.directMlcpSolverEps){V=!1;break}}return V},t}(),r.dynamics.constraint.solver.direct.BoundaryBuildInfo=function(t){this.size=t,this.numBounded=0,this.iBounded=new Array(t),this.signs=new Array(t),this.numUnbounded=0,this.iUnbounded=new Array(t)},r.dynamics.constraint.solver.direct.BoundaryBuilder=function(){function t(t){this.maxRows=t,this.numBoundaries=0,this.boundaries=new Array(1<<t),this.bbInfo=new r.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}var i=t.prototype;return i.buildBoundariesRecursive=function(t,i){if(i==t.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new r.dynamics.constraint.solver.direct.Boundary(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);var a=t.rows[i],n=a.minImpulse>-Infinity,o=a.maxImpulse<Infinity;if(0==a.minImpulse&&0==a.maxImpulse){var s=this.bbInfo;return s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=0,s.numBounded++,this.buildBoundariesRecursive(t,i+1),void this.bbInfo.numBounded--}var e=this.bbInfo;if(e.iUnbounded[e.numUnbounded]=i,e.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,n){var _=this.bbInfo;_.iBounded[_.numBounded]=i,_.signs[_.numBounded]=-1,_.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(o){var h=this.bbInfo;h.iBounded[h.numBounded]=i,h.signs[h.numBounded]=1,h.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}},i.buildBoundaries=function(t){this.numBoundaries=0;var i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)},t}(),r.dynamics.constraint.solver.direct.BoundarySelector=function(){function t(t){this.n=t,this.indices=new Array(t),this.tmpIndices=new Array(t);for(var i=0;i<t;){var a=i++;this.indices[a]=a}}var i=t.prototype;return i.getIndex=function(t){return this.indices[t]},i.select=function(t){for(var i=0;this.indices[i]!=t;)++i;for(;i>0;){var a=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=a,--i}},i.setSize=function(t){for(var i=0,a=0,n=0,o=this.n;n<o;){var s=this.indices[n++];s<t?(this.tmpIndices[i]=s,++i):(this.tmpIndices[t+a]=s,++a)}var r=this.indices;this.indices=this.tmpIndices,this.tmpIndices=r},t}(),r.dynamics.constraint.solver.direct.DirectJointConstraintSolver=function(t){function i(i){var a;(a=t.call(this)||this).joint=i,a.info=new r.dynamics.constraint.info.joint.JointSolverInfo;var n=r.common.Setting.maxJacobianRows;a.massMatrix=new r.dynamics.constraint.solver.direct.MassMatrix(n),a.boundaryBuilder=new r.dynamics.constraint.solver.direct.BoundaryBuilder(n),a.massData=new Array(n);for(var o=0,s=a.massData.length;o<s;)a.massData[o++]=new r.dynamics.constraint.solver.common.JointSolverMassDataRow;var e=a.boundaryBuilder.boundaries.length;a.velBoundarySelector=new r.dynamics.constraint.solver.direct.BoundarySelector(e),a.posBoundarySelector=new r.dynamics.constraint.solver.direct.BoundarySelector(e),a.relVels=new Array(n),a.impulses=new Array(n),a.dImpulses=new Array(n),a.dTotalImpulses=new Array(n);for(var _=0;_<n;){var h=_++;a.relVels[h]=0,a.impulses[h]=0,a.dImpulses[h]=0,a.dTotalImpulses[h]=0}return a}a(i,t);var n=i.prototype;return n.preSolveVelocity=function(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var n=this.velBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,r=0,e=0,_=n.n;e<_;){var h=n.indices[e++];h<o?(n.tmpIndices[s]=h,++s):(n.tmpIndices[o+r]=h,++r)}var l=n.indices;n.indices=n.tmpIndices,n.tmpIndices=l},n.warmStart=function(t){var i=this.joint._positionCorrectionAlgorithm==r.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?r.common.Setting.jointWarmStartingFactorForBaungarte:r.common.Setting.jointWarmStartingFactor;if((i*=t.dtRatio)<=0)for(var a=0,n=this.info.numRows;a<n;){var o=this.info.rows[a++].impulse;o.impulse=0,o.impulseM=0,o.impulseP=0}else{for(var s=0,e=this.info.numRows;s<e;){var _=s++,h=this.info.rows[_],l=h.impulse,c=l.impulse*i;if(c<h.minImpulse?c=h.minImpulse:c>h.maxImpulse&&(c=h.maxImpulse),l.impulse=c,h.motorMaxImpulse>0){var m=l.impulseM*i,v=h.motorMaxImpulse;m<-v?m=-v:m>v&&(m=v),l.impulseM=m}else l.impulseM=0;this.dImpulses[_]=l.impulse+l.impulseM}var b,f,u,p,x,y,d,g,X,Y,z,Z,M=this.dImpulses,I=!1,V=!1;b=this._b1._velX,f=this._b1._velY,u=this._b1._velZ,p=this._b2._velX,x=this._b2._velY,y=this._b2._velZ,d=this._b1._angVelX,g=this._b1._angVelY,X=this._b1._angVelZ,Y=this._b2._angVelX,z=this._b2._angVelY,Z=this._b2._angVelZ;for(var w=0,L=this.info.numRows;w<L;){var k=w++,A=this.info.rows[k].jacobian,B=this.massData[k],P=M[k];0!=(1&A.flag)&&(b+=B.invMLin1X*P,f+=B.invMLin1Y*P,u+=B.invMLin1Z*P,p+=B.invMLin2X*-P,x+=B.invMLin2Y*-P,y+=B.invMLin2Z*-P,I=!0),0!=(2&A.flag)&&(d+=B.invMAng1X*P,g+=B.invMAng1Y*P,X+=B.invMAng1Z*P,Y+=B.invMAng2X*-P,z+=B.invMAng2Y*-P,Z+=B.invMAng2Z*-P,V=!0)}I&&(this._b1._velX=b,this._b1._velY=f,this._b1._velZ=u,this._b2._velX=p,this._b2._velY=x,this._b2._velZ=y),V&&(this._b1._angVelX=d,this._b1._angVelY=g,this._b1._angVelZ=X,this._b2._angVelX=Y,this._b2._angVelY=z,this._b2._angVelZ=Z)}},n.solveVelocity=function(){var t,i,a,n,o,s,r,e,_,h,l,c,m=this.info.numRows;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,n=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var v=0;v<m;){var b=v++,f=this.info.rows[b],u=f.jacobian,p=0;p+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,p-=n*u.lin2X+o*u.lin2Y+s*u.lin2Z,p+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,p-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z,this.relVels[b]=p,this.impulses[b]=f.impulse.impulse,this.dTotalImpulses[b]=0}for(var x=this.massMatrix._invMassWithoutCfm,y=0;y<m;){var d=y++,g=this.info.rows[d],X=g.impulse;if(g.motorMaxImpulse>0){var Y=X.impulseM,z=Y+this.massData[d].massWithoutCfm*(-g.motorSpeed-this.relVels[d]),Z=g.motorMaxImpulse;z<-Z?z=-Z:z>Z&&(z=Z),X.impulseM=z;var M=z-Y;this.dTotalImpulses[d]=M;for(var I=0;I<m;){var V=I++;this.relVels[V]+=M*x[d][V]}}}for(var w=!1,L=0,k=this.boundaryBuilder.numBoundaries;L<k;){var A=this.velBoundarySelector.indices[L++];if(this.boundaryBuilder.boundaries[A].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var B=0;B<m;){var P=B++,S=this.dImpulses[P];this.info.rows[P].impulse.impulse+=S,this.dTotalImpulses[P]+=S}var T=this.dTotalImpulses,C=!1,j=!1,R=void 0,E=void 0,q=void 0,D=void 0,N=void 0,F=void 0,G=void 0,J=void 0,W=void 0,O=void 0,U=void 0,H=void 0;R=this._b1._velX,E=this._b1._velY,q=this._b1._velZ,D=this._b2._velX,N=this._b2._velY,F=this._b2._velZ,G=this._b1._angVelX,J=this._b1._angVelY,W=this._b1._angVelZ,O=this._b2._angVelX,U=this._b2._angVelY,H=this._b2._angVelZ;for(var Q=0,K=this.info.numRows;Q<K;){var $=Q++,tt=this.info.rows[$].jacobian,it=this.massData[$],at=T[$];0!=(1&tt.flag)&&(R+=it.invMLin1X*at,E+=it.invMLin1Y*at,q+=it.invMLin1Z*at,D+=it.invMLin2X*-at,N+=it.invMLin2Y*-at,F+=it.invMLin2Z*-at,C=!0),0!=(2&tt.flag)&&(G+=it.invMAng1X*at,J+=it.invMAng1Y*at,W+=it.invMAng1Z*at,O+=it.invMAng2X*-at,U+=it.invMAng2Y*-at,H+=it.invMAng2Z*-at,j=!0)}C&&(this._b1._velX=R,this._b1._velY=E,this._b1._velZ=q,this._b2._velX=D,this._b2._velY=N,this._b2._velZ=F),j&&(this._b1._angVelX=G,this._b1._angVelY=J,this._b1._angVelZ=W,this._b2._angVelX=O,this._b2._angVelY=U,this._b2._angVelZ=H);for(var nt=this.velBoundarySelector,ot=0;nt.indices[ot]!=A;)++ot;for(;ot>0;){var st=nt.indices[ot];nt.indices[ot]=nt.indices[ot-1],nt.indices[ot-1]=st,--ot}w=!0;break}}w||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)")},n.postSolveVelocity=function(t){var i,a,n,o,s,r;i=0,a=0,n=0,o=0,s=0,r=0;for(var e=0,_=this.info.numRows;e<_;){var h=this.info.rows[e++],l=h.impulse,c=h.jacobian;0!=(1&c.flag)?(i+=c.lin1X*l.impulse,a+=c.lin1Y*l.impulse,n+=c.lin1Z*l.impulse):0!=(2&c.flag)&&(o+=c.ang1X*l.impulse,s+=c.ang1Y*l.impulse,r+=c.ang1Z*l.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=s*t.invDt,this.joint._appliedTorqueZ=r*t.invDt},n.preSolvePosition=function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var n=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,r=0,e=0,_=n.n;e<_;){var h=n.indices[e++];h<o?(n.tmpIndices[s]=h,++s):(n.tmpIndices[o+r]=h,++r)}var l=n.indices;n.indices=n.tmpIndices,n.tmpIndices=l;for(var c=0,m=this.info.numRows;c<m;)this.info.rows[c++].impulse.impulseP=0},n.solvePositionSplitImpulse=function(){var t,i,a,n,o,s,e,_,h,l,c,m,v=this.info.numRows;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,e=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,h=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;for(var b=0;b<v;){var f=b++,u=this.info.rows[f],p=u.jacobian,x=0;x+=t*p.lin1X+i*p.lin1Y+a*p.lin1Z,x-=n*p.lin2X+o*p.lin2Y+s*p.lin2Z,x+=e*p.ang1X+_*p.ang1Y+h*p.ang1Z,x-=l*p.ang2X+c*p.ang2Y+m*p.ang2Z,this.relVels[f]=x,this.impulses[f]=u.impulse.impulseP}for(var y=!1,d=0,g=this.boundaryBuilder.numBoundaries;d<g;){var X=this.posBoundarySelector.indices[d++];if(this.boundaryBuilder.boundaries[X].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,r.common.Setting.positionSplitImpulseBaumgarte,!1)){for(var Y=0;Y<v;){var z=Y++;this.info.rows[z].impulse.impulseP+=this.dImpulses[z]}var Z=this.dImpulses,M=!1,I=!1,V=void 0,w=void 0,L=void 0,k=void 0,A=void 0,B=void 0,P=void 0,S=void 0,T=void 0,C=void 0,j=void 0,R=void 0;V=this._b1._pseudoVelX,w=this._b1._pseudoVelY,L=this._b1._pseudoVelZ,k=this._b2._pseudoVelX,A=this._b2._pseudoVelY,B=this._b2._pseudoVelZ,P=this._b1._angPseudoVelX,S=this._b1._angPseudoVelY,T=this._b1._angPseudoVelZ,C=this._b2._angPseudoVelX,j=this._b2._angPseudoVelY,R=this._b2._angPseudoVelZ;for(var E=0,q=this.info.numRows;E<q;){var D=E++,N=this.info.rows[D].jacobian,F=this.massData[D],G=Z[D];0!=(1&N.flag)&&(V+=F.invMLin1X*G,w+=F.invMLin1Y*G,L+=F.invMLin1Z*G,k+=F.invMLin2X*-G,A+=F.invMLin2Y*-G,B+=F.invMLin2Z*-G,M=!0),0!=(2&N.flag)&&(P+=F.invMAng1X*G,S+=F.invMAng1Y*G,T+=F.invMAng1Z*G,C+=F.invMAng2X*-G,j+=F.invMAng2Y*-G,R+=F.invMAng2Z*-G,I=!0)}M&&(this._b1._pseudoVelX=V,this._b1._pseudoVelY=w,this._b1._pseudoVelZ=L,this._b2._pseudoVelX=k,this._b2._pseudoVelY=A,this._b2._pseudoVelZ=B),I&&(this._b1._angPseudoVelX=P,this._b1._angPseudoVelY=S,this._b1._angPseudoVelZ=T,this._b2._angPseudoVelX=C,this._b2._angPseudoVelY=j,this._b2._angPseudoVelZ=R);for(var J=this.posBoundarySelector,W=0;J.indices[W]!=X;)++W;for(;W>0;){var O=J.indices[W];J.indices[W]=J.indices[W-1],J.indices[W-1]=O,--W}y=!0;break}}y||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)")},n.solvePositionNgs=function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var n=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,e=0,_=0,h=n.n;_<h;){var l=n.indices[_++];l<o?(n.tmpIndices[s]=l,++s):(n.tmpIndices[o+e]=l,++e)}var c=n.indices;n.indices=n.tmpIndices,n.tmpIndices=c;for(var m=this.info.numRows,v=0;v<m;){var b=v++,f=this.info.rows[b].impulse;this.relVels[b]=0,this.impulses[b]=f.impulseP}for(var u=!1,p=0,x=this.boundaryBuilder.numBoundaries;p<x;){var y=this.posBoundarySelector.indices[p++];if(this.boundaryBuilder.boundaries[y].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,r.common.Setting.positionNgsBaumgarte,!1)){for(var d=0;d<m;){var g=d++;this.info.rows[g].impulse.impulseP+=this.dImpulses[g]}var X=this.dImpulses,Y=!1,z=!1,Z=void 0,M=void 0,I=void 0,V=void 0,w=void 0,L=void 0,k=void 0,A=void 0,B=void 0,P=void 0,S=void 0,T=void 0;Z=0,M=0,I=0,V=0,w=0,L=0,k=0,A=0,B=0,P=0,S=0,T=0;for(var C=0,j=this.info.numRows;C<j;){var R=C++,E=this.info.rows[R].jacobian,q=this.massData[R],D=X[R];0!=(1&E.flag)&&(Z+=q.invMLin1X*D,M+=q.invMLin1Y*D,I+=q.invMLin1Z*D,V+=q.invMLin2X*-D,w+=q.invMLin2Y*-D,L+=q.invMLin2Z*-D,Y=!0),0!=(2&E.flag)&&(k+=q.invMAng1X*D,A+=q.invMAng1Y*D,B+=q.invMAng1Z*D,P+=q.invMAng2X*-D,S+=q.invMAng2Y*-D,T+=q.invMAng2Z*-D,z=!0)}if(Y){var N=this._b1;N._transform._positionX+=Z,N._transform._positionY+=M,N._transform._positionZ+=I;var F=this._b2;F._transform._positionX+=V,F._transform._positionY+=w,F._transform._positionZ+=L}if(z){var G=this._b1,J=Math.sqrt(k*k+A*A+B*B),W=.5*J,O=void 0,U=void 0;if(W<.5){var H=W*W;O=.5*(1-.16666666666666666*H+H*H*.008333333333333333),U=1-.5*H+H*H*.041666666666666664}else O=Math.sin(W)/J,U=Math.cos(W);var Q,K,$,tt;Q=k*O,K=A*O,$=B*O,tt=U;var it=void 0,at=void 0,nt=void 0,ot=void 0,st=G._transform._rotation00,rt=G._transform._rotation11,et=G._transform._rotation22,_t=st+rt+et,ht=void 0;_t>0?(ot=.5*(ht=Math.sqrt(_t+1)),ht=.5/ht,it=(G._transform._rotation21-G._transform._rotation12)*ht,at=(G._transform._rotation02-G._transform._rotation20)*ht,nt=(G._transform._rotation10-G._transform._rotation01)*ht):st>rt?st>et?(it=.5*(ht=Math.sqrt(st-rt-et+1)),ht=.5/ht,at=(G._transform._rotation01+G._transform._rotation10)*ht,nt=(G._transform._rotation02+G._transform._rotation20)*ht,ot=(G._transform._rotation21-G._transform._rotation12)*ht):(nt=.5*(ht=Math.sqrt(et-st-rt+1)),ht=.5/ht,it=(G._transform._rotation02+G._transform._rotation20)*ht,at=(G._transform._rotation12+G._transform._rotation21)*ht,ot=(G._transform._rotation10-G._transform._rotation01)*ht):rt>et?(at=.5*(ht=Math.sqrt(rt-et-st+1)),ht=.5/ht,it=(G._transform._rotation01+G._transform._rotation10)*ht,nt=(G._transform._rotation12+G._transform._rotation21)*ht,ot=(G._transform._rotation02-G._transform._rotation20)*ht):(nt=.5*(ht=Math.sqrt(et-st-rt+1)),ht=.5/ht,it=(G._transform._rotation02+G._transform._rotation20)*ht,at=(G._transform._rotation12+G._transform._rotation21)*ht,ot=(G._transform._rotation10-G._transform._rotation01)*ht);var lt=(it=tt*it+Q*ot+K*nt-$*at)*it+(at=tt*at-Q*nt+K*ot+$*it)*at+(nt=tt*nt+Q*at-K*it+$*ot)*nt+(ot=tt*ot-Q*it-K*at-$*nt)*ot;lt>1e-32&&(lt=1/Math.sqrt(lt));it*=lt,at*=lt,nt*=lt,ot*=lt;var ct=2*it,mt=2*at,vt=2*nt,bt=it*ct,ft=at*mt,ut=nt*vt,pt=it*mt,xt=at*vt,yt=it*vt,dt=ot*ct,gt=ot*mt,Xt=ot*vt;G._transform._rotation00=1-ft-ut,G._transform._rotation01=pt-Xt,G._transform._rotation02=yt+gt,G._transform._rotation10=pt+Xt,G._transform._rotation11=1-bt-ut,G._transform._rotation12=xt-dt,G._transform._rotation20=yt-gt,G._transform._rotation21=xt+dt,G._transform._rotation22=1-bt-ft;var Yt,zt,Zt,Mt,It,Vt,wt,Lt,kt;Yt=G._transform._rotation00*G._invLocalInertia00+G._transform._rotation01*G._invLocalInertia10+G._transform._rotation02*G._invLocalInertia20,zt=G._transform._rotation00*G._invLocalInertia01+G._transform._rotation01*G._invLocalInertia11+G._transform._rotation02*G._invLocalInertia21,Zt=G._transform._rotation00*G._invLocalInertia02+G._transform._rotation01*G._invLocalInertia12+G._transform._rotation02*G._invLocalInertia22,Mt=G._transform._rotation10*G._invLocalInertia00+G._transform._rotation11*G._invLocalInertia10+G._transform._rotation12*G._invLocalInertia20,It=G._transform._rotation10*G._invLocalInertia01+G._transform._rotation11*G._invLocalInertia11+G._transform._rotation12*G._invLocalInertia21,Vt=G._transform._rotation10*G._invLocalInertia02+G._transform._rotation11*G._invLocalInertia12+G._transform._rotation12*G._invLocalInertia22,wt=G._transform._rotation20*G._invLocalInertia00+G._transform._rotation21*G._invLocalInertia10+G._transform._rotation22*G._invLocalInertia20,Lt=G._transform._rotation20*G._invLocalInertia01+G._transform._rotation21*G._invLocalInertia11+G._transform._rotation22*G._invLocalInertia21,kt=G._transform._rotation20*G._invLocalInertia02+G._transform._rotation21*G._invLocalInertia12+G._transform._rotation22*G._invLocalInertia22,G._invInertia00=Yt,G._invInertia01=zt,G._invInertia02=Zt,G._invInertia10=Mt,G._invInertia11=It,G._invInertia12=Vt,G._invInertia20=wt,G._invInertia21=Lt,G._invInertia22=kt;var At,Bt,Pt,St,Tt,Ct,jt,Rt,Et;At=G._invInertia00*G._transform._rotation00+G._invInertia01*G._transform._rotation01+G._invInertia02*G._transform._rotation02,Bt=G._invInertia00*G._transform._rotation10+G._invInertia01*G._transform._rotation11+G._invInertia02*G._transform._rotation12,Pt=G._invInertia00*G._transform._rotation20+G._invInertia01*G._transform._rotation21+G._invInertia02*G._transform._rotation22,St=G._invInertia10*G._transform._rotation00+G._invInertia11*G._transform._rotation01+G._invInertia12*G._transform._rotation02,Tt=G._invInertia10*G._transform._rotation10+G._invInertia11*G._transform._rotation11+G._invInertia12*G._transform._rotation12,Ct=G._invInertia10*G._transform._rotation20+G._invInertia11*G._transform._rotation21+G._invInertia12*G._transform._rotation22,jt=G._invInertia20*G._transform._rotation00+G._invInertia21*G._transform._rotation01+G._invInertia22*G._transform._rotation02,Rt=G._invInertia20*G._transform._rotation10+G._invInertia21*G._transform._rotation11+G._invInertia22*G._transform._rotation12,Et=G._invInertia20*G._transform._rotation20+G._invInertia21*G._transform._rotation21+G._invInertia22*G._transform._rotation22,G._invInertia00=At,G._invInertia01=Bt,G._invInertia02=Pt,G._invInertia10=St,G._invInertia11=Tt,G._invInertia12=Ct,G._invInertia20=jt,G._invInertia21=Rt,G._invInertia22=Et,G._invInertia00*=G._rotFactor.x,G._invInertia01*=G._rotFactor.x,G._invInertia02*=G._rotFactor.x,G._invInertia10*=G._rotFactor.y,G._invInertia11*=G._rotFactor.y,G._invInertia12*=G._rotFactor.y,G._invInertia20*=G._rotFactor.z,G._invInertia21*=G._rotFactor.z,G._invInertia22*=G._rotFactor.z;var qt=this._b2,Dt=Math.sqrt(P*P+S*S+T*T),Nt=.5*Dt,Ft=void 0,Gt=void 0;if(Nt<.5){var Jt=Nt*Nt;Ft=.5*(1-.16666666666666666*Jt+Jt*Jt*.008333333333333333),Gt=1-.5*Jt+Jt*Jt*.041666666666666664}else Ft=Math.sin(Nt)/Dt,Gt=Math.cos(Nt);var Wt,Ot,Ut,Ht;Wt=P*Ft,Ot=S*Ft,Ut=T*Ft,Ht=Gt;var Qt=void 0,Kt=void 0,$t=void 0,ti=void 0,ii=qt._transform._rotation00,ai=qt._transform._rotation11,ni=qt._transform._rotation22,oi=ii+ai+ni,si=void 0;oi>0?(ti=.5*(si=Math.sqrt(oi+1)),si=.5/si,Qt=(qt._transform._rotation21-qt._transform._rotation12)*si,Kt=(qt._transform._rotation02-qt._transform._rotation20)*si,$t=(qt._transform._rotation10-qt._transform._rotation01)*si):ii>ai?ii>ni?(Qt=.5*(si=Math.sqrt(ii-ai-ni+1)),si=.5/si,Kt=(qt._transform._rotation01+qt._transform._rotation10)*si,$t=(qt._transform._rotation02+qt._transform._rotation20)*si,ti=(qt._transform._rotation21-qt._transform._rotation12)*si):($t=.5*(si=Math.sqrt(ni-ii-ai+1)),si=.5/si,Qt=(qt._transform._rotation02+qt._transform._rotation20)*si,Kt=(qt._transform._rotation12+qt._transform._rotation21)*si,ti=(qt._transform._rotation10-qt._transform._rotation01)*si):ai>ni?(Kt=.5*(si=Math.sqrt(ai-ni-ii+1)),si=.5/si,Qt=(qt._transform._rotation01+qt._transform._rotation10)*si,$t=(qt._transform._rotation12+qt._transform._rotation21)*si,ti=(qt._transform._rotation02-qt._transform._rotation20)*si):($t=.5*(si=Math.sqrt(ni-ii-ai+1)),si=.5/si,Qt=(qt._transform._rotation02+qt._transform._rotation20)*si,Kt=(qt._transform._rotation12+qt._transform._rotation21)*si,ti=(qt._transform._rotation10-qt._transform._rotation01)*si);var ri=(Qt=Ht*Qt+Wt*ti+Ot*$t-Ut*Kt)*Qt+(Kt=Ht*Kt-Wt*$t+Ot*ti+Ut*Qt)*Kt+($t=Ht*$t+Wt*Kt-Ot*Qt+Ut*ti)*$t+(ti=Ht*ti-Wt*Qt-Ot*Kt-Ut*$t)*ti;ri>1e-32&&(ri=1/Math.sqrt(ri));Qt*=ri,Kt*=ri,$t*=ri,ti*=ri;var ei=2*Qt,_i=2*Kt,hi=2*$t,li=Qt*ei,ci=Kt*_i,mi=$t*hi,vi=Qt*_i,bi=Kt*hi,fi=Qt*hi,ui=ti*ei,pi=ti*_i,xi=ti*hi;qt._transform._rotation00=1-ci-mi,qt._transform._rotation01=vi-xi,qt._transform._rotation02=fi+pi,qt._transform._rotation10=vi+xi,qt._transform._rotation11=1-li-mi,qt._transform._rotation12=bi-ui,qt._transform._rotation20=fi-pi,qt._transform._rotation21=bi+ui,qt._transform._rotation22=1-li-ci;var yi,di,gi,Xi,Yi,zi,Zi,Mi,Ii;yi=qt._transform._rotation00*qt._invLocalInertia00+qt._transform._rotation01*qt._invLocalInertia10+qt._transform._rotation02*qt._invLocalInertia20,di=qt._transform._rotation00*qt._invLocalInertia01+qt._transform._rotation01*qt._invLocalInertia11+qt._transform._rotation02*qt._invLocalInertia21,gi=qt._transform._rotation00*qt._invLocalInertia02+qt._transform._rotation01*qt._invLocalInertia12+qt._transform._rotation02*qt._invLocalInertia22,Xi=qt._transform._rotation10*qt._invLocalInertia00+qt._transform._rotation11*qt._invLocalInertia10+qt._transform._rotation12*qt._invLocalInertia20,Yi=qt._transform._rotation10*qt._invLocalInertia01+qt._transform._rotation11*qt._invLocalInertia11+qt._transform._rotation12*qt._invLocalInertia21,zi=qt._transform._rotation10*qt._invLocalInertia02+qt._transform._rotation11*qt._invLocalInertia12+qt._transform._rotation12*qt._invLocalInertia22,Zi=qt._transform._rotation20*qt._invLocalInertia00+qt._transform._rotation21*qt._invLocalInertia10+qt._transform._rotation22*qt._invLocalInertia20,Mi=qt._transform._rotation20*qt._invLocalInertia01+qt._transform._rotation21*qt._invLocalInertia11+qt._transform._rotation22*qt._invLocalInertia21,Ii=qt._transform._rotation20*qt._invLocalInertia02+qt._transform._rotation21*qt._invLocalInertia12+qt._transform._rotation22*qt._invLocalInertia22,qt._invInertia00=yi,qt._invInertia01=di,qt._invInertia02=gi,qt._invInertia10=Xi,qt._invInertia11=Yi,qt._invInertia12=zi,qt._invInertia20=Zi,qt._invInertia21=Mi,qt._invInertia22=Ii;var Vi,wi,Li,ki,Ai,Bi,Pi,Si,Ti;Vi=qt._invInertia00*qt._transform._rotation00+qt._invInertia01*qt._transform._rotation01+qt._invInertia02*qt._transform._rotation02,wi=qt._invInertia00*qt._transform._rotation10+qt._invInertia01*qt._transform._rotation11+qt._invInertia02*qt._transform._rotation12,Li=qt._invInertia00*qt._transform._rotation20+qt._invInertia01*qt._transform._rotation21+qt._invInertia02*qt._transform._rotation22,ki=qt._invInertia10*qt._transform._rotation00+qt._invInertia11*qt._transform._rotation01+qt._invInertia12*qt._transform._rotation02,Ai=qt._invInertia10*qt._transform._rotation10+qt._invInertia11*qt._transform._rotation11+qt._invInertia12*qt._transform._rotation12,Bi=qt._invInertia10*qt._transform._rotation20+qt._invInertia11*qt._transform._rotation21+qt._invInertia12*qt._transform._rotation22,Pi=qt._invInertia20*qt._transform._rotation00+qt._invInertia21*qt._transform._rotation01+qt._invInertia22*qt._transform._rotation02,Si=qt._invInertia20*qt._transform._rotation10+qt._invInertia21*qt._transform._rotation11+qt._invInertia22*qt._transform._rotation12,Ti=qt._invInertia20*qt._transform._rotation20+qt._invInertia21*qt._transform._rotation21+qt._invInertia22*qt._transform._rotation22,qt._invInertia00=Vi,qt._invInertia01=wi,qt._invInertia02=Li,qt._invInertia10=ki,qt._invInertia11=Ai,qt._invInertia12=Bi,qt._invInertia20=Pi,qt._invInertia21=Si,qt._invInertia22=Ti,qt._invInertia00*=qt._rotFactor.x,qt._invInertia01*=qt._rotFactor.x,qt._invInertia02*=qt._rotFactor.x,qt._invInertia10*=qt._rotFactor.y,qt._invInertia11*=qt._rotFactor.y,qt._invInertia12*=qt._rotFactor.y,qt._invInertia20*=qt._rotFactor.z,qt._invInertia21*=qt._rotFactor.z,qt._invInertia22*=qt._rotFactor.z}for(var Ci=this.posBoundarySelector,ji=0;Ci.indices[ji]!=y;)++ji;for(;ji>0;){var Ri=Ci.indices[ji];Ci.indices[ji]=Ci.indices[ji-1],Ci.indices[ji-1]=Ri,--ji}u=!0;break}}u||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)")},n.postSolve=function(){this.joint._syncAnchors(),this.joint._checkDestruction()},i}(r.dynamics.constraint.ConstraintSolver),r.dynamics.constraint.solver.direct.MassMatrix=function(){function t(t){this._size=t,this.tmpMatrix=new Array(this._size),this._invMass=new Array(this._size),this._invMassWithoutCfm=new Array(this._size);for(var i=0,a=this._size;i<a;){var n=i++;this.tmpMatrix[n]=new Array(this._size),this._invMass[n]=new Array(this._size),this._invMassWithoutCfm[n]=new Array(this._size);for(var o=0,s=this._size;o<s;){var r=o++;this.tmpMatrix[n][r]=0,this._invMass[n][r]=0,this._invMassWithoutCfm[n][r]=0}}this._maxSubmatrixId=1<<this._size,this._cacheComputed=new Array(this._maxSubmatrixId),this._cachedSubmatrices=new Array(this._maxSubmatrixId);for(var e=0,_=this._maxSubmatrixId;e<_;){for(var h=e++,l=h,c=l=(15&(l=(51&(l=(85&h)+(h>>1&85)))+(l>>2&51)))+(l>>4&15),m=new Array(c),v=0;v<c;){var b=v++;m[b]=new Array(c);for(var f=0;f<c;)m[b][f++]=0}this._cacheComputed[h]=!1,this._cachedSubmatrices[h]=m}}var i=t.prototype;return i.computeSubmatrix=function(t,i,a){for(var n=0;n<a;)for(var o=n++,s=i[o],r=0;r<a;){var e=r++;this.tmpMatrix[o][e]=this._invMass[s][i[e]]}var _,h,l,c,m,v=this.tmpMatrix,b=this._cachedSubmatrices[t];switch(a){case 4:_=v[0],h=b[0],m=1/_[0],h[0]=m,_[1]*=m,_[2]*=m,_[3]*=m,l=v[1],(c=b[1])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l=v[2],(c=b[2])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l=v[3],(c=b[3])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],_=v[1],h=b[1],m=1/_[1],h[1]=m,h[0]*=m,_[2]*=m,_[3]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l=v[2],(c=b[2])[0]-=h[0]*l[1],c[1]=-m*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l=v[3],(c=b[3])[0]-=h[0]*l[1],c[1]=-m*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],_=v[2],h=b[2],m=1/_[2],h[2]=m,h[0]*=m,h[1]*=m,_[3]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[2],l[3]-=_[3]*l[2],l=v[1],(c=b[1])[0]-=h[0]*l[2],c[1]-=h[1]*l[2],l[3]-=_[3]*l[2],l=v[3],(c=b[3])[0]-=h[0]*l[2],c[1]-=h[1]*l[2],c[2]=-m*l[2],l[3]-=_[3]*l[2],_=v[3],h=b[3],m=1/_[3],h[3]=m,h[0]*=m,h[1]*=m,h[2]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[3],l=v[1],(c=b[1])[0]-=h[0]*l[3],c[1]-=h[1]*l[3],l=v[2],(c=b[2])[0]-=h[0]*l[3],c[1]-=h[1]*l[3],c[2]-=h[2]*l[3],h=b[1],b[0][1]=h[0],h=b[2],b[0][2]=h[0],b[1][2]=h[1],h=b[3],b[0][3]=h[0],b[1][3]=h[1],b[2][3]=h[2];break;case 5:_=v[0],h=b[0],m=1/_[0],h[0]=m,_[1]*=m,_[2]*=m,_[3]*=m,_[4]*=m,l=v[1],(c=b[1])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l[4]-=_[4]*l[0],l=v[2],(c=b[2])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l[4]-=_[4]*l[0],l=v[3],(c=b[3])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l[4]-=_[4]*l[0],l=v[4],(c=b[4])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l[4]-=_[4]*l[0],_=v[1],h=b[1],m=1/_[1],h[1]=m,h[0]*=m,_[2]*=m,_[3]*=m,_[4]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l[4]-=_[4]*l[1],l=v[2],(c=b[2])[0]-=h[0]*l[1],c[1]=-m*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l[4]-=_[4]*l[1],l=v[3],(c=b[3])[0]-=h[0]*l[1],c[1]=-m*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l[4]-=_[4]*l[1],l=v[4],(c=b[4])[0]-=h[0]*l[1],c[1]=-m*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l[4]-=_[4]*l[1],_=v[2],h=b[2],m=1/_[2],h[2]=m,h[0]*=m,h[1]*=m,_[3]*=m,_[4]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[2],l[3]-=_[3]*l[2],l[4]-=_[4]*l[2],l=v[1],(c=b[1])[0]-=h[0]*l[2],c[1]-=h[1]*l[2],l[3]-=_[3]*l[2],l[4]-=_[4]*l[2],l=v[3],(c=b[3])[0]-=h[0]*l[2],c[1]-=h[1]*l[2],c[2]=-m*l[2],l[3]-=_[3]*l[2],l[4]-=_[4]*l[2],l=v[4],(c=b[4])[0]-=h[0]*l[2],c[1]-=h[1]*l[2],c[2]=-m*l[2],l[3]-=_[3]*l[2],l[4]-=_[4]*l[2],_=v[3],h=b[3],m=1/_[3],h[3]=m,h[0]*=m,h[1]*=m,h[2]*=m,_[4]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[3],l[4]-=_[4]*l[3],l=v[1],(c=b[1])[0]-=h[0]*l[3],c[1]-=h[1]*l[3],l[4]-=_[4]*l[3],l=v[2],(c=b[2])[0]-=h[0]*l[3],c[1]-=h[1]*l[3],c[2]-=h[2]*l[3],l[4]-=_[4]*l[3],l=v[4],(c=b[4])[0]-=h[0]*l[3],c[1]-=h[1]*l[3],c[2]-=h[2]*l[3],c[3]=-m*l[3],l[4]-=_[4]*l[3],_=v[4],h=b[4],m=1/_[4],h[4]=m,h[0]*=m,h[1]*=m,h[2]*=m,h[3]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[4],l=v[1],(c=b[1])[0]-=h[0]*l[4],c[1]-=h[1]*l[4],l=v[2],(c=b[2])[0]-=h[0]*l[4],c[1]-=h[1]*l[4],c[2]-=h[2]*l[4],l=v[3],(c=b[3])[0]-=h[0]*l[4],c[1]-=h[1]*l[4],c[2]-=h[2]*l[4],c[3]-=h[3]*l[4],h=b[1],b[0][1]=h[0],h=b[2],b[0][2]=h[0],b[1][2]=h[1],h=b[3],b[0][3]=h[0],b[1][3]=h[1],b[2][3]=h[2],h=b[4],b[0][4]=h[0],b[1][4]=h[1],b[2][4]=h[2],b[3][4]=h[3];break;case 6:_=v[0],h=b[0],m=1/_[0],h[0]=m,_[1]*=m,_[2]*=m,_[3]*=m,_[4]*=m,_[5]*=m,l=v[1],(c=b[1])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l[4]-=_[4]*l[0],l[5]-=_[5]*l[0],l=v[2],(c=b[2])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l[4]-=_[4]*l[0],l[5]-=_[5]*l[0],l=v[3],(c=b[3])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l[4]-=_[4]*l[0],l[5]-=_[5]*l[0],l=v[4],(c=b[4])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l[4]-=_[4]*l[0],l[5]-=_[5]*l[0],l=v[5],(c=b[5])[0]=-m*l[0],l[1]-=_[1]*l[0],l[2]-=_[2]*l[0],l[3]-=_[3]*l[0],l[4]-=_[4]*l[0],l[5]-=_[5]*l[0],_=v[1],h=b[1],m=1/_[1],h[1]=m,h[0]*=m,_[2]*=m,_[3]*=m,_[4]*=m,_[5]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l[4]-=_[4]*l[1],l[5]-=_[5]*l[1],l=v[2],(c=b[2])[0]-=h[0]*l[1],c[1]=-m*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l[4]-=_[4]*l[1],l[5]-=_[5]*l[1],l=v[3],(c=b[3])[0]-=h[0]*l[1],c[1]=-m*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l[4]-=_[4]*l[1],l[5]-=_[5]*l[1],l=v[4],(c=b[4])[0]-=h[0]*l[1],c[1]=-m*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l[4]-=_[4]*l[1],l[5]-=_[5]*l[1],l=v[5],(c=b[5])[0]-=h[0]*l[1],c[1]=-m*l[1],l[2]-=_[2]*l[1],l[3]-=_[3]*l[1],l[4]-=_[4]*l[1],l[5]-=_[5]*l[1],_=v[2],h=b[2],m=1/_[2],h[2]=m,h[0]*=m,h[1]*=m,_[3]*=m,_[4]*=m,_[5]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[2],l[3]-=_[3]*l[2],l[4]-=_[4]*l[2],l[5]-=_[5]*l[2],l=v[1],(c=b[1])[0]-=h[0]*l[2],c[1]-=h[1]*l[2],l[3]-=_[3]*l[2],l[4]-=_[4]*l[2],l[5]-=_[5]*l[2],l=v[3],(c=b[3])[0]-=h[0]*l[2],c[1]-=h[1]*l[2],c[2]=-m*l[2],l[3]-=_[3]*l[2],l[4]-=_[4]*l[2],l[5]-=_[5]*l[2],l=v[4],(c=b[4])[0]-=h[0]*l[2],c[1]-=h[1]*l[2],c[2]=-m*l[2],l[3]-=_[3]*l[2],l[4]-=_[4]*l[2],l[5]-=_[5]*l[2],l=v[5],(c=b[5])[0]-=h[0]*l[2],c[1]-=h[1]*l[2],c[2]=-m*l[2],l[3]-=_[3]*l[2],l[4]-=_[4]*l[2],l[5]-=_[5]*l[2],_=v[3],h=b[3],m=1/_[3],h[3]=m,h[0]*=m,h[1]*=m,h[2]*=m,_[4]*=m,_[5]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[3],l[4]-=_[4]*l[3],l[5]-=_[5]*l[3],l=v[1],(c=b[1])[0]-=h[0]*l[3],c[1]-=h[1]*l[3],l[4]-=_[4]*l[3],l[5]-=_[5]*l[3],l=v[2],(c=b[2])[0]-=h[0]*l[3],c[1]-=h[1]*l[3],c[2]-=h[2]*l[3],l[4]-=_[4]*l[3],l[5]-=_[5]*l[3],l=v[4],(c=b[4])[0]-=h[0]*l[3],c[1]-=h[1]*l[3],c[2]-=h[2]*l[3],c[3]=-m*l[3],l[4]-=_[4]*l[3],l[5]-=_[5]*l[3],l=v[5],(c=b[5])[0]-=h[0]*l[3],c[1]-=h[1]*l[3],c[2]-=h[2]*l[3],c[3]=-m*l[3],l[4]-=_[4]*l[3],l[5]-=_[5]*l[3],_=v[4],h=b[4],m=1/_[4],h[4]=m,h[0]*=m,h[1]*=m,h[2]*=m,h[3]*=m,_[5]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[4],l[5]-=_[5]*l[4],l=v[1],(c=b[1])[0]-=h[0]*l[4],c[1]-=h[1]*l[4],l[5]-=_[5]*l[4],l=v[2],(c=b[2])[0]-=h[0]*l[4],c[1]-=h[1]*l[4],c[2]-=h[2]*l[4],l[5]-=_[5]*l[4],l=v[3],(c=b[3])[0]-=h[0]*l[4],c[1]-=h[1]*l[4],c[2]-=h[2]*l[4],c[3]-=h[3]*l[4],l[5]-=_[5]*l[4],l=v[5],(c=b[5])[0]-=h[0]*l[4],c[1]-=h[1]*l[4],c[2]-=h[2]*l[4],c[3]-=h[3]*l[4],c[4]=-m*l[4],l[5]-=_[5]*l[4],_=v[5],h=b[5],m=1/_[5],h[5]=m,h[0]*=m,h[1]*=m,h[2]*=m,h[3]*=m,h[4]*=m,l=v[0],(c=b[0])[0]-=h[0]*l[5],l=v[1],(c=b[1])[0]-=h[0]*l[5],c[1]-=h[1]*l[5],l=v[2],(c=b[2])[0]-=h[0]*l[5],c[1]-=h[1]*l[5],c[2]-=h[2]*l[5],l=v[3],(c=b[3])[0]-=h[0]*l[5],c[1]-=h[1]*l[5],c[2]-=h[2]*l[5],c[3]-=h[3]*l[5],l=v[4],(c=b[4])[0]-=h[0]*l[5],c[1]-=h[1]*l[5],c[2]-=h[2]*l[5],c[3]-=h[3]*l[5],c[4]-=h[4]*l[5],h=b[1],b[0][1]=h[0],h=b[2],b[0][2]=h[0],b[1][2]=h[1],h=b[3],b[0][3]=h[0],b[1][3]=h[1],b[2][3]=h[2],h=b[4],b[0][4]=h[0],b[1][4]=h[1],b[2][4]=h[2],b[3][4]=h[3],h=b[5],b[0][5]=h[0],b[1][5]=h[1],b[2][5]=h[2],b[3][5]=h[3],b[4][5]=h[4];break;default:for(var f=0;f<a;){var u=f++;_=v[u],h=b[u];var p=1/_[u];h[u]=p;for(var x=0;x<u;)h[x++]*=p;for(var y=u+1;y<a;)_[y++]*=p;for(var d=0;d<u;){var g=d++;l=v[g],c=b[g];for(var X=0,Y=g+1;X<Y;){var z=X++;c[z]-=h[z]*l[u]}for(var Z=u+1;Z<a;){var M=Z++;l[M]-=_[M]*l[u]}}for(var I=u+1;I<a;){var V=I++;l=v[V],c=b[V];for(var w=0;w<u;){var L=w++;c[L]-=h[L]*l[u]}c[u]=-p*l[u];for(var k=u+1;k<a;){var A=k++;l[A]-=_[A]*l[u]}}}for(var B=1;B<a;){var P=B++;h=b[P];for(var S=0;S<P;){var T=S++;b[T][P]=h[T]}}}},i.computeInvMass=function(t,i){var a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d=this._invMass,g=this._invMassWithoutCfm,X=t.numRows,Y=t.b1,z=t.b2,Z=Y._invMass,M=z._invMass;a=Y._invInertia00,n=Y._invInertia01,o=Y._invInertia02,s=Y._invInertia10,r=Y._invInertia11,e=Y._invInertia12,_=Y._invInertia20,h=Y._invInertia21,l=Y._invInertia22,c=z._invInertia00,m=z._invInertia01,v=z._invInertia02,b=z._invInertia10,f=z._invInertia11,u=z._invInertia12,p=z._invInertia20,x=z._invInertia21,y=z._invInertia22;for(var I=0;I<X;){var V=I++,w=t.rows[V].jacobian,L=i[V];if(w.updateSparsity(),0!=(1&w.flag)?(L.invMLin1X=w.lin1X*Z,L.invMLin1Y=w.lin1Y*Z,L.invMLin1Z=w.lin1Z*Z,L.invMLin2X=w.lin2X*M,L.invMLin2Y=w.lin2Y*M,L.invMLin2Z=w.lin2Z*M):(L.invMLin1X=0,L.invMLin1Y=0,L.invMLin1Z=0,L.invMLin2X=0,L.invMLin2Y=0,L.invMLin2Z=0),0!=(2&w.flag)){var k,A,B;k=a*w.ang1X+n*w.ang1Y+o*w.ang1Z,A=s*w.ang1X+r*w.ang1Y+e*w.ang1Z,B=_*w.ang1X+h*w.ang1Y+l*w.ang1Z,L.invMAng1X=k,L.invMAng1Y=A,L.invMAng1Z=B;var P,S,T;P=c*w.ang2X+m*w.ang2Y+v*w.ang2Z,S=b*w.ang2X+f*w.ang2Y+u*w.ang2Z,T=p*w.ang2X+x*w.ang2Y+y*w.ang2Z,L.invMAng2X=P,L.invMAng2Y=S,L.invMAng2Z=T}else L.invMAng1X=0,L.invMAng1Y=0,L.invMAng1Z=0,L.invMAng2X=0,L.invMAng2Y=0,L.invMAng2Z=0}for(var C=0;C<X;)for(var j=C++,R=t.rows[j].jacobian,E=j;E<X;){var q=E++,D=i[q],N=R.lin1X*D.invMLin1X+R.lin1Y*D.invMLin1Y+R.lin1Z*D.invMLin1Z+(R.ang1X*D.invMAng1X+R.ang1Y*D.invMAng1Y+R.ang1Z*D.invMAng1Z)+(R.lin2X*D.invMLin2X+R.lin2Y*D.invMLin2Y+R.lin2Z*D.invMLin2Z)+(R.ang2X*D.invMAng2X+R.ang2Y*D.invMAng2Y+R.ang2Z*D.invMAng2Z);j==q?(d[j][q]=N+t.rows[j].cfm,g[j][q]=N,D.mass=N+t.rows[j].cfm,D.massWithoutCfm=N,0!=D.mass&&(D.mass=1/D.mass),0!=D.massWithoutCfm&&(D.massWithoutCfm=1/D.massWithoutCfm)):(d[j][q]=N,d[q][j]=N,g[j][q]=N,g[q][j]=N)}for(var F=0,G=this._maxSubmatrixId;F<G;)this._cacheComputed[F++]=!1},t}(),r.dynamics.constraint.solver.pgs||(r.dynamics.constraint.solver.pgs={}),r.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=function(t){function i(i){var a;(a=t.call(this)||this).constraint=i,a.info=new r.dynamics.constraint.info.contact.ContactSolverInfo,a.massData=new Array(r.common.Setting.maxManifoldPoints);for(var n=0,o=a.massData.length;n<o;)a.massData[n++]=new r.dynamics.constraint.solver.common.ContactSolverMassDataRow;return a}a(i,t);var n=i.prototype;return n.preSolveVelocity=function(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,u=this._b2._invInertia20,p=this._b2._invInertia21,x=this._b2._invInertia22;for(var g=0,X=this.info.numRows;g<X;){var Y=g++,z=this.info.rows[Y],Z=this.massData[Y],M=z.jacobianN;Z.invMLinN1X=M.lin1X*y,Z.invMLinN1Y=M.lin1Y*y,Z.invMLinN1Z=M.lin1Z*y,Z.invMLinN2X=M.lin2X*d,Z.invMLinN2Y=M.lin2Y*d,Z.invMLinN2Z=M.lin2Z*d;var I,V,w;I=i*M.ang1X+a*M.ang1Y+n*M.ang1Z,V=o*M.ang1X+s*M.ang1Y+r*M.ang1Z,w=e*M.ang1X+_*M.ang1Y+h*M.ang1Z,Z.invMAngN1X=I,Z.invMAngN1Y=V,Z.invMAngN1Z=w;var L,k,A;L=l*M.ang2X+c*M.ang2Y+m*M.ang2Z,k=v*M.ang2X+b*M.ang2Y+f*M.ang2Z,A=u*M.ang2X+p*M.ang2Y+x*M.ang2Z,Z.invMAngN2X=L,Z.invMAngN2Y=k,Z.invMAngN2Z=A,Z.massN=y+d+(Z.invMAngN1X*M.ang1X+Z.invMAngN1Y*M.ang1Y+Z.invMAngN1Z*M.ang1Z)+(Z.invMAngN2X*M.ang2X+Z.invMAngN2Y*M.ang2Y+Z.invMAngN2Z*M.ang2Z),0!=Z.massN&&(Z.massN=1/Z.massN);var B=z.jacobianT,P=z.jacobianB;Z.invMLinT1X=B.lin1X*y,Z.invMLinT1Y=B.lin1Y*y,Z.invMLinT1Z=B.lin1Z*y,Z.invMLinT2X=B.lin2X*d,Z.invMLinT2Y=B.lin2Y*d,Z.invMLinT2Z=B.lin2Z*d,Z.invMLinB1X=P.lin1X*y,Z.invMLinB1Y=P.lin1Y*y,Z.invMLinB1Z=P.lin1Z*y,Z.invMLinB2X=P.lin2X*d,Z.invMLinB2Y=P.lin2Y*d,Z.invMLinB2Z=P.lin2Z*d;var S,T,C;S=i*B.ang1X+a*B.ang1Y+n*B.ang1Z,T=o*B.ang1X+s*B.ang1Y+r*B.ang1Z,C=e*B.ang1X+_*B.ang1Y+h*B.ang1Z,Z.invMAngT1X=S,Z.invMAngT1Y=T,Z.invMAngT1Z=C;var j,R,E;j=l*B.ang2X+c*B.ang2Y+m*B.ang2Z,R=v*B.ang2X+b*B.ang2Y+f*B.ang2Z,E=u*B.ang2X+p*B.ang2Y+x*B.ang2Z,Z.invMAngT2X=j,Z.invMAngT2Y=R,Z.invMAngT2Z=E;var q,D,N;q=i*P.ang1X+a*P.ang1Y+n*P.ang1Z,D=o*P.ang1X+s*P.ang1Y+r*P.ang1Z,N=e*P.ang1X+_*P.ang1Y+h*P.ang1Z,Z.invMAngB1X=q,Z.invMAngB1Y=D,Z.invMAngB1Z=N;var F,G,J;F=l*P.ang2X+c*P.ang2Y+m*P.ang2Z,G=v*P.ang2X+b*P.ang2Y+f*P.ang2Z,J=u*P.ang2X+p*P.ang2Y+x*P.ang2Z,Z.invMAngB2X=F,Z.invMAngB2Y=G,Z.invMAngB2Z=J;var W=y+d+(Z.invMAngT1X*B.ang1X+Z.invMAngT1Y*B.ang1Y+Z.invMAngT1Z*B.ang1Z)+(Z.invMAngT2X*B.ang2X+Z.invMAngT2Y*B.ang2Y+Z.invMAngT2Z*B.ang2Z),O=Z.invMAngT1X*P.ang1X+Z.invMAngT1Y*P.ang1Y+Z.invMAngT1Z*P.ang1Z+(Z.invMAngT2X*P.ang2X+Z.invMAngT2Y*P.ang2Y+Z.invMAngT2Z*P.ang2Z),U=y+d+(Z.invMAngB1X*P.ang1X+Z.invMAngB1Y*P.ang1Y+Z.invMAngB1Z*P.ang1Z)+(Z.invMAngB2X*P.ang2X+Z.invMAngB2Y*P.ang2Y+Z.invMAngB2Z*P.ang2Z),H=W*U-O*O;0!=H&&(H=1/H),Z.massTB00=U*H,Z.massTB01=-O*H,Z.massTB10=-O*H,Z.massTB11=W*H}},n.warmStart=function(t){var i,a,n,o,s,r,e,_,h,l,c,m;i=this._b1._velX,a=this._b1._velY,n=this._b1._velZ,o=this._b2._velX,s=this._b2._velY,r=this._b2._velZ,e=this._b1._angVelX,_=this._b1._angVelY,h=this._b1._angVelZ,l=this._b2._angVelX,c=this._b2._angVelY,m=this._b2._angVelZ;for(var v=0,b=this.info.numRows;v<b;){var f=v++,u=this.info.rows[f],p=u.impulse,x=this.massData[f],y=u.jacobianT,d=u.jacobianB,g=p.impulseN,X=p.impulseLX*y.lin1X+p.impulseLY*y.lin1Y+p.impulseLZ*y.lin1Z,Y=p.impulseLX*d.lin1X+p.impulseLY*d.lin1Y+p.impulseLZ*d.lin1Z;p.impulseT=X,p.impulseB=Y,p.impulseN*=t.dtRatio,p.impulseT*=t.dtRatio,p.impulseB*=t.dtRatio,i+=x.invMLinN1X*g,a+=x.invMLinN1Y*g,n+=x.invMLinN1Z*g,i+=x.invMLinT1X*X,a+=x.invMLinT1Y*X,n+=x.invMLinT1Z*X,i+=x.invMLinB1X*Y,a+=x.invMLinB1Y*Y,n+=x.invMLinB1Z*Y,o+=x.invMLinN2X*-g,s+=x.invMLinN2Y*-g,r+=x.invMLinN2Z*-g,o+=x.invMLinT2X*-X,s+=x.invMLinT2Y*-X,r+=x.invMLinT2Z*-X,o+=x.invMLinB2X*-Y,s+=x.invMLinB2Y*-Y,r+=x.invMLinB2Z*-Y,e+=x.invMAngN1X*g,_+=x.invMAngN1Y*g,h+=x.invMAngN1Z*g,e+=x.invMAngT1X*X,_+=x.invMAngT1Y*X,h+=x.invMAngT1Z*X,e+=x.invMAngB1X*Y,_+=x.invMAngB1Y*Y,h+=x.invMAngB1Z*Y,l+=x.invMAngN2X*-g,c+=x.invMAngN2Y*-g,m+=x.invMAngN2Z*-g,l+=x.invMAngT2X*-X,c+=x.invMAngT2Y*-X,m+=x.invMAngT2Z*-X,l+=x.invMAngB2X*-Y,c+=x.invMAngB2Y*-Y,m+=x.invMAngB2Z*-Y}this._b1._velX=i,this._b1._velY=a,this._b1._velZ=n,this._b2._velX=o,this._b2._velY=s,this._b2._velZ=r,this._b1._angVelX=e,this._b1._angVelY=_,this._b1._angVelZ=h,this._b2._angVelX=l,this._b2._angVelY=c,this._b2._angVelZ=m},n.solveVelocity=function(){var t,i,a,n,o,s,r,e,_,h,l,c;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,n=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var m=0,v=this.info.numRows;m<v;){var b=m++,f=this.info.rows[b],u=this.massData[b],p=f.impulse,x=0,y=f.jacobianT;x+=t*y.lin1X+i*y.lin1Y+a*y.lin1Z,x-=n*y.lin2X+o*y.lin2Y+s*y.lin2Z,x+=r*y.ang1X+e*y.ang1Y+_*y.ang1Z,x-=h*y.ang2X+l*y.ang2Y+c*y.ang2Z;var d=0;d+=t*(y=f.jacobianB).lin1X+i*y.lin1Y+a*y.lin1Z,d-=n*y.lin2X+o*y.lin2Y+s*y.lin2Z,d+=r*y.ang1X+e*y.ang1Y+_*y.ang1Z,d-=h*y.ang2X+l*y.ang2Y+c*y.ang2Z;var g=-(x*u.massTB00+d*u.massTB01),X=-(x*u.massTB10+d*u.massTB11),Y=p.impulseT,z=p.impulseB;p.impulseT+=g,p.impulseB+=X;var Z=f.friction*p.impulseN;if(0==Z)p.impulseT=0,p.impulseB=0;else{var M=p.impulseT*p.impulseT+p.impulseB*p.impulseB;if(M>Z*Z){var I=Z/Math.sqrt(M);p.impulseT*=I,p.impulseB*=I}}g=p.impulseT-Y,X=p.impulseB-z,t+=u.invMLinT1X*g,i+=u.invMLinT1Y*g,a+=u.invMLinT1Z*g,t+=u.invMLinB1X*X,i+=u.invMLinB1Y*X,a+=u.invMLinB1Z*X,n+=u.invMLinT2X*-g,o+=u.invMLinT2Y*-g,s+=u.invMLinT2Z*-g,n+=u.invMLinB2X*-X,o+=u.invMLinB2Y*-X,s+=u.invMLinB2Z*-X,r+=u.invMAngT1X*g,e+=u.invMAngT1Y*g,_+=u.invMAngT1Z*g,r+=u.invMAngB1X*X,e+=u.invMAngB1Y*X,_+=u.invMAngB1Z*X,h+=u.invMAngT2X*-g,l+=u.invMAngT2Y*-g,c+=u.invMAngT2Z*-g,h+=u.invMAngB2X*-X,l+=u.invMAngB2Y*-X,c+=u.invMAngB2Z*-X}for(var V=0,w=this.info.numRows;V<w;){var L=V++,k=this.info.rows[L],A=this.massData[L],B=k.impulse,P=0,S=k.jacobianN;P+=t*S.lin1X+i*S.lin1Y+a*S.lin1Z,P-=n*S.lin2X+o*S.lin2Y+s*S.lin2Z,P+=r*S.ang1X+e*S.ang1Y+_*S.ang1Z,P-=h*S.ang2X+l*S.ang2Y+c*S.ang2Z;var T=(k.rhs-P)*A.massN,C=B.impulseN;B.impulseN+=T,B.impulseN<0&&(B.impulseN=0),T=B.impulseN-C,t+=A.invMLinN1X*T,i+=A.invMLinN1Y*T,a+=A.invMLinN1Z*T,n+=A.invMLinN2X*-T,o+=A.invMLinN2Y*-T,s+=A.invMLinN2Z*-T,r+=A.invMAngN1X*T,e+=A.invMAngN1Y*T,_+=A.invMAngN1Z*T,h+=A.invMAngN2X*-T,l+=A.invMAngN2Y*-T,c+=A.invMAngN2Z*-T}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=n,this._b2._velY=o,this._b2._velZ=s,this._b1._angVelX=r,this._b1._angVelY=e,this._b1._angVelZ=_,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c},n.preSolvePosition=function(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,u=this._b2._invInertia20,p=this._b2._invInertia21,x=this._b2._invInertia22;for(var g=0,X=this.info.numRows;g<X;){var Y=g++,z=this.massData[Y],Z=this.info.rows[Y].jacobianN;z.invMLinN1X=Z.lin1X*y,z.invMLinN1Y=Z.lin1Y*y,z.invMLinN1Z=Z.lin1Z*y,z.invMLinN2X=Z.lin2X*d,z.invMLinN2Y=Z.lin2Y*d,z.invMLinN2Z=Z.lin2Z*d;var M,I,V;M=i*Z.ang1X+a*Z.ang1Y+n*Z.ang1Z,I=o*Z.ang1X+s*Z.ang1Y+r*Z.ang1Z,V=e*Z.ang1X+_*Z.ang1Y+h*Z.ang1Z,z.invMAngN1X=M,z.invMAngN1Y=I,z.invMAngN1Z=V;var w,L,k;w=l*Z.ang2X+c*Z.ang2Y+m*Z.ang2Z,L=v*Z.ang2X+b*Z.ang2Y+f*Z.ang2Z,k=u*Z.ang2X+p*Z.ang2Y+x*Z.ang2Z,z.invMAngN2X=w,z.invMAngN2Y=L,z.invMAngN2Z=k,z.massN=y+d+(z.invMAngN1X*Z.ang1X+z.invMAngN1Y*Z.ang1Y+z.invMAngN1Z*Z.ang1Z)+(z.invMAngN2X*Z.ang2X+z.invMAngN2Y*Z.ang2Y+z.invMAngN2Z*Z.ang2Z),0!=z.massN&&(z.massN=1/z.massN)}for(var A=0,B=this.info.numRows;A<B;)this.info.rows[A++].impulse.impulseP=0},n.solvePositionSplitImpulse=function(){var t,i,a,n,o,s,e,_,h,l,c,m;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,e=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,h=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;for(var v=0,b=this.info.numRows;v<b;){var f=v++,u=this.info.rows[f],p=this.massData[f],x=u.impulse,y=u.jacobianN,d=0;d+=t*y.lin1X+i*y.lin1Y+a*y.lin1Z,d-=n*y.lin2X+o*y.lin2Y+s*y.lin2Z,d+=e*y.ang1X+_*y.ang1Y+h*y.ang1Z,d-=l*y.ang2X+c*y.ang2Y+m*y.ang2Z;var g=(u.rhs-d)*p.massN*r.common.Setting.positionSplitImpulseBaumgarte,X=x.impulseP;x.impulseP+=g,x.impulseP<0&&(x.impulseP=0),g=x.impulseP-X,t+=p.invMLinN1X*g,i+=p.invMLinN1Y*g,a+=p.invMLinN1Z*g,n+=p.invMLinN2X*-g,o+=p.invMLinN2Y*-g,s+=p.invMLinN2Z*-g,e+=p.invMAngN1X*g,_+=p.invMAngN1Y*g,h+=p.invMAngN1Z*g,l+=p.invMAngN2X*-g,c+=p.invMAngN2Y*-g,m+=p.invMAngN2Z*-g}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=n,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=e,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=h,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=c,this._b2._angPseudoVelZ=m},n.solvePositionNgs=function(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var i,a,n,o,s,e,_,h,l,c,m,v,b,f,u,p,x,y,d=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,e=this._b1._invInertia12,_=this._b1._invInertia20,h=this._b1._invInertia21,l=this._b1._invInertia22,c=this._b2._invInertia00,m=this._b2._invInertia01,v=this._b2._invInertia02,b=this._b2._invInertia10,f=this._b2._invInertia11,u=this._b2._invInertia12,p=this._b2._invInertia20,x=this._b2._invInertia21,y=this._b2._invInertia22;for(var X,Y,z,Z,M,I,V,w,L,k,A,B,P=0,S=this.info.numRows;P<S;){var T=P++,C=this.massData[T],j=this.info.rows[T].jacobianN;C.invMLinN1X=j.lin1X*d,C.invMLinN1Y=j.lin1Y*d,C.invMLinN1Z=j.lin1Z*d,C.invMLinN2X=j.lin2X*g,C.invMLinN2Y=j.lin2Y*g,C.invMLinN2Z=j.lin2Z*g;var R,E,q;R=i*j.ang1X+a*j.ang1Y+n*j.ang1Z,E=o*j.ang1X+s*j.ang1Y+e*j.ang1Z,q=_*j.ang1X+h*j.ang1Y+l*j.ang1Z,C.invMAngN1X=R,C.invMAngN1Y=E,C.invMAngN1Z=q;var D,N,F;D=c*j.ang2X+m*j.ang2Y+v*j.ang2Z,N=b*j.ang2X+f*j.ang2Y+u*j.ang2Z,F=p*j.ang2X+x*j.ang2Y+y*j.ang2Z,C.invMAngN2X=D,C.invMAngN2Y=N,C.invMAngN2Z=F,C.massN=d+g+(C.invMAngN1X*j.ang1X+C.invMAngN1Y*j.ang1Y+C.invMAngN1Z*j.ang1Z)+(C.invMAngN2X*j.ang2X+C.invMAngN2Y*j.ang2Y+C.invMAngN2Z*j.ang2Z),0!=C.massN&&(C.massN=1/C.massN)}X=0,Y=0,z=0,Z=0,M=0,I=0,V=0,w=0,L=0,k=0,A=0,B=0;for(var G=0,J=this.info.numRows;G<J;){var W=G++,O=this.info.rows[W],U=this.massData[W],H=O.impulse,Q=O.jacobianN,K=0;K+=X*Q.lin1X+Y*Q.lin1Y+z*Q.lin1Z,K-=Z*Q.lin2X+M*Q.lin2Y+I*Q.lin2Z,K+=V*Q.ang1X+w*Q.ang1Y+L*Q.ang1Z,K-=k*Q.ang2X+A*Q.ang2Y+B*Q.ang2Z;var $=(O.rhs-K)*U.massN*r.common.Setting.positionNgsBaumgarte,tt=H.impulseP;H.impulseP+=$,H.impulseP<0&&(H.impulseP=0),$=H.impulseP-tt,X+=U.invMLinN1X*$,Y+=U.invMLinN1Y*$,z+=U.invMLinN1Z*$,Z+=U.invMLinN2X*-$,M+=U.invMLinN2Y*-$,I+=U.invMLinN2Z*-$,V+=U.invMAngN1X*$,w+=U.invMAngN1Y*$,L+=U.invMAngN1Z*$,k+=U.invMAngN2X*-$,A+=U.invMAngN2Y*-$,B+=U.invMAngN2Z*-$}var it=this._b1;it._transform._positionX+=X,it._transform._positionY+=Y,it._transform._positionZ+=z;var at=this._b2;at._transform._positionX+=Z,at._transform._positionY+=M,at._transform._positionZ+=I;var nt,ot,st,rt,et,_t,ht,lt,ct,mt,vt=this._b1,bt=Math.sqrt(V*V+w*w+L*L),ft=.5*bt;if(ft<.5){var ut=ft*ft;nt=.5*(1-.16666666666666666*ut+ut*ut*.008333333333333333),ot=1-.5*ut+ut*ut*.041666666666666664}else nt=Math.sin(ft)/bt,ot=Math.cos(ft);st=V*nt,rt=w*nt,et=L*nt,_t=ot;var pt,xt=vt._transform._rotation00,yt=vt._transform._rotation11,dt=vt._transform._rotation22,gt=xt+yt+dt;gt>0?(mt=.5*(pt=Math.sqrt(gt+1)),pt=.5/pt,ht=(vt._transform._rotation21-vt._transform._rotation12)*pt,lt=(vt._transform._rotation02-vt._transform._rotation20)*pt,ct=(vt._transform._rotation10-vt._transform._rotation01)*pt):xt>yt?xt>dt?(ht=.5*(pt=Math.sqrt(xt-yt-dt+1)),pt=.5/pt,lt=(vt._transform._rotation01+vt._transform._rotation10)*pt,ct=(vt._transform._rotation02+vt._transform._rotation20)*pt,mt=(vt._transform._rotation21-vt._transform._rotation12)*pt):(ct=.5*(pt=Math.sqrt(dt-xt-yt+1)),pt=.5/pt,ht=(vt._transform._rotation02+vt._transform._rotation20)*pt,lt=(vt._transform._rotation12+vt._transform._rotation21)*pt,mt=(vt._transform._rotation10-vt._transform._rotation01)*pt):yt>dt?(lt=.5*(pt=Math.sqrt(yt-dt-xt+1)),pt=.5/pt,ht=(vt._transform._rotation01+vt._transform._rotation10)*pt,ct=(vt._transform._rotation12+vt._transform._rotation21)*pt,mt=(vt._transform._rotation02-vt._transform._rotation20)*pt):(ct=.5*(pt=Math.sqrt(dt-xt-yt+1)),pt=.5/pt,ht=(vt._transform._rotation02+vt._transform._rotation20)*pt,lt=(vt._transform._rotation12+vt._transform._rotation21)*pt,mt=(vt._transform._rotation10-vt._transform._rotation01)*pt);var Xt=(ht=_t*ht+st*mt+rt*ct-et*lt)*ht+(lt=_t*lt-st*ct+rt*mt+et*ht)*lt+(ct=_t*ct+st*lt-rt*ht+et*mt)*ct+(mt=_t*mt-st*ht-rt*lt-et*ct)*mt;Xt>1e-32&&(Xt=1/Math.sqrt(Xt));ht*=Xt,lt*=Xt,ct*=Xt,mt*=Xt;var Yt,zt,Zt,Mt,It,Vt,wt,Lt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt,Et,qt=2*ht,Dt=2*lt,Nt=2*ct,Ft=ht*qt,Gt=lt*Dt,Jt=ct*Nt,Wt=ht*Dt,Ot=lt*Nt,Ut=ht*Nt,Ht=mt*qt,Qt=mt*Dt,Kt=mt*Nt;vt._transform._rotation00=1-Gt-Jt,vt._transform._rotation01=Wt-Kt,vt._transform._rotation02=Ut+Qt,vt._transform._rotation10=Wt+Kt,vt._transform._rotation11=1-Ft-Jt,vt._transform._rotation12=Ot-Ht,vt._transform._rotation20=Ut-Qt,vt._transform._rotation21=Ot+Ht,vt._transform._rotation22=1-Ft-Gt,Yt=vt._transform._rotation00*vt._invLocalInertia00+vt._transform._rotation01*vt._invLocalInertia10+vt._transform._rotation02*vt._invLocalInertia20,zt=vt._transform._rotation00*vt._invLocalInertia01+vt._transform._rotation01*vt._invLocalInertia11+vt._transform._rotation02*vt._invLocalInertia21,Zt=vt._transform._rotation00*vt._invLocalInertia02+vt._transform._rotation01*vt._invLocalInertia12+vt._transform._rotation02*vt._invLocalInertia22,Mt=vt._transform._rotation10*vt._invLocalInertia00+vt._transform._rotation11*vt._invLocalInertia10+vt._transform._rotation12*vt._invLocalInertia20,It=vt._transform._rotation10*vt._invLocalInertia01+vt._transform._rotation11*vt._invLocalInertia11+vt._transform._rotation12*vt._invLocalInertia21,Vt=vt._transform._rotation10*vt._invLocalInertia02+vt._transform._rotation11*vt._invLocalInertia12+vt._transform._rotation12*vt._invLocalInertia22,wt=vt._transform._rotation20*vt._invLocalInertia00+vt._transform._rotation21*vt._invLocalInertia10+vt._transform._rotation22*vt._invLocalInertia20,Lt=vt._transform._rotation20*vt._invLocalInertia01+vt._transform._rotation21*vt._invLocalInertia11+vt._transform._rotation22*vt._invLocalInertia21,kt=vt._transform._rotation20*vt._invLocalInertia02+vt._transform._rotation21*vt._invLocalInertia12+vt._transform._rotation22*vt._invLocalInertia22,vt._invInertia00=Yt,vt._invInertia01=zt,vt._invInertia02=Zt,vt._invInertia10=Mt,vt._invInertia11=It,vt._invInertia12=Vt,vt._invInertia20=wt,vt._invInertia21=Lt,vt._invInertia22=kt,At=vt._invInertia00*vt._transform._rotation00+vt._invInertia01*vt._transform._rotation01+vt._invInertia02*vt._transform._rotation02,Bt=vt._invInertia00*vt._transform._rotation10+vt._invInertia01*vt._transform._rotation11+vt._invInertia02*vt._transform._rotation12,Pt=vt._invInertia00*vt._transform._rotation20+vt._invInertia01*vt._transform._rotation21+vt._invInertia02*vt._transform._rotation22,St=vt._invInertia10*vt._transform._rotation00+vt._invInertia11*vt._transform._rotation01+vt._invInertia12*vt._transform._rotation02,Tt=vt._invInertia10*vt._transform._rotation10+vt._invInertia11*vt._transform._rotation11+vt._invInertia12*vt._transform._rotation12,Ct=vt._invInertia10*vt._transform._rotation20+vt._invInertia11*vt._transform._rotation21+vt._invInertia12*vt._transform._rotation22,jt=vt._invInertia20*vt._transform._rotation00+vt._invInertia21*vt._transform._rotation01+vt._invInertia22*vt._transform._rotation02,Rt=vt._invInertia20*vt._transform._rotation10+vt._invInertia21*vt._transform._rotation11+vt._invInertia22*vt._transform._rotation12,Et=vt._invInertia20*vt._transform._rotation20+vt._invInertia21*vt._transform._rotation21+vt._invInertia22*vt._transform._rotation22,vt._invInertia00=At,vt._invInertia01=Bt,vt._invInertia02=Pt,vt._invInertia10=St,vt._invInertia11=Tt,vt._invInertia12=Ct,vt._invInertia20=jt,vt._invInertia21=Rt,vt._invInertia22=Et,vt._invInertia00*=vt._rotFactor.x,vt._invInertia01*=vt._rotFactor.x,vt._invInertia02*=vt._rotFactor.x,vt._invInertia10*=vt._rotFactor.y,vt._invInertia11*=vt._rotFactor.y,vt._invInertia12*=vt._rotFactor.y,vt._invInertia20*=vt._rotFactor.z,vt._invInertia21*=vt._rotFactor.z,vt._invInertia22*=vt._rotFactor.z;var $t,ti,ii,ai,ni,oi,si,ri,ei,_i,hi=this._b2,li=Math.sqrt(k*k+A*A+B*B),ci=.5*li;if(ci<.5){var mi=ci*ci;$t=.5*(1-.16666666666666666*mi+mi*mi*.008333333333333333),ti=1-.5*mi+mi*mi*.041666666666666664}else $t=Math.sin(ci)/li,ti=Math.cos(ci);ii=k*$t,ai=A*$t,ni=B*$t,oi=ti;var vi,bi=hi._transform._rotation00,fi=hi._transform._rotation11,ui=hi._transform._rotation22,pi=bi+fi+ui;pi>0?(_i=.5*(vi=Math.sqrt(pi+1)),vi=.5/vi,si=(hi._transform._rotation21-hi._transform._rotation12)*vi,ri=(hi._transform._rotation02-hi._transform._rotation20)*vi,ei=(hi._transform._rotation10-hi._transform._rotation01)*vi):bi>fi?bi>ui?(si=.5*(vi=Math.sqrt(bi-fi-ui+1)),vi=.5/vi,ri=(hi._transform._rotation01+hi._transform._rotation10)*vi,ei=(hi._transform._rotation02+hi._transform._rotation20)*vi,_i=(hi._transform._rotation21-hi._transform._rotation12)*vi):(ei=.5*(vi=Math.sqrt(ui-bi-fi+1)),vi=.5/vi,si=(hi._transform._rotation02+hi._transform._rotation20)*vi,ri=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation10-hi._transform._rotation01)*vi):fi>ui?(ri=.5*(vi=Math.sqrt(fi-ui-bi+1)),vi=.5/vi,si=(hi._transform._rotation01+hi._transform._rotation10)*vi,ei=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation02-hi._transform._rotation20)*vi):(ei=.5*(vi=Math.sqrt(ui-bi-fi+1)),vi=.5/vi,si=(hi._transform._rotation02+hi._transform._rotation20)*vi,ri=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation10-hi._transform._rotation01)*vi);var xi=(si=oi*si+ii*_i+ai*ei-ni*ri)*si+(ri=oi*ri-ii*ei+ai*_i+ni*si)*ri+(ei=oi*ei+ii*ri-ai*si+ni*_i)*ei+(_i=oi*_i-ii*si-ai*ri-ni*ei)*_i;xi>1e-32&&(xi=1/Math.sqrt(xi));si*=xi,ri*=xi,ei*=xi,_i*=xi;var yi,di,gi,Xi,Yi,zi,Zi,Mi,Ii,Vi,wi,Li,ki,Ai,Bi,Pi,Si,Ti,Ci=2*si,ji=2*ri,Ri=2*ei,Ei=si*Ci,qi=ri*ji,Di=ei*Ri,Ni=si*ji,Fi=ri*Ri,Gi=si*Ri,Ji=_i*Ci,Wi=_i*ji,Oi=_i*Ri;hi._transform._rotation00=1-qi-Di,hi._transform._rotation01=Ni-Oi,hi._transform._rotation02=Gi+Wi,hi._transform._rotation10=Ni+Oi,hi._transform._rotation11=1-Ei-Di,hi._transform._rotation12=Fi-Ji,hi._transform._rotation20=Gi-Wi,hi._transform._rotation21=Fi+Ji,hi._transform._rotation22=1-Ei-qi,yi=hi._transform._rotation00*hi._invLocalInertia00+hi._transform._rotation01*hi._invLocalInertia10+hi._transform._rotation02*hi._invLocalInertia20,di=hi._transform._rotation00*hi._invLocalInertia01+hi._transform._rotation01*hi._invLocalInertia11+hi._transform._rotation02*hi._invLocalInertia21,gi=hi._transform._rotation00*hi._invLocalInertia02+hi._transform._rotation01*hi._invLocalInertia12+hi._transform._rotation02*hi._invLocalInertia22,Xi=hi._transform._rotation10*hi._invLocalInertia00+hi._transform._rotation11*hi._invLocalInertia10+hi._transform._rotation12*hi._invLocalInertia20,Yi=hi._transform._rotation10*hi._invLocalInertia01+hi._transform._rotation11*hi._invLocalInertia11+hi._transform._rotation12*hi._invLocalInertia21,zi=hi._transform._rotation10*hi._invLocalInertia02+hi._transform._rotation11*hi._invLocalInertia12+hi._transform._rotation12*hi._invLocalInertia22,Zi=hi._transform._rotation20*hi._invLocalInertia00+hi._transform._rotation21*hi._invLocalInertia10+hi._transform._rotation22*hi._invLocalInertia20,Mi=hi._transform._rotation20*hi._invLocalInertia01+hi._transform._rotation21*hi._invLocalInertia11+hi._transform._rotation22*hi._invLocalInertia21,Ii=hi._transform._rotation20*hi._invLocalInertia02+hi._transform._rotation21*hi._invLocalInertia12+hi._transform._rotation22*hi._invLocalInertia22,hi._invInertia00=yi,hi._invInertia01=di,hi._invInertia02=gi,hi._invInertia10=Xi,hi._invInertia11=Yi,hi._invInertia12=zi,hi._invInertia20=Zi,hi._invInertia21=Mi,hi._invInertia22=Ii,Vi=hi._invInertia00*hi._transform._rotation00+hi._invInertia01*hi._transform._rotation01+hi._invInertia02*hi._transform._rotation02,wi=hi._invInertia00*hi._transform._rotation10+hi._invInertia01*hi._transform._rotation11+hi._invInertia02*hi._transform._rotation12,Li=hi._invInertia00*hi._transform._rotation20+hi._invInertia01*hi._transform._rotation21+hi._invInertia02*hi._transform._rotation22,ki=hi._invInertia10*hi._transform._rotation00+hi._invInertia11*hi._transform._rotation01+hi._invInertia12*hi._transform._rotation02,Ai=hi._invInertia10*hi._transform._rotation10+hi._invInertia11*hi._transform._rotation11+hi._invInertia12*hi._transform._rotation12,Bi=hi._invInertia10*hi._transform._rotation20+hi._invInertia11*hi._transform._rotation21+hi._invInertia12*hi._transform._rotation22,Pi=hi._invInertia20*hi._transform._rotation00+hi._invInertia21*hi._transform._rotation01+hi._invInertia22*hi._transform._rotation02,Si=hi._invInertia20*hi._transform._rotation10+hi._invInertia21*hi._transform._rotation11+hi._invInertia22*hi._transform._rotation12,Ti=hi._invInertia20*hi._transform._rotation20+hi._invInertia21*hi._transform._rotation21+hi._invInertia22*hi._transform._rotation22,hi._invInertia00=Vi,hi._invInertia01=wi,hi._invInertia02=Li,hi._invInertia10=ki,hi._invInertia11=Ai,hi._invInertia12=Bi,hi._invInertia20=Pi,hi._invInertia21=Si,hi._invInertia22=Ti,hi._invInertia00*=hi._rotFactor.x,hi._invInertia01*=hi._rotFactor.x,hi._invInertia02*=hi._rotFactor.x,hi._invInertia10*=hi._rotFactor.y,hi._invInertia11*=hi._rotFactor.y,hi._invInertia12*=hi._rotFactor.y,hi._invInertia20*=hi._rotFactor.z,hi._invInertia21*=hi._rotFactor.z,hi._invInertia22*=hi._rotFactor.z},n.postSolve=function(){var t,i,a,n,o,s,r,e,_;t=0,i=0,a=0,n=0,o=0,s=0,r=0,e=0,_=0;for(var h=0,l=this.info.numRows;h<l;){var c=this.info.rows[h++],m=c.impulse,v=c.jacobianN,b=c.jacobianT,f=c.jacobianB,u=m.impulseN,p=m.impulseT,x=m.impulseB,y=void 0,d=void 0,g=void 0;y=0,d=0,g=0,y+=b.lin1X*p,d+=b.lin1Y*p,g+=b.lin1Z*p,y+=f.lin1X*x,d+=f.lin1Y*x,g+=f.lin1Z*x,m.impulseLX=y,m.impulseLY=d,m.impulseLZ=g,t+=v.lin1X*u,i+=v.lin1Y*u,a+=v.lin1Z*u,n+=v.ang1X*u,o+=v.ang1Y*u,s+=v.ang1Z*u,r+=v.ang2X*u,e+=v.ang2Y*u,_+=v.ang2Z*u,t+=b.lin1X*p,i+=b.lin1Y*p,a+=b.lin1Z*p,n+=b.ang1X*p,o+=b.ang1Y*p,s+=b.ang1Z*p,r+=b.ang2X*p,e+=b.ang2Y*p,_+=b.ang2Z*p,t+=f.lin1X*x,i+=f.lin1Y*x,a+=f.lin1Z*x,n+=f.ang1X*x,o+=f.ang1Y*x,s+=f.ang1Z*x,r+=f.ang2X*x,e+=f.ang2Y*x,_+=f.ang2Z*x}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=i,this._b1._linearContactImpulseZ+=a,this._b1._angularContactImpulseX+=n,this._b1._angularContactImpulseY+=o,this._b1._angularContactImpulseZ+=s,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=i,this._b2._linearContactImpulseZ-=a,this._b2._angularContactImpulseX-=r,this._b2._angularContactImpulseY-=e,this._b2._angularContactImpulseZ-=_,this.constraint._syncManifold()},i}(r.dynamics.constraint.ConstraintSolver),r.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=function(t){function i(i){var a;(a=t.call(this)||this).joint=i,a.info=new r.dynamics.constraint.info.joint.JointSolverInfo,a.massData=new Array(r.common.Setting.maxJacobianRows);for(var n=0,o=a.massData.length;n<o;)a.massData[n++]=new r.dynamics.constraint.solver.common.JointSolverMassDataRow;return a}a(i,t);var n=i.prototype;return n.preSolveVelocity=function(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,u=this._b2._invInertia20,p=this._b2._invInertia21,x=this._b2._invInertia22;for(var g=0,X=this.info.numRows;g<X;){var Y=g++,z=this.info.rows[Y],Z=this.massData[Y],M=z.jacobian;if(M.updateSparsity(),0!=(1&M.flag)?(Z.invMLin1X=M.lin1X*y,Z.invMLin1Y=M.lin1Y*y,Z.invMLin1Z=M.lin1Z*y,Z.invMLin2X=M.lin2X*d,Z.invMLin2Y=M.lin2Y*d,Z.invMLin2Z=M.lin2Z*d):(Z.invMLin1X=0,Z.invMLin1Y=0,Z.invMLin1Z=0,Z.invMLin2X=0,Z.invMLin2Y=0,Z.invMLin2Z=0),0!=(2&M.flag)){var I,V,w;I=i*M.ang1X+a*M.ang1Y+n*M.ang1Z,V=o*M.ang1X+s*M.ang1Y+r*M.ang1Z,w=e*M.ang1X+_*M.ang1Y+h*M.ang1Z,Z.invMAng1X=I,Z.invMAng1Y=V,Z.invMAng1Z=w;var L,k,A;L=l*M.ang2X+c*M.ang2Y+m*M.ang2Z,k=v*M.ang2X+b*M.ang2Y+f*M.ang2Z,A=u*M.ang2X+p*M.ang2Y+x*M.ang2Z,Z.invMAng2X=L,Z.invMAng2Y=k,Z.invMAng2Z=A}else Z.invMAng1X=0,Z.invMAng1Y=0,Z.invMAng1Z=0,Z.invMAng2X=0,Z.invMAng2Y=0,Z.invMAng2Z=0;Z.massWithoutCfm=Z.invMLin1X*M.lin1X+Z.invMLin1Y*M.lin1Y+Z.invMLin1Z*M.lin1Z+(Z.invMLin2X*M.lin2X+Z.invMLin2Y*M.lin2Y+Z.invMLin2Z*M.lin2Z)+(Z.invMAng1X*M.ang1X+Z.invMAng1Y*M.ang1Y+Z.invMAng1Z*M.ang1Z)+(Z.invMAng2X*M.ang2X+Z.invMAng2Y*M.ang2Y+Z.invMAng2Z*M.ang2Z),Z.mass=Z.massWithoutCfm+z.cfm,0!=Z.massWithoutCfm&&(Z.massWithoutCfm=1/Z.massWithoutCfm),0!=Z.mass&&(Z.mass=1/Z.mass)}},n.warmStart=function(t){var i=this.joint._positionCorrectionAlgorithm==r.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?r.common.Setting.jointWarmStartingFactorForBaungarte:r.common.Setting.jointWarmStartingFactor;if((i*=t.dtRatio)<=0)for(var a=0,n=this.info.numRows;a<n;){var o=this.info.rows[a++].impulse;o.impulse=0,o.impulseM=0,o.impulseP=0}else{var s,e,_,h,l,c,m,v,b,f,u,p;s=this._b1._velX,e=this._b1._velY,_=this._b1._velZ,h=this._b2._velX,l=this._b2._velY,c=this._b2._velZ,m=this._b1._angVelX,v=this._b1._angVelY,b=this._b1._angVelZ,f=this._b2._angVelX,u=this._b2._angVelY,p=this._b2._angVelZ;for(var x=0,y=this.info.numRows;x<y;){var d=x++,g=this.massData[d],X=this.info.rows[d].impulse;X.impulse*=i,X.impulseM*=i;var Y=X.impulse+X.impulseM;s+=g.invMLin1X*Y,e+=g.invMLin1Y*Y,_+=g.invMLin1Z*Y,h+=g.invMLin2X*-Y,l+=g.invMLin2Y*-Y,c+=g.invMLin2Z*-Y,m+=g.invMAng1X*Y,v+=g.invMAng1Y*Y,b+=g.invMAng1Z*Y,f+=g.invMAng2X*-Y,u+=g.invMAng2Y*-Y,p+=g.invMAng2Z*-Y}this._b1._velX=s,this._b1._velY=e,this._b1._velZ=_,this._b2._velX=h,this._b2._velY=l,this._b2._velZ=c,this._b1._angVelX=m,this._b1._angVelY=v,this._b1._angVelZ=b,this._b2._angVelX=f,this._b2._angVelY=u,this._b2._angVelZ=p}},n.solveVelocity=function(){var t,i,a,n,o,s,r,e,_,h,l,c;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,n=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var m=0,v=this.info.numRows;m<v;){var b=m++,f=this.info.rows[b],u=this.massData[b],p=f.impulse,x=f.jacobian;if(0!=f.motorMaxImpulse){var y=0;y+=t*x.lin1X+i*x.lin1Y+a*x.lin1Z,y-=n*x.lin2X+o*x.lin2Y+s*x.lin2Z,y+=r*x.ang1X+e*x.ang1Y+_*x.ang1Z,y-=h*x.ang2X+l*x.ang2Y+c*x.ang2Z;var d=(-f.motorSpeed-y)*u.massWithoutCfm,g=p.impulseM;p.impulseM+=d,p.impulseM<-f.motorMaxImpulse?p.impulseM=-f.motorMaxImpulse:p.impulseM>f.motorMaxImpulse&&(p.impulseM=f.motorMaxImpulse),d=p.impulseM-g,0!=(1&x.flag)&&(t+=u.invMLin1X*d,i+=u.invMLin1Y*d,a+=u.invMLin1Z*d,n+=u.invMLin2X*-d,o+=u.invMLin2Y*-d,s+=u.invMLin2Z*-d),0!=(2&x.flag)&&(r+=u.invMAng1X*d,e+=u.invMAng1Y*d,_+=u.invMAng1Z*d,h+=u.invMAng2X*-d,l+=u.invMAng2Y*-d,c+=u.invMAng2Z*-d)}}for(var X=0,Y=this.info.numRows;X<Y;){var z=X++,Z=this.info.rows[z],M=this.massData[z],I=Z.impulse,V=Z.jacobian,w=0;w+=t*V.lin1X+i*V.lin1Y+a*V.lin1Z,w-=n*V.lin2X+o*V.lin2Y+s*V.lin2Z,w+=r*V.ang1X+e*V.ang1Y+_*V.ang1Z,w-=h*V.ang2X+l*V.ang2Y+c*V.ang2Z;var L=(Z.rhs-w-I.impulse*Z.cfm)*M.mass,k=I.impulse;I.impulse+=L,I.impulse<Z.minImpulse?I.impulse=Z.minImpulse:I.impulse>Z.maxImpulse&&(I.impulse=Z.maxImpulse),L=I.impulse-k,0!=(1&V.flag)&&(t+=M.invMLin1X*L,i+=M.invMLin1Y*L,a+=M.invMLin1Z*L,n+=M.invMLin2X*-L,o+=M.invMLin2Y*-L,s+=M.invMLin2Z*-L),0!=(2&V.flag)&&(r+=M.invMAng1X*L,e+=M.invMAng1Y*L,_+=M.invMAng1Z*L,h+=M.invMAng2X*-L,l+=M.invMAng2Y*-L,c+=M.invMAng2Z*-L)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=n,this._b2._velY=o,this._b2._velZ=s,this._b1._angVelX=r,this._b1._angVelY=e,this._b1._angVelZ=_,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c},n.postSolveVelocity=function(t){var i,a,n,o,s,r;i=0,a=0,n=0,o=0,s=0,r=0;for(var e=0,_=this.info.numRows;e<_;){var h=this.info.rows[e++],l=h.impulse,c=h.jacobian;0!=(1&c.flag)?(i+=c.lin1X*l.impulse,a+=c.lin1Y*l.impulse,n+=c.lin1Z*l.impulse):0!=(2&c.flag)&&(o+=c.ang1X*l.impulse,s+=c.ang1Y*l.impulse,r+=c.ang1Z*l.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=s*t.invDt,this.joint._appliedTorqueZ=r*t.invDt},n.preSolvePosition=function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,u=this._b2._invInertia20,p=this._b2._invInertia21,x=this._b2._invInertia22;for(var g=0,X=this.info.numRows;g<X;){var Y=g++,z=this.massData[Y],Z=this.info.rows[Y].jacobian;z.invMLin1X=Z.lin1X*y,z.invMLin1Y=Z.lin1Y*y,z.invMLin1Z=Z.lin1Z*y,z.invMLin2X=Z.lin2X*d,z.invMLin2Y=Z.lin2Y*d,z.invMLin2Z=Z.lin2Z*d;var M,I,V;M=i*Z.ang1X+a*Z.ang1Y+n*Z.ang1Z,I=o*Z.ang1X+s*Z.ang1Y+r*Z.ang1Z,V=e*Z.ang1X+_*Z.ang1Y+h*Z.ang1Z,z.invMAng1X=M,z.invMAng1Y=I,z.invMAng1Z=V;var w,L,k;w=l*Z.ang2X+c*Z.ang2Y+m*Z.ang2Z,L=v*Z.ang2X+b*Z.ang2Y+f*Z.ang2Z,k=u*Z.ang2X+p*Z.ang2Y+x*Z.ang2Z,z.invMAng2X=w,z.invMAng2Y=L,z.invMAng2Z=k,z.mass=z.invMLin1X*Z.lin1X+z.invMLin1Y*Z.lin1Y+z.invMLin1Z*Z.lin1Z+(z.invMLin2X*Z.lin2X+z.invMLin2Y*Z.lin2Y+z.invMLin2Z*Z.lin2Z)+(z.invMAng1X*Z.ang1X+z.invMAng1Y*Z.ang1Y+z.invMAng1Z*Z.ang1Z)+(z.invMAng2X*Z.ang2X+z.invMAng2Y*Z.ang2Y+z.invMAng2Z*Z.ang2Z),0!=z.mass&&(z.mass=1/z.mass)}for(var A=0,B=this.info.numRows;A<B;)this.info.rows[A++].impulse.impulseP=0},n.solvePositionSplitImpulse=function(){var t,i,a,n,o,s,e,_,h,l,c,m;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,e=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,h=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;for(var v=0,b=this.info.numRows;v<b;){var f=v++,u=this.info.rows[f],p=this.massData[f],x=u.impulse,y=u.jacobian,d=0;d+=t*y.lin1X+i*y.lin1Y+a*y.lin1Z,d-=n*y.lin2X+o*y.lin2Y+s*y.lin2Z,d+=e*y.ang1X+_*y.ang1Y+h*y.ang1Z,d-=l*y.ang2X+c*y.ang2Y+m*y.ang2Z;var g=(u.rhs*r.common.Setting.positionSplitImpulseBaumgarte-d)*p.mass,X=x.impulseP;x.impulseP+=g,x.impulseP<u.minImpulse?x.impulseP=u.minImpulse:x.impulseP>u.maxImpulse&&(x.impulseP=u.maxImpulse),g=x.impulseP-X,t+=p.invMLin1X*g,i+=p.invMLin1Y*g,a+=p.invMLin1Z*g,n+=p.invMLin2X*-g,o+=p.invMLin2Y*-g,s+=p.invMLin2Z*-g,e+=p.invMAng1X*g,_+=p.invMAng1Y*g,h+=p.invMAng1Z*g,l+=p.invMAng2X*-g,c+=p.invMAng2Y*-g,m+=p.invMAng2Z*-g}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=n,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=e,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=h,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=c,this._b2._angPseudoVelZ=m},n.solvePositionNgs=function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,n,o,s,e,_,h,l,c,m,v,b,f,u,p,x,y,d=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,e=this._b1._invInertia12,_=this._b1._invInertia20,h=this._b1._invInertia21,l=this._b1._invInertia22,c=this._b2._invInertia00,m=this._b2._invInertia01,v=this._b2._invInertia02,b=this._b2._invInertia10,f=this._b2._invInertia11,u=this._b2._invInertia12,p=this._b2._invInertia20,x=this._b2._invInertia21,y=this._b2._invInertia22;for(var X,Y,z,Z,M,I,V,w,L,k,A,B,P=0,S=this.info.numRows;P<S;){var T=P++,C=this.massData[T],j=this.info.rows[T].jacobian;C.invMLin1X=j.lin1X*d,C.invMLin1Y=j.lin1Y*d,C.invMLin1Z=j.lin1Z*d,C.invMLin2X=j.lin2X*g,C.invMLin2Y=j.lin2Y*g,C.invMLin2Z=j.lin2Z*g;var R,E,q;R=i*j.ang1X+a*j.ang1Y+n*j.ang1Z,E=o*j.ang1X+s*j.ang1Y+e*j.ang1Z,q=_*j.ang1X+h*j.ang1Y+l*j.ang1Z,C.invMAng1X=R,C.invMAng1Y=E,C.invMAng1Z=q;var D,N,F;D=c*j.ang2X+m*j.ang2Y+v*j.ang2Z,N=b*j.ang2X+f*j.ang2Y+u*j.ang2Z,F=p*j.ang2X+x*j.ang2Y+y*j.ang2Z,C.invMAng2X=D,C.invMAng2Y=N,C.invMAng2Z=F,C.mass=C.invMLin1X*j.lin1X+C.invMLin1Y*j.lin1Y+C.invMLin1Z*j.lin1Z+(C.invMLin2X*j.lin2X+C.invMLin2Y*j.lin2Y+C.invMLin2Z*j.lin2Z)+(C.invMAng1X*j.ang1X+C.invMAng1Y*j.ang1Y+C.invMAng1Z*j.ang1Z)+(C.invMAng2X*j.ang2X+C.invMAng2Y*j.ang2Y+C.invMAng2Z*j.ang2Z),0!=C.mass&&(C.mass=1/C.mass)}X=0,Y=0,z=0,Z=0,M=0,I=0,V=0,w=0,L=0,k=0,A=0,B=0;for(var G=0,J=this.info.numRows;G<J;){var W=G++,O=this.info.rows[W],U=this.massData[W],H=O.impulse,Q=O.jacobian,K=0;K+=X*Q.lin1X+Y*Q.lin1Y+z*Q.lin1Z,K-=Z*Q.lin2X+M*Q.lin2Y+I*Q.lin2Z,K+=V*Q.ang1X+w*Q.ang1Y+L*Q.ang1Z,K-=k*Q.ang2X+A*Q.ang2Y+B*Q.ang2Z;var $=(O.rhs*r.common.Setting.positionNgsBaumgarte-K)*U.mass,tt=H.impulseP;H.impulseP+=$,H.impulseP<O.minImpulse?H.impulseP=O.minImpulse:H.impulseP>O.maxImpulse&&(H.impulseP=O.maxImpulse),$=H.impulseP-tt,X+=U.invMLin1X*$,Y+=U.invMLin1Y*$,z+=U.invMLin1Z*$,Z+=U.invMLin2X*-$,M+=U.invMLin2Y*-$,I+=U.invMLin2Z*-$,V+=U.invMAng1X*$,w+=U.invMAng1Y*$,L+=U.invMAng1Z*$,k+=U.invMAng2X*-$,A+=U.invMAng2Y*-$,B+=U.invMAng2Z*-$}var it=this._b1;it._transform._positionX+=X,it._transform._positionY+=Y,it._transform._positionZ+=z;var at=this._b2;at._transform._positionX+=Z,at._transform._positionY+=M,at._transform._positionZ+=I;var nt,ot,st,rt,et,_t,ht,lt,ct,mt,vt=this._b1,bt=Math.sqrt(V*V+w*w+L*L),ft=.5*bt;if(ft<.5){var ut=ft*ft;nt=.5*(1-.16666666666666666*ut+ut*ut*.008333333333333333),ot=1-.5*ut+ut*ut*.041666666666666664}else nt=Math.sin(ft)/bt,ot=Math.cos(ft);st=V*nt,rt=w*nt,et=L*nt,_t=ot;var pt,xt=vt._transform._rotation00,yt=vt._transform._rotation11,dt=vt._transform._rotation22,gt=xt+yt+dt;gt>0?(mt=.5*(pt=Math.sqrt(gt+1)),pt=.5/pt,ht=(vt._transform._rotation21-vt._transform._rotation12)*pt,lt=(vt._transform._rotation02-vt._transform._rotation20)*pt,ct=(vt._transform._rotation10-vt._transform._rotation01)*pt):xt>yt?xt>dt?(ht=.5*(pt=Math.sqrt(xt-yt-dt+1)),pt=.5/pt,lt=(vt._transform._rotation01+vt._transform._rotation10)*pt,ct=(vt._transform._rotation02+vt._transform._rotation20)*pt,mt=(vt._transform._rotation21-vt._transform._rotation12)*pt):(ct=.5*(pt=Math.sqrt(dt-xt-yt+1)),pt=.5/pt,ht=(vt._transform._rotation02+vt._transform._rotation20)*pt,lt=(vt._transform._rotation12+vt._transform._rotation21)*pt,mt=(vt._transform._rotation10-vt._transform._rotation01)*pt):yt>dt?(lt=.5*(pt=Math.sqrt(yt-dt-xt+1)),pt=.5/pt,ht=(vt._transform._rotation01+vt._transform._rotation10)*pt,ct=(vt._transform._rotation12+vt._transform._rotation21)*pt,mt=(vt._transform._rotation02-vt._transform._rotation20)*pt):(ct=.5*(pt=Math.sqrt(dt-xt-yt+1)),pt=.5/pt,ht=(vt._transform._rotation02+vt._transform._rotation20)*pt,lt=(vt._transform._rotation12+vt._transform._rotation21)*pt,mt=(vt._transform._rotation10-vt._transform._rotation01)*pt);var Xt=(ht=_t*ht+st*mt+rt*ct-et*lt)*ht+(lt=_t*lt-st*ct+rt*mt+et*ht)*lt+(ct=_t*ct+st*lt-rt*ht+et*mt)*ct+(mt=_t*mt-st*ht-rt*lt-et*ct)*mt;Xt>1e-32&&(Xt=1/Math.sqrt(Xt));ht*=Xt,lt*=Xt,ct*=Xt,mt*=Xt;var Yt,zt,Zt,Mt,It,Vt,wt,Lt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt,Et,qt=2*ht,Dt=2*lt,Nt=2*ct,Ft=ht*qt,Gt=lt*Dt,Jt=ct*Nt,Wt=ht*Dt,Ot=lt*Nt,Ut=ht*Nt,Ht=mt*qt,Qt=mt*Dt,Kt=mt*Nt;vt._transform._rotation00=1-Gt-Jt,vt._transform._rotation01=Wt-Kt,vt._transform._rotation02=Ut+Qt,vt._transform._rotation10=Wt+Kt,vt._transform._rotation11=1-Ft-Jt,vt._transform._rotation12=Ot-Ht,vt._transform._rotation20=Ut-Qt,vt._transform._rotation21=Ot+Ht,vt._transform._rotation22=1-Ft-Gt,Yt=vt._transform._rotation00*vt._invLocalInertia00+vt._transform._rotation01*vt._invLocalInertia10+vt._transform._rotation02*vt._invLocalInertia20,zt=vt._transform._rotation00*vt._invLocalInertia01+vt._transform._rotation01*vt._invLocalInertia11+vt._transform._rotation02*vt._invLocalInertia21,Zt=vt._transform._rotation00*vt._invLocalInertia02+vt._transform._rotation01*vt._invLocalInertia12+vt._transform._rotation02*vt._invLocalInertia22,Mt=vt._transform._rotation10*vt._invLocalInertia00+vt._transform._rotation11*vt._invLocalInertia10+vt._transform._rotation12*vt._invLocalInertia20,It=vt._transform._rotation10*vt._invLocalInertia01+vt._transform._rotation11*vt._invLocalInertia11+vt._transform._rotation12*vt._invLocalInertia21,Vt=vt._transform._rotation10*vt._invLocalInertia02+vt._transform._rotation11*vt._invLocalInertia12+vt._transform._rotation12*vt._invLocalInertia22,wt=vt._transform._rotation20*vt._invLocalInertia00+vt._transform._rotation21*vt._invLocalInertia10+vt._transform._rotation22*vt._invLocalInertia20,Lt=vt._transform._rotation20*vt._invLocalInertia01+vt._transform._rotation21*vt._invLocalInertia11+vt._transform._rotation22*vt._invLocalInertia21,kt=vt._transform._rotation20*vt._invLocalInertia02+vt._transform._rotation21*vt._invLocalInertia12+vt._transform._rotation22*vt._invLocalInertia22,vt._invInertia00=Yt,vt._invInertia01=zt,vt._invInertia02=Zt,vt._invInertia10=Mt,vt._invInertia11=It,vt._invInertia12=Vt,vt._invInertia20=wt,vt._invInertia21=Lt,vt._invInertia22=kt,At=vt._invInertia00*vt._transform._rotation00+vt._invInertia01*vt._transform._rotation01+vt._invInertia02*vt._transform._rotation02,Bt=vt._invInertia00*vt._transform._rotation10+vt._invInertia01*vt._transform._rotation11+vt._invInertia02*vt._transform._rotation12,Pt=vt._invInertia00*vt._transform._rotation20+vt._invInertia01*vt._transform._rotation21+vt._invInertia02*vt._transform._rotation22,St=vt._invInertia10*vt._transform._rotation00+vt._invInertia11*vt._transform._rotation01+vt._invInertia12*vt._transform._rotation02,Tt=vt._invInertia10*vt._transform._rotation10+vt._invInertia11*vt._transform._rotation11+vt._invInertia12*vt._transform._rotation12,Ct=vt._invInertia10*vt._transform._rotation20+vt._invInertia11*vt._transform._rotation21+vt._invInertia12*vt._transform._rotation22,jt=vt._invInertia20*vt._transform._rotation00+vt._invInertia21*vt._transform._rotation01+vt._invInertia22*vt._transform._rotation02,Rt=vt._invInertia20*vt._transform._rotation10+vt._invInertia21*vt._transform._rotation11+vt._invInertia22*vt._transform._rotation12,Et=vt._invInertia20*vt._transform._rotation20+vt._invInertia21*vt._transform._rotation21+vt._invInertia22*vt._transform._rotation22,vt._invInertia00=At,vt._invInertia01=Bt,vt._invInertia02=Pt,vt._invInertia10=St,vt._invInertia11=Tt,vt._invInertia12=Ct,vt._invInertia20=jt,vt._invInertia21=Rt,vt._invInertia22=Et,vt._invInertia00*=vt._rotFactor.x,vt._invInertia01*=vt._rotFactor.x,vt._invInertia02*=vt._rotFactor.x,vt._invInertia10*=vt._rotFactor.y,vt._invInertia11*=vt._rotFactor.y,vt._invInertia12*=vt._rotFactor.y,vt._invInertia20*=vt._rotFactor.z,vt._invInertia21*=vt._rotFactor.z,vt._invInertia22*=vt._rotFactor.z;var $t,ti,ii,ai,ni,oi,si,ri,ei,_i,hi=this._b2,li=Math.sqrt(k*k+A*A+B*B),ci=.5*li;if(ci<.5){var mi=ci*ci;$t=.5*(1-.16666666666666666*mi+mi*mi*.008333333333333333),ti=1-.5*mi+mi*mi*.041666666666666664}else $t=Math.sin(ci)/li,ti=Math.cos(ci);ii=k*$t,ai=A*$t,ni=B*$t,oi=ti;var vi,bi=hi._transform._rotation00,fi=hi._transform._rotation11,ui=hi._transform._rotation22,pi=bi+fi+ui;pi>0?(_i=.5*(vi=Math.sqrt(pi+1)),vi=.5/vi,si=(hi._transform._rotation21-hi._transform._rotation12)*vi,ri=(hi._transform._rotation02-hi._transform._rotation20)*vi,ei=(hi._transform._rotation10-hi._transform._rotation01)*vi):bi>fi?bi>ui?(si=.5*(vi=Math.sqrt(bi-fi-ui+1)),vi=.5/vi,ri=(hi._transform._rotation01+hi._transform._rotation10)*vi,ei=(hi._transform._rotation02+hi._transform._rotation20)*vi,_i=(hi._transform._rotation21-hi._transform._rotation12)*vi):(ei=.5*(vi=Math.sqrt(ui-bi-fi+1)),vi=.5/vi,si=(hi._transform._rotation02+hi._transform._rotation20)*vi,ri=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation10-hi._transform._rotation01)*vi):fi>ui?(ri=.5*(vi=Math.sqrt(fi-ui-bi+1)),vi=.5/vi,si=(hi._transform._rotation01+hi._transform._rotation10)*vi,ei=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation02-hi._transform._rotation20)*vi):(ei=.5*(vi=Math.sqrt(ui-bi-fi+1)),vi=.5/vi,si=(hi._transform._rotation02+hi._transform._rotation20)*vi,ri=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation10-hi._transform._rotation01)*vi);var xi=(si=oi*si+ii*_i+ai*ei-ni*ri)*si+(ri=oi*ri-ii*ei+ai*_i+ni*si)*ri+(ei=oi*ei+ii*ri-ai*si+ni*_i)*ei+(_i=oi*_i-ii*si-ai*ri-ni*ei)*_i;xi>1e-32&&(xi=1/Math.sqrt(xi));si*=xi,ri*=xi,ei*=xi,_i*=xi;var yi,di,gi,Xi,Yi,zi,Zi,Mi,Ii,Vi,wi,Li,ki,Ai,Bi,Pi,Si,Ti,Ci=2*si,ji=2*ri,Ri=2*ei,Ei=si*Ci,qi=ri*ji,Di=ei*Ri,Ni=si*ji,Fi=ri*Ri,Gi=si*Ri,Ji=_i*Ci,Wi=_i*ji,Oi=_i*Ri;hi._transform._rotation00=1-qi-Di,hi._transform._rotation01=Ni-Oi,hi._transform._rotation02=Gi+Wi,hi._transform._rotation10=Ni+Oi,hi._transform._rotation11=1-Ei-Di,hi._transform._rotation12=Fi-Ji,hi._transform._rotation20=Gi-Wi,hi._transform._rotation21=Fi+Ji,hi._transform._rotation22=1-Ei-qi,yi=hi._transform._rotation00*hi._invLocalInertia00+hi._transform._rotation01*hi._invLocalInertia10+hi._transform._rotation02*hi._invLocalInertia20,di=hi._transform._rotation00*hi._invLocalInertia01+hi._transform._rotation01*hi._invLocalInertia11+hi._transform._rotation02*hi._invLocalInertia21,gi=hi._transform._rotation00*hi._invLocalInertia02+hi._transform._rotation01*hi._invLocalInertia12+hi._transform._rotation02*hi._invLocalInertia22,Xi=hi._transform._rotation10*hi._invLocalInertia00+hi._transform._rotation11*hi._invLocalInertia10+hi._transform._rotation12*hi._invLocalInertia20,Yi=hi._transform._rotation10*hi._invLocalInertia01+hi._transform._rotation11*hi._invLocalInertia11+hi._transform._rotation12*hi._invLocalInertia21,zi=hi._transform._rotation10*hi._invLocalInertia02+hi._transform._rotation11*hi._invLocalInertia12+hi._transform._rotation12*hi._invLocalInertia22,Zi=hi._transform._rotation20*hi._invLocalInertia00+hi._transform._rotation21*hi._invLocalInertia10+hi._transform._rotation22*hi._invLocalInertia20,Mi=hi._transform._rotation20*hi._invLocalInertia01+hi._transform._rotation21*hi._invLocalInertia11+hi._transform._rotation22*hi._invLocalInertia21,Ii=hi._transform._rotation20*hi._invLocalInertia02+hi._transform._rotation21*hi._invLocalInertia12+hi._transform._rotation22*hi._invLocalInertia22,hi._invInertia00=yi,hi._invInertia01=di,hi._invInertia02=gi,hi._invInertia10=Xi,hi._invInertia11=Yi,hi._invInertia12=zi,hi._invInertia20=Zi,hi._invInertia21=Mi,hi._invInertia22=Ii,Vi=hi._invInertia00*hi._transform._rotation00+hi._invInertia01*hi._transform._rotation01+hi._invInertia02*hi._transform._rotation02,wi=hi._invInertia00*hi._transform._rotation10+hi._invInertia01*hi._transform._rotation11+hi._invInertia02*hi._transform._rotation12,Li=hi._invInertia00*hi._transform._rotation20+hi._invInertia01*hi._transform._rotation21+hi._invInertia02*hi._transform._rotation22,ki=hi._invInertia10*hi._transform._rotation00+hi._invInertia11*hi._transform._rotation01+hi._invInertia12*hi._transform._rotation02,Ai=hi._invInertia10*hi._transform._rotation10+hi._invInertia11*hi._transform._rotation11+hi._invInertia12*hi._transform._rotation12,Bi=hi._invInertia10*hi._transform._rotation20+hi._invInertia11*hi._transform._rotation21+hi._invInertia12*hi._transform._rotation22,Pi=hi._invInertia20*hi._transform._rotation00+hi._invInertia21*hi._transform._rotation01+hi._invInertia22*hi._transform._rotation02,Si=hi._invInertia20*hi._transform._rotation10+hi._invInertia21*hi._transform._rotation11+hi._invInertia22*hi._transform._rotation12,Ti=hi._invInertia20*hi._transform._rotation20+hi._invInertia21*hi._transform._rotation21+hi._invInertia22*hi._transform._rotation22,hi._invInertia00=Vi,hi._invInertia01=wi,hi._invInertia02=Li,hi._invInertia10=ki,hi._invInertia11=Ai,hi._invInertia12=Bi,hi._invInertia20=Pi,hi._invInertia21=Si,hi._invInertia22=Ti,hi._invInertia00*=hi._rotFactor.x,hi._invInertia01*=hi._rotFactor.x,hi._invInertia02*=hi._rotFactor.x,hi._invInertia10*=hi._rotFactor.y,hi._invInertia11*=hi._rotFactor.y,hi._invInertia12*=hi._rotFactor.y,hi._invInertia20*=hi._rotFactor.z,hi._invInertia21*=hi._rotFactor.z,hi._invInertia22*=hi._rotFactor.z},n.postSolve=function(){this.joint._syncAnchors(),this.joint._checkDestruction()},i}(r.dynamics.constraint.ConstraintSolver),r.dynamics.rigidbody||(r.dynamics.rigidbody={}),r.dynamics.rigidbody.MassData=function(){this.mass=0,this.localInertia=new r.common.Mat3},r.dynamics.rigidbody.RigidBody=function(){function t(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;var a=t.angularVelocity;this._angVelX=a.x,this._angVelY=a.y,this._angVelZ=a.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new r.common.Transform,this._transform=new r.common.Transform;var n=t.position;this._ptransform._positionX=n.x,this._ptransform._positionY=n.y,this._ptransform._positionZ=n.z;var o=t.rotation;this._ptransform._rotation00=o.e00,this._ptransform._rotation01=o.e01,this._ptransform._rotation02=o.e02,this._ptransform._rotation10=o.e10,this._ptransform._rotation11=o.e11,this._ptransform._rotation12=o.e12,this._ptransform._rotation20=o.e20,this._ptransform._rotation21=o.e21,this._ptransform._rotation22=o.e22;var s=this._transform,e=this._ptransform;s._positionX=e._positionX,s._positionY=e._positionY,s._positionZ=e._positionZ,s._rotation00=e._rotation00,s._rotation01=e._rotation01,s._rotation02=e._rotation02,s._rotation10=e._rotation10,s._rotation11=e._rotation11,s._rotation12=e._rotation12,s._rotation20=e._rotation20,s._rotation21=e._rotation21,s._rotation22=e._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new r.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}var i=t.prototype;return i._integrate=function(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var i,a,n,o,s,e,_=(i=this._velX*t)*i+(a=this._velY*t)*a+(n=this._velZ*t)*n,h=(o=this._angVelX*t)*o+(s=this._angVelY*t)*s+(e=this._angVelZ*t)*e;if(0==_&&0==h)return;if(_>r.common.Setting.maxTranslationPerStep*r.common.Setting.maxTranslationPerStep){var l=r.common.Setting.maxTranslationPerStep/Math.sqrt(_);this._velX*=l,this._velY*=l,this._velZ*=l,i*=l,a*=l,n*=l}if(h>r.common.Setting.maxRotationPerStep*r.common.Setting.maxRotationPerStep){var c=r.common.Setting.maxRotationPerStep/Math.sqrt(h);this._angVelX*=c,this._angVelY*=c,this._angVelZ*=c,o*=c,s*=c,e*=c}this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=n;var m,v,b,f,u,p,x,y,d,g,X=Math.sqrt(o*o+s*s+e*e),Y=.5*X;if(Y<.5){var z=Y*Y;m=.5*(1-.16666666666666666*z+z*z*.008333333333333333),v=1-.5*z+z*z*.041666666666666664}else m=Math.sin(Y)/X,v=Math.cos(Y);b=o*m,f=s*m,u=e*m,p=v;var Z,M=this._transform._rotation00,I=this._transform._rotation11,V=this._transform._rotation22,w=M+I+V;w>0?(g=.5*(Z=Math.sqrt(w+1)),Z=.5/Z,x=(this._transform._rotation21-this._transform._rotation12)*Z,y=(this._transform._rotation02-this._transform._rotation20)*Z,d=(this._transform._rotation10-this._transform._rotation01)*Z):M>I?M>V?(x=.5*(Z=Math.sqrt(M-I-V+1)),Z=.5/Z,y=(this._transform._rotation01+this._transform._rotation10)*Z,d=(this._transform._rotation02+this._transform._rotation20)*Z,g=(this._transform._rotation21-this._transform._rotation12)*Z):(d=.5*(Z=Math.sqrt(V-M-I+1)),Z=.5/Z,x=(this._transform._rotation02+this._transform._rotation20)*Z,y=(this._transform._rotation12+this._transform._rotation21)*Z,g=(this._transform._rotation10-this._transform._rotation01)*Z):I>V?(y=.5*(Z=Math.sqrt(I-V-M+1)),Z=.5/Z,x=(this._transform._rotation01+this._transform._rotation10)*Z,d=(this._transform._rotation12+this._transform._rotation21)*Z,g=(this._transform._rotation02-this._transform._rotation20)*Z):(d=.5*(Z=Math.sqrt(V-M-I+1)),Z=.5/Z,x=(this._transform._rotation02+this._transform._rotation20)*Z,y=(this._transform._rotation12+this._transform._rotation21)*Z,g=(this._transform._rotation10-this._transform._rotation01)*Z);var L=(x=p*x+b*g+f*d-u*y)*x+(y=p*y-b*d+f*g+u*x)*y+(d=p*d+b*y-f*x+u*g)*d+(g=p*g-b*x-f*y-u*d)*g;L>1e-32&&(L=1/Math.sqrt(L));x*=L,y*=L,d*=L,g*=L;var k,A,B,P,S,T,C,j,R,E,q,D,N,F,G,J,W,O,U=2*x,H=2*y,Q=2*d,K=x*U,$=y*H,tt=d*Q,it=x*H,at=y*Q,nt=x*Q,ot=g*U,st=g*H,rt=g*Q;this._transform._rotation00=1-$-tt,this._transform._rotation01=it-rt,this._transform._rotation02=nt+st,this._transform._rotation10=it+rt,this._transform._rotation11=1-K-tt,this._transform._rotation12=at-ot,this._transform._rotation20=nt-st,this._transform._rotation21=at+ot,this._transform._rotation22=1-K-$,k=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,B=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,P=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,S=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,C=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,j=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,R=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=k,this._invInertia01=A,this._invInertia02=B,this._invInertia10=P,this._invInertia11=S,this._invInertia12=T,this._invInertia20=C,this._invInertia21=j,this._invInertia22=R,E=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,q=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,D=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,N=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,G=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,J=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,W=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,O=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=E,this._invInertia01=q,this._invInertia02=D,this._invInertia10=N,this._invInertia11=F,this._invInertia12=G,this._invInertia20=J,this._invInertia21=W,this._invInertia22=O,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}},i._integratePseudoVelocity=function(){if(this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ!=0||this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ!=0)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var t,i,a,n,o,s;t=this._pseudoVelX,i=this._pseudoVelY,a=this._pseudoVelZ,n=this._angPseudoVelX,o=this._angPseudoVelY,s=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=a;var r,e,_,h,l,c,m,v,b,f,u=Math.sqrt(n*n+o*o+s*s),p=.5*u;if(p<.5){var x=p*p;r=.5*(1-.16666666666666666*x+x*x*.008333333333333333),e=1-.5*x+x*x*.041666666666666664}else r=Math.sin(p)/u,e=Math.cos(p);_=n*r,h=o*r,l=s*r,c=e;var y,d=this._transform._rotation00,g=this._transform._rotation11,X=this._transform._rotation22,Y=d+g+X;Y>0?(f=.5*(y=Math.sqrt(Y+1)),y=.5/y,m=(this._transform._rotation21-this._transform._rotation12)*y,v=(this._transform._rotation02-this._transform._rotation20)*y,b=(this._transform._rotation10-this._transform._rotation01)*y):d>g?d>X?(m=.5*(y=Math.sqrt(d-g-X+1)),y=.5/y,v=(this._transform._rotation01+this._transform._rotation10)*y,b=(this._transform._rotation02+this._transform._rotation20)*y,f=(this._transform._rotation21-this._transform._rotation12)*y):(b=.5*(y=Math.sqrt(X-d-g+1)),y=.5/y,m=(this._transform._rotation02+this._transform._rotation20)*y,v=(this._transform._rotation12+this._transform._rotation21)*y,f=(this._transform._rotation10-this._transform._rotation01)*y):g>X?(v=.5*(y=Math.sqrt(g-X-d+1)),y=.5/y,m=(this._transform._rotation01+this._transform._rotation10)*y,b=(this._transform._rotation12+this._transform._rotation21)*y,f=(this._transform._rotation02-this._transform._rotation20)*y):(b=.5*(y=Math.sqrt(X-d-g+1)),y=.5/y,m=(this._transform._rotation02+this._transform._rotation20)*y,v=(this._transform._rotation12+this._transform._rotation21)*y,f=(this._transform._rotation10-this._transform._rotation01)*y);var z=(m=c*m+_*f+h*b-l*v)*m+(v=c*v-_*b+h*f+l*m)*v+(b=c*b+_*v-h*m+l*f)*b+(f=c*f-_*m-h*v-l*b)*f;z>1e-32&&(z=1/Math.sqrt(z));m*=z,v*=z,b*=z,f*=z;var Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,E,q,D,N=2*m,F=2*v,G=2*b,J=m*N,W=v*F,O=b*G,U=m*F,H=v*G,Q=m*G,K=f*N,$=f*F,tt=f*G;this._transform._rotation00=1-W-O,this._transform._rotation01=U-tt,this._transform._rotation02=Q+$,this._transform._rotation10=U+tt,this._transform._rotation11=1-J-O,this._transform._rotation12=H-K,this._transform._rotation20=Q-$,this._transform._rotation21=H+K,this._transform._rotation22=1-J-W,Z=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,M=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,I=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,V=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,w=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,L=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,k=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,A=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,B=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=Z,this._invInertia01=M,this._invInertia02=I,this._invInertia10=V,this._invInertia11=w,this._invInertia12=L,this._invInertia20=k,this._invInertia21=A,this._invInertia22=B,P=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,S=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,T=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,C=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,j=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,R=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,E=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,q=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,D=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=P,this._invInertia01=S,this._invInertia02=T,this._invInertia10=C,this._invInertia11=j,this._invInertia12=R,this._invInertia20=E,this._invInertia21=q,this._invInertia22=D,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}},i.updateMass=function(){var t,i,a,n,o,s,r,e,_;t=0,i=0,a=0,n=0,o=0,s=0,r=0,e=0,_=0;for(var h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I=0,V=this._shapeList;null!=V;){var w=V._next,L=V._geom;L._updateMass();var k,A=V._density*L._volume,B=void 0,P=void 0,S=void 0,T=void 0,C=void 0,j=void 0,R=void 0,E=void 0,q=void 0;k=V._localTransform._rotation00*L._inertiaCoeff00+V._localTransform._rotation01*L._inertiaCoeff10+V._localTransform._rotation02*L._inertiaCoeff20,P=V._localTransform._rotation00*L._inertiaCoeff01+V._localTransform._rotation01*L._inertiaCoeff11+V._localTransform._rotation02*L._inertiaCoeff21,S=V._localTransform._rotation00*L._inertiaCoeff02+V._localTransform._rotation01*L._inertiaCoeff12+V._localTransform._rotation02*L._inertiaCoeff22,T=V._localTransform._rotation10*L._inertiaCoeff00+V._localTransform._rotation11*L._inertiaCoeff10+V._localTransform._rotation12*L._inertiaCoeff20,C=V._localTransform._rotation10*L._inertiaCoeff01+V._localTransform._rotation11*L._inertiaCoeff11+V._localTransform._rotation12*L._inertiaCoeff21,j=V._localTransform._rotation10*L._inertiaCoeff02+V._localTransform._rotation11*L._inertiaCoeff12+V._localTransform._rotation12*L._inertiaCoeff22,R=V._localTransform._rotation20*L._inertiaCoeff00+V._localTransform._rotation21*L._inertiaCoeff10+V._localTransform._rotation22*L._inertiaCoeff20,E=V._localTransform._rotation20*L._inertiaCoeff01+V._localTransform._rotation21*L._inertiaCoeff11+V._localTransform._rotation22*L._inertiaCoeff21,q=V._localTransform._rotation20*L._inertiaCoeff02+V._localTransform._rotation21*L._inertiaCoeff12+V._localTransform._rotation22*L._inertiaCoeff22;var D,N,F,G,J,W,O,U,H;D=(B=k)*V._localTransform._rotation00+P*V._localTransform._rotation01+S*V._localTransform._rotation02,N=B*V._localTransform._rotation10+P*V._localTransform._rotation11+S*V._localTransform._rotation12,F=B*V._localTransform._rotation20+P*V._localTransform._rotation21+S*V._localTransform._rotation22,G=T*V._localTransform._rotation00+C*V._localTransform._rotation01+j*V._localTransform._rotation02,J=T*V._localTransform._rotation10+C*V._localTransform._rotation11+j*V._localTransform._rotation12,W=T*V._localTransform._rotation20+C*V._localTransform._rotation21+j*V._localTransform._rotation22,O=R*V._localTransform._rotation00+E*V._localTransform._rotation01+q*V._localTransform._rotation02,U=R*V._localTransform._rotation10+E*V._localTransform._rotation11+q*V._localTransform._rotation12,H=R*V._localTransform._rotation20+E*V._localTransform._rotation21+q*V._localTransform._rotation22,B=D,P=N,S=F,T=G,C=J,j=W,R=O,E=U,q=H,B*=A,P*=A,S*=A,T*=A,C*=A,j*=A,R*=A,E*=A,q*=A;var Q=V._localTransform._positionX*V._localTransform._positionX,K=V._localTransform._positionY*V._localTransform._positionY,$=V._localTransform._positionZ*V._localTransform._positionZ,tt=-V._localTransform._positionX*V._localTransform._positionY,it=-V._localTransform._positionY*V._localTransform._positionZ,at=-V._localTransform._positionZ*V._localTransform._positionX;I+=A,t+=B+=(K+$)*A,i+=P+=tt*A,a+=S+=at*A,n+=T+=tt*A,o+=C+=(Q+$)*A,s+=j+=it*A,r+=R+=at*A,e+=E+=it*A,_+=q+=(Q+K)*A,V=w}if(this._mass=I,this._localInertia00=t,this._localInertia01=i,this._localInertia02=a,this._localInertia10=n,this._localInertia11=o,this._localInertia12=s,this._localInertia20=r,this._localInertia21=e,this._localInertia22=_,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;var nt=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,ot=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,st=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,rt=this._localInertia00*nt-this._localInertia01*ot+this._localInertia02*st;(rt<-1e-32||rt>1e-32)&&(rt=1/rt),this._invLocalInertia00=nt*rt,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*rt,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*rt,this._invLocalInertia10=-ot*rt,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*rt,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*rt,this._invLocalInertia20=st*rt,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*rt,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*rt,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);h=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,l=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,c=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,m=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,v=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,b=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,f=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,u=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,p=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=h,this._invInertia01=l,this._invInertia02=c,this._invInertia10=m,this._invInertia11=v,this._invInertia12=b,this._invInertia20=f,this._invInertia21=u,this._invInertia22=p,x=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,y=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,d=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,g=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,X=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Z=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,M=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=x,this._invInertia01=y,this._invInertia02=d,this._invInertia10=g,this._invInertia11=X,this._invInertia12=Y,this._invInertia20=z,this._invInertia21=Z,this._invInertia22=M,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},i.getPosition=function(){var t=new r.common.Vec3;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,t},i.getPositionTo=function(t){t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ},i.setPosition=function(t){this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;var i=this._ptransform,a=this._transform;i._positionX=a._positionX,i._positionY=a._positionY,i._positionZ=a._positionZ,i._rotation00=a._rotation00,i._rotation01=a._rotation01,i._rotation02=a._rotation02,i._rotation10=a._rotation10,i._rotation11=a._rotation11,i._rotation12=a._rotation12,i._rotation20=a._rotation20,i._rotation21=a._rotation21,i._rotation22=a._rotation22;for(var n=this._shapeList;null!=n;){var o,s,r,e,_,h,l,c,m,v=n._next,b=this._ptransform,f=this._transform,u=n._ptransform,p=n._localTransform;o=b._rotation00*p._rotation00+b._rotation01*p._rotation10+b._rotation02*p._rotation20,s=b._rotation00*p._rotation01+b._rotation01*p._rotation11+b._rotation02*p._rotation21,r=b._rotation00*p._rotation02+b._rotation01*p._rotation12+b._rotation02*p._rotation22,e=b._rotation10*p._rotation00+b._rotation11*p._rotation10+b._rotation12*p._rotation20,_=b._rotation10*p._rotation01+b._rotation11*p._rotation11+b._rotation12*p._rotation21,h=b._rotation10*p._rotation02+b._rotation11*p._rotation12+b._rotation12*p._rotation22,l=b._rotation20*p._rotation00+b._rotation21*p._rotation10+b._rotation22*p._rotation20,c=b._rotation20*p._rotation01+b._rotation21*p._rotation11+b._rotation22*p._rotation21,m=b._rotation20*p._rotation02+b._rotation21*p._rotation12+b._rotation22*p._rotation22,u._rotation00=o,u._rotation01=s,u._rotation02=r,u._rotation10=e,u._rotation11=_,u._rotation12=h,u._rotation20=l,u._rotation21=c,u._rotation22=m;var x,y,d;x=b._rotation00*p._positionX+b._rotation01*p._positionY+b._rotation02*p._positionZ,y=b._rotation10*p._positionX+b._rotation11*p._positionY+b._rotation12*p._positionZ,d=b._rotation20*p._positionX+b._rotation21*p._positionY+b._rotation22*p._positionZ,u._positionX=x,u._positionY=y,u._positionZ=d,u._positionX+=b._positionX,u._positionY+=b._positionY,u._positionZ+=b._positionZ;var g,X,Y,z,Z,M,I,V,w,L=n._transform,k=n._localTransform;g=f._rotation00*k._rotation00+f._rotation01*k._rotation10+f._rotation02*k._rotation20,X=f._rotation00*k._rotation01+f._rotation01*k._rotation11+f._rotation02*k._rotation21,Y=f._rotation00*k._rotation02+f._rotation01*k._rotation12+f._rotation02*k._rotation22,z=f._rotation10*k._rotation00+f._rotation11*k._rotation10+f._rotation12*k._rotation20,Z=f._rotation10*k._rotation01+f._rotation11*k._rotation11+f._rotation12*k._rotation21,M=f._rotation10*k._rotation02+f._rotation11*k._rotation12+f._rotation12*k._rotation22,I=f._rotation20*k._rotation00+f._rotation21*k._rotation10+f._rotation22*k._rotation20,V=f._rotation20*k._rotation01+f._rotation21*k._rotation11+f._rotation22*k._rotation21,w=f._rotation20*k._rotation02+f._rotation21*k._rotation12+f._rotation22*k._rotation22,L._rotation00=g,L._rotation01=X,L._rotation02=Y,L._rotation10=z,L._rotation11=Z,L._rotation12=M,L._rotation20=I,L._rotation21=V,L._rotation22=w;var A,B,P;A=f._rotation00*k._positionX+f._rotation01*k._positionY+f._rotation02*k._positionZ,B=f._rotation10*k._positionX+f._rotation11*k._positionY+f._rotation12*k._positionZ,P=f._rotation20*k._positionX+f._rotation21*k._positionY+f._rotation22*k._positionZ,L._positionX=A,L._positionY=B,L._positionZ=P,L._positionX+=f._positionX,L._positionY+=f._positionY,L._positionZ+=f._positionZ;var S,T,C,j,R,E;if(n._geom._computeAabb(n._aabb,n._ptransform),S=n._aabb._minX,T=n._aabb._minY,C=n._aabb._minZ,j=n._aabb._maxX,R=n._aabb._maxY,E=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=S<n._aabb._minX?S:n._aabb._minX,n._aabb._minY=T<n._aabb._minY?T:n._aabb._minY,n._aabb._minZ=C<n._aabb._minZ?C:n._aabb._minZ,n._aabb._maxX=j>n._aabb._maxX?j:n._aabb._maxX,n._aabb._maxY=R>n._aabb._maxY?R:n._aabb._maxY,n._aabb._maxZ=E>n._aabb._maxZ?E:n._aabb._maxZ,null!=n._proxy){var q,D,N;q=n._transform._positionX-n._ptransform._positionX,D=n._transform._positionY-n._ptransform._positionY,N=n._transform._positionZ-n._ptransform._positionZ;var F=n.displacement;F.x=q,F.y=D,F.z=N,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=v}this._sleeping=!1,this._sleepTime=0},i.translate=function(t){var i,a,n;i=t.x,a=t.y,n=t.z,this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=n;var o=this._ptransform,s=this._transform;o._positionX=s._positionX,o._positionY=s._positionY,o._positionZ=s._positionZ,o._rotation00=s._rotation00,o._rotation01=s._rotation01,o._rotation02=s._rotation02,o._rotation10=s._rotation10,o._rotation11=s._rotation11,o._rotation12=s._rotation12,o._rotation20=s._rotation20,o._rotation21=s._rotation21,o._rotation22=s._rotation22;for(var r=this._shapeList;null!=r;){var e,_,h,l,c,m,v,b,f,u=r._next,p=this._ptransform,x=this._transform,y=r._ptransform,d=r._localTransform;e=p._rotation00*d._rotation00+p._rotation01*d._rotation10+p._rotation02*d._rotation20,_=p._rotation00*d._rotation01+p._rotation01*d._rotation11+p._rotation02*d._rotation21,h=p._rotation00*d._rotation02+p._rotation01*d._rotation12+p._rotation02*d._rotation22,l=p._rotation10*d._rotation00+p._rotation11*d._rotation10+p._rotation12*d._rotation20,c=p._rotation10*d._rotation01+p._rotation11*d._rotation11+p._rotation12*d._rotation21,m=p._rotation10*d._rotation02+p._rotation11*d._rotation12+p._rotation12*d._rotation22,v=p._rotation20*d._rotation00+p._rotation21*d._rotation10+p._rotation22*d._rotation20,b=p._rotation20*d._rotation01+p._rotation21*d._rotation11+p._rotation22*d._rotation21,f=p._rotation20*d._rotation02+p._rotation21*d._rotation12+p._rotation22*d._rotation22,y._rotation00=e,y._rotation01=_,y._rotation02=h,y._rotation10=l,y._rotation11=c,y._rotation12=m,y._rotation20=v,y._rotation21=b,y._rotation22=f;var g,X,Y;g=p._rotation00*d._positionX+p._rotation01*d._positionY+p._rotation02*d._positionZ,X=p._rotation10*d._positionX+p._rotation11*d._positionY+p._rotation12*d._positionZ,Y=p._rotation20*d._positionX+p._rotation21*d._positionY+p._rotation22*d._positionZ,y._positionX=g,y._positionY=X,y._positionZ=Y,y._positionX+=p._positionX,y._positionY+=p._positionY,y._positionZ+=p._positionZ;var z,Z,M,I,V,w,L,k,A,B=r._transform,P=r._localTransform;z=x._rotation00*P._rotation00+x._rotation01*P._rotation10+x._rotation02*P._rotation20,Z=x._rotation00*P._rotation01+x._rotation01*P._rotation11+x._rotation02*P._rotation21,M=x._rotation00*P._rotation02+x._rotation01*P._rotation12+x._rotation02*P._rotation22,I=x._rotation10*P._rotation00+x._rotation11*P._rotation10+x._rotation12*P._rotation20,V=x._rotation10*P._rotation01+x._rotation11*P._rotation11+x._rotation12*P._rotation21,w=x._rotation10*P._rotation02+x._rotation11*P._rotation12+x._rotation12*P._rotation22,L=x._rotation20*P._rotation00+x._rotation21*P._rotation10+x._rotation22*P._rotation20,k=x._rotation20*P._rotation01+x._rotation21*P._rotation11+x._rotation22*P._rotation21,A=x._rotation20*P._rotation02+x._rotation21*P._rotation12+x._rotation22*P._rotation22,B._rotation00=z,B._rotation01=Z,B._rotation02=M,B._rotation10=I,B._rotation11=V,B._rotation12=w,B._rotation20=L,B._rotation21=k,B._rotation22=A;var S,T,C;S=x._rotation00*P._positionX+x._rotation01*P._positionY+x._rotation02*P._positionZ,T=x._rotation10*P._positionX+x._rotation11*P._positionY+x._rotation12*P._positionZ,C=x._rotation20*P._positionX+x._rotation21*P._positionY+x._rotation22*P._positionZ,B._positionX=S,B._positionY=T,B._positionZ=C,B._positionX+=x._positionX,B._positionY+=x._positionY,B._positionZ+=x._positionZ;var j,R,E,q,D,N;if(r._geom._computeAabb(r._aabb,r._ptransform),j=r._aabb._minX,R=r._aabb._minY,E=r._aabb._minZ,q=r._aabb._maxX,D=r._aabb._maxY,N=r._aabb._maxZ,r._geom._computeAabb(r._aabb,r._transform),r._aabb._minX=j<r._aabb._minX?j:r._aabb._minX,r._aabb._minY=R<r._aabb._minY?R:r._aabb._minY,r._aabb._minZ=E<r._aabb._minZ?E:r._aabb._minZ,r._aabb._maxX=q>r._aabb._maxX?q:r._aabb._maxX,r._aabb._maxY=D>r._aabb._maxY?D:r._aabb._maxY,r._aabb._maxZ=N>r._aabb._maxZ?N:r._aabb._maxZ,null!=r._proxy){var F,G,J;F=r._transform._positionX-r._ptransform._positionX,G=r._transform._positionY-r._ptransform._positionY,J=r._transform._positionZ-r._ptransform._positionZ;var W=r.displacement;W.x=F,W.y=G,W.z=J,r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=u}this._sleeping=!1,this._sleepTime=0},i.getRotation=function(){var t=new r.common.Mat3;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,t},i.getRotationTo=function(t){t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22},i.setRotation=function(t){var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=n,this._invInertia10=o,this._invInertia11=s,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,f=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,p=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=f,this._invInertia20=u,this._invInertia21=p,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var y=this._ptransform,d=this._transform;y._positionX=d._positionX,y._positionY=d._positionY,y._positionZ=d._positionZ,y._rotation00=d._rotation00,y._rotation01=d._rotation01,y._rotation02=d._rotation02,y._rotation10=d._rotation10,y._rotation11=d._rotation11,y._rotation12=d._rotation12,y._rotation20=d._rotation20,y._rotation21=d._rotation21,y._rotation22=d._rotation22;for(var g=this._shapeList;null!=g;){var X,Y,z,Z,M,I,V,w,L,k=g._next,A=this._ptransform,B=this._transform,P=g._ptransform,S=g._localTransform;X=A._rotation00*S._rotation00+A._rotation01*S._rotation10+A._rotation02*S._rotation20,Y=A._rotation00*S._rotation01+A._rotation01*S._rotation11+A._rotation02*S._rotation21,z=A._rotation00*S._rotation02+A._rotation01*S._rotation12+A._rotation02*S._rotation22,Z=A._rotation10*S._rotation00+A._rotation11*S._rotation10+A._rotation12*S._rotation20,M=A._rotation10*S._rotation01+A._rotation11*S._rotation11+A._rotation12*S._rotation21,I=A._rotation10*S._rotation02+A._rotation11*S._rotation12+A._rotation12*S._rotation22,V=A._rotation20*S._rotation00+A._rotation21*S._rotation10+A._rotation22*S._rotation20,w=A._rotation20*S._rotation01+A._rotation21*S._rotation11+A._rotation22*S._rotation21,L=A._rotation20*S._rotation02+A._rotation21*S._rotation12+A._rotation22*S._rotation22,P._rotation00=X,P._rotation01=Y,P._rotation02=z,P._rotation10=Z,P._rotation11=M,P._rotation12=I,P._rotation20=V,P._rotation21=w,P._rotation22=L;var T,C,j;T=A._rotation00*S._positionX+A._rotation01*S._positionY+A._rotation02*S._positionZ,C=A._rotation10*S._positionX+A._rotation11*S._positionY+A._rotation12*S._positionZ,j=A._rotation20*S._positionX+A._rotation21*S._positionY+A._rotation22*S._positionZ,P._positionX=T,P._positionY=C,P._positionZ=j,P._positionX+=A._positionX,P._positionY+=A._positionY,P._positionZ+=A._positionZ;var R,E,q,D,N,F,G,J,W,O=g._transform,U=g._localTransform;R=B._rotation00*U._rotation00+B._rotation01*U._rotation10+B._rotation02*U._rotation20,E=B._rotation00*U._rotation01+B._rotation01*U._rotation11+B._rotation02*U._rotation21,q=B._rotation00*U._rotation02+B._rotation01*U._rotation12+B._rotation02*U._rotation22,D=B._rotation10*U._rotation00+B._rotation11*U._rotation10+B._rotation12*U._rotation20,N=B._rotation10*U._rotation01+B._rotation11*U._rotation11+B._rotation12*U._rotation21,F=B._rotation10*U._rotation02+B._rotation11*U._rotation12+B._rotation12*U._rotation22,G=B._rotation20*U._rotation00+B._rotation21*U._rotation10+B._rotation22*U._rotation20,J=B._rotation20*U._rotation01+B._rotation21*U._rotation11+B._rotation22*U._rotation21,W=B._rotation20*U._rotation02+B._rotation21*U._rotation12+B._rotation22*U._rotation22,O._rotation00=R,O._rotation01=E,O._rotation02=q,O._rotation10=D,O._rotation11=N,O._rotation12=F,O._rotation20=G,O._rotation21=J,O._rotation22=W;var H,Q,K;H=B._rotation00*U._positionX+B._rotation01*U._positionY+B._rotation02*U._positionZ,Q=B._rotation10*U._positionX+B._rotation11*U._positionY+B._rotation12*U._positionZ,K=B._rotation20*U._positionX+B._rotation21*U._positionY+B._rotation22*U._positionZ,O._positionX=H,O._positionY=Q,O._positionZ=K,O._positionX+=B._positionX,O._positionY+=B._positionY,O._positionZ+=B._positionZ;var $,tt,it,at,nt,ot;if(g._geom._computeAabb(g._aabb,g._ptransform),$=g._aabb._minX,tt=g._aabb._minY,it=g._aabb._minZ,at=g._aabb._maxX,nt=g._aabb._maxY,ot=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=$<g._aabb._minX?$:g._aabb._minX,g._aabb._minY=tt<g._aabb._minY?tt:g._aabb._minY,g._aabb._minZ=it<g._aabb._minZ?it:g._aabb._minZ,g._aabb._maxX=at>g._aabb._maxX?at:g._aabb._maxX,g._aabb._maxY=nt>g._aabb._maxY?nt:g._aabb._maxY,g._aabb._maxZ=ot>g._aabb._maxZ?ot:g._aabb._maxZ,null!=g._proxy){var st,rt,et;st=g._transform._positionX-g._ptransform._positionX,rt=g._transform._positionY-g._ptransform._positionY,et=g._transform._positionZ-g._ptransform._positionZ;var _t=g.displacement;_t.x=st,_t.y=rt,_t.z=et,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=k}this._sleeping=!1,this._sleepTime=0},i.setRotationXyz=function(t){var i,a,n;i=t.x,a=t.y,n=t.z;var o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X=Math.sin(i),Y=Math.sin(a),z=Math.sin(n),Z=Math.cos(i),M=Math.cos(a),I=Math.cos(n);this._transform._rotation00=M*I,this._transform._rotation01=-M*z,this._transform._rotation02=Y,this._transform._rotation10=Z*z+I*X*Y,this._transform._rotation11=Z*I-X*Y*z,this._transform._rotation12=-M*X,this._transform._rotation20=X*z-Z*I*Y,this._transform._rotation21=I*X+Z*Y*z,this._transform._rotation22=Z*M,o=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,r=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,e=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,l=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,c=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,m=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=o,this._invInertia01=s,this._invInertia02=r,this._invInertia10=e,this._invInertia11=_,this._invInertia12=h,this._invInertia20=l,this._invInertia21=c,this._invInertia22=m,v=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,u=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,y=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,d=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,g=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=v,this._invInertia01=b,this._invInertia02=f,this._invInertia10=u,this._invInertia11=p,this._invInertia12=x,this._invInertia20=y,this._invInertia21=d,this._invInertia22=g,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var V=this._ptransform,w=this._transform;V._positionX=w._positionX,V._positionY=w._positionY,V._positionZ=w._positionZ,V._rotation00=w._rotation00,V._rotation01=w._rotation01,V._rotation02=w._rotation02,V._rotation10=w._rotation10,V._rotation11=w._rotation11,V._rotation12=w._rotation12,V._rotation20=w._rotation20,V._rotation21=w._rotation21,V._rotation22=w._rotation22;for(var L=this._shapeList;null!=L;){var k,A,B,P,S,T,C,j,R,E=L._next,q=this._ptransform,D=this._transform,N=L._ptransform,F=L._localTransform;k=q._rotation00*F._rotation00+q._rotation01*F._rotation10+q._rotation02*F._rotation20,A=q._rotation00*F._rotation01+q._rotation01*F._rotation11+q._rotation02*F._rotation21,B=q._rotation00*F._rotation02+q._rotation01*F._rotation12+q._rotation02*F._rotation22,P=q._rotation10*F._rotation00+q._rotation11*F._rotation10+q._rotation12*F._rotation20,S=q._rotation10*F._rotation01+q._rotation11*F._rotation11+q._rotation12*F._rotation21,T=q._rotation10*F._rotation02+q._rotation11*F._rotation12+q._rotation12*F._rotation22,C=q._rotation20*F._rotation00+q._rotation21*F._rotation10+q._rotation22*F._rotation20,j=q._rotation20*F._rotation01+q._rotation21*F._rotation11+q._rotation22*F._rotation21,R=q._rotation20*F._rotation02+q._rotation21*F._rotation12+q._rotation22*F._rotation22,N._rotation00=k,N._rotation01=A,N._rotation02=B,N._rotation10=P,N._rotation11=S,N._rotation12=T,N._rotation20=C,N._rotation21=j,N._rotation22=R;var G,J,W;G=q._rotation00*F._positionX+q._rotation01*F._positionY+q._rotation02*F._positionZ,J=q._rotation10*F._positionX+q._rotation11*F._positionY+q._rotation12*F._positionZ,W=q._rotation20*F._positionX+q._rotation21*F._positionY+q._rotation22*F._positionZ,N._positionX=G,N._positionY=J,N._positionZ=W,N._positionX+=q._positionX,N._positionY+=q._positionY,N._positionZ+=q._positionZ;var O,U,H,Q,K,$,tt,it,at,nt=L._transform,ot=L._localTransform;O=D._rotation00*ot._rotation00+D._rotation01*ot._rotation10+D._rotation02*ot._rotation20,U=D._rotation00*ot._rotation01+D._rotation01*ot._rotation11+D._rotation02*ot._rotation21,H=D._rotation00*ot._rotation02+D._rotation01*ot._rotation12+D._rotation02*ot._rotation22,Q=D._rotation10*ot._rotation00+D._rotation11*ot._rotation10+D._rotation12*ot._rotation20,K=D._rotation10*ot._rotation01+D._rotation11*ot._rotation11+D._rotation12*ot._rotation21,$=D._rotation10*ot._rotation02+D._rotation11*ot._rotation12+D._rotation12*ot._rotation22,tt=D._rotation20*ot._rotation00+D._rotation21*ot._rotation10+D._rotation22*ot._rotation20,it=D._rotation20*ot._rotation01+D._rotation21*ot._rotation11+D._rotation22*ot._rotation21,at=D._rotation20*ot._rotation02+D._rotation21*ot._rotation12+D._rotation22*ot._rotation22,nt._rotation00=O,nt._rotation01=U,nt._rotation02=H,nt._rotation10=Q,nt._rotation11=K,nt._rotation12=$,nt._rotation20=tt,nt._rotation21=it,nt._rotation22=at;var st,rt,et;st=D._rotation00*ot._positionX+D._rotation01*ot._positionY+D._rotation02*ot._positionZ,rt=D._rotation10*ot._positionX+D._rotation11*ot._positionY+D._rotation12*ot._positionZ,et=D._rotation20*ot._positionX+D._rotation21*ot._positionY+D._rotation22*ot._positionZ,nt._positionX=st,nt._positionY=rt,nt._positionZ=et,nt._positionX+=D._positionX,nt._positionY+=D._positionY,nt._positionZ+=D._positionZ;var _t,ht,lt,ct,mt,vt;if(L._geom._computeAabb(L._aabb,L._ptransform),_t=L._aabb._minX,ht=L._aabb._minY,lt=L._aabb._minZ,ct=L._aabb._maxX,mt=L._aabb._maxY,vt=L._aabb._maxZ,L._geom._computeAabb(L._aabb,L._transform),L._aabb._minX=_t<L._aabb._minX?_t:L._aabb._minX,L._aabb._minY=ht<L._aabb._minY?ht:L._aabb._minY,L._aabb._minZ=lt<L._aabb._minZ?lt:L._aabb._minZ,L._aabb._maxX=ct>L._aabb._maxX?ct:L._aabb._maxX,L._aabb._maxY=mt>L._aabb._maxY?mt:L._aabb._maxY,L._aabb._maxZ=vt>L._aabb._maxZ?vt:L._aabb._maxZ,null!=L._proxy){var bt,ft,ut;bt=L._transform._positionX-L._ptransform._positionX,ft=L._transform._positionY-L._ptransform._positionY,ut=L._transform._positionZ-L._ptransform._positionZ;var pt=L.displacement;pt.x=bt,pt.y=ft,pt.z=ut,L._rigidBody._world._broadPhase.moveProxy(L._proxy,L._aabb,L.displacement)}L=E}this._sleeping=!1,this._sleepTime=0},i.rotate=function(t){var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T;i=t.e00,a=t.e01,n=t.e02,o=t.e10,s=t.e11,r=t.e12,e=t.e20,_=t.e21,h=t.e22,l=i*this._transform._rotation00+a*this._transform._rotation10+n*this._transform._rotation20,c=i*this._transform._rotation01+a*this._transform._rotation11+n*this._transform._rotation21,m=i*this._transform._rotation02+a*this._transform._rotation12+n*this._transform._rotation22,v=o*this._transform._rotation00+s*this._transform._rotation10+r*this._transform._rotation20,b=o*this._transform._rotation01+s*this._transform._rotation11+r*this._transform._rotation21,f=o*this._transform._rotation02+s*this._transform._rotation12+r*this._transform._rotation22,u=e*this._transform._rotation00+_*this._transform._rotation10+h*this._transform._rotation20,p=e*this._transform._rotation01+_*this._transform._rotation11+h*this._transform._rotation21,x=e*this._transform._rotation02+_*this._transform._rotation12+h*this._transform._rotation22,this._transform._rotation00=l,this._transform._rotation01=c,this._transform._rotation02=m,this._transform._rotation10=v,this._transform._rotation11=b,this._transform._rotation12=f,this._transform._rotation20=u,this._transform._rotation21=p,this._transform._rotation22=x,y=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,d=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,g=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,X=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Y=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,z=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,M=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,I=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=y,this._invInertia01=d,this._invInertia02=g,this._invInertia10=X,this._invInertia11=Y,this._invInertia12=z,this._invInertia20=Z,this._invInertia21=M,this._invInertia22=I,V=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,w=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,L=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,k=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,A=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,B=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,P=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,S=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,T=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=V,this._invInertia01=w,this._invInertia02=L,this._invInertia10=k,this._invInertia11=A,this._invInertia12=B,this._invInertia20=P,this._invInertia21=S,this._invInertia22=T,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var C=this._ptransform,j=this._transform;C._positionX=j._positionX,C._positionY=j._positionY,C._positionZ=j._positionZ,C._rotation00=j._rotation00,C._rotation01=j._rotation01,C._rotation02=j._rotation02,C._rotation10=j._rotation10,C._rotation11=j._rotation11,C._rotation12=j._rotation12,C._rotation20=j._rotation20,C._rotation21=j._rotation21,C._rotation22=j._rotation22;for(var R=this._shapeList;null!=R;){var E,q,D,N,F,G,J,W,O,U=R._next,H=this._ptransform,Q=this._transform,K=R._ptransform,$=R._localTransform;E=H._rotation00*$._rotation00+H._rotation01*$._rotation10+H._rotation02*$._rotation20,q=H._rotation00*$._rotation01+H._rotation01*$._rotation11+H._rotation02*$._rotation21,D=H._rotation00*$._rotation02+H._rotation01*$._rotation12+H._rotation02*$._rotation22,N=H._rotation10*$._rotation00+H._rotation11*$._rotation10+H._rotation12*$._rotation20,F=H._rotation10*$._rotation01+H._rotation11*$._rotation11+H._rotation12*$._rotation21,G=H._rotation10*$._rotation02+H._rotation11*$._rotation12+H._rotation12*$._rotation22,J=H._rotation20*$._rotation00+H._rotation21*$._rotation10+H._rotation22*$._rotation20,W=H._rotation20*$._rotation01+H._rotation21*$._rotation11+H._rotation22*$._rotation21,O=H._rotation20*$._rotation02+H._rotation21*$._rotation12+H._rotation22*$._rotation22,K._rotation00=E,K._rotation01=q,K._rotation02=D,K._rotation10=N,K._rotation11=F,K._rotation12=G,K._rotation20=J,K._rotation21=W,K._rotation22=O;var tt,it,at;tt=H._rotation00*$._positionX+H._rotation01*$._positionY+H._rotation02*$._positionZ,it=H._rotation10*$._positionX+H._rotation11*$._positionY+H._rotation12*$._positionZ,at=H._rotation20*$._positionX+H._rotation21*$._positionY+H._rotation22*$._positionZ,K._positionX=tt,K._positionY=it,K._positionZ=at,K._positionX+=H._positionX,K._positionY+=H._positionY,K._positionZ+=H._positionZ;var nt,ot,st,rt,et,_t,ht,lt,ct,mt=R._transform,vt=R._localTransform;nt=Q._rotation00*vt._rotation00+Q._rotation01*vt._rotation10+Q._rotation02*vt._rotation20,ot=Q._rotation00*vt._rotation01+Q._rotation01*vt._rotation11+Q._rotation02*vt._rotation21,st=Q._rotation00*vt._rotation02+Q._rotation01*vt._rotation12+Q._rotation02*vt._rotation22,rt=Q._rotation10*vt._rotation00+Q._rotation11*vt._rotation10+Q._rotation12*vt._rotation20,et=Q._rotation10*vt._rotation01+Q._rotation11*vt._rotation11+Q._rotation12*vt._rotation21,_t=Q._rotation10*vt._rotation02+Q._rotation11*vt._rotation12+Q._rotation12*vt._rotation22,ht=Q._rotation20*vt._rotation00+Q._rotation21*vt._rotation10+Q._rotation22*vt._rotation20,lt=Q._rotation20*vt._rotation01+Q._rotation21*vt._rotation11+Q._rotation22*vt._rotation21,ct=Q._rotation20*vt._rotation02+Q._rotation21*vt._rotation12+Q._rotation22*vt._rotation22,mt._rotation00=nt,mt._rotation01=ot,mt._rotation02=st,mt._rotation10=rt,mt._rotation11=et,mt._rotation12=_t,mt._rotation20=ht,mt._rotation21=lt,mt._rotation22=ct;var bt,ft,ut;bt=Q._rotation00*vt._positionX+Q._rotation01*vt._positionY+Q._rotation02*vt._positionZ,ft=Q._rotation10*vt._positionX+Q._rotation11*vt._positionY+Q._rotation12*vt._positionZ,ut=Q._rotation20*vt._positionX+Q._rotation21*vt._positionY+Q._rotation22*vt._positionZ,mt._positionX=bt,mt._positionY=ft,mt._positionZ=ut,mt._positionX+=Q._positionX,mt._positionY+=Q._positionY,mt._positionZ+=Q._positionZ;var pt,xt,yt,dt,gt,Xt;if(R._geom._computeAabb(R._aabb,R._ptransform),pt=R._aabb._minX,xt=R._aabb._minY,yt=R._aabb._minZ,dt=R._aabb._maxX,gt=R._aabb._maxY,Xt=R._aabb._maxZ,R._geom._computeAabb(R._aabb,R._transform),R._aabb._minX=pt<R._aabb._minX?pt:R._aabb._minX,R._aabb._minY=xt<R._aabb._minY?xt:R._aabb._minY,R._aabb._minZ=yt<R._aabb._minZ?yt:R._aabb._minZ,R._aabb._maxX=dt>R._aabb._maxX?dt:R._aabb._maxX,R._aabb._maxY=gt>R._aabb._maxY?gt:R._aabb._maxY,R._aabb._maxZ=Xt>R._aabb._maxZ?Xt:R._aabb._maxZ,null!=R._proxy){var Yt,zt,Zt;Yt=R._transform._positionX-R._ptransform._positionX,zt=R._transform._positionY-R._ptransform._positionY,Zt=R._transform._positionZ-R._ptransform._positionZ;var Mt=R.displacement;Mt.x=Yt,Mt.y=zt,Mt.z=Zt,R._rigidBody._world._broadPhase.moveProxy(R._proxy,R._aabb,R.displacement)}R=U}this._sleeping=!1,this._sleepTime=0},i.rotateXyz=function(t){var i,a,n,o,s,r,e,_,h,l,c,m;i=t.x,a=t.y,n=t.z;var v,b,f,u,p,x,y,d,g,X,Y,z,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,E=Math.sin(i),q=Math.sin(a),D=Math.sin(n),N=Math.cos(i),F=Math.cos(a),G=Math.cos(n);s=-F*D,r=q,e=N*D+G*E*q,_=N*G-E*q*D,h=-F*E,l=E*D-N*G*q,c=G*E+N*q*D,m=N*F,v=(o=F*G)*this._transform._rotation00+s*this._transform._rotation10+r*this._transform._rotation20,b=o*this._transform._rotation01+s*this._transform._rotation11+r*this._transform._rotation21,f=o*this._transform._rotation02+s*this._transform._rotation12+r*this._transform._rotation22,u=e*this._transform._rotation00+_*this._transform._rotation10+h*this._transform._rotation20,p=e*this._transform._rotation01+_*this._transform._rotation11+h*this._transform._rotation21,x=e*this._transform._rotation02+_*this._transform._rotation12+h*this._transform._rotation22,y=l*this._transform._rotation00+c*this._transform._rotation10+m*this._transform._rotation20,d=l*this._transform._rotation01+c*this._transform._rotation11+m*this._transform._rotation21,g=l*this._transform._rotation02+c*this._transform._rotation12+m*this._transform._rotation22,this._transform._rotation00=v,this._transform._rotation01=b,this._transform._rotation02=f,this._transform._rotation10=u,this._transform._rotation11=p,this._transform._rotation12=x,this._transform._rotation20=y,this._transform._rotation21=d,this._transform._rotation22=g,X=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Z=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,M=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,I=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,V=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,w=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,L=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=X,this._invInertia01=Y,this._invInertia02=z,this._invInertia10=Z,this._invInertia11=M,this._invInertia12=I,this._invInertia20=V,this._invInertia21=w,this._invInertia22=L,k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,B=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,P=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,S=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,T=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,C=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,j=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,R=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=k,this._invInertia01=A,this._invInertia02=B,this._invInertia10=P,this._invInertia11=S,this._invInertia12=T,this._invInertia20=C,this._invInertia21=j,this._invInertia22=R,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var J=this._ptransform,W=this._transform;J._positionX=W._positionX,J._positionY=W._positionY,J._positionZ=W._positionZ,J._rotation00=W._rotation00,J._rotation01=W._rotation01,J._rotation02=W._rotation02,J._rotation10=W._rotation10,J._rotation11=W._rotation11,J._rotation12=W._rotation12,J._rotation20=W._rotation20,J._rotation21=W._rotation21,J._rotation22=W._rotation22;for(var O=this._shapeList;null!=O;){var U,H,Q,K,$,tt,it,at,nt,ot=O._next,st=this._ptransform,rt=this._transform,et=O._ptransform,_t=O._localTransform;U=st._rotation00*_t._rotation00+st._rotation01*_t._rotation10+st._rotation02*_t._rotation20,H=st._rotation00*_t._rotation01+st._rotation01*_t._rotation11+st._rotation02*_t._rotation21,Q=st._rotation00*_t._rotation02+st._rotation01*_t._rotation12+st._rotation02*_t._rotation22,K=st._rotation10*_t._rotation00+st._rotation11*_t._rotation10+st._rotation12*_t._rotation20,$=st._rotation10*_t._rotation01+st._rotation11*_t._rotation11+st._rotation12*_t._rotation21,tt=st._rotation10*_t._rotation02+st._rotation11*_t._rotation12+st._rotation12*_t._rotation22,it=st._rotation20*_t._rotation00+st._rotation21*_t._rotation10+st._rotation22*_t._rotation20,at=st._rotation20*_t._rotation01+st._rotation21*_t._rotation11+st._rotation22*_t._rotation21,nt=st._rotation20*_t._rotation02+st._rotation21*_t._rotation12+st._rotation22*_t._rotation22,et._rotation00=U,et._rotation01=H,et._rotation02=Q,et._rotation10=K,et._rotation11=$,et._rotation12=tt,et._rotation20=it,et._rotation21=at,et._rotation22=nt;var ht,lt,ct;ht=st._rotation00*_t._positionX+st._rotation01*_t._positionY+st._rotation02*_t._positionZ,lt=st._rotation10*_t._positionX+st._rotation11*_t._positionY+st._rotation12*_t._positionZ,ct=st._rotation20*_t._positionX+st._rotation21*_t._positionY+st._rotation22*_t._positionZ,et._positionX=ht,et._positionY=lt,et._positionZ=ct,et._positionX+=st._positionX,et._positionY+=st._positionY,et._positionZ+=st._positionZ;var mt,vt,bt,ft,ut,pt,xt,yt,dt,gt=O._transform,Xt=O._localTransform;mt=rt._rotation00*Xt._rotation00+rt._rotation01*Xt._rotation10+rt._rotation02*Xt._rotation20,vt=rt._rotation00*Xt._rotation01+rt._rotation01*Xt._rotation11+rt._rotation02*Xt._rotation21,bt=rt._rotation00*Xt._rotation02+rt._rotation01*Xt._rotation12+rt._rotation02*Xt._rotation22,ft=rt._rotation10*Xt._rotation00+rt._rotation11*Xt._rotation10+rt._rotation12*Xt._rotation20,ut=rt._rotation10*Xt._rotation01+rt._rotation11*Xt._rotation11+rt._rotation12*Xt._rotation21,pt=rt._rotation10*Xt._rotation02+rt._rotation11*Xt._rotation12+rt._rotation12*Xt._rotation22,xt=rt._rotation20*Xt._rotation00+rt._rotation21*Xt._rotation10+rt._rotation22*Xt._rotation20,yt=rt._rotation20*Xt._rotation01+rt._rotation21*Xt._rotation11+rt._rotation22*Xt._rotation21,dt=rt._rotation20*Xt._rotation02+rt._rotation21*Xt._rotation12+rt._rotation22*Xt._rotation22,gt._rotation00=mt,gt._rotation01=vt,gt._rotation02=bt,gt._rotation10=ft,gt._rotation11=ut,gt._rotation12=pt,gt._rotation20=xt,gt._rotation21=yt,gt._rotation22=dt;var Yt,zt,Zt;Yt=rt._rotation00*Xt._positionX+rt._rotation01*Xt._positionY+rt._rotation02*Xt._positionZ,zt=rt._rotation10*Xt._positionX+rt._rotation11*Xt._positionY+rt._rotation12*Xt._positionZ,Zt=rt._rotation20*Xt._positionX+rt._rotation21*Xt._positionY+rt._rotation22*Xt._positionZ,gt._positionX=Yt,gt._positionY=zt,gt._positionZ=Zt,gt._positionX+=rt._positionX,gt._positionY+=rt._positionY,gt._positionZ+=rt._positionZ;var Mt,It,Vt,wt,Lt,kt;if(O._geom._computeAabb(O._aabb,O._ptransform),Mt=O._aabb._minX,It=O._aabb._minY,Vt=O._aabb._minZ,wt=O._aabb._maxX,Lt=O._aabb._maxY,kt=O._aabb._maxZ,O._geom._computeAabb(O._aabb,O._transform),O._aabb._minX=Mt<O._aabb._minX?Mt:O._aabb._minX,O._aabb._minY=It<O._aabb._minY?It:O._aabb._minY,O._aabb._minZ=Vt<O._aabb._minZ?Vt:O._aabb._minZ,O._aabb._maxX=wt>O._aabb._maxX?wt:O._aabb._maxX,O._aabb._maxY=Lt>O._aabb._maxY?Lt:O._aabb._maxY,O._aabb._maxZ=kt>O._aabb._maxZ?kt:O._aabb._maxZ,null!=O._proxy){var At,Bt,Pt;At=O._transform._positionX-O._ptransform._positionX,Bt=O._transform._positionY-O._ptransform._positionY,Pt=O._transform._positionZ-O._ptransform._positionZ;var St=O.displacement;St.x=At,St.y=Bt,St.z=Pt,O._rigidBody._world._broadPhase.moveProxy(O._proxy,O._aabb,O.displacement)}O=ot}this._sleeping=!1,this._sleepTime=0},i.getOrientation=function(){var t,i,a,n,o,s=new r.common.Quat,e=this._transform._rotation00,_=this._transform._rotation11,h=this._transform._rotation22,l=e+_+h;return l>0?(n=.5*(o=Math.sqrt(l+1)),o=.5/o,t=(this._transform._rotation21-this._transform._rotation12)*o,i=(this._transform._rotation02-this._transform._rotation20)*o,a=(this._transform._rotation10-this._transform._rotation01)*o):e>_?e>h?(t=.5*(o=Math.sqrt(e-_-h+1)),o=.5/o,i=(this._transform._rotation01+this._transform._rotation10)*o,a=(this._transform._rotation02+this._transform._rotation20)*o,n=(this._transform._rotation21-this._transform._rotation12)*o):(a=.5*(o=Math.sqrt(h-e-_+1)),o=.5/o,t=(this._transform._rotation02+this._transform._rotation20)*o,i=(this._transform._rotation12+this._transform._rotation21)*o,n=(this._transform._rotation10-this._transform._rotation01)*o):_>h?(i=.5*(o=Math.sqrt(_-h-e+1)),o=.5/o,t=(this._transform._rotation01+this._transform._rotation10)*o,a=(this._transform._rotation12+this._transform._rotation21)*o,n=(this._transform._rotation02-this._transform._rotation20)*o):(a=.5*(o=Math.sqrt(h-e-_+1)),o=.5/o,t=(this._transform._rotation02+this._transform._rotation20)*o,i=(this._transform._rotation12+this._transform._rotation21)*o,n=(this._transform._rotation10-this._transform._rotation01)*o),s.x=t,s.y=i,s.z=a,s.w=n,s},i.getOrientationTo=function(t){var i,a,n,o,s,r=this._transform._rotation00,e=this._transform._rotation11,_=this._transform._rotation22,h=r+e+_;h>0?(o=.5*(s=Math.sqrt(h+1)),s=.5/s,i=(this._transform._rotation21-this._transform._rotation12)*s,a=(this._transform._rotation02-this._transform._rotation20)*s,n=(this._transform._rotation10-this._transform._rotation01)*s):r>e?r>_?(i=.5*(s=Math.sqrt(r-e-_+1)),s=.5/s,a=(this._transform._rotation01+this._transform._rotation10)*s,n=(this._transform._rotation02+this._transform._rotation20)*s,o=(this._transform._rotation21-this._transform._rotation12)*s):(n=.5*(s=Math.sqrt(_-r-e+1)),s=.5/s,i=(this._transform._rotation02+this._transform._rotation20)*s,a=(this._transform._rotation12+this._transform._rotation21)*s,o=(this._transform._rotation10-this._transform._rotation01)*s):e>_?(a=.5*(s=Math.sqrt(e-_-r+1)),s=.5/s,i=(this._transform._rotation01+this._transform._rotation10)*s,n=(this._transform._rotation12+this._transform._rotation21)*s,o=(this._transform._rotation02-this._transform._rotation20)*s):(n=.5*(s=Math.sqrt(_-r-e+1)),s=.5/s,i=(this._transform._rotation02+this._transform._rotation20)*s,a=(this._transform._rotation12+this._transform._rotation21)*s,o=(this._transform._rotation10-this._transform._rotation01)*s),t.x=i,t.y=a,t.z=n,t.w=o},i.setOrientation=function(t){i=t.x,a=t.y,n=t.z,o=t.w;var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y,d,g,X,Y=2*i,z=2*a,Z=2*n,M=i*Y,I=a*z,V=n*Z,w=i*z,L=a*Z,k=i*Z,A=o*Y,B=o*z,P=o*Z;this._transform._rotation00=1-I-V,this._transform._rotation01=w-P,this._transform._rotation02=k+B,this._transform._rotation10=w+P,this._transform._rotation11=1-M-V,this._transform._rotation12=L-A,this._transform._rotation20=k-B,this._transform._rotation21=L+A,this._transform._rotation22=1-M-I,s=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,e=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,m=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,v=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=s,this._invInertia01=r,this._invInertia02=e,this._invInertia10=_,this._invInertia11=h,this._invInertia12=l,this._invInertia20=c,this._invInertia21=m,this._invInertia22=v,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,f=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,u=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,p=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,d=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,g=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,X=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=f,this._invInertia02=u,this._invInertia10=p,this._invInertia11=x,this._invInertia12=y,this._invInertia20=d,this._invInertia21=g,this._invInertia22=X,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var S=this._ptransform,T=this._transform;S._positionX=T._positionX,S._positionY=T._positionY,S._positionZ=T._positionZ,S._rotation00=T._rotation00,S._rotation01=T._rotation01,S._rotation02=T._rotation02,S._rotation10=T._rotation10,S._rotation11=T._rotation11,S._rotation12=T._rotation12,S._rotation20=T._rotation20,S._rotation21=T._rotation21,S._rotation22=T._rotation22;for(var C=this._shapeList;null!=C;){var j,R,E,q,D,N,F,G,J,W=C._next,O=this._ptransform,U=this._transform,H=C._ptransform,Q=C._localTransform;j=O._rotation00*Q._rotation00+O._rotation01*Q._rotation10+O._rotation02*Q._rotation20,R=O._rotation00*Q._rotation01+O._rotation01*Q._rotation11+O._rotation02*Q._rotation21,E=O._rotation00*Q._rotation02+O._rotation01*Q._rotation12+O._rotation02*Q._rotation22,q=O._rotation10*Q._rotation00+O._rotation11*Q._rotation10+O._rotation12*Q._rotation20,D=O._rotation10*Q._rotation01+O._rotation11*Q._rotation11+O._rotation12*Q._rotation21,N=O._rotation10*Q._rotation02+O._rotation11*Q._rotation12+O._rotation12*Q._rotation22,F=O._rotation20*Q._rotation00+O._rotation21*Q._rotation10+O._rotation22*Q._rotation20,G=O._rotation20*Q._rotation01+O._rotation21*Q._rotation11+O._rotation22*Q._rotation21,J=O._rotation20*Q._rotation02+O._rotation21*Q._rotation12+O._rotation22*Q._rotation22,H._rotation00=j,H._rotation01=R,H._rotation02=E,H._rotation10=q,H._rotation11=D,H._rotation12=N,H._rotation20=F,H._rotation21=G,H._rotation22=J;var K,$,tt;K=O._rotation00*Q._positionX+O._rotation01*Q._positionY+O._rotation02*Q._positionZ,$=O._rotation10*Q._positionX+O._rotation11*Q._positionY+O._rotation12*Q._positionZ,tt=O._rotation20*Q._positionX+O._rotation21*Q._positionY+O._rotation22*Q._positionZ,H._positionX=K,H._positionY=$,H._positionZ=tt,H._positionX+=O._positionX,H._positionY+=O._positionY,H._positionZ+=O._positionZ;var it,at,nt,ot,st,rt,et,_t,ht,lt=C._transform,ct=C._localTransform;it=U._rotation00*ct._rotation00+U._rotation01*ct._rotation10+U._rotation02*ct._rotation20,at=U._rotation00*ct._rotation01+U._rotation01*ct._rotation11+U._rotation02*ct._rotation21,nt=U._rotation00*ct._rotation02+U._rotation01*ct._rotation12+U._rotation02*ct._rotation22,ot=U._rotation10*ct._rotation00+U._rotation11*ct._rotation10+U._rotation12*ct._rotation20,st=U._rotation10*ct._rotation01+U._rotation11*ct._rotation11+U._rotation12*ct._rotation21,rt=U._rotation10*ct._rotation02+U._rotation11*ct._rotation12+U._rotation12*ct._rotation22,et=U._rotation20*ct._rotation00+U._rotation21*ct._rotation10+U._rotation22*ct._rotation20,_t=U._rotation20*ct._rotation01+U._rotation21*ct._rotation11+U._rotation22*ct._rotation21,ht=U._rotation20*ct._rotation02+U._rotation21*ct._rotation12+U._rotation22*ct._rotation22,lt._rotation00=it,lt._rotation01=at,lt._rotation02=nt,lt._rotation10=ot,lt._rotation11=st,lt._rotation12=rt,lt._rotation20=et,lt._rotation21=_t,lt._rotation22=ht;var mt,vt,bt;mt=U._rotation00*ct._positionX+U._rotation01*ct._positionY+U._rotation02*ct._positionZ,vt=U._rotation10*ct._positionX+U._rotation11*ct._positionY+U._rotation12*ct._positionZ,bt=U._rotation20*ct._positionX+U._rotation21*ct._positionY+U._rotation22*ct._positionZ,lt._positionX=mt,lt._positionY=vt,lt._positionZ=bt,lt._positionX+=U._positionX,lt._positionY+=U._positionY,lt._positionZ+=U._positionZ;var ft,ut,pt,xt,yt,dt;if(C._geom._computeAabb(C._aabb,C._ptransform),ft=C._aabb._minX,ut=C._aabb._minY,pt=C._aabb._minZ,xt=C._aabb._maxX,yt=C._aabb._maxY,dt=C._aabb._maxZ,C._geom._computeAabb(C._aabb,C._transform),C._aabb._minX=ft<C._aabb._minX?ft:C._aabb._minX,C._aabb._minY=ut<C._aabb._minY?ut:C._aabb._minY,C._aabb._minZ=pt<C._aabb._minZ?pt:C._aabb._minZ,C._aabb._maxX=xt>C._aabb._maxX?xt:C._aabb._maxX,C._aabb._maxY=yt>C._aabb._maxY?yt:C._aabb._maxY,C._aabb._maxZ=dt>C._aabb._maxZ?dt:C._aabb._maxZ,null!=C._proxy){var gt,Xt,Yt;gt=C._transform._positionX-C._ptransform._positionX,Xt=C._transform._positionY-C._ptransform._positionY,Yt=C._transform._positionZ-C._ptransform._positionZ;var zt=C.displacement;zt.x=gt,zt.y=Xt,zt.z=Yt,C._rigidBody._world._broadPhase.moveProxy(C._proxy,C._aabb,C.displacement)}C=W}this._sleeping=!1,this._sleepTime=0},i.getTransform=function(){var t=this._transform,i=new r.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i},i.getTransformTo=function(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22},i.setTransform=function(t){var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x;this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=n,this._invInertia10=o,this._invInertia11=s,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,f=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,p=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=f,this._invInertia20=u,this._invInertia21=p,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var y=this._ptransform,d=this._transform;y._positionX=d._positionX,y._positionY=d._positionY,y._positionZ=d._positionZ,y._rotation00=d._rotation00,y._rotation01=d._rotation01,y._rotation02=d._rotation02,y._rotation10=d._rotation10,y._rotation11=d._rotation11,y._rotation12=d._rotation12,y._rotation20=d._rotation20,y._rotation21=d._rotation21,y._rotation22=d._rotation22;for(var g=this._shapeList;null!=g;){var X,Y,z,Z,M,I,V,w,L,k=g._next,A=this._ptransform,B=this._transform,P=g._ptransform,S=g._localTransform;X=A._rotation00*S._rotation00+A._rotation01*S._rotation10+A._rotation02*S._rotation20,Y=A._rotation00*S._rotation01+A._rotation01*S._rotation11+A._rotation02*S._rotation21,z=A._rotation00*S._rotation02+A._rotation01*S._rotation12+A._rotation02*S._rotation22,Z=A._rotation10*S._rotation00+A._rotation11*S._rotation10+A._rotation12*S._rotation20,M=A._rotation10*S._rotation01+A._rotation11*S._rotation11+A._rotation12*S._rotation21,I=A._rotation10*S._rotation02+A._rotation11*S._rotation12+A._rotation12*S._rotation22,V=A._rotation20*S._rotation00+A._rotation21*S._rotation10+A._rotation22*S._rotation20,w=A._rotation20*S._rotation01+A._rotation21*S._rotation11+A._rotation22*S._rotation21,L=A._rotation20*S._rotation02+A._rotation21*S._rotation12+A._rotation22*S._rotation22,P._rotation00=X,P._rotation01=Y,P._rotation02=z,P._rotation10=Z,P._rotation11=M,P._rotation12=I,P._rotation20=V,P._rotation21=w,P._rotation22=L;var T,C,j;T=A._rotation00*S._positionX+A._rotation01*S._positionY+A._rotation02*S._positionZ,C=A._rotation10*S._positionX+A._rotation11*S._positionY+A._rotation12*S._positionZ,j=A._rotation20*S._positionX+A._rotation21*S._positionY+A._rotation22*S._positionZ,P._positionX=T,P._positionY=C,P._positionZ=j,P._positionX+=A._positionX,P._positionY+=A._positionY,P._positionZ+=A._positionZ;var R,E,q,D,N,F,G,J,W,O=g._transform,U=g._localTransform;R=B._rotation00*U._rotation00+B._rotation01*U._rotation10+B._rotation02*U._rotation20,E=B._rotation00*U._rotation01+B._rotation01*U._rotation11+B._rotation02*U._rotation21,q=B._rotation00*U._rotation02+B._rotation01*U._rotation12+B._rotation02*U._rotation22,D=B._rotation10*U._rotation00+B._rotation11*U._rotation10+B._rotation12*U._rotation20,N=B._rotation10*U._rotation01+B._rotation11*U._rotation11+B._rotation12*U._rotation21,F=B._rotation10*U._rotation02+B._rotation11*U._rotation12+B._rotation12*U._rotation22,G=B._rotation20*U._rotation00+B._rotation21*U._rotation10+B._rotation22*U._rotation20,J=B._rotation20*U._rotation01+B._rotation21*U._rotation11+B._rotation22*U._rotation21,W=B._rotation20*U._rotation02+B._rotation21*U._rotation12+B._rotation22*U._rotation22,O._rotation00=R,O._rotation01=E,O._rotation02=q,O._rotation10=D,O._rotation11=N,O._rotation12=F,O._rotation20=G,O._rotation21=J,O._rotation22=W;var H,Q,K;H=B._rotation00*U._positionX+B._rotation01*U._positionY+B._rotation02*U._positionZ,Q=B._rotation10*U._positionX+B._rotation11*U._positionY+B._rotation12*U._positionZ,K=B._rotation20*U._positionX+B._rotation21*U._positionY+B._rotation22*U._positionZ,O._positionX=H,O._positionY=Q,O._positionZ=K,O._positionX+=B._positionX,O._positionY+=B._positionY,O._positionZ+=B._positionZ;var $,tt,it,at,nt,ot;if(g._geom._computeAabb(g._aabb,g._ptransform),$=g._aabb._minX,tt=g._aabb._minY,it=g._aabb._minZ,at=g._aabb._maxX,nt=g._aabb._maxY,ot=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=$<g._aabb._minX?$:g._aabb._minX,g._aabb._minY=tt<g._aabb._minY?tt:g._aabb._minY,g._aabb._minZ=it<g._aabb._minZ?it:g._aabb._minZ,g._aabb._maxX=at>g._aabb._maxX?at:g._aabb._maxX,g._aabb._maxY=nt>g._aabb._maxY?nt:g._aabb._maxY,g._aabb._maxZ=ot>g._aabb._maxZ?ot:g._aabb._maxZ,null!=g._proxy){var st,rt,et;st=g._transform._positionX-g._ptransform._positionX,rt=g._transform._positionY-g._ptransform._positionY,et=g._transform._positionZ-g._ptransform._positionZ;var _t=g.displacement;_t.x=st,_t.y=rt,_t.z=et,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=k}this._sleeping=!1,this._sleepTime=0},i.getMass=function(){return this._mass},i.getLocalInertia=function(){var t=new r.common.Mat3;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,t},i.getLocalInertiaTo=function(t){t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22},i.getMassData=function(){var t=new r.dynamics.rigidbody.MassData;t.mass=this._mass;var i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t},i.getMassDataTo=function(t){t.mass=this._mass;var i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22},i.setMassData=function(t){this._mass=t.mass;var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y=t.localInertia;if(this._localInertia00=y.e00,this._localInertia01=y.e01,this._localInertia02=y.e02,this._localInertia10=y.e10,this._localInertia11=y.e11,this._localInertia12=y.e12,this._localInertia20=y.e20,this._localInertia21=y.e21,this._localInertia22=y.e22,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;var d=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,g=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,X=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,Y=this._localInertia00*d-this._localInertia01*g+this._localInertia02*X;(Y<-1e-32||Y>1e-32)&&(Y=1/Y),this._invLocalInertia00=d*Y,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*Y,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*Y,this._invLocalInertia10=-g*Y,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*Y,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*Y,this._invLocalInertia20=X*Y,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*Y,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*Y,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=n,this._invInertia10=o,this._invInertia11=s,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,f=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,p=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=f,this._invInertia20=u,this._invInertia21=p,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},i.getRotationFactor=function(){var t=this._rotFactor;return new r.common.Vec3(t.x,t.y,t.z)},i.setRotationFactor=function(t){var i,a,n,o,s,r,e,_,h,l,c,m,v,b,f,u,p,x,y=this._rotFactor;y.x=t.x,y.y=t.y,y.z=t.z,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=n,this._invInertia10=o,this._invInertia11=s,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,f=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,p=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=f,this._invInertia20=u,this._invInertia21=p,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},i.getLinearVelocity=function(){var t=new r.common.Vec3;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,t},i.getLinearVelocityTo=function(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ},i.setLinearVelocity=function(t){1==this._type?(this._velX=0,this._velY=0,this._velZ=0):(this._velX=t.x,this._velY=t.y,this._velZ=t.z),this._sleeping=!1,this._sleepTime=0},i.getAngularVelocity=function(){var t=new r.common.Vec3;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,t},i.getAngularVelocityTo=function(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ},i.setAngularVelocity=function(t){1==this._type?(this._angVelX=0,this._angVelY=0,this._angVelZ=0):(this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z),this._sleeping=!1,this._sleepTime=0},i.addLinearVelocity=function(t){var i,a,n;1!=this._type&&(i=t.x,a=t.y,n=t.z,this._velX+=i,this._velY+=a,this._velZ+=n);this._sleeping=!1,this._sleepTime=0},i.addAngularVelocity=function(t){var i,a,n;1!=this._type&&(i=t.x,a=t.y,n=t.z,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=n);this._sleeping=!1,this._sleepTime=0},i.applyImpulse=function(t,i){var a,n,o,s,r,e,_,h,l,c,m,v;a=t.x,n=t.y,o=t.z,this._velX+=a*this._invMass,this._velY+=n*this._invMass,this._velZ+=o*this._invMass,_=i.x,h=i.y,l=i.z,_-=this._transform._positionX,s=(h-=this._transform._positionY)*o-(l-=this._transform._positionZ)*n,r=l*a-_*o,e=_*n-h*a,c=this._invInertia00*s+this._invInertia01*r+this._invInertia02*e,m=this._invInertia10*s+this._invInertia11*r+this._invInertia12*e,v=this._invInertia20*s+this._invInertia21*r+this._invInertia22*e,s=c,r=m,e=v,this._angVelX+=s,this._angVelY+=r,this._angVelZ+=e,this._sleeping=!1,this._sleepTime=0},i.applyLinearImpulse=function(t){var i,a,n;i=t.x,a=t.y,n=t.z,this._velX+=i*this._invMass,this._velY+=a*this._invMass,this._velZ+=n*this._invMass,this._sleeping=!1,this._sleepTime=0},i.applyAngularImpulse=function(t){var i,a,n,o,s,r;i=t.x,a=t.y,n=t.z,o=this._invInertia00*i+this._invInertia01*a+this._invInertia02*n,s=this._invInertia10*i+this._invInertia11*a+this._invInertia12*n,r=this._invInertia20*i+this._invInertia21*a+this._invInertia22*n,i=o,a=s,n=r,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=n,this._sleeping=!1,this._sleepTime=0},i.applyForce=function(t,i){var a,n,o,s,r,e,_,h,l;a=t.x,n=t.y,o=t.z,this._forceX+=a,this._forceY+=n,this._forceZ+=o,_=i.x,h=i.y,l=i.z,_-=this._transform._positionX,s=(h-=this._transform._positionY)*o-(l-=this._transform._positionZ)*n,r=l*a-_*o,e=_*n-h*a,this._torqueX+=s,this._torqueY+=r,this._torqueZ+=e,this._sleeping=!1,this._sleepTime=0},i.applyForceToCenter=function(t){var i,a,n;i=t.x,a=t.y,n=t.z,this._forceX+=i,this._forceY+=a,this._forceZ+=n,this._sleeping=!1,this._sleepTime=0},i.applyTorque=function(t){var i,a,n;i=t.x,a=t.y,n=t.z,this._torqueX+=i,this._torqueY+=a,this._torqueZ+=n,this._sleeping=!1,this._sleepTime=0},i.getLinearContactImpulse=function(){var t=new r.common.Vec3;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,t},i.getLinearContactImpulseTo=function(t){t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ},i.getAngularContactImpulse=function(){var t=new r.common.Vec3;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,t},i.getAngularContactImpulseTo=function(t){t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ},i.getGravityScale=function(){return this._gravityScale},i.setGravityScale=function(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0},i.getLocalPoint=function(t){var i,a,n,o,s,e;i=t.x,a=t.y,n=t.z,i-=this._transform._positionX,a-=this._transform._positionY,n-=this._transform._positionZ,o=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*n,s=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*n,e=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*n,i=o,a=s,n=e;var _=new r.common.Vec3;return _.x=i,_.y=a,_.z=n,_},i.getLocalPointTo=function(t,i){var a,n,o,s,r,e;a=t.x,n=t.y,o=t.z,a-=this._transform._positionX,n-=this._transform._positionY,o-=this._transform._positionZ,s=this._transform._rotation00*a+this._transform._rotation10*n+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*n+this._transform._rotation21*o,e=this._transform._rotation02*a+this._transform._rotation12*n+this._transform._rotation22*o,a=s,n=r,o=e,i.x=a,i.y=n,i.z=o},i.getLocalVector=function(t){var i,a,n,o,s,e;i=t.x,a=t.y,n=t.z,o=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*n,s=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*n,e=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*n,i=o,a=s,n=e;var _=new r.common.Vec3;return _.x=i,_.y=a,_.z=n,_},i.getLocalVectorTo=function(t,i){var a,n,o,s,r,e;a=t.x,n=t.y,o=t.z,s=this._transform._rotation00*a+this._transform._rotation10*n+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*n+this._transform._rotation21*o,e=this._transform._rotation02*a+this._transform._rotation12*n+this._transform._rotation22*o,a=s,n=r,o=e,i.x=a,i.y=n,i.z=o},i.getWorldPoint=function(t){var i,a,n,o,s,e;i=t.x,a=t.y,n=t.z,o=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*n,s=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*n,e=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*n,i=o,a=s,n=e,i+=this._transform._positionX,a+=this._transform._positionY,n+=this._transform._positionZ;var _=new r.common.Vec3;return _.x=i,_.y=a,_.z=n,_},i.getWorldPointTo=function(t,i){var a,n,o,s,r,e;a=t.x,n=t.y,o=t.z,s=this._transform._rotation00*a+this._transform._rotation01*n+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*n+this._transform._rotation12*o,e=this._transform._rotation20*a+this._transform._rotation21*n+this._transform._rotation22*o,a=s,n=r,o=e,a+=this._transform._positionX,n+=this._transform._positionY,o+=this._transform._positionZ,i.x=a,i.y=n,i.z=o},i.getWorldVector=function(t){var i,a,n,o,s,e;i=t.x,a=t.y,n=t.z,o=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*n,s=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*n,e=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*n,i=o,a=s,n=e;var _=new r.common.Vec3;return _.x=i,_.y=a,_.z=n,_},i.getWorldVectorTo=function(t,i){var a,n,o,s,r,e;a=t.x,n=t.y,o=t.z,s=this._transform._rotation00*a+this._transform._rotation01*n+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*n+this._transform._rotation12*o,e=this._transform._rotation20*a+this._transform._rotation21*n+this._transform._rotation22*o,a=s,n=r,o=e,i.x=a,i.y=n,i.z=o},i.getNumShapes=function(){return this._numShapes},i.getShapeList=function(){return this._shapeList},i.getNumContectLinks=function(){return this._numContactLinks},i.getContactLinkList=function(){return this._contactLinkList},i.getNumJointLinks=function(){return this._numJointLinks},i.getJointLinkList=function(){return this._jointLinkList},i.addShape=function(t){if(null==this._shapeList?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,null!=this._world){var i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();for(var a=this._shapeList;null!=a;){var n,o,s,r,e,_,h,l,c,m=a._next,v=this._ptransform,b=this._transform,f=a._ptransform,u=a._localTransform;n=v._rotation00*u._rotation00+v._rotation01*u._rotation10+v._rotation02*u._rotation20,o=v._rotation00*u._rotation01+v._rotation01*u._rotation11+v._rotation02*u._rotation21,s=v._rotation00*u._rotation02+v._rotation01*u._rotation12+v._rotation02*u._rotation22,r=v._rotation10*u._rotation00+v._rotation11*u._rotation10+v._rotation12*u._rotation20,e=v._rotation10*u._rotation01+v._rotation11*u._rotation11+v._rotation12*u._rotation21,_=v._rotation10*u._rotation02+v._rotation11*u._rotation12+v._rotation12*u._rotation22,h=v._rotation20*u._rotation00+v._rotation21*u._rotation10+v._rotation22*u._rotation20,l=v._rotation20*u._rotation01+v._rotation21*u._rotation11+v._rotation22*u._rotation21,c=v._rotation20*u._rotation02+v._rotation21*u._rotation12+v._rotation22*u._rotation22,f._rotation00=n,f._rotation01=o,f._rotation02=s,f._rotation10=r,f._rotation11=e,f._rotation12=_,f._rotation20=h,f._rotation21=l,f._rotation22=c;var p,x,y;p=v._rotation00*u._positionX+v._rotation01*u._positionY+v._rotation02*u._positionZ,x=v._rotation10*u._positionX+v._rotation11*u._positionY+v._rotation12*u._positionZ,y=v._rotation20*u._positionX+v._rotation21*u._positionY+v._rotation22*u._positionZ,f._positionX=p,f._positionY=x,f._positionZ=y,f._positionX+=v._positionX,f._positionY+=v._positionY,f._positionZ+=v._positionZ;var d,g,X,Y,z,Z,M,I,V,w=a._transform,L=a._localTransform;d=b._rotation00*L._rotation00+b._rotation01*L._rotation10+b._rotation02*L._rotation20,g=b._rotation00*L._rotation01+b._rotation01*L._rotation11+b._rotation02*L._rotation21,X=b._rotation00*L._rotation02+b._rotation01*L._rotation12+b._rotation02*L._rotation22,Y=b._rotation10*L._rotation00+b._rotation11*L._rotation10+b._rotation12*L._rotation20,z=b._rotation10*L._rotation01+b._rotation11*L._rotation11+b._rotation12*L._rotation21,Z=b._rotation10*L._rotation02+b._rotation11*L._rotation12+b._rotation12*L._rotation22,M=b._rotation20*L._rotation00+b._rotation21*L._rotation10+b._rotation22*L._rotation20,I=b._rotation20*L._rotation01+b._rotation21*L._rotation11+b._rotation22*L._rotation21,V=b._rotation20*L._rotation02+b._rotation21*L._rotation12+b._rotation22*L._rotation22,w._rotation00=d,w._rotation01=g,w._rotation02=X,w._rotation10=Y,w._rotation11=z,w._rotation12=Z,w._rotation20=M,w._rotation21=I,w._rotation22=V;var k,A,B;k=b._rotation00*L._positionX+b._rotation01*L._positionY+b._rotation02*L._positionZ,A=b._rotation10*L._positionX+b._rotation11*L._positionY+b._rotation12*L._positionZ,B=b._rotation20*L._positionX+b._rotation21*L._positionY+b._rotation22*L._positionZ,w._positionX=k,w._positionY=A,w._positionZ=B,w._positionX+=b._positionX,w._positionY+=b._positionY,w._positionZ+=b._positionZ;var P,S,T,C,j,R;if(a._geom._computeAabb(a._aabb,a._ptransform),P=a._aabb._minX,S=a._aabb._minY,T=a._aabb._minZ,C=a._aabb._maxX,j=a._aabb._maxY,R=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=P<a._aabb._minX?P:a._aabb._minX,a._aabb._minY=S<a._aabb._minY?S:a._aabb._minY,a._aabb._minZ=T<a._aabb._minZ?T:a._aabb._minZ,a._aabb._maxX=C>a._aabb._maxX?C:a._aabb._maxX,a._aabb._maxY=j>a._aabb._maxY?j:a._aabb._maxY,a._aabb._maxZ=R>a._aabb._maxZ?R:a._aabb._maxZ,null!=a._proxy){var E,q,D;E=a._transform._positionX-a._ptransform._positionX,q=a._transform._positionY-a._ptransform._positionY,D=a._transform._positionZ-a._ptransform._positionZ;var N=a.displacement;N.x=E,N.y=q,N.z=D,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=m}},i.removeShape=function(t){var i=t._prev,a=t._next;if(null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,null!=this._world){var n=this._world;n._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;for(var o=t._rigidBody._contactLinkList;null!=o;){var s=o._next,r=o._contact;if(r._s1==t||r._s2==t){var e=o._other;e._sleeping=!1,e._sleepTime=0;var _=n._contactManager,h=r._prev,l=r._next;if(null!=h&&(h._next=l),null!=l&&(l._prev=h),r==_._contactList&&(_._contactList=_._contactList._next),r==_._contactListLast&&(_._contactListLast=_._contactListLast._prev),r._next=null,r._prev=null,r._touching){var c=r._s1._contactCallback,m=r._s2._contactCallback;c==m&&(m=null),null!=c&&c.endContact(r),null!=m&&m.endContact(r)}var v=r._link1._prev,b=r._link1._next;null!=v&&(v._next=b),null!=b&&(b._prev=v),r._link1==r._b1._contactLinkList&&(r._b1._contactLinkList=r._b1._contactLinkList._next),r._link1==r._b1._contactLinkListLast&&(r._b1._contactLinkListLast=r._b1._contactLinkListLast._prev),r._link1._next=null,r._link1._prev=null;var f=r._link2._prev,u=r._link2._next;null!=f&&(f._next=u),null!=u&&(u._prev=f),r._link2==r._b2._contactLinkList&&(r._b2._contactLinkList=r._b2._contactLinkList._next),r._link2==r._b2._contactLinkListLast&&(r._b2._contactLinkListLast=r._b2._contactLinkListLast._prev),r._link2._next=null,r._link2._prev=null,r._b1._numContactLinks--,r._b2._numContactLinks--,r._link1._other=null,r._link2._other=null,r._link1._contact=null,r._link2._contact=null,r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._touching=!1,r._cachedDetectorData._clear(),r._manifold._clear(),r._detector=null;var p=r._contactConstraint;p._s1=null,p._s2=null,p._b1=null,p._b2=null,p._tf1=null,p._tf2=null,r._next=_._contactPool,_._contactPool=r,_._numContacts--}o=s}n._numShapes--}this.updateMass();for(var x=this._shapeList;null!=x;){var y,d,g,X,Y,z,Z,M,I,V=x._next,w=this._ptransform,L=this._transform,k=x._ptransform,A=x._localTransform;y=w._rotation00*A._rotation00+w._rotation01*A._rotation10+w._rotation02*A._rotation20,d=w._rotation00*A._rotation01+w._rotation01*A._rotation11+w._rotation02*A._rotation21,g=w._rotation00*A._rotation02+w._rotation01*A._rotation12+w._rotation02*A._rotation22,X=w._rotation10*A._rotation00+w._rotation11*A._rotation10+w._rotation12*A._rotation20,Y=w._rotation10*A._rotation01+w._rotation11*A._rotation11+w._rotation12*A._rotation21,z=w._rotation10*A._rotation02+w._rotation11*A._rotation12+w._rotation12*A._rotation22,Z=w._rotation20*A._rotation00+w._rotation21*A._rotation10+w._rotation22*A._rotation20,M=w._rotation20*A._rotation01+w._rotation21*A._rotation11+w._rotation22*A._rotation21,I=w._rotation20*A._rotation02+w._rotation21*A._rotation12+w._rotation22*A._rotation22,k._rotation00=y,k._rotation01=d,k._rotation02=g,k._rotation10=X,k._rotation11=Y,k._rotation12=z,k._rotation20=Z,k._rotation21=M,k._rotation22=I;var B,P,S;B=w._rotation00*A._positionX+w._rotation01*A._positionY+w._rotation02*A._positionZ,P=w._rotation10*A._positionX+w._rotation11*A._positionY+w._rotation12*A._positionZ,S=w._rotation20*A._positionX+w._rotation21*A._positionY+w._rotation22*A._positionZ,k._positionX=B,k._positionY=P,k._positionZ=S,k._positionX+=w._positionX,k._positionY+=w._positionY,k._positionZ+=w._positionZ;var T,C,j,R,E,q,D,N,F,G=x._transform,J=x._localTransform;T=L._rotation00*J._rotation00+L._rotation01*J._rotation10+L._rotation02*J._rotation20,C=L._rotation00*J._rotation01+L._rotation01*J._rotation11+L._rotation02*J._rotation21,j=L._rotation00*J._rotation02+L._rotation01*J._rotation12+L._rotation02*J._rotation22,R=L._rotation10*J._rotation00+L._rotation11*J._rotation10+L._rotation12*J._rotation20,E=L._rotation10*J._rotation01+L._rotation11*J._rotation11+L._rotation12*J._rotation21,q=L._rotation10*J._rotation02+L._rotation11*J._rotation12+L._rotation12*J._rotation22,D=L._rotation20*J._rotation00+L._rotation21*J._rotation10+L._rotation22*J._rotation20,N=L._rotation20*J._rotation01+L._rotation21*J._rotation11+L._rotation22*J._rotation21,F=L._rotation20*J._rotation02+L._rotation21*J._rotation12+L._rotation22*J._rotation22,G._rotation00=T,G._rotation01=C,G._rotation02=j,G._rotation10=R,G._rotation11=E,G._rotation12=q,G._rotation20=D,G._rotation21=N,G._rotation22=F;var W,O,U;W=L._rotation00*J._positionX+L._rotation01*J._positionY+L._rotation02*J._positionZ,O=L._rotation10*J._positionX+L._rotation11*J._positionY+L._rotation12*J._positionZ,U=L._rotation20*J._positionX+L._rotation21*J._positionY+L._rotation22*J._positionZ,G._positionX=W,G._positionY=O,G._positionZ=U,G._positionX+=L._positionX,G._positionY+=L._positionY,G._positionZ+=L._positionZ;var H,Q,K,$,tt,it;if(x._geom._computeAabb(x._aabb,x._ptransform),H=x._aabb._minX,Q=x._aabb._minY,K=x._aabb._minZ,$=x._aabb._maxX,tt=x._aabb._maxY,it=x._aabb._maxZ,x._geom._computeAabb(x._aabb,x._transform),x._aabb._minX=H<x._aabb._minX?H:x._aabb._minX,x._aabb._minY=Q<x._aabb._minY?Q:x._aabb._minY,x._aabb._minZ=K<x._aabb._minZ?K:x._aabb._minZ,x._aabb._maxX=$>x._aabb._maxX?$:x._aabb._maxX,x._aabb._maxY=tt>x._aabb._maxY?tt:x._aabb._maxY,x._aabb._maxZ=it>x._aabb._maxZ?it:x._aabb._maxZ,null!=x._proxy){var at,nt,ot;at=x._transform._positionX-x._ptransform._positionX,nt=x._transform._positionY-x._ptransform._positionY,ot=x._transform._positionZ-x._ptransform._positionZ;var st=x.displacement;st.x=at,st.y=nt,st.z=ot,x._rigidBody._world._broadPhase.moveProxy(x._proxy,x._aabb,x.displacement)}x=V}},i.getType=function(){return this._type},i.setType=function(t){this._type=t,this.updateMass()},i.wakeUp=function(){this._sleeping=!1,this._sleepTime=0},i.sleep=function(){this._sleeping=!0,this._sleepTime=0},i.isSleeping=function(){return this._sleeping},i.getSleepTime=function(){return this._sleepTime},i.setAutoSleep=function(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0},i.getLinearDamping=function(){return this._linearDamping},i.setLinearDamping=function(t){this._linearDamping=t},i.getAngularDamping=function(){return this._angularDamping},i.setAngularDamping=function(t){this._angularDamping=t},i.getPrev=function(){return this._prev},i.getNext=function(){return this._next},t}(),r.dynamics.rigidbody.RigidBodyConfig=function(){this.position=new r.common.Vec3,this.rotation=new r.common.Mat3,this.linearVelocity=new r.common.Vec3,this.angularVelocity=new r.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0},r.dynamics.rigidbody.RigidBodyType=function(){},r.dynamics.rigidbody.Shape=function(){function t(t){this._id=-1,this._localTransform=new r.common.Transform,this._ptransform=new r.common.Transform,this._transform=new r.common.Transform;var i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;var a=t.rotation;this._localTransform._rotation00=a.e00,this._localTransform._rotation01=a.e01,this._localTransform._rotation02=a.e02,this._localTransform._rotation10=a.e10,this._localTransform._rotation11=a.e11,this._localTransform._rotation12=a.e12,this._localTransform._rotation20=a.e20,this._localTransform._rotation21=a.e21,this._localTransform._rotation22=a.e22;var n=this._ptransform,o=this._localTransform;n._positionX=o._positionX,n._positionY=o._positionY,n._positionZ=o._positionZ,n._rotation00=o._rotation00,n._rotation01=o._rotation01,n._rotation02=o._rotation02,n._rotation10=o._rotation10,n._rotation11=o._rotation11,n._rotation12=o._rotation12,n._rotation20=o._rotation20,n._rotation21=o._rotation21,n._rotation22=o._rotation22;var s=this._transform,e=this._localTransform;s._positionX=e._positionX,s._positionY=e._positionY,s._positionZ=e._positionZ,s._rotation00=e._rotation00,s._rotation01=e._rotation01,s._rotation02=e._rotation02,s._rotation10=e._rotation10,s._rotation11=e._rotation11,s._rotation12=e._rotation12,s._rotation20=e._rotation20,s._rotation21=e._rotation21,s._rotation22=e._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new r.collision.geometry.Aabb,this._proxy=null,this.displacement=new r.common.Vec3}var i=t.prototype;return i.getFriction=function(){return this._friction},i.setFriction=function(t){this._friction=t},i.getRestitution=function(){return this._restitution},i.setRestitution=function(t){this._restitution=t},i.getLocalTransform=function(){var t=this._localTransform,i=new r.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i},i.getLocalTransformTo=function(t){var i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22},i.getTransform=function(){var t=this._transform,i=new r.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i},i.getTransformTo=function(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22},i.setLocalTransform=function(t){var i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,null!=this._rigidBody){var a=this._rigidBody;a.updateMass();for(var n=a._shapeList;null!=n;){var o,s,r,e,_,h,l,c,m,v=n._next,b=a._ptransform,f=a._transform,u=n._ptransform,p=n._localTransform;o=b._rotation00*p._rotation00+b._rotation01*p._rotation10+b._rotation02*p._rotation20,s=b._rotation00*p._rotation01+b._rotation01*p._rotation11+b._rotation02*p._rotation21,r=b._rotation00*p._rotation02+b._rotation01*p._rotation12+b._rotation02*p._rotation22,e=b._rotation10*p._rotation00+b._rotation11*p._rotation10+b._rotation12*p._rotation20,_=b._rotation10*p._rotation01+b._rotation11*p._rotation11+b._rotation12*p._rotation21,h=b._rotation10*p._rotation02+b._rotation11*p._rotation12+b._rotation12*p._rotation22,l=b._rotation20*p._rotation00+b._rotation21*p._rotation10+b._rotation22*p._rotation20,c=b._rotation20*p._rotation01+b._rotation21*p._rotation11+b._rotation22*p._rotation21,m=b._rotation20*p._rotation02+b._rotation21*p._rotation12+b._rotation22*p._rotation22,u._rotation00=o,u._rotation01=s,u._rotation02=r,u._rotation10=e,u._rotation11=_,u._rotation12=h,u._rotation20=l,u._rotation21=c,u._rotation22=m;var x,y,d;x=b._rotation00*p._positionX+b._rotation01*p._positionY+b._rotation02*p._positionZ,y=b._rotation10*p._positionX+b._rotation11*p._positionY+b._rotation12*p._positionZ,d=b._rotation20*p._positionX+b._rotation21*p._positionY+b._rotation22*p._positionZ,u._positionX=x,u._positionY=y,u._positionZ=d,u._positionX+=b._positionX,u._positionY+=b._positionY,u._positionZ+=b._positionZ;var g,X,Y,z,Z,M,I,V,w,L=n._transform,k=n._localTransform;g=f._rotation00*k._rotation00+f._rotation01*k._rotation10+f._rotation02*k._rotation20,X=f._rotation00*k._rotation01+f._rotation01*k._rotation11+f._rotation02*k._rotation21,Y=f._rotation00*k._rotation02+f._rotation01*k._rotation12+f._rotation02*k._rotation22,z=f._rotation10*k._rotation00+f._rotation11*k._rotation10+f._rotation12*k._rotation20,Z=f._rotation10*k._rotation01+f._rotation11*k._rotation11+f._rotation12*k._rotation21,M=f._rotation10*k._rotation02+f._rotation11*k._rotation12+f._rotation12*k._rotation22,I=f._rotation20*k._rotation00+f._rotation21*k._rotation10+f._rotation22*k._rotation20,V=f._rotation20*k._rotation01+f._rotation21*k._rotation11+f._rotation22*k._rotation21,w=f._rotation20*k._rotation02+f._rotation21*k._rotation12+f._rotation22*k._rotation22,L._rotation00=g,L._rotation01=X,L._rotation02=Y,L._rotation10=z,L._rotation11=Z,L._rotation12=M,L._rotation20=I,L._rotation21=V,L._rotation22=w;var A,B,P;A=f._rotation00*k._positionX+f._rotation01*k._positionY+f._rotation02*k._positionZ,B=f._rotation10*k._positionX+f._rotation11*k._positionY+f._rotation12*k._positionZ,P=f._rotation20*k._positionX+f._rotation21*k._positionY+f._rotation22*k._positionZ,L._positionX=A,L._positionY=B,L._positionZ=P,L._positionX+=f._positionX,L._positionY+=f._positionY,L._positionZ+=f._positionZ;var S,T,C,j,R,E;if(n._geom._computeAabb(n._aabb,n._ptransform),S=n._aabb._minX,T=n._aabb._minY,C=n._aabb._minZ,j=n._aabb._maxX,R=n._aabb._maxY,E=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=S<n._aabb._minX?S:n._aabb._minX,n._aabb._minY=T<n._aabb._minY?T:n._aabb._minY,n._aabb._minZ=C<n._aabb._minZ?C:n._aabb._minZ,n._aabb._maxX=j>n._aabb._maxX?j:n._aabb._maxX,n._aabb._maxY=R>n._aabb._maxY?R:n._aabb._maxY,n._aabb._maxZ=E>n._aabb._maxZ?E:n._aabb._maxZ,null!=n._proxy){var q,D,N;q=n._transform._positionX-n._ptransform._positionX,D=n._transform._positionY-n._ptransform._positionY,N=n._transform._positionZ-n._ptransform._positionZ;var F=n.displacement;F.x=q,F.y=D,F.z=N,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=v}}},i.getDensity=function(){return this._density},i.setDensity=function(t){if(this._density=t,null!=this._rigidBody){var i=this._rigidBody;i.updateMass();for(var a=i._shapeList;null!=a;){var n,o,s,r,e,_,h,l,c,m=a._next,v=i._ptransform,b=i._transform,f=a._ptransform,u=a._localTransform;n=v._rotation00*u._rotation00+v._rotation01*u._rotation10+v._rotation02*u._rotation20,o=v._rotation00*u._rotation01+v._rotation01*u._rotation11+v._rotation02*u._rotation21,s=v._rotation00*u._rotation02+v._rotation01*u._rotation12+v._rotation02*u._rotation22,r=v._rotation10*u._rotation00+v._rotation11*u._rotation10+v._rotation12*u._rotation20,e=v._rotation10*u._rotation01+v._rotation11*u._rotation11+v._rotation12*u._rotation21,_=v._rotation10*u._rotation02+v._rotation11*u._rotation12+v._rotation12*u._rotation22,h=v._rotation20*u._rotation00+v._rotation21*u._rotation10+v._rotation22*u._rotation20,l=v._rotation20*u._rotation01+v._rotation21*u._rotation11+v._rotation22*u._rotation21,c=v._rotation20*u._rotation02+v._rotation21*u._rotation12+v._rotation22*u._rotation22,f._rotation00=n,f._rotation01=o,f._rotation02=s,f._rotation10=r,f._rotation11=e,f._rotation12=_,f._rotation20=h,f._rotation21=l,f._rotation22=c;var p,x,y;p=v._rotation00*u._positionX+v._rotation01*u._positionY+v._rotation02*u._positionZ,x=v._rotation10*u._positionX+v._rotation11*u._positionY+v._rotation12*u._positionZ,y=v._rotation20*u._positionX+v._rotation21*u._positionY+v._rotation22*u._positionZ,f._positionX=p,f._positionY=x,f._positionZ=y,f._positionX+=v._positionX,f._positionY+=v._positionY,f._positionZ+=v._positionZ;var d,g,X,Y,z,Z,M,I,V,w=a._transform,L=a._localTransform;d=b._rotation00*L._rotation00+b._rotation01*L._rotation10+b._rotation02*L._rotation20,g=b._rotation00*L._rotation01+b._rotation01*L._rotation11+b._rotation02*L._rotation21,X=b._rotation00*L._rotation02+b._rotation01*L._rotation12+b._rotation02*L._rotation22,Y=b._rotation10*L._rotation00+b._rotation11*L._rotation10+b._rotation12*L._rotation20,z=b._rotation10*L._rotation01+b._rotation11*L._rotation11+b._rotation12*L._rotation21,Z=b._rotation10*L._rotation02+b._rotation11*L._rotation12+b._rotation12*L._rotation22,M=b._rotation20*L._rotation00+b._rotation21*L._rotation10+b._rotation22*L._rotation20,I=b._rotation20*L._rotation01+b._rotation21*L._rotation11+b._rotation22*L._rotation21,V=b._rotation20*L._rotation02+b._rotation21*L._rotation12+b._rotation22*L._rotation22,w._rotation00=d,w._rotation01=g,w._rotation02=X,w._rotation10=Y,w._rotation11=z,w._rotation12=Z,w._rotation20=M,w._rotation21=I,w._rotation22=V;var k,A,B;k=b._rotation00*L._positionX+b._rotation01*L._positionY+b._rotation02*L._positionZ,A=b._rotation10*L._positionX+b._rotation11*L._positionY+b._rotation12*L._positionZ,B=b._rotation20*L._positionX+b._rotation21*L._positionY+b._rotation22*L._positionZ,w._positionX=k,w._positionY=A,w._positionZ=B,w._positionX+=b._positionX,w._positionY+=b._positionY,w._positionZ+=b._positionZ;var P,S,T,C,j,R;if(a._geom._computeAabb(a._aabb,a._ptransform),P=a._aabb._minX,S=a._aabb._minY,T=a._aabb._minZ,C=a._aabb._maxX,j=a._aabb._maxY,R=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=P<a._aabb._minX?P:a._aabb._minX,a._aabb._minY=S<a._aabb._minY?S:a._aabb._minY,a._aabb._minZ=T<a._aabb._minZ?T:a._aabb._minZ,a._aabb._maxX=C>a._aabb._maxX?C:a._aabb._maxX,a._aabb._maxY=j>a._aabb._maxY?j:a._aabb._maxY,a._aabb._maxZ=R>a._aabb._maxZ?R:a._aabb._maxZ,null!=a._proxy){var E,q,D;E=a._transform._positionX-a._ptransform._positionX,q=a._transform._positionY-a._ptransform._positionY,D=a._transform._positionZ-a._ptransform._positionZ;var N=a.displacement;N.x=E,N.y=q,N.z=D,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=m}}},i.getAabb=function(){return this._aabb.clone()},i.getAabbTo=function(t){t.copyFrom(this._aabb)},i.getGeometry=function(){return this._geom},i.getRigidBody=function(){return this._rigidBody},i.getCollisionGroup=function(){return this._collisionGroup},i.setCollisionGroup=function(t){this._collisionGroup=t},i.getCollisionMask=function(){return this._collisionMask},i.setCollisionMask=function(t){this._collisionMask=t},i.getContactCallback=function(){return this._contactCallback},i.setContactCallback=function(t){this._contactCallback=t},i.getPrev=function(){return this._prev},i.getNext=function(){return this._next},t}(),r.dynamics.rigidbody.ShapeConfig=function(){this.position=new r.common.Vec3,this.rotation=new r.common.Mat3,this.friction=r.common.Setting.defaultFriction,this.restitution=r.common.Setting.defaultRestitution,this.density=r.common.Setting.defaultDensity,this.collisionGroup=r.common.Setting.defaultCollisionGroup,this.collisionMask=r.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null},r.m||(r.m={}),r.m.M=function(){},r.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1,r.collision.broadphase.BroadPhaseType._BVH=2,r.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1,r.collision.broadphase.BroadPhaseType.BVH=2,r.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0,r.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1,r.collision.geometry.GeometryType._SPHERE=0,r.collision.geometry.GeometryType._BOX=1,r.collision.geometry.GeometryType._CYLINDER=2,r.collision.geometry.GeometryType._CONE=3,r.collision.geometry.GeometryType._CAPSULE=4,r.collision.geometry.GeometryType._CONVEX_HULL=5,r.collision.geometry.GeometryType._CONVEX_MIN=0,r.collision.geometry.GeometryType._CONVEX_MAX=5,r.collision.geometry.GeometryType.SPHERE=0,r.collision.geometry.GeometryType.BOX=1,r.collision.geometry.GeometryType.CYLINDER=2,r.collision.geometry.GeometryType.CONE=3,r.collision.geometry.GeometryType.CAPSULE=4,r.collision.geometry.GeometryType.CONVEX_HULL=5,r.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1,r.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0,r.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1,r.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2,r.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3,r.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4,r.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5,r.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6,r.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0,r.common.Vec3.numCreations=0,r.common.Setting.defaultFriction=.2,r.common.Setting.defaultRestitution=.2,r.common.Setting.defaultDensity=1,r.common.Setting.defaultCollisionGroup=1,r.common.Setting.defaultCollisionMask=1,r.common.Setting.maxTranslationPerStep=20,r.common.Setting.maxRotationPerStep=3.14159265358979,r.common.Setting.bvhProxyPadding=.1,r.common.Setting.bvhIncrementalCollisionThreshold=.45,r.common.Setting.defaultGJKMargin=.05,r.common.Setting.enableGJKCaching=!0,r.common.Setting.maxEPAVertices=128,r.common.Setting.maxEPAPolyhedronFaces=128,r.common.Setting.contactEnableBounceThreshold=.5,r.common.Setting.velocityBaumgarte=.2,r.common.Setting.positionSplitImpulseBaumgarte=.4,r.common.Setting.positionNgsBaumgarte=1,r.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,r.common.Setting.defaultContactPositionCorrectionAlgorithm=0,r.common.Setting.alternativeContactPositionCorrectionAlgorithm=1,r.common.Setting.contactPersistenceThreshold=.05,r.common.Setting.maxManifoldPoints=4,r.common.Setting.defaultJointConstraintSolverType=0,r.common.Setting.defaultJointPositionCorrectionAlgorithm=0,r.common.Setting.jointWarmStartingFactorForBaungarte=.8,r.common.Setting.jointWarmStartingFactor=.95,r.common.Setting.minSpringDamperDampingRatio=1e-6,r.common.Setting.minRagdollMaxSwingAngle=1e-6,r.common.Setting.maxJacobianRows=6,r.common.Setting.directMlcpSolverEps=1e-9,r.common.Setting.islandInitialRigidBodyArraySize=128,r.common.Setting.islandInitialConstraintArraySize=128,r.common.Setting.sleepingVelocityThreshold=.2,r.common.Setting.sleepingAngularVelocityThreshold=.5,r.common.Setting.sleepingTimeThreshold=1,r.common.Setting.disableSleeping=!1,r.common.Setting.linearSlop=.005,r.common.Setting.angularSlop=.017453292519943278,r.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new r.collision.narrowphase.detector.gjkepa.GjkEpa,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258,r.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259,r.common.Mat3.numCreations=0,r.common.Mat4.numCreations=0,r.common.MathUtil.POSITIVE_INFINITY=Infinity,r.common.MathUtil.NEGATIVE_INFINITY=-Infinity,r.common.MathUtil.PI=3.14159265358979,r.common.MathUtil.TWO_PI=6.28318530717958,r.common.MathUtil.HALF_PI=1.570796326794895,r.common.MathUtil.TO_RADIANS=.017453292519943278,r.common.MathUtil.TO_DEGREES=57.29577951308238,r.common.Quat.numCreations=0,r.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8,r.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4,r.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8,r.dynamics.common.Performance.broadPhaseCollisionTime=0,r.dynamics.common.Performance.narrowPhaseCollisionTime=0,r.dynamics.common.Performance.dynamicsTime=0,r.dynamics.common.Performance.totalTime=0,r.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0,r.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1,r.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2,r.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0,r.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1,r.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2,r.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1,r.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2,r.dynamics.constraint.joint.JointType._SPHERICAL=0,r.dynamics.constraint.joint.JointType._REVOLUTE=1,r.dynamics.constraint.joint.JointType._CYLINDRICAL=2,r.dynamics.constraint.joint.JointType._PRISMATIC=3,r.dynamics.constraint.joint.JointType._UNIVERSAL=4,r.dynamics.constraint.joint.JointType._RAGDOLL=5,r.dynamics.constraint.joint.JointType._GENERIC=6,r.dynamics.constraint.joint.JointType.SPHERICAL=0,r.dynamics.constraint.joint.JointType.REVOLUTE=1,r.dynamics.constraint.joint.JointType.CYLINDRICAL=2,r.dynamics.constraint.joint.JointType.PRISMATIC=3,r.dynamics.constraint.joint.JointType.UNIVERSAL=4,r.dynamics.constraint.joint.JointType.RAGDOLL=5,r.dynamics.constraint.joint.JointType.GENERIC=6,r.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0,r.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1,r.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0,r.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1,r.dynamics.rigidbody.RigidBodyType._DYNAMIC=0,r.dynamics.rigidbody.RigidBodyType._STATIC=1,r.dynamics.rigidbody.RigidBodyType._KINEMATIC=2,r.dynamics.rigidbody.RigidBodyType.DYNAMIC=0,r.dynamics.rigidbody.RigidBodyType.STATIC=1,r.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;var e=new Map,_={world:null,flow:{ray:[],tmp:[],key:[]}},h=Math.PI/180,l=function(){function t(){}return t.byName=function(t){return e.has(t)?e.get(t):null},t.add=function(t){switch(t.type){case"joint":_.world.addJoint(t);break;default:_.world.addRigidBody(t)}e.set(t.name,t)},t.remove=function(t){switch(t.type){case"joint":_.world.removeJoint(t);break;default:_.world.removeRigidBody(t)}e.delete(t.name)},t.stats=function(){},t}(),c=r.common.Vec3,m=r.common.Quat,v=r.common.Mat3;r.common.Mat4;var f=r.common.Transform,u=r.dynamics.World,p=r.dynamics.rigidbody.RigidBodyConfig,x=r.dynamics.rigidbody.ShapeConfig,y=r.dynamics.rigidbody.RigidBody,d=r.dynamics.rigidbody.Shape;r.collision.geometry.Aabb;var g=r.collision.geometry.BoxGeometry,X=r.collision.geometry.SphereGeometry,Y=r.collision.geometry.CylinderGeometry,z=r.collision.geometry.CapsuleGeometry,Z=r.collision.geometry.ConeGeometry;r.collision.geometry.RayCastHit,r.collision.geometry.ConvexGeometry;var M=r.collision.geometry.ConvexHullGeometry,I={RagdollJoint:r.dynamics.constraint.joint.RagdollJoint,UniversalJoint:r.dynamics.constraint.joint.UniversalJoint,GenericJoint:r.dynamics.constraint.joint.GenericJoint,PrismaticJoint:r.dynamics.constraint.joint.PrismaticJoint,RevoluteJoint:r.dynamics.constraint.joint.RevoluteJoint,CylindricalJoint:r.dynamics.constraint.joint.CylindricalJoint,SphericalJoint:r.dynamics.constraint.joint.SphericalJoint,RagdollJointConfig:r.dynamics.constraint.joint.RagdollJointConfig,UniversalJointConfig:r.dynamics.constraint.joint.UniversalJointConfig,GenericJointConfig:r.dynamics.constraint.joint.GenericJointConfig,PrismaticJointConfig:r.dynamics.constraint.joint.PrismaticJointConfig,RevoluteJointConfig:r.dynamics.constraint.joint.RevoluteJointConfig,CylindricalJointConfig:r.dynamics.constraint.joint.CylindricalJointConfig,SphericalJointConfig:r.dynamics.constraint.joint.SphericalJointConfig,RotationalLimitMotor:r.dynamics.constraint.joint.RotationalLimitMotor,TranslationalLimitMotor:r.dynamics.constraint.joint.TranslationalLimitMotor,SpringDamper:r.dynamics.constraint.joint.SpringDamper};f.prototype.fromArray=function(t,i,a,n){n=(n=a||0)||0,t&&this._position.fromArray(t,a),i&&this._rotation.fromQuat({x:i[n],y:i[n+1],z:i[n+2],w:i[n+3]})},c.prototype.toArray=function(t,i){var a=void 0!==t;if(a||(t=[]),t[i=i||0]=this.x,t[i+1]=this.y,t[i+2]=this.z,!a)return t},c.prototype.fromArray=function(t,i){return i=i||0,this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},c.prototype.set=function(t,i,a){return this.x=t,this.y=i,this.z=a,this},m.prototype.toArray=function(t,i){var a=void 0!==t;if(a||(t=[]),t[i=i||0]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,!a)return t},m.prototype.fromArray=function(t,i){return i=i||0,this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},m.prototype.set=function(t,i,a,n){return this.x=t,this.y=i,this.z=a,this.w=n,this};var V=function(){function t(){this.id=0,this.list=[],this.type="item"}var i=t.prototype;return i.reset=function(){for(var t=this.list.length;t--;)this.dispose(this.list[t]);this.id=0,this.list=[]},i.dispose=function(t){l.remove(t)},i.byName=function(t){return l.byName(t)},i.setName=function(t){void 0===t&&(t={});var i=void 0!==t.name?t.name:this.type+this.id++;return this.remove(i),i},i.addToWorld=function(t){l.add(t),this.list.push(t)},i.remove=function(t){var i=this.byName(t);if(i){var a=this.list.indexOf(i);-1!==a&&(this.list.splice(a,1),this.dispose(i))}},i.add=function(t){},i.set=function(t){},i.step=function(t,i){},t}(),w=function(t){function i(){var i;return(i=t.call(this)||this).type="body",i.v=new c,i.q=new m,i.sc=new x,i}a(i,t);var n=i.prototype;return n.reset=function(){t.prototype.reset.call(this)},n.step=function(t,i){for(var a,n,o=this.list.length;o--;)(a=this.list[o]).getPositionTo(this.v),a.getOrientationTo(this.q),t[n=i+8*o]=a.isSleeping()?1:0,this.v.toArray(t,n+1),this.q.toArray(t,n+4)},n.shape=function(t){void 0===t&&(t={});var i,a=this.sc;void 0!==t.density&&(a.density=t.density),void 0!==t.mass&&(a.density=t.mass),void 0!==t.friction&&(a.friction=t.friction),void 0!==t.restitution&&(a.restitution=t.restitution),void 0!==t.mask&&(a.collisionMask=t.mask),void 0!==t.group&&(a.collisionGroup=t.group),void 0!==t.callback&&(a.contactCallback=t.callback);var n,o,s,r=t.type||"box",e=t.size||[1,1,1];switch(r){case"plane":n=[new c(.5*e[0],0,.5*e[2]),new c(.5*e[0],0,.5*-e[2]),new c(.5*-e[0],0,.5*-e[2]),new c(.5*-e[0],0,.5*e[2])],(i=new M(n))._gjkMargin=t.margin||0,i._useGjkRayCast=t.ray||!1;break;case"box":i=new g(this.v.set(.5*e[0],.5*e[1],.5*e[2]));break;case"sphere":i=new X(e[0]);break;case"cone":i=new Z(e[0],.5*e[1]);break;case"cylinder":i=new Y(e[0],.5*e[1]);break;case"capsule":i=new z(e[0],.5*e[1]);break;case"convex":for(o=Math.floor(t.v.length/3),n=[];o--;)s=3*o,n.push(new c(t.v[s],t.v[s+1],t.v[s+2]));(i=new M(n))._gjkMargin=t.margin||0,i._useGjkRayCast=t.ray||!1}return a.geometry=i,a.position.fromArray(t.localPos||[0,0,0]),a.rotation.fromQuat(this.q.fromArray(t.localQuat||[0,0,0,1])),new d(a)},n.add=function(t){void 0===t&&(t={});var i=this.setName(t),a=new p;a.autoSleep=void 0===t.autoSleep||t.autoSleep,a.type="body"===this.type?t.kinematic?2:0:1;var n=new y(a);if("compound"!==t.type)n.addShape(this.shape(t));else for(var o,s=0;s<t.shapes.length;s++)o=t.shapes[s],void 0!==t.density&&(o.density=t.density),void 0!==t.friction&&(o.friction=t.friction),void 0!==t.restitution&&(o.restitution=t.restitution),void 0!==t.mask&&(o.collisionMask=t.mask),void 0!==t.group&&(o.collisionGroup=t.group),void 0!==t.callback&&(o.contactCallback=t.callback),o.pos&&(o.localPos=o.pos),o.quat&&(o.localQuat=o.quat),n.addShape(this.shape(o));n.name=i,n.type=this.type,this.set(t,n),this.addToWorld(n)},n.set=function(t,i){void 0===t&&(t={}),void 0===i&&(i=null),null===i&&(i=this.byName(t.name)),null!==i&&(t.pos&&i.setPosition(this.v.fromArray(t.pos)),t.quat&&i.setOrientation(this.q.fromArray(t.quat)),t.worldForce&&i.applyForce(this.v.fromArray(t.worldForce),this.v.fromArray(t.worldForce,3)),t.force&&i.applyForceToCenter(this.v.fromArray(t.force)),t.torque&&i.applyTorque(this.v.fromArray(t.torque)),t.impulse&&i.applyImpulse(this.v.fromArray(t.impulse),this.v.fromArray(t.impulse,3)),t.linearImpulse&&i.applyLinearImpulse(this.v.fromArray(t.linearImpulse)),t.angularImpulse&&i.applyAngularImpulse(this.v.fromArray(t.angularImpulse)),t.gravityScale&&i.setGravityScale(t.gravityScale),t.linearVelocity&&i.setLinearVelocity(this.v.fromArray(t.linearVelocity)),t.angularVelocity&&i.setLinearVelocity(this.v.fromArray(t.angularVelocity)),t.damping&&(i.setLinearDamping(t.damping[0]),i.setAngularDamping(t.damping[1])),t.reset&&(i.setLinearVelocity(this.v.set(0,0,0)),i.setAngularVelocity(this.v.set(0,0,0))),t.sleep&&i.sleep(),t.wakeUp&&i.wakeUp(),t.canSleep&&i.setAutoSleep(t.canSleep))},n.setShapes=function(t){void 0===t&&(t={});for(var i,a=b.getShapeList(),n=b.getNumShapes();n--;)i=a[n],void 0!==t.density&&i.setDensity(t.density),void 0!==t.friction&&i.setFriction(t.friction),void 0!==t.restitution&&i.setRestitution(t.restitution),void 0!==t.mask&&i.setCollisionMask(t.mask),void 0!==t.group&&i.setCollisionGroup(t.group),void 0!==t.callback&&i.setContactCallback(t.callback)},i}(V),L=function(t){function i(){var i;return(i=t.call(this)||this).type="solid",i}return a(i,t),i.prototype.step=function(t,i){},i}(w),k=function(t){function i(){var i;return(i=t.call(this)||this).type="joint",i.v=new c,i.q=new m,i.m=new v,i}a(i,t);var n=i.prototype;return n.step=function(t,i){for(var a,n,o=this.list.length;o--;)n=i+16*o,(a=this.list[o]).getAnchor1To(this.v),this.v.toArray(t,n),a.getAnchor2To(this.v),this.v.toArray(t,n+3),a.getBasis1To(this.m),this.q.fromMat3(this.m),this.q.toArray(t,n+6),a.getBasis1To(this.m),this.q.fromMat3(this.m),this.q.toArray(t,n+10)},n.add=function(t){void 0===t&&(t={});var i=this.setName(t),a=this.byName(t.b1),n=this.byName(t.b2),o=t.mode||"revolute";o=o.charAt(0).toUpperCase()+o.slice(1);var s=new I[o+"JointConfig"];switch(s.rigidBody1=a,s.rigidBody2=n,a&&n&&(t.worldAnchor&&(this.v.fromArray(t.worldAnchor),a.getLocalPointTo(this.v,s.localAnchor1),n.getLocalPointTo(this.v,s.localAnchor2)),t.worldAxis&&(this.v.fromArray(t.worldAxis),a.getLocalVectorTo(this.v,s.localAxis1),n.getLocalVectorTo(this.v,s.localAxis2))),t.pos1&&s.localAnchor1.fromArray(t.pos1||[0,0,0]),t.pos2&&s.localAnchor2.fromArray(t.pos2||[0,0,0]),s.localAxis1&&t.axis1&&s.localAxis1.fromArray(t.axis1),s.localAxis2&&t.axis2&&s.localAxis2.fromArray(t.axis2),o){case"Ragdoll":t.axis1&&s.localTwistAxis1.fromArray(t.axis1||[1,0,0]),t.axis2&&s.localTwistAxis2.fromArray(t.axis2||[1,0,0]),t.axis3&&s.localSwingAxis1.fromArray(t.axis3||[0,1,0]),t.twistSd&&this.spring(s.twistSpringDamper,t.twistSd),t.swingSd&&this.spring(s.swingSpringDamper,t.swingSd),t.twistLm&&this.limit(s.twistLimitMoto,t.twistLm),s.maxSwingAngle1=(void 0!==t.maxSwing1?t.maxSwing1:180)*h,s.maxSwingAngle2=(void 0!==t.maxSwing2?t.maxSwing2:180)*h;break;case"Universal":t.sd1&&this.spring(s.springDamper1,t.sd1),t.sd2&&this.spring(s.springDamper2,t.sd2),t.lm1&&this.limit(s.limitMotor1,t.lm1),t.lm2&&this.limit(s.limitMotor2,t.lm2);break;case"Prismatic":case"Revolute":t.sd&&this.spring(s.springDamper,t.sd),t.lm&&this.limit(s.limitMotor,t.lm,"Prismatic"===o),t.motor&&this.motor(s.limitMotor,t.motor,"Prismatic"===o);break;case"Cylindrical":case"Generic":t.rotSd&&this.spring(s.rotationalSpringDamper,t.rotSd),t.traSd&&this.spring(s.translationalSpringDamper,t.traSd),t.rotLm&&this.limit(s.rotationalLimitMotor,t.rotLm),t.traLm&&this.limit(s.translationalLimitMotor,t.traLm,!0);break;case"Spherical":t.sd&&this.spring(s.springDamper,t.sd)}var r=new I[o+"Joint"](s);r.name=i,r.type=this.type,r.mode=o,this.set(t,r),this.addToWorld(r)},n.spring=function(t,i){void 0===i&&(i=[0,0]),t.setSpring(i[0],i[1]),void 0!==i[2]&&t.setSymplecticEuler(!!i[2])},n.motor=function(t,i,a){void 0===i&&(i=[0,0]),void 0===a&&(a=!1);var n=a?1:h;t.setMotor(i[0]*n,i[1])},n.limit=function(t,i,a){void 0===i&&(i=[0,0]),void 0===a&&(a=!1);var n=a?1:h;t.setLimits(i[0]*n,i[1]*n)},n.set=function(t,i){void 0===t&&(t={}),void 0===i&&(i=null),null===i&&(i=this.byName(t.name)),null!==i&&(void 0!==t.collision&&i.setAllowCollision(t.collision),void 0!==t.breakForce&&i.setBreakForce(t.breakForce),void 0!==t.breakTorque&&i.setBreakTorque(t.breakTorque))},i}(V);self.onmessage=function(t){tt.message(t)};var A,B,P,S,T,C=!0,j=!1,R=new w,E=new L,q=new k,D="undefined"==typeof performance?Date:performance,N={tmp:0,n:0,dt:0,fps:0},F={fps:0},G=1/60,J=10,W=2,O=0,U=0,H=!1,Q=null,K=null,$=null,tt=function(){function t(){}return t.test=function(){},t.message=function(i){var a=i.data;a.Ar&&(A=a.Ar),a.flow&&(_.flow=a.flow),t[a.m](a.o)},t.post=function(t,i){T?self.postMessage(t,i):S({data:t})},t.init=function(i){void 0===i&&(i={}),void 0!==i.isTimeout&&(C=i.isTimeout),T=!0,j=i.isBuffer||!1,B=i.ArPos,P=i.ArMax,void 0!==i.fps&&(G=1/i.fps),void 0!==i.substep&&(J=i.substep),i.returnMessage&&(S=i.returnMessage,T=!1,j=!1),$=new c(0,-9.80665,0),t.post({m:"ready",o:{}})},t.set=function(i){void 0===i&&(i={}),G=1/(i.fps||60),J=i.substep||1,W=i.broadphase||2,$.fromArray(i.gravity||[0,-9.80665,0]),null===_.world?t.start():_.world.setGravity($)},t.start=function(){if(null===_.world&&(A=new Float32Array(P),_.world=new u(W,$)),H=!1,C)K=setTimeout(t.step,0);else{if(Q)return;O=0,Q=setInterval(t.step,1e3*G)}},t.add=function(t){switch(void 0===t&&(t={}),t.type||"box"){case"joint":q.add(t);break;default:t.density||t.kinematic?R.add(t):E.add(t)}},t.poststep=function(){if(!H)if(C){var i=D.now();if(H)O=0;else{O=2;var a=1e3*G-(i-U);a<0&&(a=0),K=setTimeout(t.step,a)}}else O=2},t.step=function(){if(!H&&(C||!j||3!==O)){O=3,U=D.now();for(var i=J;i--;)_.world.step(G/J);t.stepItems(),U-1e3>N.tmp&&(N.tmp=U,F.fps=N.n,N.n=0),N.n++,j?t.post({m:"step",Ar:A,stat:F},[A.buffer]):t.post({m:"step",Ar:A,stat:F})}},t.stepItems=function(){R.step(A,B.body),q.step(A,B.joint)},t.byName=function(t){return l.byName(t)},t.reset=function(){t.stop(),R.reset(),E.reset(),q.reset(),_.world=null},t.stop=function(){H=!0,K&&clearTimeout(K),Q&&clearInterval(Q),Q=null,K=null},t.pause=function(){H?this.start():this.stop()},t}();t.engine=tt,Object.defineProperty(t,"__esModule",{value:!0})}));
