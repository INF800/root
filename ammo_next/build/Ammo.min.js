!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MM={})}(this,(function(t){"use strict";var e=function(t){var e,r=Object.prototype,o=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var n=e&&e.prototype instanceof y?e:y,i=Object.create(n.prototype),s=new L(o||[]);return i._invoke=function(t,e,r){var o=m;return function(n,i){if(o===h)throw new Error("Generator is already running");if(o===p){if("throw"===n)throw i;return O()}for(r.method=n,r.arg=i;;){var s=r.delegate;if(s){var a=T(s,r);if(a){if(a===d)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===m)throw o=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=h;var c=u(t,e,r);if("normal"===c.type){if(o=r.done?p:f,c.arg===d)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=p,r.method="throw",r.arg=c.arg)}}}(t,r,s),i}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var m="suspendedStart",f="suspendedYield",h="executing",p="completed",d={};function y(){}function v(){}function g(){}var b={};b[i]=function(){return this};var w=Object.getPrototypeOf,A=w&&w(w(j([])));A&&A!==r&&o.call(A,i)&&(b=A);var x=g.prototype=y.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(n,i,s,a){var c=u(t[n],t,i);if("throw"!==c.type){var l=c.arg,m=l.value;return m&&"object"==typeof m&&o.call(m,"__await")?e.resolve(m.__await).then((function(t){r("next",t,s,a)}),(function(t){r("throw",t,s,a)})):e.resolve(m).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,a)}))}a(c.arg)}var n;this._invoke=function(t,o){function i(){return new e((function(e,n){r(t,o,e,n)}))}return n=n?n.then(i,i):i()}}function T(t,r){var o=t.iterator[r.method];if(o===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method))return d;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=u(o,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,d;var i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,d):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function j(t){if(t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,s=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}return{next:O}}function O(){return{value:e,done:!0}}return v.prototype=x.constructor=g,g.constructor=v,v.displayName=c(g,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c(t,a,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},_(k.prototype),k.prototype[s]=function(){return this},t.AsyncIterator=k,t.async=function(e,r,o,n,i){void 0===i&&(i=Promise);var s=new k(l(e,r,o,n),i);return t.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},_(x),c(x,a,"Generator"),x[i]=function(){return this},x.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var o=e.pop();if(o in t)return r.value=o,r.done=!1,r}return r.done=!0,r}},t.values=j,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(o,n){return a.type="throw",a.arg=t,r.next=o,n&&(r.method="next",r.arg=e),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var c=o.call(s,"catchLoc"),l=o.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=t,s.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var o=r.completion;if("throw"===o.type){var n=o.arg;C(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,o){return this.delegate={iterator:j(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=e),d}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}var r=new Map,o={world:null,flow:{tmp:[],key:[]},reflow:{ray:[],stat:{fps:0}}},i=function(){function t(){}return t.byName=function(t){return r.has(t)?r.get(t):null},t.add=function(t,e,n){if("ray"!==t.type)switch(t.type){case"joint":o.world.addConstraint(t,e);break;case"solid":o.world.addCollisionObject(t,e,n);break;default:o.world.addRigidBody(t,e,n)}r.set(t.name,t)},t.remove=function(t){if("ray"!==t.type){switch(t.type){case"joint":o.world.removeConstraint(t),Ammo.destroy(t.formA),Ammo.destroy(t.formB);break;case"solid":o.world.removeCollisionObject(t);break;default:o.world.removeRigidBody(t)}Ammo.destroy(t)}r.delete(t.name)},t.stats=function(){},t.extends=function(){Ammo.btVector3.prototype.set=function(t,e,r){return this.setValue(t,e,r),this},Ammo.btVector3.prototype.toArray=function(t,e){var r=void 0!==t;if(r||(t=[]),t[e=e||0]=this.x(),t[e+1]=this.y(),t[e+2]=this.z(),!r)return t},Ammo.btVector3.prototype.fromArray=function(t,e){return e=e||0,this.setValue(t[e],t[e+1],t[e+2]),this},Ammo.btVector3.prototype.copy=function(t){return this.setValue(t.x(),t.y(),t.z()),this},Ammo.btVector3.prototype.applyMatrix3=function(t){var e=this.x(),r=this.y(),o=this.z(),n=[];return t.getRow(0).toArray(n,0),t.getRow(1).toArray(n,3),t.getRow(2).toArray(n,6),this.setValue(n[0]*e+n[3]*r+n[6]*o,n[1]*e+n[4]*r+n[7]*o,n[2]*e+n[5]*r+n[8]*o),this},Ammo.btQuaternion.prototype.set=function(t,e,r,o){return this.setValue(t,e,r,o),this},Ammo.btQuaternion.prototype.toArray=function(t,e){var r=void 0!==t;if(r||(t=[]),t[e=e||0]=this.x(),t[e+1]=this.y(),t[e+2]=this.z(),t[e+3]=this.w(),!r)return t},Ammo.btQuaternion.prototype.fromArray=function(t,e){return e=e||0,this.setValue(t[e],t[e+1],t[e+2],t[e+3]),this},Ammo.btQuaternion.prototype.fromAxisAngle=function(t,e){var r=.5*e,o=Math.sin(r);return this.setValue(t[0]*o,t[1]*o,t[2]*o,Math.cos(r)),this},Ammo.btQuaternion.prototype.fromAxis=function(t){var e=t.toArray();if(e[2]>.99999)this.setValue(0,0,0,1);else if(e[2]<-.99999)this.setValue(1,0,0,0);else{var r=[e[1],e[0],0],o=Math.acos(e[2]);this.fromAxisAngle(r,o)}return this},Ammo.btTransform.prototype.set=function(t,e){return this.setOrigin(t),this.setRotation(e),this},Ammo.btTransform.prototype.identity=function(){return this.setIdentity(),this},Ammo.btTransform.prototype.fromArray=function(t,e,r,o){var n=this.getOrigin();n.fromArray(t||[0,0,0],r||0),this.setOrigin(n);var i=this.getRotation();return i.fromArray(e||[0,0,0,1],o||0),this.setRotation(i),this},Ammo.btTransform.prototype.toArray=function(t,e){e=e||0,this.getOrigin().toArray(t,e),this.getRotation().toArray(t,e+3)},Ammo.btTransform.prototype.copy=function(t){return this.op_set(t),this},Ammo.btTransform.prototype.rotationFromAxis=function(t){var e=this.getRotation();return e.fromAxis(t),this.setRotation(e),this}},t}();function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,a(t,e)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var c=function(){function t(){this.id=0,this.list=[],this.type="item"}var e=t.prototype;return e.reset=function(){for(var t=this.list.length;t--;)this.dispose(this.list[t]);this.id=0,this.list=[]},e.dispose=function(t){i.remove(t)},e.byName=function(t){return i.byName(t)},e.setName=function(t){void 0===t&&(t={});var e=void 0!==t.name?t.name:this.type+this.id++;return this.remove(e),e},e.addToWorld=function(t,e,r){i.add(t,e,r),this.list.push(t)},e.remove=function(t){var e=this.byName(t);e&&this.clear(e)},e.clear=function(t){var e=this.list.indexOf(t);-1!==e&&this.list.splice(e,1),this.dispose(t)},e.add=function(t){},e.set=function(t){},e.step=function(t,e){},t}(),l=function(t){function e(){var e;return(e=t.call(this)||this).type="body",e.v=new Ammo.btVector3,e.q=new Ammo.btQuaternion,e.t=new Ammo.btTransform,e}s(e,t);var r=e.prototype;return r.reset=function(){t.prototype.reset.call(this)},r.step=function(t,e){for(var r,o,n=this.list.length;n--;)r=this.list[n],t[o=e+8*n]=9.8*r.getLinearVelocity().length(),r.getMotionState().getWorldTransform(this.t),this.t.toArray(t,o+1)},r.shape=function(t){var e;void 0===t&&(t={});var r,o,n=t.type||"box",i=t.size||[1,1,1];switch(n){case"plane":e=new Ammo.btStaticPlaneShape(this.v.fromArray(t.dir||[0,1,0]),0);break;case"box":e=new Ammo.btBoxShape(this.v.set(.5*i[0],.5*i[1],.5*i[2]));break;case"sphere":e=new Ammo.btSphereShape(i[0]);break;case"cone":e=new Ammo.btConeShape(.5*i[0],.5*i[1]);break;case"cylinder":e=new Ammo.btCylinderShape(this.v.set(i[0],.5*i[1],0));break;case"capsule":e=new Ammo.btCapsuleShape(i[0],i[1]);break;case"convex":for(e=new Ammo.btConvexHullShape,r=Math.floor(t.v.length/3);r--;)o=3*r,e.addPoint(this.v.fromArray(t.v,o));t.optimized&&(e.recalcLocalAabb(),e.initializePolyhedralFeatures())}return void 0!==t.margin&&void 0!==t.setMargin&&"sphere"!==t.type&&"capsule"!==t.type&&t.setMargin(t.margin),e},r.add=function(t){void 0===t&&(t={});var e=this.setName(t),r=void 0!==t.flag?t.flag:"solid"===this.type?1:0,o=void 0!==t.group?t.group:"solid"===this.type?2:1,n=void 0!==t.mask?t.mask:-1,i=null;switch(t.type){case"null":n=0,i=this.shape({type:"sphere",size:[.01]});break;case"compound":var s;i=new Ammo.btCompoundShape;for(var a=0;a<t.shapes.length;a++)s=t.shapes[a],this.t.fromArray(s.pos,s.quat),i.addChildShape(this.t,this.shape(s));break;default:i=this.shape(t)}this.t.fromArray(t.pos,t.quat),this.v.set(0,0,0),t.density&&i.calculateLocalInertia(t.density,this.v);var c=new Ammo.btDefaultMotionState(this.t),l=new Ammo.btRigidBodyConstructionInfo(t.density||0,c,i,this.v),u=new Ammo.btRigidBody(l);u.setCollisionFlags(r),Ammo.destroy(l),u.name=e,u.type=this.type,u.isKinematic=!1,this.set(t,u),this.addToWorld(u,o,n)},r.set=function(t,e){void 0===t&&(t={}),void 0===e&&(e=null),null===e&&(e=this.byName(t.name)),null!==e&&(void 0!==t.friction&&e.setFriction(t.friction),void 0!==t.restitution&&e.setRestitution(t.restitution),void 0!==t.rollingFriction&&e.setRollingFriction(t.rollingFriction),t.pos&&(this.t.fromArray(t.pos,t.quat),e.isKinematic?e.getMotionState().setWorldTransform(this.t):e.setWorldTransform(this.t)),t.reset&&(e.setLinearVelocity(this.v.set(0,0,0)),e.setAngularVelocity(this.v.set(0,0,0))))},r.setShapes=function(t){},e}(c),u=function(t){function e(){var e;return(e=t.call(this)||this).type="solid",e}return s(e,t),e.prototype.step=function(t,e){},e}(l),m=function(t){function e(){var e;return(e=t.call(this)||this).type="joint",e.t=new Ammo.btTransform,e.t1=new Ammo.btTransform,e.t2=new Ammo.btTransform,e.v1=new Ammo.btVector3,e.v2=new Ammo.btVector3,e.p1=new Ammo.btVector3,e.p2=new Ammo.btVector3,e.q1=new Ammo.btQuaternion,e.q2=new Ammo.btQuaternion,e}s(e,t);var r=e.prototype;return r.step=function(t,e){for(var r,o,n=this.list.length;n--;)r=this.list[n],o=e+16*n,this.t.copy(r.getRigidBodyA().getWorldTransform()).op_mul(r.formA).toArray(t,o),this.t.copy(r.getRigidBodyB().getWorldTransform()).op_mul(r.formB).toArray(t,o+7)},r.add=function(t){void 0===t&&(t={}),this.v;var e=this.setName(t),r=this.byName(t.b1),o=this.byName(t.b2),i=t.mode||"revolute",s=this.v1.fromArray(t.pos1||[0,0,0]),a=this.v2.fromArray(t.pos2||[0,0,0]),c=this.q1.fromArray(t.quat1||[0,0,0,1]),l=this.q2.fromArray(t.quat2||[0,0,0,1]),u=this.p1.fromArray(t.axis1||[1,0,0]),m=this.p2.fromArray(t.axis2||[1,0,0]);t.quat1||c.fromAxis(u),t.quat2||l.fromAxis(m),this.t1.identity(),this.t2.identity();var f=t.useA||!1;(t.worldAnchor||t.worldAxis)&&(r&&(r.activate(),r.getMotionState().getWorldTransform(this.t1)),o&&(o.activate(),o.getMotionState().getWorldTransform(this.t2))),t.worldAnchor&&(s=this.v1.fromArray(t.worldAnchor).op_sub(this.t1.getOrigin()),a=this.v2.fromArray(t.worldAnchor).op_sub(this.t2.getOrigin()),s.applyMatrix3(this.t1.getBasis()),a.applyMatrix3(this.t2.getBasis())),t.worldAxis&&(u=this.p1.fromArray(t.worldAxis),m=this.p2.fromArray(t.worldAxis),u.applyMatrix3(this.t1.getBasis()),m.applyMatrix3(this.t2.getBasis()),c.fromAxis(u),l.fromAxis(m));var h,p=(new Ammo.btTransform).set(s,c),d=(new Ammo.btTransform).set(a,l);switch(i){case"joint_p2p":case"spherical":h=new Ammo.btPoint2PointConstraint(r,o,s,a),t.strength&&h.get_m_setting().set_m_tau(t.strength),t.damping&&h.get_m_setting().set_m_damping(t.damping),t.impulse&&h.get_m_setting().set_m_impulseClamp(t.impulse);break;case"hinge":case"revolute":h=new Ammo.btHingeConstraint(r,o,p,d,f);break;case"slider":case"prismatic":h=new Ammo.btSliderConstraint(r,o,p,d,f);break;case"conetwist":case"ragdoll":h=new Ammo.btConeTwistConstraint(r,o,p,d);break;case"dof":h=new Ammo.btGeneric6DofConstraint(r,o,p,d,f);break;case"sdof":h=new Ammo.btGeneric6DofSpringConstraint(r,o,p,d,f);break;case"fixe":n=7,h=new Ammo.btFixedConstraint(r,o,p,d);break;case"gear":h=new Ammo.btGearConstraint(r,o,u,m,t.ratio||1);break;case"universal":h=new Ammo.btUniversalConstraint(r,o,p,u,m)}h.name=e,h.mode=i,h.type=this.type,h.formA=p,h.formB=d,this.set(t,h);var y=void 0!==t.collision&&t.collision;this.addToWorld(h,!y)},r.spring=function(t,e){},r.motor=function(t,e,r){},r.limit=function(t,e,r){},r.set=function(t,e){void 0===t&&(t={}),void 0===e&&(e=null),null===e&&(e=this.byName(t.name))},e}(c),f=function(t){function e(){var e;return(e=t.call(this)||this).type="ray",e.callback=new Ammo.ClosestRayResultCallback,e}s(e,t);var r=e.prototype;return r.step=function(t,e){o.reflow.ray=[];for(var r,n,i,s=this.list.length,a=this.callback;s--;)n=e+8*s,r=this.list[s],t[n]=0,a.set_m_collisionObject(null),a.get_m_rayFromWorld().fromArray(t,n+1),a.get_m_rayToWorld().fromArray(t,n+4),a.set_m_collisionFilterGroup(r.group),a.set_m_collisionFilterMask(r.mask),a.set_m_closestHitFraction(r.precision),o.world.rayTest(a.get_m_rayFromWorld(),a.get_m_rayToWorld(),a),a.hasHit()&&(t[n]=1,a.get_m_hitPointWorld().toArray(t,n+1),a.get_m_hitNormalWorld().toArray(t,n+4),void 0===(i=Ammo.castObject(a.get_m_collisionObject(),Ammo.btRigidBody).name)&&(i=Ammo.castObject(ray.get_m_collisionObject(),Ammo.btSoftBody).name),o.reflow.ray[s]=i)},r.add=function(t){void 0===t&&(t={}),this.setName(t);var e=new h(t);this.addToWorld(e)},r.set=function(t,e){},e}(c),h=function(t){void 0===t&&(t={}),this.type="ray",this.name=t.name,this.precision=t.precision||1,this.group=void 0!==t.group||1,this.mask=void 0!==t.mask||-1};self.onmessage=function(t){I.message(t)};var p,d,y,v,g,b,w,A,x,_,k,T,S,C,L=!0,j=!0,O=!1,M="undefined"==typeof performance?Date:performance,N={tmp:0,n:0,dt:0,fps:0},V=1/60,R=10,B=2,E=0,F=0,W=!1,P=null,q=null,G=null,I=function(){function t(){}return t.test=function(){},t.message=function(e){var r=e.data;r.Ar&&(p=r.Ar),r.flow&&(o.flow=r.flow),t[r.m](r.o)},t.post=function(t,e){g?self.postMessage(t,e):v({data:t})},t.init=function(e){void 0===e&&(e={}),void 0!==e.isTimeout&&(L=e.isTimeout),g=!0,O=e.isBuffer||!1,d=e.ArPos,y=e.ArMax,void 0!==e.fps&&(V=1/e.fps),void 0!==e.substep&&(R=e.substep),e.returnMessage&&(v=e.returnMessage,g=!1,O=!1),e.blob&&importScripts(e.blob),Ammo().then((function(e){i.extends(),G=new e.btVector3(0,-9.81,0),b=new l,w=new u,A=new m,x=new f,t.post({m:"ready",o:{}})}))},t.set=function(e){(void 0===e&&(e={}),V=1/(e.fps||60),R=e.substep||1,void 0===e.fixe||e.fixe,B=e.broadphase||2,j=void 0===e.soft||e.soft,G.fromArray(e.gravity||[0,-9.80665,0]),null===o.world&&t.start(),o.world.setGravity(G),j)&&o.world.getWorldInfo().set_m_gravity(G);void 0!==e.penetration&&o.world.getDispatchInfo().set_m_allowedCcdPenetration(e.penetration)},t.start=function(){if(null===o.world){switch(p=new Float32Array(y),_=new Ammo.btSequentialImpulseConstraintSolver,k=j?new Ammo.btDefaultSoftBodySolver:null,T=j?new Ammo.btSoftBodyRigidBodyCollisionConfiguration:new Ammo.btDefaultCollisionConfiguration,S=new Ammo.btCollisionDispatcher(T),B){case 1:var e=1e3;C=new Ammo.btAxisSweep3(new Ammo.btVector3(-e,-e,-e),new Ammo.btVector3(e,e,e),4096);break;case 2:C=new Ammo.btDbvtBroadphase}o.world=j?new Ammo.btSoftRigidDynamicsWorld(S,C,_,T,k):new Ammo.btDiscreteDynamicsWorld(S,C,_,T)}if(W=!1,L)q=setTimeout(t.step,0);else{if(P)return;E=0,P=setInterval(t.step,1e3*V)}},t.add=function(t){switch(void 0===t&&(t={}),t.type||"box"){case"ray":x.add(t);break;case"joint":A.add(t);break;default:t.density||t.kinematic?b.add(t):w.add(t)}},t.remove=function(t){void 0===t&&(t={});var e=this.byName(t.name);if(null!==e)switch(e.type){case"ray":e=x.clear(e);break;case"joint":e=A.clear(e);break;case"solid":e=w.clear(e);break;case"body":e=b.clear(e)}},t.change=function(t){void 0===t&&(t={});var e=this.byName(t.name);if(null!==e)switch(e.type){case"ray":e=x.set(t,e);break;case"joint":e=A.set(t,e);break;case"solid":e=w.set(t,e);break;case"body":e=b.set(t,e)}},t.poststep=function(){if(!W){for(var e=o.flow.tmp.length;e--;)this.change(o.flow.tmp[e]);if(o.flow.tmp=[],o.flow.key=[],L){var r=M.now();if(W)E=0;else{E=2;var n=1e3*V-(r-F);n<0&&(n=0),q=setTimeout(t.step,n)}}else E=2}},t.step=function(){if(!W&&(L||!O||3!==E)){E=3,F=M.now();for(var e=R;e--;)o.world.stepSimulation(V/R,0);t.stepItems(),F-1e3>N.tmp&&(N.tmp=F,o.reflow.stat.fps=N.n,N.n=0),N.n++,O?t.post({m:"step",reflow:o.reflow,Ar:p},[p.buffer]):t.post({m:"step",reflow:o.reflow,Ar:p})}},t.stepItems=function(){b.step(p,d.body),A.step(p,d.joint),x.step(p,d.ray)},t.byName=function(t){return i.byName(t)},t.reset=function(){t.stop(),b.reset(),w.reset(),A.reset(),null!==o.world&&(Ammo.destroy(o.world),Ammo.destroy(_),j&&Ammo.destroy(k),Ammo.destroy(T),Ammo.destroy(S),Ammo.destroy(C),o.world=null)},t.stop=function(){W=!0,q&&clearTimeout(q),P&&clearInterval(P),P=null,q=null},t.pause=function(){W?this.start():this.stop()},t}();t.engine=I,Object.defineProperty(t,"__esModule",{value:!0})}));
